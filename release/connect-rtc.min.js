!function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return e(b[g][1][a]||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":17}],2:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":18}],3:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":19}],4:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":20}],5:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":21}],6:[function(a,b,c){b.exports={default:a("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":22}],7:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":23}],8:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":24}],9:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../core-js/promise"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(a){return function(){var b=a.apply(this,arguments);return new e.default(function(a,c){function d(f,g){try{var h=b[f](g),i=h.value}catch(a){return void c(a)}if(!h.done)return e.default.resolve(i).then(function(a){d("next",a)},function(a){d("throw",a)});a(i)}return d("next")})}}},{"../core-js/promise":6}],10:[function(a,b,c){"use strict";c.__esModule=!0,c.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}},{}],11:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../core-js/object/define-property"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,e.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()},{"../core-js/object/define-property":2}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/object/get-prototype-of"),f=d(e),g=a("../core-js/object/get-own-property-descriptor"),h=d(g);c.default=function a(b,c,d){null===b&&(b=Function.prototype);var e=(0,h.default)(b,c);if(void 0===e){var g=(0,f.default)(b);return null===g?void 0:a(g,c,d)}if("value"in e)return e.value;var i=e.get;if(void 0!==i)return i.call(d)}},{"../core-js/object/get-own-property-descriptor":3,"../core-js/object/get-prototype-of":4}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/object/set-prototype-of"),f=d(e),g=a("../core-js/object/create"),h=d(g),i=a("../helpers/typeof"),j=d(i);c.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":(0,j.default)(b)));a.prototype=(0,h.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(f.default?(0,f.default)(a,b):a.__proto__=b)}},{"../core-js/object/create":1,"../core-js/object/set-prototype-of":5,"../helpers/typeof":15}],14:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../helpers/typeof"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":(0,e.default)(b))&&"function"!=typeof b?a:b}},{"../helpers/typeof":15}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/symbol/iterator"),f=d(e),g=a("../core-js/symbol"),h=d(g),i="function"==typeof h.default&&"symbol"==typeof f.default?function(a){return typeof a}:function(a){return a&&"function"==typeof h.default&&a.constructor===h.default&&a!==h.default.prototype?"symbol":typeof a};c.default="function"==typeof h.default&&"symbol"===i(f.default)?function(a){return void 0===a?"undefined":i(a)}:function(a){return a&&"function"==typeof h.default&&a.constructor===h.default&&a!==h.default.prototype?"symbol":void 0===a?"undefined":i(a)}},{"../core-js/symbol":7,"../core-js/symbol/iterator":8}],16:[function(a,b,c){b.exports=a("regenerator-runtime")},{"regenerator-runtime":114}],17:[function(a,b,c){a("../../modules/es6.object.create");var d=a("../../modules/_core").Object;b.exports=function(a,b){return d.create(a,b)}},{"../../modules/_core":32,"../../modules/es6.object.create":100}],18:[function(a,b,c){a("../../modules/es6.object.define-property");var d=a("../../modules/_core").Object;b.exports=function(a,b,c){return d.defineProperty(a,b,c)}},{"../../modules/_core":32,"../../modules/es6.object.define-property":101}],19:[function(a,b,c){a("../../modules/es6.object.get-own-property-descriptor");var d=a("../../modules/_core").Object;b.exports=function(a,b){return d.getOwnPropertyDescriptor(a,b)}},{"../../modules/_core":32,"../../modules/es6.object.get-own-property-descriptor":102}],20:[function(a,b,c){a("../../modules/es6.object.get-prototype-of"),b.exports=a("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":32,"../../modules/es6.object.get-prototype-of":103}],21:[function(a,b,c){a("../../modules/es6.object.set-prototype-of"),b.exports=a("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":32,"../../modules/es6.object.set-prototype-of":104}],22:[function(a,b,c){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.promise"),a("../modules/es7.promise.finally"),a("../modules/es7.promise.try"),b.exports=a("../modules/_core").Promise},{"../modules/_core":32,"../modules/es6.object.to-string":105,"../modules/es6.promise":106,"../modules/es6.string.iterator":107,"../modules/es7.promise.finally":109,"../modules/es7.promise.try":110,"../modules/web.dom.iterable":113}],23:[function(a,b,c){a("../../modules/es6.symbol"),a("../../modules/es6.object.to-string"),a("../../modules/es7.symbol.async-iterator"),a("../../modules/es7.symbol.observable"),b.exports=a("../../modules/_core").Symbol},{"../../modules/_core":32,"../../modules/es6.object.to-string":105,"../../modules/es6.symbol":108,"../../modules/es7.symbol.async-iterator":111,"../../modules/es7.symbol.observable":112}],24:[function(a,b,c){a("../../modules/es6.string.iterator"),a("../../modules/web.dom.iterable"),b.exports=a("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":96,"../../modules/es6.string.iterator":107,"../../modules/web.dom.iterable":113}],25:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],26:[function(a,b,c){b.exports=function(){}},{}],27:[function(a,b,c){b.exports=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a}},{}],28:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":51}],29:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_to-length"),f=a("./_to-absolute-index");b.exports=function(a){return function(b,c,g){var h,i=d(b),j=e(i.length),k=f(g,j);if(a&&c!=c){for(;j>k;)if((h=i[k++])!=h)return!0}else for(;j>k;k++)if((a||k in i)&&i[k]===c)return a||k||0;return!a&&-1}}},{"./_to-absolute-index":87,"./_to-iobject":89,"./_to-length":90}],30:[function(a,b,c){var d=a("./_cof"),e=a("./_wks")("toStringTag"),f="Arguments"==d(function(){return arguments}()),g=function(a,b){try{return a[b]}catch(a){}};b.exports=function(a){var b,c,h;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=g(b=Object(a),e))?c:f?d(b):"Object"==(h=d(b))&&"function"==typeof b.callee?"Arguments":h}},{"./_cof":31,"./_wks":97}],31:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],32:[function(a,b,c){var d=b.exports={version:"2.6.9"};"number"==typeof __e&&(__e=d)},{}],33:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":25}],34:[function(a,b,c){b.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}},{}],35:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":40}],36:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":42,"./_is-object":51}],37:[function(a,b,c){b.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],38:[function(a,b,c){var d=a("./_object-keys"),e=a("./_object-gops"),f=a("./_object-pie");b.exports=function(a){var b=d(a),c=e.f;if(c)for(var g,h=c(a),i=f.f,j=0;h.length>j;)i.call(a,g=h[j++])&&b.push(g);return b}},{"./_object-gops":68,"./_object-keys":71,"./_object-pie":72}],39:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h=a("./_has"),i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s.prototype,u=n?d:o?d[b]:(d[b]||{}).prototype;n&&(c=b);for(j in c)(k=!m&&u&&void 0!==u[j])&&h(s,j)||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":32,"./_ctx":33,"./_global":42,"./_has":43,"./_hide":44}],40:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(a){return!0}}},{}],41:[function(a,b,c){var d=a("./_ctx"),e=a("./_iter-call"),f=a("./_is-array-iter"),g=a("./_an-object"),h=a("./_to-length"),i=a("./core.get-iterator-method"),j={},k={},c=b.exports=function(a,b,c,l,m){var n,o,p,q,r=m?function(){return a}:i(a),s=d(c,l,b?2:1),t=0;if("function"!=typeof r)throw TypeError(a+" is not iterable!");if(f(r)){for(n=h(a.length);n>t;t++)if((q=b?s(g(o=a[t])[0],o[1]):s(a[t]))===j||q===k)return q}else for(p=r.call(a);!(o=p.next()).done;)if((q=e(p,s,o.value,b))===j||q===k)return q};c.BREAK=j,c.RETURN=k},{"./_an-object":28,"./_ctx":33,"./_is-array-iter":49,"./_iter-call":52,"./_to-length":90,"./core.get-iterator-method":98}],42:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],43:[function(a,b,c){var d={}.hasOwnProperty;b.exports=function(a,b){return d.call(a,b)}},{}],44:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":35,"./_object-dp":63,"./_property-desc":76}],45:[function(a,b,c){var d=a("./_global").document;b.exports=d&&d.documentElement},{"./_global":42}],46:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":35,"./_dom-create":36,"./_fails":40}],47:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],48:[function(a,b,c){var d=a("./_cof");b.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==d(a)?a.split(""):Object(a)}},{"./_cof":31}],49:[function(a,b,c){var d=a("./_iterators"),e=a("./_wks")("iterator"),f=Array.prototype;b.exports=function(a){return void 0!==a&&(d.Array===a||f[e]===a)}},{"./_iterators":57,"./_wks":97}],50:[function(a,b,c){var d=a("./_cof");b.exports=Array.isArray||function(a){return"Array"==d(a)}},{"./_cof":31}],51:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],52:[function(a,b,c){var d=a("./_an-object");b.exports=function(a,b,c,e){try{return e?b(d(c)[0],c[1]):b(c)}catch(b){var f=a.return;throw void 0!==f&&d(f.call(a)),b}}},{"./_an-object":28}],53:[function(a,b,c){"use strict";var d=a("./_object-create"),e=a("./_property-desc"),f=a("./_set-to-string-tag"),g={};a("./_hide")(g,a("./_wks")("iterator"),function(){return this}),b.exports=function(a,b,c){a.prototype=d(g,{next:e(1,c)}),f(a,b+" Iterator")}},{"./_hide":44,"./_object-create":62,"./_property-desc":76,"./_set-to-string-tag":81,"./_wks":97}],54:[function(a,b,c){"use strict";var d=a("./_library"),e=a("./_export"),f=a("./_redefine"),g=a("./_hide"),h=a("./_iterators"),i=a("./_iter-create"),j=a("./_set-to-string-tag"),k=a("./_object-gpo"),l=a("./_wks")("iterator"),m=!([].keys&&"next"in[].keys()),n=function(){return this};b.exports=function(a,b,c,o,p,q,r){i(c,b,o);var s,t,u,v=function(a){if(!m&&a in z)return z[a];switch(a){case"keys":case"values":return function(){return new c(this,a)}}return function(){return new c(this,a)}},w=b+" Iterator",x="values"==p,y=!1,z=a.prototype,A=z[l]||z["@@iterator"]||p&&z[p],B=A||v(p),C=p?x?v("entries"):B:void 0,D="Array"==b?z.entries||A:A;if(D&&(u=k(D.call(new a)))!==Object.prototype&&u.next&&(j(u,w,!0),d||"function"==typeof u[l]||g(u,l,n)),x&&A&&"values"!==A.name&&(y=!0,B=function(){return A.call(this)}),d&&!r||!m&&!y&&z[l]||g(z,l,B),h[b]=B,h[w]=n,p)if(s={values:x?B:v("values"),keys:q?B:v("keys"),entries:C},r)for(t in s)t in z||f(z,t,s[t]);else e(e.P+e.F*(m||y),b,s);return s}},{"./_export":39,"./_hide":44,"./_iter-create":53,"./_iterators":57,"./_library":58,"./_object-gpo":69,"./_redefine":78,"./_set-to-string-tag":81,"./_wks":97}],55:[function(a,b,c){var d=a("./_wks")("iterator"),e=!1;try{var f=[7][d]();f.return=function(){e=!0},Array.from(f,function(){throw 2})}catch(a){}b.exports=function(a,b){if(!b&&!e)return!1;var c=!1;try{var f=[7],g=f[d]();g.next=function(){return{done:c=!0}},f[d]=function(){return g},a(f)}catch(a){}return c}},{"./_wks":97}],56:[function(a,b,c){b.exports=function(a,b){return{value:b,done:!!a}}},{}],57:[function(a,b,c){b.exports={}},{}],58:[function(a,b,c){b.exports=!0},{}],59:[function(a,b,c){var d=a("./_uid")("meta"),e=a("./_is-object"),f=a("./_has"),g=a("./_object-dp").f,h=0,i=Object.isExtensible||function(){return!0},j=!a("./_fails")(function(){return i(Object.preventExtensions({}))}),k=function(a){g(a,d,{value:{i:"O"+ ++h,w:{}}})},l=function(a,b){if(!e(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!f(a,d)){if(!i(a))return"F";if(!b)return"E";k(a)}return a[d].i},m=function(a,b){if(!f(a,d)){if(!i(a))return!0;if(!b)return!1;k(a)}return a[d].w},n=function(a){return j&&o.NEED&&i(a)&&!f(a,d)&&k(a),a},o=b.exports={KEY:d,NEED:!1,fastKey:l,getWeak:m,onFreeze:n}},{"./_fails":40,"./_has":43,"./_is-object":51,"./_object-dp":63,"./_uid":93}],60:[function(a,b,c){var d=a("./_global"),e=a("./_task").set,f=d.MutationObserver||d.WebKitMutationObserver,g=d.process,h=d.Promise,i="process"==a("./_cof")(g);b.exports=function(){var a,b,c,j=function(){var d,e;for(i&&(d=g.domain)&&d.exit();a;){e=a.fn,a=a.next;try{e()}catch(d){throw a?c():b=void 0,d}}b=void 0,d&&d.enter()};if(i)c=function(){g.nextTick(j)};else if(!f||d.navigator&&d.navigator.standalone)if(h&&h.resolve){var k=h.resolve(void 0);c=function(){k.then(j)}}else c=function(){e.call(d,j)};else{var l=!0,m=document.createTextNode("");new f(j).observe(m,{characterData:!0}),c=function(){m.data=l=!l}}return function(d){var e={fn:d,next:void 0};b&&(b.next=e),a||(a=e,c()),b=e}}},{"./_cof":31,"./_global":42,"./_task":86}],61:[function(a,b,c){"use strict";function d(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw TypeError("Bad Promise constructor");b=a,c=d}),this.resolve=e(b),this.reject=e(c)}var e=a("./_a-function");b.exports.f=function(a){return new d(a)}},{"./_a-function":25}],62:[function(a,b,c){var d=a("./_an-object"),e=a("./_object-dps"),f=a("./_enum-bug-keys"),g=a("./_shared-key")("IE_PROTO"),h=function(){},i=function(){var b,c=a("./_dom-create")("iframe"),d=f.length;for(c.style.display="none",a("./_html").appendChild(c),c.src="javascript:",b=c.contentWindow.document,b.open(),b.write("<script>document.F=Object<\/script>"),b.close(),i=b.F;d--;)delete i.prototype[f[d]];return i()};b.exports=Object.create||function(a,b){var c;return null!==a?(h.prototype=d(a),c=new h,h.prototype=null,c[g]=a):c=i(),void 0===b?c:e(c,b)}},{"./_an-object":28,"./_dom-create":36,"./_enum-bug-keys":37,"./_html":45,"./_object-dps":64,"./_shared-key":82}],63:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":28,"./_descriptors":35,"./_ie8-dom-define":46,"./_to-primitive":92}],64:[function(a,b,c){var d=a("./_object-dp"),e=a("./_an-object"),f=a("./_object-keys");b.exports=a("./_descriptors")?Object.defineProperties:function(a,b){e(a);for(var c,g=f(b),h=g.length,i=0;h>i;)d.f(a,c=g[i++],b[c]);return a}},{"./_an-object":28,"./_descriptors":35,"./_object-dp":63,"./_object-keys":71}],65:[function(a,b,c){var d=a("./_object-pie"),e=a("./_property-desc"),f=a("./_to-iobject"),g=a("./_to-primitive"),h=a("./_has"),i=a("./_ie8-dom-define"),j=Object.getOwnPropertyDescriptor;c.f=a("./_descriptors")?j:function(a,b){if(a=f(a),b=g(b,!0),i)try{return j(a,b)}catch(a){}if(h(a,b))return e(!d.f.call(a,b),a[b])}},{"./_descriptors":35,"./_has":43,"./_ie8-dom-define":46,"./_object-pie":72,"./_property-desc":76,"./_to-iobject":89,"./_to-primitive":92}],66:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_object-gopn").f,f={}.toString,g="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],h=function(a){try{return e(a)}catch(a){return g.slice()}};b.exports.f=function(a){return g&&"[object Window]"==f.call(a)?h(a):e(d(a))}},{"./_object-gopn":67,"./_to-iobject":89}],67:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys").concat("length","prototype");c.f=Object.getOwnPropertyNames||function(a){return d(a,e)}},{"./_enum-bug-keys":37,"./_object-keys-internal":70}],68:[function(a,b,c){c.f=Object.getOwnPropertySymbols},{}],69:[function(a,b,c){var d=a("./_has"),e=a("./_to-object"),f=a("./_shared-key")("IE_PROTO"),g=Object.prototype;b.exports=Object.getPrototypeOf||function(a){return a=e(a),d(a,f)?a[f]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?g:null}},{"./_has":43,"./_shared-key":82,"./_to-object":91}],70:[function(a,b,c){var d=a("./_has"),e=a("./_to-iobject"),f=a("./_array-includes")(!1),g=a("./_shared-key")("IE_PROTO");b.exports=function(a,b){var c,h=e(a),i=0,j=[];for(c in h)c!=g&&d(h,c)&&j.push(c);for(;b.length>i;)d(h,c=b[i++])&&(~f(j,c)||j.push(c));return j}},{"./_array-includes":29,"./_has":43,"./_shared-key":82,"./_to-iobject":89}],71:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys");b.exports=Object.keys||function(a){return d(a,e)}},{"./_enum-bug-keys":37,"./_object-keys-internal":70}],72:[function(a,b,c){c.f={}.propertyIsEnumerable},{}],73:[function(a,b,c){var d=a("./_export"),e=a("./_core"),f=a("./_fails");b.exports=function(a,b){var c=(e.Object||{})[a]||Object[a],g={};g[a]=b(c),d(d.S+d.F*f(function(){c(1)}),"Object",g)}},{"./_core":32,"./_export":39,"./_fails":40}],74:[function(a,b,c){b.exports=function(a){try{return{e:!1,v:a()}}catch(a){return{e:!0,v:a}}}},{}],75:[function(a,b,c){var d=a("./_an-object"),e=a("./_is-object"),f=a("./_new-promise-capability");b.exports=function(a,b){if(d(a),e(b)&&b.constructor===a)return b;var c=f.f(a);return(0,c.resolve)(b),c.promise}},{"./_an-object":28,"./_is-object":51,"./_new-promise-capability":61}],76:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],77:[function(a,b,c){var d=a("./_hide");b.exports=function(a,b,c){for(var e in b)c&&a[e]?a[e]=b[e]:d(a,e,b[e]);return a}},{"./_hide":44}],78:[function(a,b,c){b.exports=a("./_hide")},{"./_hide":44}],79:[function(a,b,c){var d=a("./_is-object"),e=a("./_an-object"),f=function(a,b){if(e(a),!d(b)&&null!==b)throw TypeError(b+": can't set as prototype!")};b.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(b,c,d){try{d=a("./_ctx")(Function.call,a("./_object-gopd").f(Object.prototype,"__proto__").set,2),d(b,[]),c=!(b instanceof Array)}catch(a){c=!0}return function(a,b){return f(a,b),c?a.__proto__=b:d(a,b),a}}({},!1):void 0),check:f}},{"./_an-object":28,"./_ctx":33,"./_is-object":51,"./_object-gopd":65}],80:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_core"),f=a("./_object-dp"),g=a("./_descriptors"),h=a("./_wks")("species");b.exports=function(a){var b="function"==typeof e[a]?e[a]:d[a];g&&b&&!b[h]&&f.f(b,h,{configurable:!0,get:function(){return this}})}},{"./_core":32,"./_descriptors":35,"./_global":42,"./_object-dp":63,"./_wks":97}],81:[function(a,b,c){var d=a("./_object-dp").f,e=a("./_has"),f=a("./_wks")("toStringTag");b.exports=function(a,b,c){a&&!e(a=c?a:a.prototype,f)&&d(a,f,{configurable:!0,value:b})}},{"./_has":43,"./_object-dp":63,"./_wks":97}],82:[function(a,b,c){var d=a("./_shared")("keys"),e=a("./_uid");b.exports=function(a){return d[a]||(d[a]=e(a))}},{"./_shared":83,"./_uid":93}],83:[function(a,b,c){var d=a("./_core"),e=a("./_global"),f=e["__core-js_shared__"]||(e["__core-js_shared__"]={});(b.exports=function(a,b){return f[a]||(f[a]=void 0!==b?b:{})})("versions",[]).push({version:d.version,mode:a("./_library")?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":32,"./_global":42,"./_library":58}],84:[function(a,b,c){var d=a("./_an-object"),e=a("./_a-function"),f=a("./_wks")("species");b.exports=function(a,b){var c,g=d(a).constructor;return void 0===g||void 0==(c=d(g)[f])?b:e(c)}},{"./_a-function":25,"./_an-object":28,"./_wks":97}],85:[function(a,b,c){var d=a("./_to-integer"),e=a("./_defined");b.exports=function(a){return function(b,c){var f,g,h=String(e(b)),i=d(c),j=h.length;return i<0||i>=j?a?"":void 0:(f=h.charCodeAt(i),f<55296||f>56319||i+1===j||(g=h.charCodeAt(i+1))<56320||g>57343?a?h.charAt(i):f:a?h.slice(i,i+2):g-56320+(f-55296<<10)+65536)}}},{"./_defined":34,"./_to-integer":88}],86:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=k.Dispatch,q=0,r={},s=function(){var a=+this;if(r.hasOwnProperty(a)){var b=r[a];delete r[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return r[++q]=function(){h("function"==typeof a?a:Function(a),b)},d(q),q},n=function(a){delete r[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:p&&p.now?d=function(a){p.now(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d="onreadystatechange"in j("script")?function(a){i.appendChild(j("script")).onreadystatechange=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":31,"./_ctx":33,"./_dom-create":36,"./_global":42,"./_html":45,"./_invoke":47}],87:[function(a,b,c){var d=a("./_to-integer"),e=Math.max,f=Math.min;b.exports=function(a,b){return a=d(a),a<0?e(a+b,0):f(a,b)}},{"./_to-integer":88}],88:[function(a,b,c){var d=Math.ceil,e=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?e:d)(a)}},{}],89:[function(a,b,c){var d=a("./_iobject"),e=a("./_defined");b.exports=function(a){return d(e(a))}},{"./_defined":34,"./_iobject":48}],90:[function(a,b,c){var d=a("./_to-integer"),e=Math.min;b.exports=function(a){return a>0?e(d(a),9007199254740991):0}},{"./_to-integer":88}],91:[function(a,b,c){var d=a("./_defined");b.exports=function(a){return Object(d(a))}},{"./_defined":34}],92:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],93:[function(a,b,c){var d=0,e=Math.random();b.exports=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++d+e).toString(36))}},{}],94:[function(a,b,c){var d=a("./_global"),e=d.navigator;b.exports=e&&e.userAgent||""},{"./_global":42}],95:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_library"),g=a("./_wks-ext"),h=a("./_object-dp").f;b.exports=function(a){var b=e.Symbol||(e.Symbol=f?{}:d.Symbol||{});"_"==a.charAt(0)||a in b||h(b,a,{value:g.f(a)})}},{"./_core":32,"./_global":42,"./_library":58,"./_object-dp":63,"./_wks-ext":96}],96:[function(a,b,c){c.f=a("./_wks")},{"./_wks":97}],97:[function(a,b,c){var d=a("./_shared")("wks"),e=a("./_uid"),f=a("./_global").Symbol,g="function"==typeof f;(b.exports=function(a){return d[a]||(d[a]=g&&f[a]||(g?f:e)("Symbol."+a))}).store=d},{"./_global":42,"./_shared":83,"./_uid":93}],98:[function(a,b,c){var d=a("./_classof"),e=a("./_wks")("iterator"),f=a("./_iterators");b.exports=a("./_core").getIteratorMethod=function(a){if(void 0!=a)return a[e]||a["@@iterator"]||f[d(a)]}},{"./_classof":30,"./_core":32,"./_iterators":57,"./_wks":97}],99:[function(a,b,c){"use strict";var d=a("./_add-to-unscopables"),e=a("./_iter-step"),f=a("./_iterators"),g=a("./_to-iobject");b.exports=a("./_iter-define")(Array,"Array",function(a,b){this._t=g(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,e(1)):"keys"==b?e(0,c):"values"==b?e(0,a[c]):e(0,[c,a[c]])},"values"),f.Arguments=f.Array,d("keys"),d("values"),d("entries")},{"./_add-to-unscopables":26,"./_iter-define":54,"./_iter-step":56,"./_iterators":57,"./_to-iobject":89}],100:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{create:a("./_object-create")})},{"./_export":39,"./_object-create":62}],101:[function(a,b,c){var d=a("./_export");d(d.S+d.F*!a("./_descriptors"),"Object",{defineProperty:a("./_object-dp").f})},{"./_descriptors":35,"./_export":39,"./_object-dp":63}],102:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_object-gopd").f;a("./_object-sap")("getOwnPropertyDescriptor",function(){return function(a,b){return e(d(a),b)}})},{"./_object-gopd":65,"./_object-sap":73,"./_to-iobject":89}],103:[function(a,b,c){var d=a("./_to-object"),e=a("./_object-gpo");a("./_object-sap")("getPrototypeOf",function(){return function(a){return e(d(a))}})},{"./_object-gpo":69,"./_object-sap":73,"./_to-object":91}],104:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{setPrototypeOf:a("./_set-proto").set})},{"./_export":39,"./_set-proto":79}],105:[function(a,b,c){},{}],106:[function(a,b,c){"use strict";var d,e,f,g,h=a("./_library"),i=a("./_global"),j=a("./_ctx"),k=a("./_classof"),l=a("./_export"),m=a("./_is-object"),n=a("./_a-function"),o=a("./_an-instance"),p=a("./_for-of"),q=a("./_species-constructor"),r=a("./_task").set,s=a("./_microtask")(),t=a("./_new-promise-capability"),u=a("./_perform"),v=a("./_user-agent"),w=a("./_promise-resolve"),x=i.TypeError,y=i.process,z=y&&y.versions,A=z&&z.v8||"",B=i.Promise,C="process"==k(y),D=function(){},E=e=t.f,F=!!function(){try{var b=B.resolve(1),c=(b.constructor={})[a("./_wks")("species")]=function(a){a(D,D)};return(C||"function"==typeof PromiseRejectionEvent)&&b.then(D)instanceof c&&0!==A.indexOf("6.6")&&-1===v.indexOf("Chrome/66")}catch(a){}}(),G=function(a){var b;return!(!m(a)||"function"!=typeof(b=a.then))&&b},H=function(a,b){if(!a._n){a._n=!0;var c=a._c;s(function(){for(var d=a._v,e=1==a._s,f=0;c.length>f;)!function(b){var c,f,g,h=e?b.ok:b.fail,i=b.resolve,j=b.reject,k=b.domain;try{h?(e||(2==a._h&&K(a),a._h=1),!0===h?c=d:(k&&k.enter(),c=h(d),k&&(k.exit(),g=!0)),c===b.promise?j(x("Promise-chain cycle")):(f=G(c))?f.call(c,i,j):i(c)):j(d)}catch(a){k&&!g&&k.exit(),j(a)}}(c[f++]);a._c=[],a._n=!1,b&&!a._h&&I(a)})}},I=function(a){r.call(i,function(){var b,c,d,e=a._v,f=J(a);if(f&&(b=u(function(){C?y.emit("unhandledRejection",e,a):(c=i.onunhandledrejection)?c({promise:a,reason:e}):(d=i.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=C||J(a)?2:1),a._a=void 0,f&&b.e)throw b.v})},J=function(a){return 1!==a._h&&0===(a._a||a._c).length},K=function(a){r.call(i,function(){var b;C?y.emit("rejectionHandled",a):(b=i.onrejectionhandled)&&b({promise:a,reason:a._v})})},L=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),H(b,!0))},M=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw x("Promise can't be resolved itself");(b=G(a))?s(function(){var d={_w:c,_d:!1};try{b.call(a,j(M,d,1),j(L,d,1))}catch(a){L.call(d,a)}}):(c._v=a,c._s=1,H(c,!1))}catch(a){L.call({_w:c,_d:!1},a)}}};F||(B=function(a){o(this,B,"Promise","_h"),n(a),d.call(this);try{a(j(M,this,1),j(L,this,1))}catch(a){L.call(this,a)}},d=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},d.prototype=a("./_redefine-all")(B.prototype,{then:function(a,b){var c=E(q(this,B));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=C?y.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&H(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),f=function(){var a=new d;this.promise=a,this.resolve=j(M,a,1),this.reject=j(L,a,1)},t.f=E=function(a){return a===B||a===g?new f(a):e(a)}),l(l.G+l.W+l.F*!F,{Promise:B}),a("./_set-to-string-tag")(B,"Promise"),a("./_set-species")("Promise"),g=a("./_core").Promise,l(l.S+l.F*!F,"Promise",{reject:function(a){var b=E(this);return(0,b.reject)(a),b.promise}}),l(l.S+l.F*(h||!F),"Promise",{resolve:function(a){return w(h&&this===g?B:this,a)}}),l(l.S+l.F*!(F&&a("./_iter-detect")(function(a){B.all(a).catch(D)})),"Promise",{all:function(a){var b=this,c=E(b),d=c.resolve,e=c.reject,f=u(function(){var c=[],f=0,g=1;p(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f.e&&e(f.v),c.promise},race:function(a){var b=this,c=E(b),d=c.reject,e=u(function(){p(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e.e&&d(e.v),c.promise}})},{"./_a-function":25,"./_an-instance":27,"./_classof":30,"./_core":32,"./_ctx":33,"./_export":39,"./_for-of":41,"./_global":42,"./_is-object":51,"./_iter-detect":55,"./_library":58,"./_microtask":60,"./_new-promise-capability":61,"./_perform":74,"./_promise-resolve":75,
"./_redefine-all":77,"./_set-species":80,"./_set-to-string-tag":81,"./_species-constructor":84,"./_task":86,"./_user-agent":94,"./_wks":97}],107:[function(a,b,c){"use strict";var d=a("./_string-at")(!0);a("./_iter-define")(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=d(b,c),this._i+=a.length,{value:a,done:!1})})},{"./_iter-define":54,"./_string-at":85}],108:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_has"),f=a("./_descriptors"),g=a("./_export"),h=a("./_redefine"),i=a("./_meta").KEY,j=a("./_fails"),k=a("./_shared"),l=a("./_set-to-string-tag"),m=a("./_uid"),n=a("./_wks"),o=a("./_wks-ext"),p=a("./_wks-define"),q=a("./_enum-keys"),r=a("./_is-array"),s=a("./_an-object"),t=a("./_is-object"),u=a("./_to-object"),v=a("./_to-iobject"),w=a("./_to-primitive"),x=a("./_property-desc"),y=a("./_object-create"),z=a("./_object-gopn-ext"),A=a("./_object-gopd"),B=a("./_object-gops"),C=a("./_object-dp"),D=a("./_object-keys"),E=A.f,F=C.f,G=z.f,H=d.Symbol,I=d.JSON,J=I&&I.stringify,K=n("_hidden"),L=n("toPrimitive"),M={}.propertyIsEnumerable,N=k("symbol-registry"),O=k("symbols"),P=k("op-symbols"),Q=Object.prototype,R="function"==typeof H&&!!B.f,S=d.QObject,T=!S||!S.prototype||!S.prototype.findChild,U=f&&j(function(){return 7!=y(F({},"a",{get:function(){return F(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=E(Q,b);d&&delete Q[b],F(a,b,c),d&&a!==Q&&F(Q,b,d)}:F,V=function(a){var b=O[a]=y(H.prototype);return b._k=a,b},W=R&&"symbol"==typeof H.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof H},X=function(a,b,c){return a===Q&&X(P,b,c),s(a),b=w(b,!0),s(c),e(O,b)?(c.enumerable?(e(a,K)&&a[K][b]&&(a[K][b]=!1),c=y(c,{enumerable:x(0,!1)})):(e(a,K)||F(a,K,x(1,{})),a[K][b]=!0),U(a,b,c)):F(a,b,c)},Y=function(a,b){s(a);for(var c,d=q(b=v(b)),e=0,f=d.length;f>e;)X(a,c=d[e++],b[c]);return a},Z=function(a,b){return void 0===b?y(a):Y(y(a),b)},$=function(a){var b=M.call(this,a=w(a,!0));return!(this===Q&&e(O,a)&&!e(P,a))&&(!(b||!e(this,a)||!e(O,a)||e(this,K)&&this[K][a])||b)},_=function(a,b){if(a=v(a),b=w(b,!0),a!==Q||!e(O,b)||e(P,b)){var c=E(a,b);return!c||!e(O,b)||e(a,K)&&a[K][b]||(c.enumerable=!0),c}},aa=function(a){for(var b,c=G(v(a)),d=[],f=0;c.length>f;)e(O,b=c[f++])||b==K||b==i||d.push(b);return d},ba=function(a){for(var b,c=a===Q,d=G(c?P:v(a)),f=[],g=0;d.length>g;)!e(O,b=d[g++])||c&&!e(Q,b)||f.push(O[b]);return f};R||(H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor!");var a=m(arguments.length>0?arguments[0]:void 0),b=function(c){this===Q&&b.call(P,c),e(this,K)&&e(this[K],a)&&(this[K][a]=!1),U(this,a,x(1,c))};return f&&T&&U(Q,a,{configurable:!0,set:b}),V(a)},h(H.prototype,"toString",function(){return this._k}),A.f=_,C.f=X,a("./_object-gopn").f=z.f=aa,a("./_object-pie").f=$,B.f=ba,f&&!a("./_library")&&h(Q,"propertyIsEnumerable",$,!0),o.f=function(a){return V(n(a))}),g(g.G+g.W+g.F*!R,{Symbol:H});for(var ca="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),da=0;ca.length>da;)n(ca[da++]);for(var ea=D(n.store),fa=0;ea.length>fa;)p(ea[fa++]);g(g.S+g.F*!R,"Symbol",{for:function(a){return e(N,a+="")?N[a]:N[a]=H(a)},keyFor:function(a){if(!W(a))throw TypeError(a+" is not a symbol!");for(var b in N)if(N[b]===a)return b},useSetter:function(){T=!0},useSimple:function(){T=!1}}),g(g.S+g.F*!R,"Object",{create:Z,defineProperty:X,defineProperties:Y,getOwnPropertyDescriptor:_,getOwnPropertyNames:aa,getOwnPropertySymbols:ba});var ga=j(function(){B.f(1)});g(g.S+g.F*ga,"Object",{getOwnPropertySymbols:function(a){return B.f(u(a))}}),I&&g(g.S+g.F*(!R||j(function(){var a=H();return"[null]"!=J([a])||"{}"!=J({a:a})||"{}"!=J(Object(a))})),"JSON",{stringify:function(a){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);if(c=b=d[1],(t(b)||void 0!==a)&&!W(a))return r(b)||(b=function(a,b){if("function"==typeof c&&(b=c.call(this,a,b)),!W(b))return b}),d[1]=b,J.apply(I,d)}}),H.prototype[L]||a("./_hide")(H.prototype,L,H.prototype.valueOf),l(H,"Symbol"),l(Math,"Math",!0),l(d.JSON,"JSON",!0)},{"./_an-object":28,"./_descriptors":35,"./_enum-keys":38,"./_export":39,"./_fails":40,"./_global":42,"./_has":43,"./_hide":44,"./_is-array":50,"./_is-object":51,"./_library":58,"./_meta":59,"./_object-create":62,"./_object-dp":63,"./_object-gopd":65,"./_object-gopn":67,"./_object-gopn-ext":66,"./_object-gops":68,"./_object-keys":71,"./_object-pie":72,"./_property-desc":76,"./_redefine":78,"./_set-to-string-tag":81,"./_shared":83,"./_to-iobject":89,"./_to-object":91,"./_to-primitive":92,"./_uid":93,"./_wks":97,"./_wks-define":95,"./_wks-ext":96}],109:[function(a,b,c){"use strict";var d=a("./_export"),e=a("./_core"),f=a("./_global"),g=a("./_species-constructor"),h=a("./_promise-resolve");d(d.P+d.R,"Promise",{finally:function(a){var b=g(this,e.Promise||f.Promise),c="function"==typeof a;return this.then(c?function(c){return h(b,a()).then(function(){return c})}:a,c?function(c){return h(b,a()).then(function(){throw c})}:a)}})},{"./_core":32,"./_export":39,"./_global":42,"./_promise-resolve":75,"./_species-constructor":84}],110:[function(a,b,c){"use strict";var d=a("./_export"),e=a("./_new-promise-capability"),f=a("./_perform");d(d.S,"Promise",{try:function(a){var b=e.f(this),c=f(a);return(c.e?b.reject:b.resolve)(c.v),b.promise}})},{"./_export":39,"./_new-promise-capability":61,"./_perform":74}],111:[function(a,b,c){a("./_wks-define")("asyncIterator")},{"./_wks-define":95}],112:[function(a,b,c){a("./_wks-define")("observable")},{"./_wks-define":95}],113:[function(a,b,c){a("./es6.array.iterator");for(var d=a("./_global"),e=a("./_hide"),f=a("./_iterators"),g=a("./_wks")("toStringTag"),h="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),i=0;i<h.length;i++){var j=h[i],k=d[j],l=k&&k.prototype;l&&!l[g]&&e(l,g,j),f[j]=f.Array}},{"./_global":42,"./_hide":44,"./_iterators":57,"./_wks":97,"./es6.array.iterator":99}],114:[function(a,b,c){var d=function(){return this}()||Function("return this")(),e=d.regeneratorRuntime&&Object.getOwnPropertyNames(d).indexOf("regeneratorRuntime")>=0,f=e&&d.regeneratorRuntime;if(d.regeneratorRuntime=void 0,b.exports=a("./runtime"),e)d.regeneratorRuntime=f;else try{delete d.regeneratorRuntime}catch(a){d.regeneratorRuntime=void 0}},{"./runtime":115}],115:[function(a,b,c){!function(a){"use strict";function c(a,b,c,d){var f=b&&b.prototype instanceof e?b:e,g=Object.create(f.prototype),h=new n(d||[]);return g._invoke=j(a,c,h),g}function d(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}function e(){}function f(){}function g(){}function h(a){["next","throw","return"].forEach(function(b){a[b]=function(a){return this._invoke(b,a)}})}function i(a){function b(c,e,f,g){var h=d(a[c],a,e);if("throw"!==h.type){var i=h.arg,j=i.value;return j&&"object"==typeof j&&s.call(j,"__await")?Promise.resolve(j.__await).then(function(a){b("next",a,f,g)},function(a){b("throw",a,f,g)}):Promise.resolve(j).then(function(a){i.value=a,f(i)},g)}g(h.arg)}function c(a,c){function d(){return new Promise(function(d,e){b(a,c,d,e)})}return e=e?e.then(d,d):d()}var e;this._invoke=c}function j(a,b,c){var e=z;return function(f,g){if(e===B)throw new Error("Generator is already running");if(e===C){if("throw"===f)throw g;return p()}for(c.method=f,c.arg=g;;){var h=c.delegate;if(h){var i=k(h,c);if(i){if(i===D)continue;return i}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(e===z)throw e=C,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);e=B;var j=d(a,b,c);if("normal"===j.type){if(e=c.done?C:A,j.arg===D)continue;return{value:j.arg,done:c.done}}"throw"===j.type&&(e=C,c.method="throw",c.arg=j.arg)}}}function k(a,b){var c=a.iterator[b.method];if(c===q){if(b.delegate=null,"throw"===b.method){if(a.iterator.return&&(b.method="return",b.arg=q,k(a,b),"throw"===b.method))return D;b.method="throw",b.arg=new TypeError("The iterator does not provide a 'throw' method")}return D}var e=d(c,a.iterator,b.arg);if("throw"===e.type)return b.method="throw",b.arg=e.arg,b.delegate=null,D;var f=e.arg;return f?f.done?(b[a.resultName]=f.value,b.next=a.nextLoc,"return"!==b.method&&(b.method="next",b.arg=q),b.delegate=null,D):f:(b.method="throw",b.arg=new TypeError("iterator result is not an object"),b.delegate=null,D)}function l(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function m(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function n(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(l,this),this.reset(!0)}function o(a){if(a){var b=a[u];if(b)return b.call(a);if("function"==typeof a.next)return a;if(!isNaN(a.length)){var c=-1,d=function b(){for(;++c<a.length;)if(s.call(a,c))return b.value=a[c],b.done=!1,b;return b.value=q,b.done=!0,b};return d.next=d}}return{next:p}}function p(){return{value:q,done:!0}}var q,r=Object.prototype,s=r.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},u=t.iterator||"@@iterator",v=t.asyncIterator||"@@asyncIterator",w=t.toStringTag||"@@toStringTag",x="object"==typeof b,y=a.regeneratorRuntime;if(y)return void(x&&(b.exports=y));y=a.regeneratorRuntime=x?b.exports:{},y.wrap=c;var z="suspendedStart",A="suspendedYield",B="executing",C="completed",D={},E={};E[u]=function(){return this};var F=Object.getPrototypeOf,G=F&&F(F(o([])));G&&G!==r&&s.call(G,u)&&(E=G);var H=g.prototype=e.prototype=Object.create(E);f.prototype=H.constructor=g,g.constructor=f,g[w]=f.displayName="GeneratorFunction",y.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===f||"GeneratorFunction"===(b.displayName||b.name))},y.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,g):(a.__proto__=g,w in a||(a[w]="GeneratorFunction")),a.prototype=Object.create(H),a},y.awrap=function(a){return{__await:a}},h(i.prototype),i.prototype[v]=function(){return this},y.AsyncIterator=i,y.async=function(a,b,d,e){var f=new i(c(a,b,d,e));return y.isGeneratorFunction(b)?f:f.next().then(function(a){return a.done?a.value:f.next()})},h(H),H[w]="Generator",H[u]=function(){return this},H.toString=function(){return"[object Generator]"},y.keys=function(a){var b=[];for(var c in a)b.push(c);return b.reverse(),function c(){for(;b.length;){var d=b.pop();if(d in a)return c.value=d,c.done=!1,c}return c.done=!0,c}},y.values=o,n.prototype={constructor:n,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=q,this.done=!1,this.delegate=null,this.method="next",this.arg=q,this.tryEntries.forEach(m),!a)for(var b in this)"t"===b.charAt(0)&&s.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=q)},stop:function(){this.done=!0;var a=this.tryEntries[0],b=a.completion;if("throw"===b.type)throw b.arg;return this.rval},dispatchException:function(a){function b(b,d){return f.type="throw",f.arg=a,c.next=b,d&&(c.method="next",c.arg=q),!!d}if(this.done)throw a;for(var c=this,d=this.tryEntries.length-1;d>=0;--d){var e=this.tryEntries[d],f=e.completion;if("root"===e.tryLoc)return b("end");if(e.tryLoc<=this.prev){var g=s.call(e,"catchLoc"),h=s.call(e,"finallyLoc");if(g&&h){if(this.prev<e.catchLoc)return b(e.catchLoc,!0);if(this.prev<e.finallyLoc)return b(e.finallyLoc)}else if(g){if(this.prev<e.catchLoc)return b(e.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<e.finallyLoc)return b(e.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&s.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var e=d;break}}e&&("break"===a||"continue"===a)&&e.tryLoc<=b&&b<=e.finallyLoc&&(e=null);var f=e?e.completion:{};return f.type=a,f.arg=b,e?(this.method="next",this.next=e.finallyLoc,D):this.complete(f)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),D},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),m(c),D}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;m(c)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(a,b,c){return this.delegate={iterator:o(a),resultName:b,nextLoc:c},"next"===this.method&&(this.arg=q),D}}}(function(){return this}()||Function("return this")())},{}],116:[function(a,b,c){"use strict";function d(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type}function e(a,b,c,d,e){var f=k.writeRtpDescription(a.kind,b);if(f+=k.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=k.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":e||"active"),f+="a=mid:"+a.mid+"\r\n",a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=g;var h="msid:"+(d?d.id:"-")+" "+g+"\r\n";f+="a="+h,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+h,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+h,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+k.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+k.localCName+"\r\n"),f}function f(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&b>=14393&&-1===a.indexOf("?transport=udp"):(c=!0,!0)}),delete a.url,a.urls=e?d[0]:d,!!d.length}})}function g(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function h(a,b,c){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}function i(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}function j(a,b){var c=new Error(b);return c.name=a,c.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a],c}var k=a("sdp");b.exports=function(a,b){function c(b,c){c.addTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:b}))}function l(b,c){c.removeTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:b}))}function m(b,c,d,e){var f=new Event("track");f.track=c,f.receiver=d,f.transceiver={receiver:d},f.streams=e,a.setTimeout(function(){b._dispatchEvent("track",f)})}var n=function(c){var d=this,e=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=e[a].bind(e)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle="max-bundle"===c.bundlePolicy,"negotiate"===c.rtcpMuxPolicy)throw j("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced"}if(c.iceServers=f(c.iceServers||[],b),this._iceGatherers=[],c.iceCandidatePoolSize)for(var g=c.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=k.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(a,b){this._isClosed||(this.dispatchEvent(b),"function"==typeof this["on"+a]&&this["on"+a](b))},n.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(a,b){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();d.iceTransport=e.iceTransport,d.dtlsTransport=e.dtlsTransport}return b||this.transceivers.push(d),d},n.prototype.addTrack=function(b,c){if(this._isClosed)throw j("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(a){return a.track===b}))throw j("InvalidAccessError","Track already exists.");for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==b.kind||(d=this.transceivers[e]);return d||(d=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(c)&&this.localStreams.push(c),d.track=b,d.stream=c,d.rtpSender=new a.RTCRtpSender(b,d.dtlsTransport),d.rtpSender},n.prototype.addStream=function(a){var c=this;if(b>=15025)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)})}},n.prototype.removeTrack=function(b){if(this._isClosed)throw j("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(a){return a.rtpSender===b});if(!c)throw j("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null,-1===this.transceivers.map(function(a){return a.stream}).indexOf(d)&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},n.prototype._createIceGatherer=function(b,c){var d=this;if(c&&b>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].bufferedCandidateEvents=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering",null!==d.transceivers[b].bufferedCandidateEvents&&d.transceivers[b].bufferedCandidateEvents.push(a)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},n.prototype._gather=function(b,c){var d=this,e=this.transceivers[c].iceGatherer;if(!e.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),e.onlocalcandidate=function(a){if(!(d.usingBundle&&c>0)){var f=new Event("icecandidate");f.candidate={sdpMid:b,sdpMLineIndex:c};var g=a.candidate,h=!g||0===Object.keys(g).length;if(h)"new"!==e.state&&"gathering"!==e.state||(e.state="completed");else{"new"===e.state&&(e.state="gathering"),g.component=1,g.ufrag=e.getLocalParameters().usernameFragment;var i=k.writeCandidate(g);f.candidate=Object.assign(f.candidate,k.parseCandidate(i)),f.candidate.candidate=i,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var j=k.getMediaSections(d._localDescription.sdp);j[f.candidate.sdpMLineIndex]+=h?"a=end-of-candidates\r\n":"a="+f.candidate.candidate+"\r\n",d._localDescription.sdp=k.getDescription(d._localDescription.sdp)+j.join("");var l=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),h||d._dispatchEvent("icecandidate",f),l&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},a.setTimeout(function(){f.forEach(function(a){e.onlocalcandidate(a)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateIceConnectionState(),b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},n.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},n.prototype._transceive=function(a,c,d){var e=g(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:k.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),d&&a.rtpReceiver&&e.codecs.length>0&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length?e.encodings=a.recvEncodingParameters:e.encodings=[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},n.prototype.setLocalDescription=function(a){var b=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(j("TypeError",'Unsupported type "'+a.type+'"'));if(!h("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(j("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));var c,d;if("offer"===a.type)c=k.splitSections(a.sdp),d=c.shift(),c.forEach(function(a,c){var d=k.parseRtpParameters(a);b.transceivers[c].localCapabilities=d}),b.transceivers.forEach(function(a,c){b._gather(a.mid,c)});else if("answer"===a.type){c=k.splitSections(b._remoteDescription.sdp),d=c.shift();var e=k.matchPrefix(d,"a=ice-lite").length>0;c.forEach(function(a,c){var f=b.transceivers[c],h=f.iceGatherer,i=f.iceTransport,j=f.dtlsTransport,l=f.localCapabilities,m=f.remoteCapabilities;if(!(k.isRejected(a)&&0===k.matchPrefix(a,"a=bundle-only").length||f.rejected)){var n=k.getIceParameters(a,d),o=k.getDtlsParameters(a,d);e&&(o.role="server"),b.usingBundle&&0!==c||(b._gather(f.mid,c),"new"===i.state&&i.start(h,n,e?"controlling":"controlled"),"new"===j.state&&j.start(o));var p=g(l,m);b._transceive(f,p.codecs.length>0,!1)}})}return b._localDescription={type:a.type,sdp:a.sdp},"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(d){var e=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(j("TypeError",'Unsupported type "'+d.type+'"'));if(!h("setRemoteDescription",d.type,e.signalingState)||e._isClosed)return Promise.reject(j("InvalidStateError","Can not set remote "+d.type+" in state "+e.signalingState));var f={};e.remoteStreams.forEach(function(a){f[a.id]=a});var n=[],o=k.splitSections(d.sdp),p=o.shift(),q=k.matchPrefix(p,"a=ice-lite").length>0,r=k.matchPrefix(p,"a=group:BUNDLE ").length>0;e.usingBundle=r;var s=k.matchPrefix(p,"a=ice-options:")[0];return e.canTrickleIceCandidates=!!s&&s.substr(14).split(" ").indexOf("trickle")>=0,o.forEach(function(h,j){var m=k.splitLines(h),o=k.getKind(h),s=k.isRejected(h)&&0===k.matchPrefix(h,"a=bundle-only").length,t=m[0].substr(2).split(" ")[2],u=k.getDirection(h,p),v=k.parseMsid(h),w=k.getMid(h)||k.generateIdentifier();if(s||"application"===o&&("DTLS/SCTP"===t||"UDP/DTLS/SCTP"===t))return void(e.transceivers[j]={mid:w,kind:o,protocol:t,rejected:!0});!s&&e.transceivers[j]&&e.transceivers[j].rejected&&(e.transceivers[j]=e._createTransceiver(o,!0));var x,y,z,A,B,C,D,E,F,G,H,I=k.parseRtpParameters(h);s||(G=k.getIceParameters(h,p),H=k.getDtlsParameters(h,p),H.role="client"),D=k.parseRtpEncodingParameters(h);var J=k.parseRtcpParameters(h),K=k.matchPrefix(h,"a=end-of-candidates",p).length>0,L=k.matchPrefix(h,"a=candidate:").map(function(a){return k.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===d.type||"answer"===d.type)&&!s&&r&&j>0&&e.transceivers[j]&&(e._disposeIceAndDtlsTransports(j),e.transceivers[j].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[j].iceTransport=e.transceivers[0].iceTransport,e.transceivers[j].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[j].rtpSender&&e.transceivers[j].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[j].rtpReceiver&&e.transceivers[j].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),"offer"!==d.type||s){if("answer"===d.type&&!s){x=e.transceivers[j],y=x.iceGatherer,z=x.iceTransport,A=x.dtlsTransport,B=x.rtpReceiver,C=x.sendEncodingParameters,E=x.localCapabilities,e.transceivers[j].recvEncodingParameters=D,e.transceivers[j].remoteCapabilities=I,e.transceivers[j].rtcpParameters=J,L.length&&"new"===z.state&&(!q&&!K||r&&0!==j?L.forEach(function(a){i(x.iceTransport,a)}):z.setRemoteCandidates(L)),r&&0!==j||("new"===z.state&&z.start(y,G,"controlling"),"new"===A.state&&A.start(H));var M=g(x.localCapabilities,x.remoteCapabilities),N=M.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!N&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,e._transceive(x,"sendrecv"===u||"recvonly"===u,"sendrecv"===u||"sendonly"===u),!B||"sendrecv"!==u&&"sendonly"!==u?delete x.rtpReceiver:(F=B.track,v?(f[v.stream]||(f[v.stream]=new a.MediaStream),c(F,f[v.stream]),n.push([F,B,f[v.stream]])):(f.default||(f.default=new a.MediaStream),c(F,f.default),n.push([F,B,f.default])))}}else{x=e.transceivers[j]||e._createTransceiver(o),x.mid=w,x.iceGatherer||(x.iceGatherer=e._createIceGatherer(j,r)),L.length&&"new"===x.iceTransport.state&&(!K||r&&0!==j?L.forEach(function(a){i(x.iceTransport,a)}):x.iceTransport.setRemoteCandidates(L)),E=a.RTCRtpReceiver.getCapabilities(o),b<15019&&(E.codecs=E.codecs.filter(function(a){return"rtx"!==a.name})),C=x.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var O=!1;if("sendrecv"===u||"sendonly"===u){if(O=!x.rtpReceiver,B=x.rtpReceiver||new a.RTCRtpReceiver(x.dtlsTransport,o),O){var P;F=B.track,v&&"-"===v.stream||(v?(f[v.stream]||(f[v.stream]=new a.MediaStream,Object.defineProperty(f[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(F,"id",{get:function(){return v.track}}),P=f[v.stream]):(f.default||(f.default=new a.MediaStream),P=f.default)),P&&(c(F,P),x.associatedRemoteMediaStreams.push(P)),n.push([F,B,P])}}else x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===x.rtpReceiver.track.id});b&&l(b,a)}),x.associatedRemoteMediaStreams=[]);x.localCapabilities=E,x.remoteCapabilities=I,x.rtpReceiver=B,x.rtcpParameters=J,x.sendEncodingParameters=C,x.recvEncodingParameters=D,e._transceive(e.transceivers[j],!1,O)}}),void 0===e._dtlsRole&&(e._dtlsRole="offer"===d.type?"active":"passive"),e._remoteDescription={type:d.type,sdp:d.sdp},"offer"===d.type?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(f).forEach(function(b){var c=f[b];if(c.getTracks().length){if(-1===e.remoteStreams.indexOf(c)){e.remoteStreams.push(c);var d=new Event("addstream");d.stream=c,a.setTimeout(function(){e._dispatchEvent("addstream",d)})}n.forEach(function(a){var b=a[0],d=a[1];c.id===a[2].id&&m(e,b,d,[c])})}}),n.forEach(function(a){
a[2]||m(e,a[0],a[1],[])}),a.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},n.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))},n.prototype._updateIceConnectionState=function(){var a,b={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&b[a.iceTransport.state]++}),a="new",b.failed>0?a="failed":b.checking>0?a="checking":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0?a="connected":b.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},n.prototype._updateConnectionState=function(){var a,b={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(b[a.iceTransport.state]++,b[a.dtlsTransport.state]++)}),b.connected+=b.completed,a="new",b.failed>0?a="failed":b.connecting>0?a="connecting":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},n.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(j("InvalidStateError","Can not call createOffer after close"));var d=c.transceivers.filter(function(a){return"audio"===a.kind}).length,f=c.transceivers.filter(function(a){return"video"===a.kind}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==g.offerToReceiveAudio&&(d=!0===g.offerToReceiveAudio?1:!1===g.offerToReceiveAudio?0:g.offerToReceiveAudio),void 0!==g.offerToReceiveVideo&&(f=!0===g.offerToReceiveVideo?1:!1===g.offerToReceiveVideo?0:g.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?--d<0&&(a.wantReceive=!1):"video"===a.kind&&--f<0&&(a.wantReceive=!1)});d>0||f>0;)d>0&&(c._createTransceiver("audio"),d--),f>0&&(c._createTransceiver("video"),f--);var h=k.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(d,e){var f=d.track,g=d.kind,h=d.mid||k.generateIdentifier();d.mid=h,d.iceGatherer||(d.iceGatherer=c._createIceGatherer(e,c.usingBundle));var i=a.RTCRtpSender.getCapabilities(g);b<15019&&(i.codecs=i.codecs.filter(function(a){return"rtx"!==a.name})),i.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1"),d.remoteCapabilities&&d.remoteCapabilities.codecs&&d.remoteCapabilities.codecs.forEach(function(b){a.name.toLowerCase()===b.name.toLowerCase()&&a.clockRate===b.clockRate&&(a.preferredPayloadType=b.payloadType)})}),i.headerExtensions.forEach(function(a){(d.remoteCapabilities&&d.remoteCapabilities.headerExtensions||[]).forEach(function(b){a.uri===b.uri&&(a.id=b.id)})});var j=d.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];f&&b>=15019&&"video"===g&&!j[0].rtx&&(j[0].rtx={ssrc:j[0].ssrc+1}),d.wantReceive&&(d.rtpReceiver=new a.RTCRtpReceiver(d.dtlsTransport,g)),d.localCapabilities=i,d.sendEncodingParameters=j}),"max-compat"!==c._config.bundlePolicy&&(h+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),h+="a=ice-options:trickle\r\n",c.transceivers.forEach(function(a,b){h+=e(a,a.localCapabilities,"offer",a.stream,c._dtlsRole),h+="a=rtcp-rsize\r\n",!a.iceGatherer||"new"===c.iceGatheringState||0!==b&&c.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1,h+="a="+k.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))});var i=new a.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(i)},n.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(j("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==c.signalingState&&"have-local-pranswer"!==c.signalingState)return Promise.reject(j("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var d=k.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(d+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n";var f=k.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(a,h){if(!(h+1>f)){if(a.rejected)return"application"===a.kind?"DTLS/SCTP"===a.protocol?d+="m=application 0 DTLS/SCTP 5000\r\n":d+="m=application 0 "+a.protocol+" webrtc-datachannel\r\n":"audio"===a.kind?d+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===a.kind&&(d+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(d+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+a.mid+"\r\n");if(a.stream){var i;"audio"===a.kind?i=a.stream.getAudioTracks()[0]:"video"===a.kind&&(i=a.stream.getVideoTracks()[0]),i&&b>=15019&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}var j=g(a.localCapabilities,a.remoteCapabilities);!j.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,d+=e(a,j,"answer",a.stream,c._dtlsRole),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(d+="a=rtcp-rsize\r\n")}});var h=new a.RTCSessionDescription({type:"answer",sdp:d});return Promise.resolve(h)},n.prototype.addIceCandidate=function(a){var b,c=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,e){if(!c._remoteDescription)return e(j("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<c.transceivers.length;g++)if(c.transceivers[g].mid===a.sdpMid){f=g;break}var h=c.transceivers[f];if(!h)return e(j("OperationError","Can not add ICE candidate"));if(h.rejected)return d();var l=Object.keys(a.candidate).length>0?k.parseCandidate(a.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return d();if(l.component&&1!==l.component)return d();if((0===f||f>0&&h.iceTransport!==c.transceivers[0].iceTransport)&&!i(h.iceTransport,l))return e(j("OperationError","Can not add ICE candidate"));var m=a.candidate.trim();0===m.indexOf("a=")&&(m=m.substr(2)),b=k.getMediaSections(c._remoteDescription.sdp),b[f]+="a="+(l.type?m:"end-of-candidates")+"\r\n",c._remoteDescription.sdp=k.getDescription(c._remoteDescription.sdp)+b.join("")}else for(var n=0;n<c.transceivers.length&&(c.transceivers[n].rejected||(c.transceivers[n].iceTransport.addRemoteCandidate({}),b=k.getMediaSections(c._remoteDescription.sdp),b[n]+="a=end-of-candidates\r\n",c._remoteDescription.sdp=k.getDescription(c._remoteDescription.sdp)+b.join(""),!c.usingBundle));n++);d()})},n.prototype.getStats=function(b){if(b&&b instanceof a.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===b?c=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===b&&(c=a.rtpReceiver)}),!c)throw j("InvalidAccessError","Invalid selector.");return c.getStats()}var d=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&d.push(a[b].getStats())})}),Promise.all(d).then(function(a){var b=new Map;return a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})}),b})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(b){var c=a[b];if(c&&c.prototype&&c.prototype.getStats){var e=c.prototype.getStats;c.prototype.getStats=function(){return e.apply(this).then(function(a){var b=new Map;return Object.keys(a).forEach(function(c){a[c].type=d(a[c]),b.set(c,a[c])}),b})}}});var o=["createOffer","createAnswer"];return o.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[0]||"function"==typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"==typeof a[0]&&a[0].apply(null,[b])},function(b){"function"==typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}}),o=["setLocalDescription","setRemoteDescription","addIceCandidate"],o.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]||"function"==typeof a[2]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)},function(b){"function"==typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}}),["getStats"].forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}}),n}},{sdp:117}],117:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.getDescription=function(a){var b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){var b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],address:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;case"ufrag":c.ufrag=b[d+1],c.usernameFragment=b[d+1];break;default:c[b[d]]=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substr(14).split(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.channels=3===b.length?parseInt(b[2],10):1,c.numChannels=c.channels,c},d.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);var c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.parseSsrcGroup=function(a){var b=a.substr(13).split(" ");return{semantics:b.shift(),ssrcs:b.map(function(a){return parseInt(a,10)})}},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},d.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:d.matchPrefix(a+b,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);return c=c.concat(d.splitLines(b)),{usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions&&b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10)};i&&b&&(d.rtx={ssrc:b}),c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:i,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.parseSctpDescription=function(a){var b,c=d.parseMLine(a),e=d.matchPrefix(a,"a=max-message-size:");e.length>0&&(b=parseInt(e[0].substr(19),10)),isNaN(b)&&(b=65536);var f=d.matchPrefix(a,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:c.fmt,maxMessageSize:b};if(d.matchPrefix(a,"a=sctpmap:").length>0){var g=d.matchPrefix(a,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:b}}},d.writeSctpDescription=function(a,b){var c=[];return c="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+b.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+b.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+b.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+b.port+" "+b.protocol+" 65535\r\n"],void 0!==b.maxMessageSize&&c.push("a=max-message-size:"+b.maxMessageSize+"\r\n"),c.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(a,b,c){var e,f=void 0!==b?b:2;return e=a||d.generateSessionId(),"v=0\r\no="+(c||"thisisadapterortc")+" "+e+" "+f+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",a.direction?f+="a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){var b=d.splitLines(a),c=b[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},d.parseOLine=function(a){var b=d.matchPrefix(a,"o=")[0],c=b.substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},d.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;for(var b=d.splitLines(a),c=0;c<b.length;c++)if(b[c].length<2||"="!==b[c].charAt(1))return!1;return!0},"object"==typeof b&&(b.exports=d)},{}],118:[function(a,b,c){function d(a,b){var c=b||0,d=e;return[d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]]].join("")}for(var e=[],f=0;f<256;++f)e[f]=(f+256).toString(16).substr(1);b.exports=d},{}],119:[function(a,b,c){var d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(d){var e=new Uint8Array(16);b.exports=function(){return d(e),e}}else{var f=new Array(16);b.exports=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),f[b]=a>>>((3&b)<<3)&255;return f}}},{}],120:[function(a,b,c){function d(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[d+h]=g[h];return b||f(g)}var e=a("./lib/rng"),f=a("./lib/bytesToUuid");b.exports=d},{"./lib/bytesToUuid":118,"./lib/rng":119}],121:[function(a,b,c){(function(c){"use strict";var d=a("./adapter_factory.js");b.exports=d({window:c.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":122}],122:[function(a,b,c){"use strict";var d=a("./utils");b.exports=function(b,c){var e=b&&b.window,f={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var g in c)hasOwnProperty.call(c,g)&&(f[g]=c[g]);var h=d.log,i=d.detectBrowser(e),j=a("./chrome/chrome_shim")||null,k=a("./edge/edge_shim")||null,l=a("./firefox/firefox_shim")||null,m=a("./safari/safari_shim")||null,n=a("./common_shim")||null,o={browserDetails:i,commonShim:n,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(i.browser){case"chrome":if(!j||!j.shimPeerConnection||!f.shimChrome)return h("Chrome shim is not included in this adapter release."),o;h("adapter.js shimming chrome."),o.browserShim=j,n.shimCreateObjectURL(e),j.shimGetUserMedia(e),j.shimMediaStream(e),j.shimSourceObject(e),j.shimPeerConnection(e),j.shimOnTrack(e),j.shimAddTrackRemoveTrack(e),j.shimGetSendersWithDtmf(e),j.shimSenderReceiverGetStats(e),j.fixNegotiationNeeded(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"firefox":if(!l||!l.shimPeerConnection||!f.shimFirefox)return h("Firefox shim is not included in this adapter release."),o;h("adapter.js shimming firefox."),o.browserShim=l,n.shimCreateObjectURL(e),l.shimGetUserMedia(e),l.shimSourceObject(e),l.shimPeerConnection(e),l.shimOnTrack(e),l.shimRemoveStream(e),l.shimSenderGetStats(e),l.shimReceiverGetStats(e),l.shimRTCDataChannel(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"edge":if(!k||!k.shimPeerConnection||!f.shimEdge)return h("MS edge shim is not included in this adapter release."),o;h("adapter.js shimming edge."),o.browserShim=k,n.shimCreateObjectURL(e),k.shimGetUserMedia(e),k.shimPeerConnection(e),k.shimReplaceTrack(e),k.shimGetDisplayMedia(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"safari":if(!m||!f.shimSafari)return h("Safari shim is not included in this adapter release."),o;h("adapter.js shimming safari."),o.browserShim=m,n.shimCreateObjectURL(e),m.shimRTCIceServerUrls(e),m.shimCreateOfferLegacy(e),m.shimCallbacksAPI(e),m.shimLocalStreamsAPI(e),m.shimRemoteStreamsAPI(e),m.shimTrackEventTransceiver(e),m.shimGetUserMedia(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;default:h("Unsupported browser!")}return o}},{"./chrome/chrome_shim":123,"./common_shim":125,"./edge/edge_shim":126,"./firefox/firefox_shim":129,"./safari/safari_shim":131,"./utils":132}],123:[function(a,b,c){"use strict";function d(a,b,c){b&&!c.has(b.id)&&(c.set(b.id,b),Object.keys(b).forEach(function(e){e.endsWith("Id")?d(a,a.get(b[e]),c):e.endsWith("Ids")&&b[e].forEach(function(b){d(a,a.get(b),c)})}))}function e(a,b,c){var e=c?"outbound-rtp":"inbound-rtp",f=new Map;if(null===b)return f;var g=[];return a.forEach(function(a){"track"===a.type&&a.trackIdentifier===b.id&&g.push(a)}),g.forEach(function(b){a.forEach(function(c){c.type===e&&c.trackId===b.id&&d(a,c,f)})}),f}var f=a("../utils.js"),g=f.log;b.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)f.wrapPeerConnectionEvent(a,"track",function(a){return a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var f=new Event("track");f.track=d.track,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)}),b.stream.getTracks().forEach(function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)})},c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=this,f=c.apply(e,arguments);return f||(f=b(e,a),e._senders.push(f)),f};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;d.apply(b,arguments);var c=b._senders.indexOf(a);-1!==c&&b._senders.splice(c,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[],e.apply(c,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[],f.apply(b,[a]),a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=g.apply(a,[]);return b.forEach(function(b){b._pc=a}),b},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver){if(!("getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return e(b,a.track,!0)})}}if(!("getStats"in a.RTCRtpReceiver.prototype)){var d=a.RTCPeerConnection.prototype.getReceivers;d&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=d.apply(a,[]);return b.forEach(function(b){b._pc=a}),b}),f.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return e(b,a.track,!1)})}}if("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype){var g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){var b=this;if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){var c,d,e,f=arguments[0];return b.getSenders().forEach(function(a){a.track===f&&(c?e=!0:c=a)}),b.getReceivers().forEach(function(a){return a.track===f&&(d?e=!0:d=a),a.track===f}),e||c&&d?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():d?d.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return g.apply(b,arguments)}}}},shimSourceObject:function(a){var b=a&&a.URL;"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;if(this._srcObject=a,this.src&&b.revokeObjectURL(this.src),!a)return void(this.src="");this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)}),a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)})}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(d)&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(function(a){if(b.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")});var d=b.getSenders();c.apply(this,arguments);var e=b.getSenders().filter(function(a){return-1===d.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(e)};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this
;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var d=b._shimmedLocalStreams[c].indexOf(a);-1!==d&&b._shimmedLocalStreams[c].splice(d,1),1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]}),e.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}function c(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})}if(a.RTCPeerConnection){var d=f.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&d.version>=65)return this.shimAddTrackRemoveTrackWithNative(a);var e=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=e.apply(this);return a._reverseStreams=a._reverseStreams||{},b.map(function(b){return a._reverseStreams[b.id]})};var g=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=this;if(c._streams=c._streams||{},c._reverseStreams=c._reverseStreams||{},b.getTracks().forEach(function(a){if(c.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")}),!c._reverseStreams[b.id]){var d=new a.MediaStream(b.getTracks());c._streams[b.id]=d,c._reverseStreams[d.id]=b,b=d}g.apply(c,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._streams=b._streams||{},b._reverseStreams=b._reverseStreams||{},h.apply(b,[b._streams[a.id]||a]),delete b._reverseStreams[b._streams[a.id]?b._streams[a.id].id:a.id],delete b._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(d.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{};var f=d._streams[c.id];if(f)f.addTrack(b),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))});else{var g=new a.MediaStream([b]);d._streams[c.id]=g,d._reverseStreams[g.id]=c,d.addStream(g)}return d.getSenders().find(function(a){return a.track===b})},["createOffer","createAnswer"].forEach(function(c){var d=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments;return arguments.length&&"function"==typeof arguments[0]?d.apply(a,[function(d){var e=b(a,d);c[0].apply(null,[e])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(c){return b(a,c)})}});var i=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a=this;return arguments.length&&arguments[0].type?(arguments[0]=c(a,arguments[0]),i.apply(a,arguments)):i.apply(a,arguments)};var j=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=this,c=j.get.apply(this);return""===c.type?c:b(a,c)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var c;Object.keys(b._streams).forEach(function(d){b._streams[d].getTracks().find(function(b){return a.track===b})&&(c=b._streams[d])}),c&&(1===c.getTracks().length?b.removeStream(b._reverseStreams[c.id]):c.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(a){var b=f.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=function(b,c){return g("PeerConnection"),b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy),new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}})),a.RTCPeerConnection){var c=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,d){var e=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return c.apply(this,arguments);if(0===c.length&&(0===arguments.length||"function"!=typeof arguments[0]))return c.apply(this,[]);var g=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return c.apply(this,[i,arguments[0]])}return new Promise(function(a,b){c.apply(e,[function(b){a(h(g(b)))},b])}).then(b,d)},b.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),b.version<52&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var d=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?d.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(a){f.wrapPeerConnectionEvent(a,"negotiationneeded",function(a){if("stable"===a.target.signalingState)return a})},shimGetDisplayMedia:function(a,b){if(a.navigator&&a.navigator.mediaDevices&&!("getDisplayMedia"in a.navigator.mediaDevices)){if("function"!=typeof b)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");a.navigator.mediaDevices.getDisplayMedia=function(c){return b(c).then(function(b){var d=c.video&&c.video.width,e=c.video&&c.video.height,f=c.video&&c.video.frameRate;return c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxFrameRate:f||3}},d&&(c.video.mandatory.maxWidth=d),e&&(c.video.mandatory.maxHeight=e),a.navigator.mediaDevices.getUserMedia(c)})},a.navigator.getDisplayMedia=function(b){return f.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),a.navigator.mediaDevices.getDisplayMedia(b)}}}}},{"../utils.js":132,"./getusermedia":124}],124:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(a,d){if(b.version>=61)return d(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","googAutoGainControl"),g(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=f(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});var i=b.version<66;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||i)){delete a.video.facingMode;var j;if("environment"===h.exact||"environment"===h.ideal?j=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(j=["front"]),j)return c.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var c=b.find(function(a){return j.some(function(b){return-1!==a.label.toLowerCase().indexOf(b)})});return!c&&b.length&&-1!==j.indexOf("back")&&(c=b[b.length-1]),c&&(a.video.deviceId=h.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=f(a.video),e("chrome: "+JSON.stringify(a)),d(a)})}a.video=f(a.video)}return e("chrome: "+JSON.stringify(a)),d(a)},h=function(a){return b.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(a,b,d){g(a,function(a){c.webkitGetUserMedia(a,b,function(a){d&&d(h(a))})})};c.getUserMedia=i;var j=function(a){return new Promise(function(b,d){c.getUserMedia(a,b,d)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:j,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return g(a,function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}else c.mediaDevices.getUserMedia=function(a){return j(a)};void 0===c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),void 0===c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":132}],125:[function(a,b,c){"use strict";var d=a("sdp"),e=a("./utils");b.exports={shimRTCIceCandidate:function(a){if(a.RTCIceCandidate&&!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){var c=new b(a),e=d.parseCandidate(a.candidate),f=Object.assign(c,e);return f.toJSON=function(){return{candidate:f.candidate,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex,usernameFragment:f.usernameFragment}},f}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,e.wrapPeerConnectionEvent(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var c=b.createObjectURL.bind(b),d=b.revokeObjectURL.bind(b),f=new Map,g=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++g;return f.set(b,a),e.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),b}return c(a)},b.revokeObjectURL=function(a){d(a),f.delete(a)};var h=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(a){return this.srcObject=f.get(a)||null,h.set.apply(this,[a])}});var i=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=f.get(arguments[1])||null),i.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=e.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var c=function(a){var b=d.splitSections(a.sdp);return b.shift(),b.some(function(a){var b=d.parseMLine(a);return b&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},f=function(a){var b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return-1;var c=parseInt(b[1],10);return c!==c?-1:c},g=function(a){var c=65536;return"firefox"===b.browser&&(c=b.version<57?-1===a?16384:2147483637:b.version<60?57===b.version?65535:65536:2147483637),c},h=function(a,c){var e=65536;"firefox"===b.browser&&57===b.version&&(e=65535);var f=d.matchPrefix(a.sdp,"a=max-message-size:");return f.length>0?e=parseInt(f[0].substr(19),10):"firefox"===b.browser&&-1!==c&&(e=2147483637),e},i=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;if(a._sctp=null,c(arguments[0])){var b,d=f(arguments[0]),e=g(d),j=h(arguments[0],d);b=0===e&&0===j?Number.POSITIVE_INFINITY:0===e||0===j?Math.max(e,j):Math.min(e,j);var k={};Object.defineProperty(k,"maxMessageSize",{get:function(){return b}}),a._sctp=k}return i.apply(a,arguments)}}},shimSendThrowTypeError:function(a){function b(a,b){var c=a.send;a.send=function(){var d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,d=c.apply(a,arguments);return b(d,a),d},e.wrapPeerConnectionEvent(a,"datachannel",function(a){return b(a.channel,a.target),a})}}}},{"./utils":132,sdp:117}],126:[function(a,b,c){"use strict";var d=a("../utils"),e=a("./filtericeservers"),f=a("rtcpeerconnection-shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){var c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){c.set.call(this,a);var b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender);var g=f(a,b.version);a.RTCPeerConnection=function(a){return a&&a.iceServers&&(a.iceServers=e(a.iceServers)),new g(a)},a.RTCPeerConnection.prototype=g.prototype},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(a,b){if("getDisplayMedia"in a.navigator&&a.navigator.mediaDevices&&!("getDisplayMedia"in a.navigator.mediaDevices)){var c=a.navigator.getDisplayMedia;a.navigator.mediaDevices.getDisplayMedia=function(b){return c.call(a.navigator,b)},a.navigator.getDisplayMedia=function(b){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),c.call(a.navigator,b)}}}}},{"../utils":132,"./filtericeservers":127,"./getusermedia":128,"rtcpeerconnection-shim":116}],127:[function(a,b,c){"use strict";var d=a("../utils");b.exports=function(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var e=a.urls||a.url;a.url&&!a.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var f="string"==typeof e;return f&&(e=[e]),e=e.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&b>=14393&&-1===a.indexOf("?transport=udp"):(c=!0,!0)}),delete a.url,a.urls=f?e[0]:e,!!e.length}})}},{"../utils":132}],128:[function(a,b,c){"use strict";b.exports=function(a){var b=a&&a.navigator,c=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return d(a).catch(function(a){return Promise.reject(c(a))})}}},{}],129:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.transceiver={receiver:c.receiver},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=d.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(b.version<38&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var i={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(i.username=g.username,i.credential=g.credential),e.push(i)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,d){return g.apply(this,[a||null]).then(function(a){if(b.version<48&&(a=e(a)),b.version<53&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(b){if("TypeError"!==b.name)throw b;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:f[b.type]||b.type}))})}return a}).then(c,d)}}},shimSenderGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)){var b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c}),d.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&-1!==a.getTracks().indexOf(c.track)&&b.removeTrack(c)})})},shimRTCDataChannel:function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)},shimGetDisplayMedia:function(a,b){!a.navigator||!a.navigator.mediaDevices||"getDisplayMedia"in a.navigator.mediaDevices||(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!c||!c.video){var d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)},a.navigator.getDisplayMedia=function(b){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),a.navigator.mediaDevices.getDisplayMedia(b)})}}},{"../utils":132,"./getusermedia":130}],130:[function(a,b,c){"use strict";var d=a("../utils"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=a&&a.MediaStreamTrack,g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,d,f){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),b.version<38&&(e("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,d,function(a){f(g(a))})},i=function(a){return new Promise(function(b,c){h(a,b,c)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},b.version<41){var j=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return j().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(b.version<49){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(g(a))})}}if(!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var l=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","mozAutoGainControl"),l(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},f&&f.prototype.getSettings){var n=f.prototype.getSettings;f.prototype.getSettings=function(){var a=n.apply(this,arguments);return l(a,"mozAutoGainControl","autoGainControl"),l(a,"mozNoiseSuppression","noiseSuppression"),a}}if(f&&f.prototype.applyConstraints){var o=f.prototype.applyConstraints;f.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),l(a,"autoGainControl","mozAutoGainControl"),l(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}c.getUserMedia=function(a,e,f){if(b.version<44)return h(a,e,f);d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(e,f)}}},{"../utils":132}],131:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(a,c){return c&&(this._localStreams?-1===this._localStreams.indexOf(c)&&this._localStreams.push(c):this._localStreams=[c]),b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){-1!==d.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){if(a._remoteStreams||(a._remoteStreams=[]),!(a._remoteStreams.indexOf(b)>=0)){a._remoteStreams.push(b);var c=new Event("addstream");c.stream=b,a.dispatchEvent(c)}})}),b.apply(a,arguments)}}},shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){var c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};var h=function(a,b,c){var d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){var d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){var d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,
"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"==typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){var c=this;if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var d=c.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==a.offerToReceiveAudio||d||c.addTransceiver("audio"),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);var e=c.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&e?"sendrecv"===e.direction?e.setDirection("sendonly"):"recvonly"===e.direction&&e.setDirection("inactive"):!0!==a.offerToReceiveVideo||e||c.addTransceiver("video")}return b.apply(c,arguments)}}}},{"../utils":132}],132:[function(a,b,c){"use strict";function d(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}function e(a,b,c){if(a.RTCPeerConnection){var d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);var f=function(a){var b=c(a);b&&d(b)};return this._eventMap=this._eventMap||{},this._eventMap[d]=f,e.apply(this,[a,f])};var f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return f.apply(this,arguments);var d=this._eventMap[c];return delete this._eventMap[c],f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}}var f=!0,g=!0;b.exports={extractVersion:d,wrapPeerConnectionEvent:e,disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(f=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(g=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(a,b){g&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,c={};if(c.browser=null,c.version=null,void 0===a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=d(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)c.browser="chrome",c.version=d(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser="edge",c.version=d(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!a.RTCPeerConnection||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=d(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c}}},{}],133:[function(a,b,c){(function(b){"use strict";a("webrtc-adapter");var c=a("./rtc_session"),d=function(a){return a&&a.__esModule?a:{default:a}}(c),e=a("./rtc_const");/**
 * @license
 * License info for uuid module assembled into js bundle:
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2010-2016 Robert Kieffer and other contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
b.connect=b.connect||{},/**
                                        * @license
                                        * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
                                        *
                                        * SPDX-License-Identifier: Apache-2.0
                                        */
/**
 * @license
 * License info for webrtc-adapter module assembled into js bundle:
 *
 * Copyright (c) 2014, The WebRTC project authors. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of Google nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/**
 * @license
 * License info for sdp module assembled into js bundle:
 *
 * See https://www.npmjs.com/package/sdp
 */
b.connect.RTCSession=d.default,b.connect.RTCErrors=e.RTC_ERRORS,b.lily=b.lily||{},b.lily.RTCSession=d.default,b.lily.RTCErrors=e.RTC_ERRORS}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./rtc_const":135,"./rtc_session":136,"webrtc-adapter":121}],134:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.UnknownSignalingError=c.UnknownSignalingErrorName=c.CallNotFoundException=c.CallNotFoundExceptionName=c.BusyException=c.BusyExceptionName=c.UnsupportedOperation=c.UnsupportedOperationExceptionName=c.IllegalState=c.IllegalStateExceptionName=c.IllegalParameters=c.IllegalParametersExceptionName=c.GumTimeout=c.GumTimeoutExceptionName=c.Timeout=c.TimeoutExceptionName=void 0;var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/possibleConstructorReturn"),h=d(g),i=a("babel-runtime/helpers/inherits"),j=d(i),k=c.TimeoutExceptionName="Timeout",l=c.Timeout=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=k,c}return(0,j.default)(b,a),b}(Error),m=c.GumTimeoutExceptionName="GumTimeout",n=(c.GumTimeout=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=m,c}return(0,j.default)(b,a),b}(l),c.IllegalParametersExceptionName="IllegalParameters"),o=(c.IllegalParameters=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=n,c}return(0,j.default)(b,a),b}(Error),c.IllegalStateExceptionName="IllegalState"),p=(c.IllegalState=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=o,c}return(0,j.default)(b,a),b}(Error),c.UnsupportedOperationExceptionName="UnsupportedOperation"),q=(c.UnsupportedOperation=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=p,c}return(0,j.default)(b,a),b}(Error),c.BusyExceptionName="BusyException"),r=(c.BusyException=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=q,c}return(0,j.default)(b,a),b}(Error),c.CallNotFoundExceptionName="CallNotFoundException"),s=(c.CallNotFoundException=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=r,c}return(0,j.default)(b,a),b}(Error),c.UnknownSignalingErrorName="UnknownSignalingError");c.UnknownSignalingError=function(a){function b(){(0,f.default)(this,b);var a=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.name=s,a}return(0,j.default)(b,a),b}(Error)},{"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/inherits":13,"babel-runtime/helpers/possibleConstructorReturn":14}],135:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.MAX_ACCEPT_BYE_DELAY_MS=2e3,c.MAX_INVITE_DELAY_MS=5e3,c.DEFAULT_CONNECT_TIMEOUT_MS=1e4,c.DEFAULT_ICE_TIMEOUT_MS=8e3,c.DEFAULT_GUM_TIMEOUT_MS=1e4,c.SOFTPHONE_ROUTE_KEY="aws/softphone",c.INVITE_METHOD_NAME="invite",c.ACCEPT_METHOD_NAME="accept",c.BYE_METHOD_NAME="bye",c.RTC_ERRORS={ICE_COLLECTION_TIMEOUT:"Ice Collection Timeout",USER_BUSY:"User Busy",SIGNALLING_CONNECTION_FAILURE:"Signalling Connection Failure",SIGNALLING_HANDSHAKE_FAILURE:"Signalling Handshake Failure",SET_REMOTE_DESCRIPTION_FAILURE:"Set Remote Description Failure",CREATE_OFFER_FAILURE:"Create Offer Failure",SET_LOCAL_DESCRIPTION_FAILURE:"Set Local Description Failure",INVALID_REMOTE_SDP:"Invalid Remote SDP",NO_REMOTE_ICE_CANDIDATE:"No Remote ICE Candidate",GUM_TIMEOUT_FAILURE:"GUM Timeout Failure",GUM_OTHER_FAILURE:"GUM Other Failure",CALL_NOT_FOUND:"Call Not Found"}},{}],136:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.FailedState=c.DisconnectedState=c.CleanUpState=c.TalkingState=c.AcceptState=c.InviteAnswerState=c.ConnectSignalingAndIceCollectionState=c.SetLocalSessionDescriptionState=c.CreateOfferState=c.GrabLocalMediaState=c.RTCSessionState=void 0;var e=a("babel-runtime/regenerator"),f=d(e),g=a("babel-runtime/helpers/asyncToGenerator"),h=d(g),i=a("babel-runtime/helpers/typeof"),j=d(i),k=a("babel-runtime/helpers/get"),l=d(k),m=a("babel-runtime/helpers/possibleConstructorReturn"),n=d(m),o=a("babel-runtime/helpers/inherits"),p=d(o),q=a("babel-runtime/helpers/classCallCheck"),r=d(q),s=a("babel-runtime/helpers/createClass"),t=d(s),u=a("./utils"),v=a("./session_report"),w=a("./rtc_const"),x=a("./exceptions"),y=a("./signaling"),z=d(y),A=a("uuid/v4"),B=d(A),C=a("./rtp-stats"),D=a("sdp"),E=c.RTCSessionState=function(){function a(b){(0,r.default)(this,a),this._rtcSession=b}return(0,t.default)(a,[{key:"onEnter",value:function(){}},{key:"onExit",value:function(){}},{key:"_isCurrentState",value:function(){return this._rtcSession._state===this}},{key:"transit",value:function(a){this._isCurrentState()&&this._rtcSession.transit(a)}},{key:"hangup",value:function(){this.transit(new O(this._rtcSession))}},{key:"onIceCandidate",value:function(a){}},{key:"onRemoteHungup",value:function(){throw new x.UnsupportedOperation("onRemoteHungup not implemented by "+this.name)}},{key:"onSignalingConnected",value:function(){throw new x.UnsupportedOperation("onSignalingConnected not implemented by "+this.name)}},{key:"onSignalingHandshaked",value:function(){throw new x.UnsupportedOperation("onSignalingHandshaked not implemented by "+this.name)}},{key:"onSignalingFailed",value:function(a){throw new x.UnsupportedOperation("onSignalingFailed not implemented by "+this.name)}},{key:"onIceStateChange",value:function(a){}},{key:"logger",get:function(){return this._rtcSession._logger}},{key:"name",get:function(){return"RTCSessionState"}}]),a}(),F=c.GrabLocalMediaState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=Date.now();if(a._rtcSession._userAudioStream)a.transit(new G(a._rtcSession));else{var c=new Promise(function(b,c){setTimeout(function(){c(new x.GumTimeout("Local media has not been initialized yet."))},a._rtcSession._gumTimeoutMillis)}),d=a._gUM(a._rtcSession._buildMediaConstraints());Promise.race([d,c]).then(function(c){a._rtcSession._sessionReport.gumTimeMillis=Date.now()-b,a._rtcSession._onGumSuccess(a._rtcSession),a._rtcSession._localStream=c,a._rtcSession._sessionReport.gumOtherFailure=!1,a._rtcSession._sessionReport.gumTimeoutFailure=!1,a.transit(new G(a._rtcSession))}).catch(function(c){a._rtcSession._sessionReport.gumTimeMillis=Date.now()-b;var d;c instanceof x.GumTimeout?(d=w.RTC_ERRORS.GUM_TIMEOUT_FAILURE,a._rtcSession._sessionReport.gumTimeoutFailure=!0,a._rtcSession._sessionReport.gumOtherFailure=!1):(d=w.RTC_ERRORS.GUM_OTHER_FAILURE,a._rtcSession._sessionReport.gumOtherFailure=!0,a._rtcSession._sessionReport.gumTimeoutFailure=!1),a.logger.error("Local media initialization failed",c),a._rtcSession._onGumError(a._rtcSession),a.transit(new O(a._rtcSession,d))})}}},{key:"_gUM",value:function(a){return navigator.mediaDevices.getUserMedia(a)}},{key:"name",get:function(){return"GrabLocalMediaState"}}]),b}(E),G=c.CreateOfferState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=a._rtcSession._localStream;a._rtcSession._pc.addStream(b),a._rtcSession._onLocalStreamAdded(a._rtcSession,b),a._rtcSession._pc.createOffer().then(function(b){a._rtcSession._localSessionDescription=b,a._rtcSession._sessionReport.createOfferFailure=!1,a.transit(new H(a._rtcSession))}).catch(function(b){a.logger.error("CreateOffer failed",b),a._rtcSession._sessionReport.createOfferFailure=!0,a.transit(new O(a._rtcSession,w.RTC_ERRORS.CREATE_OFFER_FAILURE))})}},{key:"name",get:function(){return"CreateOfferState"}}]),b}(E),H=c.SetLocalSessionDescriptionState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=a._rtcSession._localSessionDescription,c=new u.SdpOptions;a._rtcSession._forceAudioCodec&&(c.forceCodec.audio=a._rtcSession._forceAudioCodec),a._rtcSession._forceVideoCodec&&(c.forceCodec.video=a._rtcSession._forceVideoCodec),c.enableOpusDtx=a._rtcSession._enableOpusDtx;var d=(0,u.transformSdp)(b.sdp,c);b.sdp=d.sdp,a.logger.info("LocalSD",a._rtcSession._localSessionDescription),a._rtcSession._pc.setLocalDescription(a._rtcSession._localSessionDescription).then(function(){var b=Date.now()-a._rtcSession._connectTimeStamp;a._rtcSession._sessionReport.initializationTimeMillis=b,a._rtcSession._onSessionInitialized(a._rtcSession,b),a._rtcSession._sessionReport.setLocalDescriptionFailure=!1,a.transit(new I(a._rtcSession,d.mLines))}).catch(function(b){a.logger.error("SetLocalDescription failed",b),a._rtcSession._sessionReport.setLocalDescriptionFailure=!0,a.transit(new O(a._rtcSession,w.RTC_ERRORS.SET_LOCAL_DESCRIPTION_FAILURE))})}},{key:"name",get:function(){return"SetLocalSessionDescriptionState"}}]),b}(E),I=c.ConnectSignalingAndIceCollectionState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._iceCandidates=[],d._iceCandidateFoundationsMap={},d._mLines=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this;a._startTime=Date.now(),setTimeout(function(){a._isCurrentState()&&!a._iceCompleted&&(a.logger.warn("ICE collection timed out"),a._reportIceCompleted(!0))},a._rtcSession._iceTimeoutMillis),a._rtcSession._createSignalingChannel().connect()}},{key:"onSignalingConnected",value:function(){this._rtcSession._signallingConnectTimestamp=Date.now(),this._rtcSession._sessionReport.signallingConnectTimeMillis=this._rtcSession._signallingConnectTimestamp-this._startTime,this._signalingConnected=!0,this._rtcSession._onSignalingConnected(this._rtcSession),this._rtcSession._sessionReport.signallingConnectionFailure=!1,this._checkAndTransit()}},{key:"onSignalingFailed",value:function(a){this._rtcSession._sessionReport.signallingConnectTimeMillis=Date.now()-this._startTime,this.logger.error("Failed connecting to signaling server",a),this._rtcSession._sessionReport.signallingConnectionFailure=!0,this.transit(new O(this._rtcSession,w.RTC_ERRORS.SIGNALLING_CONNECTION_FAILURE))}},{key:"_createLocalCandidate",value:function(a){return new RTCIceCandidate(a)}},{key:"onIceCandidate",value:function(a){var b=a.candidate;this.logger.log("onicecandidate "+JSON.stringify(b)),b?b.candidate&&(this._iceCandidates.push(this._createLocalCandidate(b)),this._iceCompleted||this._checkCandidatesSufficient(b)):this._reportIceCompleted(!1)}},{key:"_checkCandidatesSufficient",value:function(a){var b=(0,D.parseCandidate)(a.candidate);if(1==b.component){var c=b.foundation,d=a.sdpMLineIndex;if(c&&d>=0&&d<this._mLines){var e=this._iceCandidateFoundationsMap[c]||[];e.includes(d)||e.push(d),this._iceCandidateFoundationsMap[c]=e,this._mLines==e.length&&this._reportIceCompleted(!1)}}}},{key:"_reportIceCompleted",value:function(a){this._rtcSession._sessionReport.iceCollectionTimeMillis=Date.now()-this._startTime,this._iceCompleted=!0,this._rtcSession._onIceCollectionComplete(this._rtcSession,a,this._iceCandidates.length),this._iceCandidates.length>0?(this._rtcSession._sessionReport.iceCollectionFailure=!1,this._checkAndTransit()):(this.logger.error("No ICE candidate"),this._rtcSession._sessionReport.iceCollectionFailure=!0,this.transit(new O(this._rtcSession,w.RTC_ERRORS.ICE_COLLECTION_TIMEOUT)))}},{key:"_checkAndTransit",value:function(){this._iceCompleted&&this._signalingConnected?this.transit(new J(this._rtcSession,this._iceCandidates)):this._iceCompleted?this.logger.log("Pending signaling connection"):this.logger.log("Pending ICE collection")}},{key:"name",get:function(){return"ConnectSignalingAndIceCollectionState"}}]),b}(E),J=c.InviteAnswerState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._iceCandidates=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this._rtcSession;a._onSignalingStarted(a),a._signalingChannel.invite(a._localSessionDescription.sdp,this._iceCandidates)}},{key:"onSignalingAnswered",value:function(a,b){this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!1,this.transit(new K(this._rtcSession,a,b))}},{key:"onSignalingFailed",value:function(a){var b;a.name==x.BusyExceptionName?(this.logger.error("User Busy, possibly multiple CCP windows open",a),this._rtcSession._sessionReport.userBusyFailure=!0,this._rtcSession._sessionReport.handshakingFailure=!0,b=w.RTC_ERRORS.USER_BUSY):a.name==x.CallNotFoundExceptionName?(this.logger.error("Call not found. One of the participant probably hungup.",a),b=w.RTC_ERRORS.CALL_NOT_FOUND,this._rtcSession._sessionReport.handshakingFailure=!0):(this.logger.error("Failed handshaking with signaling server",a),this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!0,b=w.RTC_ERRORS.SIGNALLING_HANDSHAKE_FAILURE),this.transit(new O(this._rtcSession,b))}},{key:"name",get:function(){return"InviteAnswerState"}}]),b}(E),K=c.AcceptState=function(a){function b(a,c,d){(0,r.default)(this,b);var e=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return e._sdp=c,e._candidates=d,e}return(0,p.default)(b,a),(0,t.default)(b,[{key:"_createSessionDescription",value:function(a){return new RTCSessionDescription(a)}},{key:"_createRemoteCandidate",value:function(a){return new RTCIceCandidate(a)}},{key:"onEnter",value:function(){var a=this,b=a._rtcSession;if(!a._sdp)return a.logger.error("Invalid remote SDP"),b._stopSession(),b._sessionReport.invalidRemoteSDPFailure=!0,void a.transit(new O(b,w.RTC_ERRORS.INVALID_REMOTE_SDP));if(!a._candidates||a._candidates.length<1)return a.logger.error("No remote ICE candidate"),b._stopSession(),b._sessionReport.noRemoteIceCandidateFailure=!0,void a.transit(new O(b,w.RTC_ERRORS.NO_REMOTE_ICE_CANDIDATE));b._sessionReport.invalidRemoteSDPFailure=!1,b._sessionReport.noRemoteIceCandidateFailure=!1;var c=b._pc.setRemoteDescription(a._createSessionDescription({type:"answer",sdp:a._sdp}));c.catch(function(b){a.logger.error("SetRemoteDescription failed",b)}),c.then(function(){var c=Promise.all(a._candidates.map(function(c){var d=a._createRemoteCandidate(c);return a.logger.info("Adding remote candidate",d),b._pc.addIceCandidate(d)}));return c.catch(function(b){a.logger.warn("Error adding remote candidate",b)}),c}).then(function(){b._sessionReport.setRemoteDescriptionFailure=!1,a._remoteDescriptionSet=!0,a._checkAndTransit()}).catch(function(){b._stopSession(),b._sessionReport.setRemoteDescriptionFailure=!0,a.transit(new O(b,w.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"onSignalingHandshaked",value:function(){this._rtcSession._sessionReport.handshakingTimeMillis=Date.now()-this._rtcSession._signallingConnectTimestamp,this._signalingHandshaked=!0,this._checkAndTransit()}},{key:"_checkAndTransit",value:function(){this._signalingHandshaked&&this._remoteDescriptionSet?this.transit(new L(this._rtcSession)):this._signalingHandshaked?this.logger.log("Pending setting remote description"):this.logger.log("Pending handshaking")}},{key:"name",get:function(){return"AcceptState"}}]),b}(E),L=c.TalkingState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._startTime=Date.now(),this._rtcSession._sessionReport.preTalkingTimeMillis=this._startTime-this._rtcSession._connectTimeStamp,this._rtcSession._onSessionConnected(this._rtcSession)}},{key:"onSignalingReconnected",value:function(){}},{key:"onRemoteHungup",value:function(){this._rtcSession._signalingChannel.hangup(),this.transit(new N(this._rtcSession))}},{key:"hangup",value:function(){this._rtcSession._signalingChannel.hangup(),this.transit(new N(this._rtcSession))}},{key:"onIceStateChange",value:function(a){"disconnected"==a.currentTarget.iceConnectionState&&(this.logger.info("Lost ICE connection"),this._rtcSession._sessionReport.iceConnectionsLost+=1)}},{key:"onExit",value:function(){this._rtcSession._sessionReport.talkingTimeMillis=Date.now()-this._startTime,this._rtcSession._detachMedia(),this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionCompleted(this._rtcSession)}},{key:"name",get:function(){return"TalkingState"}}]),b}(E),M=c.CleanUpState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._startTime=Date.now(),this._rtcSession._stopSession(),this._rtcSession._sessionReport.cleanupTimeMillis=Date.now()-this._startTime,this._rtcSession._onSessionDestroyed(this._rtcSession,this._rtcSession._sessionReport)}},{key:"hangup",value:function(){}},{key:"name",get:function(){return"CleanUpState"}}]),b}(E),N=c.DisconnectedState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"name",get:function(){return"DisconnectedState"}}]),b}(M),O=c.FailedState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._failureReason=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionFailed(this._rtcSession,this._failureReason),(0,l.default)(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onEnter",this).call(this)}},{key:"name",get:function(){return"FailedState"}}]),b}(M),P=function(){function a(b,c,d,e,f,g,h){if((0,r.default)(this,a),"string"!=typeof b||0===b.trim().length)throw new x.IllegalParameters("signalingUri required");if(!c)throw new x.IllegalParameters("iceServers required");if("object"!==(void 0===e?"undefined":(0,j.default)(e)))throw new x.IllegalParameters("logger required");this._callId=f||(0,B.default)(),this._connectionId=g,this._wssManager=h,this._sessionReport=new v.SessionReport,this._signalingUri=b,this._iceServers=c,this._contactToken=d,this._originalLogger=e,this._logger=(0,u.wrapLogger)(this._originalLogger,this._callId,"SESSION"),this._iceTimeoutMillis=w.DEFAULT_ICE_TIMEOUT_MS,this._gumTimeoutMillis=w.DEFAULT_GUM_TIMEOUT_MS,this._enableAudio=!0,this._enableVideo=!1,this._facingMode="user",this._legacyStatsReportSupport=!1,this._userProvidedStream=!1,this._onGumError=this._onGumSuccess=this._onLocalStreamAdded=this._onSessionFailed=this._onSessionInitialized=this._onSignalingConnected=this._onIceCollectionComplete=this._onSignalingStarted=this._onSessionConnected=this._onRemoteStreamAdded=this._onSessionCompleted=this._onSessionDestroyed=function(){}}return(0,t.default)(a,[{key:"pauseLocalVideo",value:function(){if(this._localStream){var a=this._localStream.getVideoTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeLocalVideo",value:function(){if(this._localStream){var a=this._localStream.getVideoTracks()[0];a&&(a.enabled=!0)}}},{key:"pauseRemoteVideo",value:function(){if(this._remoteVideoStream){var a=this._remoteVideoStream.getTracks()[1];a&&(a.enabled=!1)}}},{key:"resumeRemoteVideo",value:function(){if(this._remoteVideoStream){var a=this._remoteVideoStream.getTracks()[1];a&&(a.enabled=!0)}}},{key:"pauseLocalAudio",value:function(){if(this._localStream){var a=this._localStream.getAudioTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeLocalAudio",value:function(){if(this._localStream){var a=this._localStream.getAudioTracks()[0];a&&(a.enabled=!0)}}},{key:"pauseRemoteAudio",value:function(){if(this._remoteAudioStream){var a=this._remoteAudioStream.getTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeRemoteAudio",value:function(){if(this._remoteAudioStream){var a=this._remoteAudioStream.getTracks()[0];a&&(a.enabled=!0)}}},{key:"transit",value:function(a){try{this._logger.info((this._state?this._state.name:"null")+" => "+a.name),this._state&&this._state.onExit&&this._state.onExit()}finally{if(this._state=a,a.onEnter)try{a.onEnter()}catch(b){throw this._logger.warn(a.name+"#onEnter failed",b),b}}}},{key:"_createSignalingChannel",value:function(){var a=new z.default(this._callId,this._signalingUri,this._contactToken,this._originalLogger,this._signalingConnectTimeout,this._connectionId,this._wssManager);return a.onConnected=(0,u.hitch)(this,this._signalingConnected),a.onAnswered=(0,u.hitch)(this,this._signalingAnswered),a.onHandshaked=(0,u.hitch)(this,this._signalingHandshaked),a.onRemoteHungup=(0,u.hitch)(this,this._signalingRemoteHungup),a.onFailed=(0,u.hitch)(this,this._signalingFailed),a.onDisconnected=(0,u.hitch)(this,this._signalingDisconnected),this._signalingChannel=a,a}},{key:"_signalingConnected",value:function(){this._state.onSignalingConnected()}},{key:"_signalingAnswered",value:function(a,b){this._state.onSignalingAnswered(a,b)}},{key:"_signalingHandshaked",value:function(){this._state.onSignalingHandshaked()}},{key:"_signalingRemoteHungup",value:function(){this._state.onRemoteHungup()}},{key:"_signalingFailed",value:function(a){this._state.onSignalingFailed(a)}},{key:"_signalingDisconnected",value:function(){}},{key:"_createPeerConnection",value:function(a){return new RTCPeerConnection(a)}},{key:"connect",value:function(){var a=this,b=new Date;a._sessionReport.sessionStartTime=b,a._connectTimeStamp=b.getTime(),a._pc=a._createPeerConnection({iceServers:a._iceServers,iceTransportPolicy:"relay",rtcpMuxPolicy:"require",bundlePolicy:"balanced",sdpSemantics:"plan-b"},{optional:[{googDscp:!0}]}),a._pc.ontrack=(0,u.hitch)(a,a._ontrack),a._pc.onicecandidate=(0,u.hitch)(a,a._onIceCandidate),a._pc.oniceconnectionstatechange=(0,u.hitch)(a,a._onIceStateChange),(0,u.isLegacyStatsReportSupported)(a._pc).then(function(b){a._legacyStatsReportSupport=b,a.transit(new F(a))})}},{key:"accept",value:function(){throw new x.UnsupportedOperation("accept does not go through signaling channel at this moment")}},{key:"hangup",value:function(){this._state.hangup()}},{key:"getStats",value:function(){function a(){return b.apply(this,arguments)}var b=(0,h.default)(f.default.mark(function a(){var b,c,d,e,g,i,j=this;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b=new Date,c=function(){var a=(0,h.default)(f.default.mark(function a(c,d){var e;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=[],c){a.next=3;break}return a.abrupt("return",[]);case 3:a.t0=d,a.next="audio_input"===a.t0?6:"audio_output"===a.t0?6:"video_input"===a.t0?8:"video_output"===a.t0?8:10;break;case 6:return e=c.getAudioTracks(),a.abrupt("break",11);case 8:return e=c.getVideoTracks(),a.abrupt("break",11);case 10:throw new Error("Unsupported stream type while trying to get stats: "+d);case 11:return a.next=13,Promise.all(e.map(function(){var a=(0,h.default)(f.default.mark(function a(c){var e;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!j._legacyStatsReportSupport){a.next=5;break}return e=j,a.abrupt("return",new Promise(function(a){e._pc.getStats(function(c){var e=(0,C.extractMediaStatsFromStats)(b,c.result(),d);if(!e)throw new Error("Failed to extract MediaRtpStats from RTCStatsReport for stream type "+d);a(e)},c)}));case 5:return a.abrupt("return",j._pc.getStats().then(function(a){var c=(0,C.extractMediaStatsFromStats)(b,a,d);if(!c)throw new Error("Failed to extract MediaRtpStats from RTCStatsReport for stream type "+d);return c}));case 6:case"end":return a.stop()}},a,j)}));return function(b){return a.apply(this,arguments)}}()));case 13:return a.abrupt("return",a.sent);case 14:case"end":return a.stop()}},a,j)}));return function(b,c){return a.apply(this,arguments)}}(),!this._pc||"stable"!==this._pc.signalingState){a.next=26;break}return a.next=5,c(this._remoteAudioStream,"audio_input");case 5:return a.t0=a.sent,a.next=8,c(this._localStream,"audio_output");case 8:return a.t1=a.sent,a.t2={input:a.t0,output:a.t1},a.next=12,c(this._remoteVideoStream,"video_input");case 12:return a.t3=a.sent,a.next=15,c(this._localStream,"video_output");case 15:return a.t4=a.sent,a.t5={input:a.t3,output:a.t4},d={audio:a.t2,video:a.t5},e=function(a,b){return null!==b.rttMilliseconds&&(null===a||b.rttMilliseconds>a)&&(a=b.rttMilliseconds),b._rttMilliseconds=null,a},g=d.audio.input.reduce(e,null),i=d.video.input.reduce(e,null),null!==g&&d.audio.output.forEach(function(a){a._rttMilliseconds=g}),null!==i&&d.video.output.forEach(function(a){a._rttMilliseconds=i}),a.abrupt("return",d);case 26:return a.abrupt("return",Promise.reject(new x.IllegalState));case 27:case"end":return a.stop()}},a,this)}));return a}()},{key:"getRemoteAudioStats",value:function(){return this.getStats().then(function(a){return a.audio.output.length>0?a.audio.output[0]:Promise.reject(new x.IllegalState)})}},{key:"getUserAudioStats",value:function(){return this.getStats().then(function(a){return a.audio.input.length>0?a.audio.input[0]:Promise.reject(new x.IllegalState)})}},{key:"getRemoteVideoStats",value:function(){return this.getStats().then(function(a){return a.video.output.length>0?a.video.output[0]:Promise.reject(new x.IllegalState)})}},{key:"getUserVideoStats",value:function(){return this.getStats().then(function(a){return a.video.input.length>0?a.video.input[0]:Promise.reject(new x.IllegalState)})}},{key:"_onIceCandidate",value:function(a){this._state.onIceCandidate(a)}},{key:"_onIceStateChange",value:function(a){this._state.onIceStateChange(a)}},{key:"_ontrack",value:function(a){a.streams.length>1&&this._logger.warn("Found more than 1 streams for "+a.track.kind+" track "+a.track.id+" : "+a.streams.map(function(a){return a.id}).join(",")),"video"===a.track.kind&&this._remoteVideoElement?(this._remoteVideoElement.srcObject=a.streams[0],this._remoteVideoStream=a.streams[0]):"audio"===a.track.kind&&this._remoteAudioElement&&(this._remoteAudioElement.srcObject=a.streams[0],this._remoteAudioStream=a.streams[0]),this._onRemoteStreamAdded(this,a.streams[0])}},{key:"_detachMedia",value:function(){this._remoteVideoElement&&(this._remoteVideoElement.srcObject=null),this._remoteAudioElement&&(this._remoteAudioElement.srcObject=null,this._remoteAudioStream=null)}},{key:"_stopSession",value:function(){try{this._localStream&&!this._userProvidedStream&&((0,u.closeStream)(this._localStream),this._localStream=null,this._userProvidedStream=!1)}finally{try{this._pc&&this._pc.close()}catch(a){}finally{this._pc=null}}}},{key:"_buildMediaConstraints",value:function(){var a=this,b={};if(a._enableAudio){var c={};void 0!==a._echoCancellation&&(c.echoCancellation=!!a._echoCancellation),Object.keys(c).length>0?b.audio=c:b.audio=!0}else b.audio=!1;if(a._enableVideo){var d={},e={},f={},g={};void 0!==a._idealVideoWidth&&(e.ideal=a._idealVideoWidth),void 0!==a._maxVideoWidth&&(e.max=a._maxVideoWidth),void 0!==a._minVideoWidth&&(e.min=a._minVideoWidth),void 0!==a._idealVideoHeight&&(f.ideal=a._idealVideoHeight),void 0!==a._maxVideoHeight&&(f.max=a._maxVideoHeight),void 0!==a._minVideoHeight&&(f.min=a._minVideoHeight),Object.keys(e).length>0&&Object.keys(f).length>0&&(d.width=e,d.height=f),void 0!==a._videoFrameRate&&(g.ideal=a._videoFrameRate),void 0!==a._minVideoFrameRate&&(g.min=a._minVideoFrameRate),void 0!==a._maxVideoFrameRate&&(g.max=a._maxVideoFrameRate),Object.keys(g).length>0&&(d.frameRate=g),"user"!==a._facingMode&&"environment"!==a._facingMode&&(a._facingMode="user"),d.facingMode=a._facingMode,Object.keys(d).length>0?b.video=d:b.video=!0}return b}},{key:"sessionReport",get:function(){return this._sessionReport}},{key:"callId",get:function(){return this._callId}},{key:"mediaStream",get:function(){return this._localStream},set:function(a){this._localStream=a,this._userProvidedStream=!0}},{key:"remoteVideoStream",get:function(){return this._remoteVideoStream}},{key:"onGumSuccess",set:function(a){this._onGumSuccess=a}},{key:"onGumError",set:function(a){this._onGumError=a}},{key:"onSessionFailed",set:function(a){this._onSessionFailed=a}},{key:"onLocalStreamAdded",set:function(a){this._onLocalStreamAdded=a}},{key:"onSessionInitialized",set:function(a){this._onSessionInitialized=a}},{key:"onSignalingConnected",set:function(a){this._onSignalingConnected=a}},{key:"onIceCollectionComplete",set:function(a){this._onIceCollectionComplete=a}},{key:"onSignalingStarted",set:function(a){this._onSignalingStarted=a}},{key:"onSessionConnected",set:function(a){this._onSessionConnected=a}},{key:"onRemoteStreamAdded",set:function(a){this._onRemoteStreamAdded=a}},{key:"onSessionCompleted",set:function(a){this._onSessionCompleted=a}},{key:"onSessionDestroyed",set:function(a){this._onSessionDestroyed=a}},{key:"enableAudio",set:function(a){this._enableAudio=a}},{key:"echoCancellation",set:function(a){this._echoCancellation=a}},{key:"enableVideo",set:function(a){this._enableVideo=a}},{key:"maxVideoFrameRate",set:function(a){this._maxVideoFrameRate=a}},{key:"minVideoFrameRate",set:function(a){this._minVideoFrameRate=a}},{key:"videoFrameRate",set:function(a){this._videoFrameRate=a}},{key:"maxVideoWidth",set:function(a){this._maxVideoWidth=a}},{key:"minVideoWidth",set:function(a){this._minVideoWidth=a}},{key:"idealVideoWidth",set:function(a){this._idealVideoWidth=a}},{key:"maxVideoHeight",set:function(a){this._maxVideoHeight=a}},{key:"minVideoHeight",set:function(a){this._minVideoHeight=a}},{key:"idealVideoHeight",set:function(a){this._idealVideoHeight=a}},{key:"facingMode",set:function(a){this._facingMode=a}},{key:"remoteAudioElement",set:function(a){this._remoteAudioElement=a}},{key:"remoteVideoElement",set:function(a){this._remoteVideoElement=a}},{key:"signalingConnectTimeout",set:function(a){this._signalingConnectTimeout=a}},{key:"iceTimeoutMillis",set:function(a){this._iceTimeoutMillis=a}},{key:"gumTimeoutMillis",set:function(a){this._gumTimeoutMillis=a}},{key:"forceAudioCodec",set:function(a){this._forceAudioCodec=a}},{key:"forceVideoCodec",set:function(a){this._forceVideoCodec=a}},{key:"enableOpusDtx",set:function(a){this._enableOpusDtx=a}}]),a}();c.default=P},{"./exceptions":134,"./rtc_const":135,"./rtp-stats":137,"./session_report":138,"./signaling":139,"./utils":140,"babel-runtime/helpers/asyncToGenerator":9,"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11,"babel-runtime/helpers/get":12,"babel-runtime/helpers/inherits":13,"babel-runtime/helpers/possibleConstructorReturn":14,"babel-runtime/helpers/typeof":15,"babel-runtime/regenerator":16,sdp:117,"uuid/v4":120}],137:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c){var d=null,e=null,f=null;return b.forEach(function(b){b&&("ssrc"===b.type?(e=b.type,parseInt(b.stat("packetsSent"))&&"audio"==b.stat("mediaType")&&"audio_output"===c?d={timestamp:a,packetsCount:parseInt(b.stat("packetsSent")),bytesSent:parseInt(b.stat("bytesSent")),audioLevel:(0,j.when_defined)(parseInt(b.stat("audioInputLevel"))),packetsLost:(0,j.is_defined)(b.stat("packetsLost"))?Math.max(0,b.stat("packetsLost")):0,procMilliseconds:(0,j.when_defined)(parseInt(b.stat("googCurrentDelayMs"))),rttMilliseconds:(0,
j.when_defined)(parseInt(b.stat("googRtt"))),jbMilliseconds:(0,j.when_defined)(parseInt(b.stat("googJitterReceived")))}:parseInt(b.stat("packetsReceived"))&&"audio"==b.stat("mediaType")&&"audio_input"===c?d={timestamp:a,packetsCount:parseInt(b.stat("packetsReceived")),bytesReceived:parseInt(b.stat("bytesReceived")),audioLevel:(0,j.when_defined)(parseInt(b.stat("audioOutputLevel"))),packetsLost:(0,j.is_defined)(parseInt(b.stat("packetsLost")))?Math.max(0,b.stat("packetsLost")):0,procMilliseconds:(0,j.when_defined)(parseInt(b.stat("googCurrentDelayMs"))),jbMilliseconds:(0,j.when_defined)(parseInt(b.stat("googJitterReceived")))}:(0,j.is_defined)(b.packetsSent)&&"video"==b.mediaType&&"video_input"===c?d={timestamp:a,packetsCount:parseInt(b.stat("packetsSent")),bytesSent:parseInt(b.stat("bytesSent")),packetsLost:(0,j.is_defined)(b.stat("packetsLost"))?Math.max(0,b.stat("packetsLost")):0,rttMilliseconds:(0,j.when_defined)(parseInt(b.stat("googRtt"))),procMilliseconds:(0,j.when_defined)(parseInt(b.stat("googCurrentDelayMs"))),frameRateSent:(0,j.when_defined)(parseFloat(b.stat("googFrameRateSent")))}:void 0!==b.packetsReceived&&"video"==b.mediaType&&"video_output"===c&&(d={timestamp:a,packetsCount:parseInt(b.stat("packetsSent")),bytesReceived:parseInt(b.stat("bytesReceived")),packetsLost:(0,j.is_defined)(parseInt(b.stat("packetsLost")))?Math.max(0,b.stat("packetsLost")):0,frameRateReceived:(0,j.when_defined)(parseFloat(b.stat("statsReport.googFrameRateReceived"))),procMilliseconds:(0,j.when_defined)(parseInt(b.stat("googCurrentDelayMs"))),jbMilliseconds:(0,j.when_defined)(parseInt(b.stat("googJitterReceived")))})):"inbound-rtp"!==b.type||b.isRemote||"audio_input"!==c&&"video_input"!==c?"outbound-rtp"!==b.type||b.isRemote||"audio_output"!==c&&"video_output"!==c?"remote-inbound-rtp"!==b.type||"audio_output"!==c&&"video_output"!==c?"inbound-rtp"!==b.type||!b.isRemote||"audio_output"!==c&&"video_output"!==c||(e=b.type,d={timestamp:a,packetsLost:b.packetsLost,packetsCount:f,rttMilliseconds:Number.isInteger(b.roundTripTime)?b.roundTripTime:(0,j.is_defined)(b.roundTripTime)?1e3*b.roundTripTime:null,jbMilliseconds:1e3*(0,j.when_defined)(b.jitter,0)}):(e=b.type,d={timestamp:a,packetsLost:b.packetsLost,packetsCount:f,rttMilliseconds:Number.isInteger(b.roundTripTime)?b.roundTripTime:(0,j.is_defined)(b.roundTripTime)?1e3*b.roundTripTime:null,jbMilliseconds:1e3*(0,j.when_defined)(b.jitter,0)}):d&&!d.packetsCount?d.packetsCount=b.packetsSent:f=b.packetsSent:(e=b.type,d={timestamp:a,packetsLost:b.packetsLost,packetsCount:b.packetsReceived,jbMilliseconds:1e3*(0,j.when_defined)(b.jitter,0)}))}),d?new k(d,e,c):null}Object.defineProperty(c,"__esModule",{value:!0});var f=a("babel-runtime/helpers/classCallCheck"),g=d(f),h=a("babel-runtime/helpers/createClass"),i=d(h);c.extractMediaStatsFromStats=e;var j=a("./utils"),k=function(){function a(b,c,d){(0,g.default)(this,a);var e=b||{};this._timestamp=e.timestamp||(new Date).getTime(),this._packetsLost=(0,j.when_defined)(e.packetsLost),this._packetsCount=(0,j.when_defined)(e.packetsCount),this._audioLevel=(0,j.when_defined)(e.audioLevel),this._procMilliseconds=(0,j.when_defined)(e.procMilliseconds),this._rttMilliseconds=(0,j.when_defined)(e.rttMilliseconds),this._jbMilliseconds=(0,j.when_defined)(e.jbMilliseconds),this._bytesSent=(0,j.when_defined)(e.bytesSent),this._bytesReceived=(0,j.when_defined)(e.bytesReceived),this._framesEncoded=(0,j.when_defined)(e.framesEncoded),this._framesDecoded=(0,j.when_defined)(e.framesDecoded),this._frameRateSent=(0,j.when_defined)(e.frameRateSent),this._frameRateReceived=(0,j.when_defined)(e.frameRateReceived),this._statsReportType=c||e._statsReportType||"unknown",this._streamType=d||e.streamType||"unknown"}return(0,i.default)(a,[{key:"packetsCount",get:function(){return this._packetsCount}},{key:"packetsLost",get:function(){return this._packetsLost}},{key:"packetLossPercentage",get:function(){return this._packetsCount>0?this._packetsLost/this._packetsCount:0}},{key:"audioLevel",get:function(){return this._audioLevel}},{key:"timestamp",get:function(){return this._timestamp}},{key:"procMilliseconds",get:function(){return this._procMilliseconds}},{key:"rttMilliseconds",get:function(){return this._rttMilliseconds}},{key:"jbMilliseconds",get:function(){return this._jbMilliseconds}},{key:"bytesSent",get:function(){return this._bytesSent}},{key:"bytesReceived",get:function(){return this._bytesReceived}},{key:"framesEncoded",get:function(){return this._framesEncoded}},{key:"framesDecoded",get:function(){return this._framesDecoded}},{key:"frameRateSent",get:function(){return this._frameRateSent}},{key:"frameRateReceived",get:function(){return this._frameRateReceived}},{key:"statsReportType",get:function(){return this._statsReportType}},{key:"streamType",get:function(){return this._streamType}}]),a}()},{"./utils":140,"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11}],138:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.SessionReport=void 0;var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g);c.SessionReport=function(){function a(){(0,f.default)(this,a),this._sessionStartTime=null,this._sessionEndTime=null,this._gumTimeMillis=null,this._initializationTimeMillis=null,this._iceCollectionTimeMillis=null,this._signallingConnectTimeMillis=null,this._handshakingTimeMillis=null,this._preTalkingTimeMillis=null,this._talkingTimeMillis=null,this._iceConnectionsLost=0,this._cleanupTimeMillis=null,this._iceCollectionFailure=null,this._signallingConnectionFailure=null,this._handshakingFailure=null,this._gumOtherFailure=null,this._gumTimeoutFailure=null,this._createOfferFailure=null,this._setLocalDescriptionFailure=null,this._userBusyFailure=null,this._invalidRemoteSDPFailure=null,this._noRemoteIceCandidateFailure=null,this._setRemoteDescriptionFailure=null,this._streamStats=[]}return(0,h.default)(a,[{key:"sessionStartTime",get:function(){return this._sessionStartTime},set:function(a){this._sessionStartTime=a}},{key:"sessionEndTime",get:function(){return this._sessionEndTime},set:function(a){this._sessionEndTime=a}},{key:"gumTimeMillis",get:function(){return this._gumTimeMillis},set:function(a){this._gumTimeMillis=a}},{key:"initializationTimeMillis",get:function(){return this._initializationTimeMillis},set:function(a){this._initializationTimeMillis=a}},{key:"iceCollectionTimeMillis",get:function(){return this._iceCollectionTimeMillis},set:function(a){this._iceCollectionTimeMillis=a}},{key:"signallingConnectTimeMillis",get:function(){return this._signallingConnectTimeMillis},set:function(a){this._signallingConnectTimeMillis=a}},{key:"preTalkingTimeMillis",get:function(){return this._preTalkingTimeMillis},set:function(a){this._preTalkingTimeMillis=a}},{key:"handshakingTimeMillis",get:function(){return this._handshakingTimeMillis},set:function(a){this._handshakingTimeMillis=a}},{key:"talkingTimeMillis",get:function(){return this._talkingTimeMillis},set:function(a){this._talkingTimeMillis=a}},{key:"iceConnectionsLost",get:function(){return this._iceConnectionsLost},set:function(a){this._iceConnectionsLost=a}},{key:"cleanupTimeMillis",get:function(){return this._cleanupTimeMillis},set:function(a){this._cleanupTimeMillis=a}},{key:"iceCollectionFailure",get:function(){return this._iceCollectionFailure},set:function(a){this._iceCollectionFailure=a}},{key:"signallingConnectionFailure",get:function(){return this._signallingConnectionFailure},set:function(a){this._signallingConnectionFailure=a}},{key:"handshakingFailure",get:function(){return this._handshakingFailure},set:function(a){this._handshakingFailure=a}},{key:"gumTimeoutFailure",get:function(){return this._gumTimeoutFailure},set:function(a){this._gumTimeoutFailure=a}},{key:"gumOtherFailure",get:function(){return this._gumOtherFailure},set:function(a){this._gumOtherFailure=a}},{key:"createOfferFailure",get:function(){return this._createOfferFailure},set:function(a){this._createOfferFailure=a}},{key:"setLocalDescriptionFailure",get:function(){return this._setLocalDescriptionFailure},set:function(a){this._setLocalDescriptionFailure=a}},{key:"userBusyFailure",get:function(){return this._userBusyFailure},set:function(a){this._userBusyFailure=a}},{key:"invalidRemoteSDPFailure",get:function(){return this._invalidRemoteSDPFailure},set:function(a){this._invalidRemoteSDPFailure=a}},{key:"setRemoteDescriptionFailure",get:function(){return this._setRemoteDescriptionFailure},set:function(a){this._setRemoteDescriptionFailure=a}},{key:"noRemoteIceCandidateFailure",get:function(){return this._noRemoteIceCandidateFailure},set:function(a){this._noRemoteIceCandidateFailure=a}},{key:"streamStats",get:function(){return this._streamStats},set:function(a){this._streamStats=a}}]),a}()},{"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11}],139:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.FailedState=c.DisconnectedState=c.PendingLocalHangupState=c.PendingRemoteHangupState=c.PendingReconnectState=c.TalkingState=c.PendingAcceptAckState=c.PendingAcceptState=c.PendingAnswerState=c.PendingInviteState=c.PendingConnectState=c.FailOnTimeoutState=c.SignalingState=void 0;var e=a("babel-runtime/helpers/possibleConstructorReturn"),f=d(e),g=a("babel-runtime/helpers/inherits"),h=d(g),i=a("babel-runtime/helpers/classCallCheck"),j=d(i),k=a("babel-runtime/helpers/createClass"),l=d(k),m=a("./utils"),n=a("./rtc_const"),o=a("./exceptions"),p=a("uuid/v4"),q=d(p),r=a("./virtual_wss_connection_manager"),s=d(r),t=c.SignalingState=function(){function a(b){(0,j.default)(this,a),this._signaling=b,this._createTime=(new Date).getTime()}return(0,l.default)(a,[{key:"setStateTimeout",value:function(a){setTimeout((0,m.hitch)(this,this._onTimeoutChecked),a)}},{key:"onEnter",value:function(){}},{key:"_onTimeoutChecked",value:function(){this.isCurrentState&&this.onTimeout()}},{key:"onTimeout",value:function(){throw new o.UnsupportedOperation}},{key:"transit",value:function(a){this._signaling.transit(a)}},{key:"onExit",value:function(){}},{key:"onOpen",value:function(){throw new o.UnsupportedOperation("onOpen not supported by "+this.name)}},{key:"onError",value:function(){this.channelDown()}},{key:"onClose",value:function(){this.channelDown()}},{key:"channelDown",value:function(){throw new o.UnsupportedOperation("channelDown not supported by "+this.name)}},{key:"onRpcMsg",value:function(a){throw new o.UnsupportedOperation("onRpcMsg not supported by "+this.name)}},{key:"invite",value:function(a,b){throw new o.UnsupportedOperation("invite not supported by "+this.name)}},{key:"accept",value:function(){throw new o.UnsupportedOperation("accept not supported by "+this.name)}},{key:"hangup",value:function(){throw new o.UnsupportedOperation("hangup not supported by "+this.name)}},{key:"isCurrentState",get:function(){return this===this._signaling.state}},{key:"name",get:function(){return"SignalingState"}},{key:"logger",get:function(){return this._signaling._logger}}]),a}(),u=c.FailOnTimeoutState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._timeoutMs=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){this.setStateTimeout(this._timeoutMs)}},{key:"onTimeout",value:function(){this.transit(new F(this._signaling,new o.Timeout))}},{key:"name",get:function(){return"FailOnTimeoutState"}}]),b}(t),v=c.PendingConnectState=function(a){function b(a,c,d,e){(0,j.default)(this,b);var g=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return g._initialStartTime=d||(new Date).getTime(),g._retries=e||0,g}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onOpen",value:function(){this.transit(new w(this._signaling))}},{key:"channelDown",value:function(){var a=(new Date).getTime(),c=this._initialStartTime+this._timeoutMs-a;c>0&&++this._retries<3?(this._signaling._connect(),this.transit(new b(this._signaling,c,this._initialStartTime,this._retries))):this.transit(new F(this._signaling,new Error("channelDown")))}},{key:"name",get:function(){return"PendingConnectState"}}]),b}(u),w=c.PendingInviteState=function(a){function b(){return(0,j.default)(this,b),(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._connectedHandler(),b()})}},{key:"invite",value:function(a,b){var c=this,d=(0,q.default)(),e={sdp:a,candidates:b,callContextToken:c._signaling._contactToken};c.logger.log("Sending SDP",a),c._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:n.INVITE_METHOD_NAME,params:e,id:d})),c.transit(new x(c._signaling,d))}},{key:"channelDown",value:function(){this.transit(new F(this._signaling))}},{key:"name",get:function(){return"PendingInviteState"}}]),b}(t),x=c.PendingAnswerState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,n.MAX_INVITE_DELAY_MS));return d._inviteId=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onRpcMsg",value:function(a){var b=this;a.id===this._inviteId&&(a.error||!a.result?this.transit(new F(this._signaling,b.translateInviteError(a))):(new Promise(function(c){b.logger.log("Received SDP",a.result.sdp),b._signaling._answeredHandler(a.result.sdp,a.result.candidates),c()}),this.transit(new y(this._signaling,this._signaling._autoAnswer))))}},{key:"translateInviteError",value:function(a){return a.error&&486==a.error.code?new o.BusyException(a.error.message):a.error&&404==a.error.code?new o.CallNotFoundException(a.error.message):new o.UnknownSignalingError}},{key:"name",get:function(){return"PendingAnswerState"}}]),b}(u),y=c.PendingAcceptState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._autoAnswer=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){this._autoAnswer&&this.accept()}},{key:"accept",value:function(){var a=(0,q.default)();this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:n.ACCEPT_METHOD_NAME,params:{},id:a})),this.transit(new z(this._signaling,a))}},{key:"channelDown",value:function(){this.transit(new F(this._signaling))}},{key:"name",get:function(){return"PendingAcceptState"}}]),b}(t),z=c.PendingAcceptAckState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,n.MAX_ACCEPT_BYE_DELAY_MS));return d._acceptId=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onRpcMsg",value:function(a){a.id===this._acceptId&&(a.error?this.transit(new F(this._signaling)):(this._signaling._clientToken=a.result.clientToken,this.transit(new A(this._signaling))))}},{key:"name",get:function(){return"PendingAcceptAckState"}}]),b}(u),A=c.TalkingState=function(a){function b(){return(0,j.default)(this,b),(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._handshakedHandler(),b()})}},{key:"hangup",value:function(){var a=(0,q.default)();this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:n.BYE_METHOD_NAME,params:{callContextToken:this._signaling._contactToken},id:a})),this.transit(new C(this._signaling,a))}},{key:"onRpcMsg",value:function(a){a.method===n.BYE_METHOD_NAME?this.transit(new D(this._signaling,a.id)):"renewClientToken"===a.method&&(this._signaling._clientToken=a.params.clientToken)}},{key:"channelDown",value:function(){this._signaling._reconnect(),this._signaling.transit(new B(this._signaling))}},{key:"name",get:function(){return"TalkingState"}}]),b}(t),B=c.PendingReconnectState=function(a){function b(a){return(0,j.default)(this,b),(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,n.DEFAULT_CONNECT_TIMEOUT_MS))}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onOpen",value:function(){this.transit(new A(this._signaling))}},{key:"channelDown",value:function(){this.transit(new F(this._signaling))}},{key:"name",get:function(){return"PendingReconnectState"}}]),b}(u),C=c.PendingRemoteHangupState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,n.MAX_ACCEPT_BYE_DELAY_MS));return d._byeId=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onRpcMsg",value:function(a){a.id!==this._byeId&&a.method!==n.BYE_METHOD_NAME||this.transit(new E(this._signaling))}},{key:"name",get:function(){return"PendingRemoteHangupState"}}]),b}(u),D=c.PendingLocalHangupState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._byeId=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._remoteHungupHandler(),b()})}},{key:"hangup",value:function(){var a=this;a._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",result:{},id:a._byeId})),a.transit(new E(a._signaling))}},{key:"onRpcMsg",value:function(){}},{key:"channelDown",value:function(){this.transit(new E(this._signaling))}},{key:"name",get:function(){return"PendingLocalHangupState"}}]),b}(t),E=c.DisconnectedState=function(a){function b(){return(0,j.default)(this,b),(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._disconnectedHandler(),b()}),this._signaling._wss.close()}},{key:"channelDown",value:function(){}},{key:"onRpcMsg",value:function(){}},{key:"name",get:function(){return"DisconnectedState"}}]),b}(t),F=c.FailedState=function(a){function b(a,c){(0,j.default)(this,b);var d=(0,f.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._exception=c,d}return(0,h.default)(b,a),(0,l.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._failedHandler(a._exception),b()}),this._signaling._wss.close()}},{key:"channelDown",value:function(){}},{key:"name",get:function(){return"FailedState"}},{key:"exception",get:function(){return this._exception}}]),b}(t),G=function(){function a(b,c,d,e,f,g,h){(0,j.default)(this,a),this._callId=b,this._connectTimeoutMs=f||n.DEFAULT_CONNECT_TIMEOUT_MS,this._autoAnswer=!0,this._signalingUri=c,this._contactToken=d,this._logger=(0,m.wrapLogger)(e,b,"SIGNALING"),this._connectionId=g,this._wssManager=h,this._connectedHandler=this._answeredHandler=this._handshakedHandler=this._reconnectedHandler=this._remoteHungupHandler=this._disconnectedHandler=this._failedHandler=function(){}}return(0,l.default)(a,[{key:"connect",value:function(){this._connect(),this.transit(new v(this,this._connectTimeoutMs))}},{key:"_connect",value:function(){this._wss=this._connectWebSocket(this._buildInviteUri())}},{key:"transit",value:function(a){try{this._logger.info((this._state?this._state.name:"null")+" => "+a.name),this.state&&this.state.onExit&&this.state.onExit()}finally{this._state=a,this._state.onEnter&&this._state.onEnter()}}},{key:"_connectWebSocket",value:function(a){var b=void 0;return b=this._wssManager?new s.default(this._logger,this._connectionId,this._wssManager):new WebSocket(a),b.onopen=(0,m.hitch)(this,this._onOpen),b.onmessage=(0,m.hitch)(this,this._onMessage),b.onerror=(0,m.hitch)(this,this._onError),b.onclose=(0,m.hitch)(this,this._onClose),b}},{key:"_buildInviteUri",value:function(){return this._contactToken?this._buildUriBase()+"&contactCtx="+encodeURIComponent(this._contactToken):this._buildUriBase()}},{key:"_buildReconnectUri",value:function(){return this._buildUriBase()+"&clientToken="+encodeURIComponent(this._clientToken)}},{key:"_buildUriBase",value:function(){var a="?";return this._signalingUri.indexOf(a)>-1&&(a="&"),this._signalingUri+a+"callId="+encodeURIComponent(this._callId)}},{key:"_onMessage",value:function(a){this.state.onRpcMsg(JSON.parse(a.data))}},{key:"_onOpen",value:function(a){this.state.onOpen(a)}},{key:"_onError",value:function(a){this.state.onError(a)}},{key:"_onClose",value:function(a){this._logger.log("WebSocket onclose code="+a.code+", reason="+a.reason),this.state.onClose(a)}},{key:"_reconnect",value:function(){this._wss=this._connectWebSocket(this._buildReconnectUri())}},{key:"invite",value:function(a,b){this.state.invite(a,b)}},{key:"accept",value:function(){this.state.accept()}},{key:"hangup",value:function(){this.state.hangup()}},{key:"callId",get:function(){return this._callId}},{key:"onConnected",set:function(a){this._connectedHandler=a}},{key:"onAnswered",set:function(a){this._answeredHandler=a}},{key:"onHandshaked",set:function(a){this._handshakedHandler=a}},{key:"onReconnected",set:function(a){this._reconnectedHandler=a}},{key:"onRemoteHungup",set:function(a){this._remoteHungupHandler=a}},{key:"onDisconnected",set:function(a){this._disconnectedHandler=a}},{key:"onFailed",set:function(a){this._failedHandler=a}},{key:"state",get:function(){return this._state}}]),a}();c.default=G},{"./exceptions":134,"./rtc_const":135,"./utils":140,"./virtual_wss_connection_manager":141,"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11,"babel-runtime/helpers/inherits":13,"babel-runtime/helpers/possibleConstructorReturn":14,"uuid/v4":120}],140:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.shift();if(!b)throw new p.IllegalParameters("utils.hitch(): scope is required!");if(!c)throw new p.IllegalParameters("utils.hitch(): method is required!");if("function"!=typeof c)throw new p.IllegalParameters("utils.hitch(): method is not a function!");return function(){var d=Array.prototype.slice.call(arguments);return c.apply(b,a.concat(d))}}function f(a,b,c){var d={};return r.forEach(function(f){if(!a[f])throw new Error("Logging method "+f+" required");d[f]=e(a,a[f],b,c)}),d}function g(a){if(a)for(var b=a.getTracks(),c=0;c<b.length;c++){var d=b[c];try{d.stop()}catch(a){}}}function h(a,b){for(var c=(0,q.splitSections)(a),d=1;d<c.length;d++){var e=(0,q.getKind)(c[d]),f=(0,q.parseRtpParameters)(c[d]),g=f.codecs.reduce(function(a,b){return a[""+b.payloadType]=b,a},{});c[d]=(0,q.splitLines)(c[d]).map(function(a){if(a.startsWith("m=")){if(b.forceCodec[e]){var c=Object.keys(g).filter(function(a){return!b._shouldDeleteCodec(e,g[a].name)});return/.*RTP\/S?AVPF? /.exec(a)+c.join(" ")}return a}if(a.startsWith("a=rtpmap:")){var d=(0,q.parseRtpMap)(a),f=g[d.payloadType];return b._shouldDeleteCodec(e,f.name)?null:"OPUS"===f.name.toUpperCase()?(f.parameters.usedtx=b.enableOpusDtx?"1":"0",(a+"\r\n"+(0,q.writeFmtp)(f)).trim()):a}if(a.startsWith("a=fmtp:")){var h=a.substring("a=fmtp:".length,a.indexOf(" ")),f=g[h];return b._shouldDeleteCodec(e,f.name)?null:"OPUS"===f.name.toUpperCase()?null:a}if(a.startsWith("a=rtcp-fb:")){var h=a.substring(a.indexOf(":")+1,a.indexOf(" ")),f=g[h];return b._shouldDeleteCodec(e,f.name)?null:a}return a}).filter(function(a){return null!==a}).join("\r\n")}return{sdp:c.map(function(a){return a.trim()}).join("\r\n")+"\r\n",mLines:c.length-1}}function i(a){return void 0!==a}function j(a,b){var c=i(b)?b:null;return i(a)?a:c}function k(a){return new Promise(function(b){a.getStats(function(){b(!0)}).catch(function(){b(!1)})})}Object.defineProperty(c,"__esModule",{value:!0}),c.SdpOptions=void 0;var l=a("babel-runtime/helpers/classCallCheck"),m=d(l),n=a("babel-runtime/helpers/createClass"),o=d(n);c.hitch=e,c.wrapLogger=f,c.closeStream=g,c.transformSdp=h,c.is_defined=i,c.when_defined=j,c.isLegacyStatsReportSupported=k;var p=a("./exceptions"),q=a("sdp"),r=["log","info","warn","error"];c.SdpOptions=function(){function a(){(0,m.default)(this,a),this._forceCodec={}}return(0,o.default)(a,[{key:"_shouldDeleteCodec",value:function(a,b){var c=b.toUpperCase();return this._forceCodec[a]&&c!==this._forceCodec[a].toUpperCase()&&"TELEPHONE-EVENT"!==c}},{key:"enableOpusDtx",get:function(){return this._enableOpusDtx},set:function(a){this._enableOpusDtx=a}},{key:"forceCodec",get:function(){return this._forceCodec}}]),a}()},{"./exceptions":134,"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11,sdp:117}],141:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=a("./utils"),j=a("./rtc_const"),k=function(){function a(b,c,d){(0,f.default)(this,a),this._logger=b,this._connectionId=c,this._wssManager=d,this._initializeWebSocketEventListeners()}return(0,h.default)(a,[{key:"_initializeWebSocketEventListeners",value:function(){var a=this;this._wssManager.subscribeTopics([j.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(j.SOFTPHONE_ROUTE_KEY,(0,i.hitch)(this,this._webSocketManagerOnMessage)),setTimeout(function(){a._onOpen()},0)}},{key:"_webSocketManagerOnMessage",value:function(a){var b=void 0;a.content&&(b=JSON.parse(a.content)),this._onMessage&&b&&this._connectionId===b.connectionId&&this._onMessage({data:JSON.stringify(b.jsonRpcMsg)})}},{key:"send",value:function(a){var b={};try{b.topic=j.SOFTPHONE_ROUTE_KEY,b.connectionId=this._connectionId,b.jsonRpcMsg=JSON.parse(a),this._wssManager.sendMessage(b)}catch(a){this._logger.error("Error in sendMessage ",a)}}},{key:"close",value:function(){this._logger.info("closing virtual connection"),this._unSubscribe()}},{key:"onmessage",set:function(a){this._onMessage=a}},{key:"onopen",set:function(a){this._onOpen=a}}]),a}();c.default=k},{"./rtc_const":135,"./utils":140,"babel-runtime/helpers/classCallCheck":10,"babel-runtime/helpers/createClass":11}]},{},[133]);