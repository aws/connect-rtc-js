!function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return e(b[g][1][a]||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){(function(d){(function(){"use strict";function e(a){return a&&a.__esModule?a:{default:a}}var f=a("babel-runtime/helpers/toArray"),g=e(f),h=a("babel-runtime/helpers/slicedToArray"),i=e(h),j=a("babel-runtime/regenerator"),k=e(j),l=a("babel-runtime/helpers/asyncToGenerator"),m=e(l),n=a("babel-runtime/helpers/classCallCheck"),o=e(n),p=a("babel-runtime/helpers/createClass"),q=e(p),r=a("babel-runtime/helpers/typeof"),s=e(r);!function(a,d){"object"==(void 0===c?"undefined":(0,s.default)(c))&&void 0!==b?d(c):"function"==typeof define&&define.amd?define(["exports"],d):d((a="undefined"!=typeof globalThis?git:a||self).dcvwebrtc={})}(void 0,function(a){function b(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function c(){return function(){var a=window.navigator.userAgent.toLowerCase();return a.indexOf("edg/")>-1||a.indexOf("edge")>-1}()?w.EDGE:w.CHROME}function e(a,b,c){globalThis.DCVWebRTCRedirProxy=b,E.initCallbacks?(E.initCallbacks.forEach(function(d,e){clearTimeout(d),e({success:a,proxy:b,error:c})}),E.initCallbacks.clear()):l.debug("No DCVWebRTCPeerConnectionProxy.initCallback was specified.")}var f={major:0,minor:3,patch:3,buildNumber:0,gitHash:"2a04538bd16eaa144c6a87ab71a77e2e314f348f",versionStr:"0.3.3+build.0"},h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==d?d:"undefined"!=typeof self?self:{},j={exports:{}};!function(a){var b,c;b=h,c=function(){function a(a,b){var c=a[b];if("function"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(b){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function b(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var a=this.getLevel(),b=0;b<j.length;b++){var c=j[b];this[c]=b<a?g:this.methodFactory(c,a,this.name)}if(this.log=this.debug,("undefined"==typeof console?"undefined":(0,s.default)(console))===h&&a<this.levels.SILENT)return"No console available for logging"}function d(a){return function(){("undefined"==typeof console?"undefined":(0,s.default)(console))!==h&&(c.call(this),this[a].apply(this,arguments))}}function e(c,e,f){return function(c){return"debug"===c&&(c="log"),("undefined"==typeof console?"undefined":(0,s.default)(console))!==h&&("trace"===c&&i?b:void 0!==console[c]?a(console,c):void 0!==console.log?a(console,"log"):g)}(c)||d.apply(this,arguments)}function f(a,b){function d(){var a;if(("undefined"==typeof window?"undefined":(0,s.default)(window))!==h&&o){try{a=window.localStorage[o]}catch(a){}if((void 0===a?"undefined":(0,s.default)(a))===h)try{var b=window.document.cookie,c=encodeURIComponent(o),d=b.indexOf(c+"=");-1!==d&&(a=/^([^;]+)/.exec(b.slice(d+c.length+1))[1])}catch(a){}return void 0===n.levels[a]&&(a=void 0),a}}function f(a){var b=a;if("string"==typeof b&&void 0!==n.levels[b.toUpperCase()]&&(b=n.levels[b.toUpperCase()]),"number"==typeof b&&b>=0&&b<=n.levels.SILENT)return b;throw new TypeError("log.setLevel() called with invalid level: "+a)}var g,i,m,n=this,o="loglevel";"string"==typeof a?o+=":"+a:"symbol"==(void 0===a?"undefined":(0,s.default)(a))&&(o=void 0),n.name=a,n.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},n.methodFactory=b||e,n.getLevel=function(){return null!=m?m:null!=i?i:g},n.setLevel=function(a,b){return m=f(a),!1!==b&&function(a){var b=(j[a]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":(0,s.default)(window))!==h&&o){try{return void(window.localStorage[o]=b)}catch(a){}try{window.document.cookie=encodeURIComponent(o)+"="+b+";"}catch(a){}}}(m),c.call(n)},n.setDefaultLevel=function(a){i=f(a),d()||n.setLevel(a,!1)},n.resetLevel=function(){m=null,function(){if(("undefined"==typeof window?"undefined":(0,s.default)(window))!==h&&o){try{window.localStorage.removeItem(o)}catch(a){}try{window.document.cookie=encodeURIComponent(o)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(a){}}}(),c.call(n)},n.enableAll=function(a){n.setLevel(n.levels.TRACE,a)},n.disableAll=function(a){n.setLevel(n.levels.SILENT,a)},n.rebuild=function(){if(l!==n&&(g=f(l.getLevel())),c.call(n),l===n)for(var a in k)k[a].rebuild()},g=f(l?l.getLevel():"WARN");var p=d();null!=p&&(m=f(p)),c.call(n)}var g=function(){},h="undefined",i=("undefined"==typeof window?"undefined":(0,s.default)(window))!==h&&(0,s.default)(window.navigator)!==h&&/Trident\/|MSIE /.test(window.navigator.userAgent),j=["trace","debug","info","warn","error"],k={},l=null;(l=new f).getLogger=function(a){if("symbol"!=(void 0===a?"undefined":(0,s.default)(a))&&"string"!=typeof a||""===a)throw new TypeError("You must supply a name when creating a logger.");var b=k[a];return b||(b=k[a]=new f(a,l.methodFactory)),b};var m=("undefined"==typeof window?"undefined":(0,s.default)(window))!==h?window.log:void 0;return l.noConflict=function(){return("undefined"==typeof window?"undefined":(0,s.default)(window))!==h&&window.log===l&&(window.log=m),l},l.getLoggers=function(){return k},l.default=l,l},a.exports?a.exports=c():b.log=c()}(j);for(var l=b(j.exports),n=Object.freeze({HELLO_API_NAME:"hello",GETUSERMEDIA_API_NAME:"navigator.mediaDevices.getUserMedia",ENUMERATEDEVICES_API_NAME:"navigator.mediaDevices.enumerateDevices",GENERATE_CERTIFICATE_API_NAME:"RTCPeerConnection.generateCertificate",NEWRTCPEERCONNECTION_API_NAME:"new.RTCPeerConnection",PC_GET_CONFIGURATION:"pcs.getConfiguration",NEW_AUDIO_CONTEXT:"new.AudioContext",CREATE_WORKER:"new.Worker",WORKER_POST_MESSAGE:"workers.postMessage",WORKER_TERMINATE:"workers.terminate",AUDIO_CTX_CREATE_AUDIO_NODE:"audioContexts.createAudioNode",AUDIO_CTX_CLOSE:"audioContexts.close",AUDIO_NODE_CONNECT:"audioNodes.connect",AUDIO_NODE_DISCONNECT:"audioNodes.disconnect",AUDIO_PARAM_SET_VALUE_AT_TIME:"audioParams.setValueAtTime",AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME:"audioParams.linearRampToValueAtTime",AUDIO_NODE_SET_TYPE:"audioNodes.setType",AUDIO_NODE_START:"audioNodes.start",AUDIO_NODE_STOP:"audioNodes.stop",PC_CLOSE_API_NAME:"pcs.close",ADDSTREAM_API_NAME:"pcs.addStream",STREAM_REMOVE_TRACK:"streams.removeTrack",STREAM_ADD_TRACK:"streams.addTrack",GET_STATS_API_NAME:"pcs.getStats",CREATE_OFFER_API_NAME:"pcs.createOffer",SET_LOCAL_DESCRIPTION_API_NAME:"pcs.setLocalDescription",ADD_PC_EVENT_LISTENER:"pcs.addEventListener",ADD_TRACK_EVENT_LISTENER:"tracks.addEventListener",ADD_DTMF_EVENT_LISTENER:"dtmfs.addEventListener",ADD_WORKER_EVENT_LISTENER:"workers.addEventListener",SET_REMOTE_DESCRIPTION_API_NAME:"pcs.setRemoteDescription",ADD_ICE_CANDIDATE_API_NAME:"pcs.addIceCandidate",CREATE_MEDIA_ELEMENT_API_NAME:"document.createElement",MEDIA_ELEMENT_SET_SINK_ID_API_NAME:"mediaElements.setSinkId",MEDIA_ELEMENT_REMOVE:"mediaElements.remove",CREATE_ANSWER_API_NAME:"pcs.createAnswer",UNLOAD_EVENT_NAME:"unload",TOGGLE_TRACK_ENABLED_API_NAME:"tracks.enabled",TRACK_STOP_API_NAME:"tracks.stop",TRACK_GET_SETTINGS:"tracks.getSettings",GET_RECEIVERS_API_NAME:"pcs.getReceivers",ADD_TRACK_API_NAME:"pcs.addTrack",GET_SENDERS_API_NAME:"pcs.getSenders",GET_SENDER_STATS_API_NAME:"senders.getStats",GET_RECEIVER_STATS_API_NAME:"receivers.getStats",SET_MEDIA_SRC_OBJ_API_NAME:"mediaElements.srcObject",SET_MEDIA_HIDDEN_API_NAME:"mediaElements.hidden",SET_MEDIA_VOLUME_API_NAME:"mediaElements.volume",MEDIA_ELEMENT_PLAY_API_NAME:"mediaElements.play",MEDIA_ELEMENT_PAUSE_API_NAME:"mediaElements.pause",MEDIA_ELEMENT_MUTED:"mediaElements.muted",ADD_TRANSCEIVER_API_NAME:"pcs.addTransceiver",GET_TRANSCEIVERS_API_NAME:"pcs.getTransceivers",TRANSCEIVER_SET_CODEC_PREFS:"transceivers.setCodecPreferences",REPLACE_SENDER_TRACK_API_NAME:"senders.replaceTrack",PC_REMOVE_TRACK_API_NAME:"pcs.removeTrack",INSERT_DTMF_API_NAME:"dtmfSenders.insertDTMF",SENDER_CREATE_ENCODED_STREAMS:"senders.createEncodedStreams",RECEIVER_CREATE_ENCODED_STREAMS:"receivers.createEncodedStreams"}),p=Object.freeze({SIG_STATE_CHANGE:"signalingstatechange",TRACK:"track",CONN_STATE_CHANGE:"connectionstatechange",ICE_CONN_STATE_CHANGE:"iceconnectionstatechange",ICE_GATHER_STATE_CHANGE:"icegatheringstatechange",ICE_CANDIDATE:"icecandidate",NEGOTIATION_NEEDED:"negotiationneeded"}),r=Object.freeze({ENDED:"ended",MUTE:"mute",UNMUTE:"unmute"}),t=Object.freeze({TONECHANGE:"tonechange"}),u=Object.freeze({ERROR:"error",MESSAGE:"message",MESSAGE_ERROR:"messageerror"}),v=Object.freeze({NEW:"new",AVAILABLE:"available",UNAVAILABLE:"unavailable"}),w=Object.freeze({CHROME:"diilpfplcnhehakckkpmcmibmhbingnd",EDGE:"kjbbkjjiecchbcdoollhgffghfjnbhef"}),x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y="undefined"==typeof Uint8Array?[]:new Uint8Array(256),z=0;z<64;z++)y[x.charCodeAt(z)]=z;var A=function(a){var b,c=new Uint8Array(a),d=c.length,e="";for(b=0;b<d;b+=3)e+=x[c[b]>>2],e+=x[(3&c[b])<<4|c[b+1]>>4],e+=x[(15&c[b+1])<<2|c[b+2]>>6],e+=x[63&c[b+2]];return d%3==2?e=e.substring(0,e.length-1)+"=":d%3==1&&(e=e.substring(0,e.length-2)+"=="),e},B=function(a){var b,c,d,e,f,g=.75*a.length,h=a.length,i=0;"="===a[a.length-1]&&(g--,"="===a[a.length-2]&&g--);var j=new ArrayBuffer(g),k=new Uint8Array(j);for(b=0;b<h;b+=4)c=y[a.charCodeAt(b)],d=y[a.charCodeAt(b+1)],e=y[a.charCodeAt(b+2)],f=y[a.charCodeAt(b+3)],k[i++]=c<<2|d>>4,k[i++]=(15&d)<<4|e>>2,k[i++]=(3&e)<<6|63&f;return j},C={exports:{}};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
!function(a,b){!function(a){function b(a){for(var b=a.length;--b>=0;)a[b]=0}function c(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function d(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function e(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function f(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=qa,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ua(this.dyn_ltree),ua(this.dyn_dtree),ua(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ua(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ua(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function g(a){this.options=Oa({level:cb,method:eb,chunkSize:16384,windowBits:15,memLevel:8,strategy:db},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wa,this.strm.avail_out=0;var c=Ma.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==ab)throw new Error(U[c]);if(b.header&&Ma.deflateSetHeader(this.strm,b.header),b.dictionary){var d=void 0;if(d="string"==typeof b.dictionary?Ta(b.dictionary):"[object ArrayBuffer]"===Xa.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,(c=Ma.deflateSetDictionary(this.strm,d))!==ab)throw new Error(U[c]);this._dict_set=!0}}function h(a,b){var c=new g(b);if(c.push(a,!0),c.err)throw c.msg||U[c.err];return c.result}function i(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function j(a){this.options=Oa({chunkSize:65536,windowBits:15,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wa,this.strm.avail_out=0;var c=Pb.inflateInit2(this.strm,b.windowBits);if(c!==Ub)throw new Error(U[c]);if(this.header=new Qb,Pb.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"==typeof b.dictionary?b.dictionary=Ta(b.dictionary):"[object ArrayBuffer]"===Rb.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(c=Pb.inflateSetDictionary(this.strm,b.dictionary))!==Ub))throw new Error(U[c])}function k(a,b){var c=new j(b);if(c.push(a),c.err)throw c.msg||U[c.err];return c.result}var l=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),m=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),p=new Array(576);b(p);var q=new Array(60);b(q);var r=new Array(512);b(r);var t=new Array(256);b(t);var u=new Array(29);b(u);var v=new Array(30),w=void 0,x=void 0,y=void 0;b(v);var z=function(a){return a<256?r[a]:r[256+(a>>>7)]},A=function(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255},B=function(a,b,c){a.bi_valid>16-c?(a.bi_buf|=b<<a.bi_valid&65535,A(a,a.bi_buf),a.bi_buf=b>>16-a.bi_valid,a.bi_valid+=c-16):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)},C=function(a,b,c){B(a,c[2*b],c[2*b+1])},D=function(a,b){var c=0;do{c|=1&a,a>>>=1,c<<=1}while(--b>0);return c>>>1},E=function(a,b,c){var d=new Array(16),e=void 0,f=void 0,g=0;for(e=1;e<=15;e++)g=g+c[e-1]<<1,d[e]=g;for(f=0;f<=b;f++){var h=a[2*f+1];0!==h&&(a[2*f]=D(d[h]++,h))}},F=function(a){var b=void 0;for(b=0;b<286;b++)a.dyn_ltree[2*b]=0;for(b=0;b<30;b++)a.dyn_dtree[2*b]=0;for(b=0;b<19;b++)a.bl_tree[2*b]=0;a.dyn_ltree[512]=1,a.opt_len=a.static_len=0,a.sym_next=a.matches=0},G=function(a){a.bi_valid>8?A(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0},H=function(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]},I=function(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&H(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!H(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d},J=function(a,b,c){var d=void 0,e=void 0,f=void 0,g=void 0,h=0;if(0!==a.sym_next)do{d=255&a.pending_buf[a.sym_buf+h++],d+=(255&a.pending_buf[a.sym_buf+h++])<<8,e=a.pending_buf[a.sym_buf+h++],0===d?C(a,e,b):(f=t[e],C(a,f+256+1,b),g=l[f],0!==g&&(e-=u[f],B(a,e,g)),d--,f=z(d),C(a,f,c),0!==(g=m[f])&&(d-=v[f],B(a,d,g)))}while(h<a.sym_next);C(a,256,b)},K=function(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g=void 0,h=void 0,i=void 0,j=-1;for(a.heap_len=0,a.heap_max=573,g=0;g<f;g++)0!==c[2*g]?(a.heap[++a.heap_len]=j=g,a.depth[g]=0):c[2*g+1]=0;for(;a.heap_len<2;)i=a.heap[++a.heap_len]=j<2?++j:0,c[2*i]=1,a.depth[i]=0,a.opt_len--,e&&(a.static_len-=d[2*i+1]);for(b.max_code=j,g=a.heap_len>>1;g>=1;g--)I(a,c,g);i=f;do{g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],I(a,c,1),h=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=h,c[2*i]=c[2*g]+c[2*h],a.depth[i]=(a.depth[g]>=a.depth[h]?a.depth[g]:a.depth[h])+1,c[2*g+1]=c[2*h+1]=i,a.heap[1]=i++,I(a,c,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],function(a,b){var c=b.dyn_tree,d=b.max_code,e=b.stat_desc.static_tree,f=b.stat_desc.has_stree,g=b.stat_desc.extra_bits,h=b.stat_desc.extra_base,i=b.stat_desc.max_length,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=0;for(m=0;m<=15;m++)a.bl_count[m]=0;for(c[2*a.heap[a.heap_max]+1]=0,j=a.heap_max+1;j<573;j++)k=a.heap[j],m=c[2*c[2*k+1]+1]+1,m>i&&(m=i,p++),c[2*k+1]=m,k>d||(a.bl_count[m]++,n=0,k>=h&&(n=g[k-h]),o=c[2*k],a.opt_len+=o*(m+n),f&&(a.static_len+=o*(e[2*k+1]+n)));if(0!==p){do{for(m=i-1;0===a.bl_count[m];)m--;a.bl_count[m]--,a.bl_count[m+1]+=2,a.bl_count[i]--,p-=2}while(p>0);for(m=i;0!==m;m--)for(k=a.bl_count[m];0!==k;)(l=a.heap[--j])>d||(c[2*l+1]!==m&&(a.opt_len+=(m-c[2*l+1])*c[2*l],c[2*l+1]=m),k--)}}(a,b),E(c,j,a.bl_count)},L=function(a,b,c){var d=void 0,e=void 0,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[32]++):h<=10?a.bl_tree[34]++:a.bl_tree[36]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))},M=function(a,b,c){var d=void 0,e=void 0,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<i&&e===g)){if(h<j)do{C(a,e,a.bl_tree)}while(0!=--h);else 0!==e?(e!==f&&(C(a,e,a.bl_tree),h--),C(a,16,a.bl_tree),B(a,h-3,2)):h<=10?(C(a,17,a.bl_tree),B(a,h-3,3)):(C(a,18,a.bl_tree),B(a,h-11,7));h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4)}},N=!1,O=function(a,b,c,d){B(a,0+(d?1:0),3),G(a),A(a,c),A(a,~c),c&&a.pending_buf.set(a.window.subarray(b,b+c),a.pending),a.pending+=c},P=function(a,b,c,d){var e=void 0,f=void 0,g=0;a.level>0?(2===a.strm.data_type&&(a.strm.data_type=function(a){var b=void 0,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(b=32;b<256;b++)if(0!==a.dyn_ltree[2*b])return 1;return 0}(a)),K(a,a.l_desc),K(a,a.d_desc),g=function(a){var b=void 0;for(L(a,a.dyn_ltree,a.l_desc.max_code),L(a,a.dyn_dtree,a.d_desc.max_code),K(a,a.bl_desc),b=18;b>=3&&0===a.bl_tree[2*o[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}(a),e=a.opt_len+3+7>>>3,(f=a.static_len+3+7>>>3)<=e&&(e=f)):e=f=c+5,c+4<=e&&-1!==b?O(a,b,c,d):4===a.strategy||f===e?(B(a,2+(d?1:0),3),J(a,p,q)):(B(a,4+(d?1:0),3),function(a,b,c,d){var e=void 0;for(B(a,b-257,5),B(a,c-1,5),B(a,d-4,4),e=0;e<d;e++)B(a,a.bl_tree[2*o[e]+1],3);M(a,a.dyn_ltree,b-1),M(a,a.dyn_dtree,c-1)}(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),J(a,a.dyn_ltree,a.dyn_dtree)),F(a),d&&G(a)},Q={_tr_init:function(a){N||(function(){var a=void 0,b=void 0,d=void 0,e=void 0,f=void 0,g=new Array(16);for(d=0,e=0;e<28;e++)for(u[e]=d,a=0;a<1<<l[e];a++)t[d++]=e;for(t[d-1]=e,f=0,e=0;e<16;e++)for(v[e]=f,a=0;a<1<<m[e];a++)r[f++]=e;for(f>>=7;e<30;e++)for(v[e]=f<<7,a=0;a<1<<m[e]-7;a++)r[256+f++]=e;for(b=0;b<=15;b++)g[b]=0;for(a=0;a<=143;)p[2*a+1]=8,a++,g[8]++;for(;a<=255;)p[2*a+1]=9,a++,g[9]++;for(;a<=279;)p[2*a+1]=7,a++,g[7]++;for(;a<=287;)p[2*a+1]=8,a++,g[8]++;for(E(p,287,g),a=0;a<30;a++)q[2*a+1]=5,q[2*a]=D(a,5);w=new c(p,l,257,286,15),x=new c(q,m,0,30,15),y=new c(new Array(0),n,0,19,7)}(),N=!0),a.l_desc=new d(a.dyn_ltree,w),a.d_desc=new d(a.dyn_dtree,x),a.bl_desc=new d(a.bl_tree,y),a.bi_buf=0,a.bi_valid=0,F(a)},_tr_stored_block:O,_tr_flush_block:P,_tr_tally:function(a,b,c){return a.pending_buf[a.sym_buf+a.sym_next++]=b,a.pending_buf[a.sym_buf+a.sym_next++]=b>>8,a.pending_buf[a.sym_buf+a.sym_next++]=c,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(t[c]+256+1)]++,a.dyn_dtree[2*z(b)]++),a.sym_next===a.sym_end},_tr_align:function(a){B(a,2,3),C(a,256,p),function(a){16===a.bi_valid?(A(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}(a)}},R=function(a,b,c,d){for(var e=65535&a,f=a>>>16&65535,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do{e=e+b[d++]|0,f=f+e|0}while(--g);e%=65521,f%=65521}return e|f<<16},S=new Uint32Array(function(){for(var a=void 0,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}()),T=function(a,b,c,d){var e=S,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return~a},U={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},V={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},W=Q._tr_init,X=Q._tr_stored_block,Y=Q._tr_flush_block,Z=Q._tr_tally,$=Q._tr_align,_=V.Z_NO_FLUSH,aa=V.Z_PARTIAL_FLUSH,ba=V.Z_FULL_FLUSH,ca=V.Z_FINISH,da=V.Z_BLOCK,ea=V.Z_OK,fa=V.Z_STREAM_END,ga=V.Z_STREAM_ERROR,ha=V.Z_DATA_ERROR,ia=V.Z_BUF_ERROR,ja=V.Z_DEFAULT_COMPRESSION,ka=V.Z_FILTERED,la=V.Z_HUFFMAN_ONLY,ma=V.Z_RLE,na=V.Z_FIXED,oa=V.Z_DEFAULT_STRATEGY,pa=V.Z_UNKNOWN,qa=V.Z_DEFLATED,ra=262,sa=function(a,b){return a.msg=U[b],b},ta=function(a){return 2*a-(a>4?9:0)},ua=function(a){for(var b=a.length;--b>=0;)a[b]=0},va=function(a){var b=void 0,c=void 0,d=void 0,e=a.w_size;b=a.hash_size,d=b;do{c=a.head[--d],a.head[d]=c>=e?c-e:0}while(--b);b=e,d=b;do{c=a.prev[--d],a.prev[d]=c>=e?c-e:0}while(--b)},wa=function(a,b,c){return(b<<a.hash_shift^c)&a.hash_mask},xa=function(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(a.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+c),a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))},ya=function(a,b){Y(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,xa(a.strm)},za=function(a,b){a.pending_buf[a.pending++]=b},Aa=function(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b},Ba=function(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,b.set(a.input.subarray(a.next_in,a.next_in+e),c),1===a.state.wrap?a.adler=R(a.adler,b,e,c):2===a.state.wrap&&(a.adler=T(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)},Ca=function(a,b){var c=void 0,d=void 0,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-ra?a.strstart-(a.w_size-ra):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+258,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do{if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do{}while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=258-(m-f),f=m-258,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}}while((b=l[b&k])>i&&0!=--e);return g<=a.lookahead?g:a.lookahead},Da=function(a){var b=a.w_size,c=void 0,d=void 0,e=void 0;do{if(d=a.window_size-a.lookahead-a.strstart,a.strstart>=b+(b-ra)&&(a.window.set(a.window.subarray(b,b+b-d),0),a.match_start-=b,a.strstart-=b,a.block_start-=b,a.insert>a.strstart&&(a.insert=a.strstart),va(a),d+=b),0===a.strm.avail_in)break;if(c=Ba(a.strm,a.window,a.strstart+a.lookahead,d),a.lookahead+=c,a.lookahead+a.insert>=3)for(e=a.strstart-a.insert,a.ins_h=a.window[e],a.ins_h=wa(a,a.ins_h,a.window[e+1]);a.insert&&(a.ins_h=wa(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++,a.insert--,!(a.lookahead+a.insert<3)););}while(a.lookahead<ra&&0!==a.strm.avail_in)},Ea=function(a,b){var c=void 0,d=void 0,e=void 0,f=a.pending_buf_size-5>a.w_size?a.w_size:a.pending_buf_size-5,g=0,h=a.strm.avail_in;do{if(c=65535,e=a.bi_valid+42>>3,a.strm.avail_out<e)break;if(e=a.strm.avail_out-e,d=a.strstart-a.block_start,c>d+a.strm.avail_in&&(c=d+a.strm.avail_in),c>e&&(c=e),c<f&&(0===c&&b!==ca||b===_||c!==d+a.strm.avail_in))break;g=b===ca&&c===d+a.strm.avail_in?1:0,X(a,0,0,g),a.pending_buf[a.pending-4]=c,a.pending_buf[a.pending-3]=c>>8,a.pending_buf[a.pending-2]=~c,a.pending_buf[a.pending-1]=~c>>8,xa(a.strm),d&&(d>c&&(d=c),a.strm.output.set(a.window.subarray(a.block_start,a.block_start+d),a.strm.next_out),a.strm.next_out+=d,a.strm.avail_out-=d,a.strm.total_out+=d,a.block_start+=d,c-=d),c&&(Ba(a.strm,a.strm.output,a.strm.next_out,c),a.strm.next_out+=c,a.strm.avail_out-=c,a.strm.total_out+=c)}while(0===g);return h-=a.strm.avail_in,h&&(h>=a.w_size?(a.matches=2,a.window.set(a.strm.input.subarray(a.strm.next_in-a.w_size,a.strm.next_in),0),a.strstart=a.w_size,a.insert=a.strstart):(a.window_size-a.strstart<=h&&(a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,a.insert>a.strstart&&(a.insert=a.strstart)),a.window.set(a.strm.input.subarray(a.strm.next_in-h,a.strm.next_in),a.strstart),a.strstart+=h,a.insert+=h>a.w_size-a.insert?a.w_size-a.insert:h),a.block_start=a.strstart),a.high_water<a.strstart&&(a.high_water=a.strstart),g?4:b!==_&&b!==ca&&0===a.strm.avail_in&&a.strstart===a.block_start?2:(e=a.window_size-a.strstart,a.strm.avail_in>e&&a.block_start>=a.w_size&&(a.block_start-=a.w_size,a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,e+=a.w_size,a.insert>a.strstart&&(a.insert=a.strstart)),e>a.strm.avail_in&&(e=a.strm.avail_in),e&&(Ba(a.strm,a.window,a.strstart,e),a.strstart+=e,a.insert+=e>a.w_size-a.insert?a.w_size-a.insert:e),a.high_water<a.strstart&&(a.high_water=a.strstart),e=a.bi_valid+42>>3,e=a.pending_buf_size-e>65535?65535:a.pending_buf_size-e,f=e>a.w_size?a.w_size:e,d=a.strstart-a.block_start,(d>=f||(d||b===ca)&&b!==_&&0===a.strm.avail_in&&d<=e)&&(c=d>e?e:d,g=b===ca&&0===a.strm.avail_in&&c===d?1:0,X(a,a.block_start,c,g),a.block_start+=c,xa(a.strm)),g?3:1)},Fa=function(a,b){for(var c=void 0,d=void 0;;){if(a.lookahead<ra){if(Da(a),a.lookahead<ra&&b===_)return 1;if(0===a.lookahead)break}if(c=0,a.lookahead>=3&&(a.ins_h=wa(a,a.ins_h,a.window[a.strstart+3-1]),c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-ra&&(a.match_length=Ca(a,c)),a.match_length>=3)if(d=Z(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=3){a.match_length--;do{a.strstart++,a.ins_h=wa(a,a.ins_h,a.window[a.strstart+3-1]),c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=wa(a,a.ins_h,a.window[a.strstart+1]);else d=Z(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(ya(a,!1),0===a.strm.avail_out))return 1}return a.insert=a.strstart<2?a.strstart:2,b===ca?(ya(a,!0),0===a.strm.avail_out?3:4):a.sym_next&&(ya(a,!1),0===a.strm.avail_out)?1:2},Ga=function(a,b){for(var c=void 0,d=void 0,e=void 0;;){if(a.lookahead<ra){if(Da(a),a.lookahead<ra&&b===_)return 1;if(0===a.lookahead)break}if(c=0,a.lookahead>=3&&(a.ins_h=wa(a,a.ins_h,a.window[a.strstart+3-1]),c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-ra&&(a.match_length=Ca(a,c),a.match_length<=5&&(a.strategy===ka||3===a.match_length&&a.strstart-a.match_start>4096)&&(a.match_length=2)),a.prev_length>=3&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-3,d=Z(a,a.strstart-1-a.prev_match,a.prev_length-3),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=e&&(a.ins_h=wa(a,a.ins_h,a.window[a.strstart+3-1]),c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!=--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,d&&(ya(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(d=Z(a,0,a.window[a.strstart-1]),d&&ya(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=Z(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<2?a.strstart:2,b===ca?(ya(a,!0),0===a.strm.avail_out?3:4):a.sym_next&&(ya(a,!1),0===a.strm.avail_out)?1:2},Ha=[new e(0,0,0,0,Ea),new e(4,4,8,4,Fa),new e(4,5,16,8,Fa),new e(4,6,32,32,Fa),new e(4,4,16,16,Ga),new e(8,16,32,32,Ga),new e(8,16,128,128,Ga),new e(8,32,128,256,Ga),new e(32,128,258,1024,Ga),new e(32,258,258,4096,Ga)],Ia=function(a){if(!a)return 1;var b=a.state;return!b||b.strm!==a||42!==b.status&&57!==b.status&&69!==b.status&&73!==b.status&&91!==b.status&&103!==b.status&&113!==b.status&&666!==b.status?1:0},Ja=function(a){if(Ia(a))return sa(a,ga);a.total_in=a.total_out=0,a.data_type=pa;var b=a.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=2===b.wrap?57:b.wrap?42:113,a.adler=2===b.wrap?0:1,b.last_flush=-2,W(b),ea},Ka=function(a){var b,c=Ja(a);return c===ea&&((b=a.state).window_size=2*b.w_size,ua(b.head),b.max_lazy_match=Ha[b.level].max_lazy,b.good_match=Ha[b.level].good_length,b.nice_match=Ha[b.level].nice_length,b.max_chain_length=Ha[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),c},La=function(a,b,c,d,e,g){if(!a)return ga;var h=1;if(b===ja&&(b=6),d<0?(h=0,d=-d):d>15&&(h=2,d-=16),e<1||e>9||c!==qa||d<8||d>15||b<0||b>9||g<0||g>na||8===d&&1!==h)return sa(a,ga);8===d&&(d=9);var i=new f;return a.state=i,i.strm=a,i.status=42,i.wrap=h,i.gzhead=null,i.w_bits=d,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=e+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<e+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=b,i.strategy=g,i.method=c,Ka(a)},Ma={deflateInit:function(a,b){return La(a,b,qa,15,8,oa)},deflateInit2:La,deflateReset:Ka,deflateResetKeep:Ja,deflateSetHeader:function(a,b){return Ia(a)||2!==a.state.wrap?ga:(a.state.gzhead=b,ea)},deflate:function(a,b){if(Ia(a)||b>da||b<0)return a?sa(a,ga):ga;var c=a.state;if(!a.output||0!==a.avail_in&&!a.input||666===c.status&&b!==ca)return sa(a,0===a.avail_out?ia:ga);var d=c.last_flush;if(c.last_flush=b,0!==c.pending){if(xa(a),0===a.avail_out)return c.last_flush=-1,ea}else if(0===a.avail_in&&ta(b)<=ta(d)&&b!==ca)return sa(a,ia);if(666===c.status&&0!==a.avail_in)return sa(a,ia);if(42===c.status&&0===c.wrap&&(c.status=113),42===c.status){var e=qa+(c.w_bits-8<<4)<<8,f=-1;if(f=c.strategy>=la||c.level<2?0:c.level<6?1:6===c.level?2:3,e|=f<<6,0!==c.strstart&&(e|=32),e+=31-e%31,Aa(c,e),0!==c.strstart&&(Aa(c,a.adler>>>16),Aa(c,65535&a.adler)),a.adler=1,c.status=113,xa(a),0!==c.pending)return c.last_flush=-1,ea}if(57===c.status)if(a.adler=0,za(c,31),za(c,139),za(c,8),c.gzhead)za(c,(c.gzhead.text?1:0)+(c.gzhead.hcrc?2:0)+(c.gzhead.extra?4:0)+(c.gzhead.name?8:0)+(c.gzhead.comment?16:0)),za(c,255&c.gzhead.time),za(c,c.gzhead.time>>8&255),za(c,c.gzhead.time>>16&255),za(c,c.gzhead.time>>24&255),za(c,9===c.level?2:c.strategy>=la||c.level<2?4:0),za(c,255&c.gzhead.os),c.gzhead.extra&&c.gzhead.extra.length&&(za(c,255&c.gzhead.extra.length),za(c,c.gzhead.extra.length>>8&255)),c.gzhead.hcrc&&(a.adler=T(a.adler,c.pending_buf,c.pending,0)),c.gzindex=0,c.status=69;else if(za(c,0),za(c,0),za(c,0),za(c,0),za(c,0),za(c,9===c.level?2:c.strategy>=la||c.level<2?4:0),za(c,3),c.status=113,xa(a),0!==c.pending)return c.last_flush=-1,ea;if(69===c.status){if(c.gzhead.extra){for(var g=c.pending,h=(65535&c.gzhead.extra.length)-c.gzindex;c.pending+h>c.pending_buf_size;){var i=c.pending_buf_size-c.pending;if(c.pending_buf.set(c.gzhead.extra.subarray(c.gzindex,c.gzindex+i),c.pending),c.pending=c.pending_buf_size,c.gzhead.hcrc&&c.pending>g&&(a.adler=T(a.adler,c.pending_buf,c.pending-g,g)),c.gzindex+=i,xa(a),0!==c.pending)return c.last_flush=-1,ea;g=0,h-=i}var j=new Uint8Array(c.gzhead.extra);c.pending_buf.set(j.subarray(c.gzindex,c.gzindex+h),c.pending),c.pending+=h,c.gzhead.hcrc&&c.pending>g&&(a.adler=T(a.adler,c.pending_buf,c.pending-g,g)),c.gzindex=0}c.status=73}if(73===c.status){if(c.gzhead.name){var k=void 0,l=c.pending;do{if(c.pending===c.pending_buf_size){if(c.gzhead.hcrc&&c.pending>l&&(a.adler=T(a.adler,c.pending_buf,c.pending-l,l)),xa(a),0!==c.pending)return c.last_flush=-1,ea;l=0}k=c.gzindex<c.gzhead.name.length?255&c.gzhead.name.charCodeAt(c.gzindex++):0,za(c,k)}while(0!==k);c.gzhead.hcrc&&c.pending>l&&(a.adler=T(a.adler,c.pending_buf,c.pending-l,l)),c.gzindex=0}c.status=91}if(91===c.status){if(c.gzhead.comment){var m=void 0,n=c.pending;do{if(c.pending===c.pending_buf_size){if(c.gzhead.hcrc&&c.pending>n&&(a.adler=T(a.adler,c.pending_buf,c.pending-n,n)),xa(a),0!==c.pending)return c.last_flush=-1,ea;n=0}m=c.gzindex<c.gzhead.comment.length?255&c.gzhead.comment.charCodeAt(c.gzindex++):0,za(c,m)}while(0!==m);c.gzhead.hcrc&&c.pending>n&&(a.adler=T(a.adler,c.pending_buf,c.pending-n,n))}c.status=103}if(103===c.status){if(c.gzhead.hcrc){if(c.pending+2>c.pending_buf_size&&(xa(a),0!==c.pending))return c.last_flush=-1,ea;za(c,255&a.adler),za(c,a.adler>>8&255),a.adler=0}if(c.status=113,xa(a),0!==c.pending)return c.last_flush=-1,ea}if(0!==a.avail_in||0!==c.lookahead||b!==_&&666!==c.status){var o=0===c.level?Ea(c,b):c.strategy===la?function(a,b){for(var c=void 0;;){if(0===a.lookahead&&(Da(a),0===a.lookahead)){if(b===_)return 1;break}if(a.match_length=0,c=Z(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(ya(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,b===ca?(ya(a,!0),0===a.strm.avail_out?3:4):a.sym_next&&(ya(a,!1),0===a.strm.avail_out)?1:2}(c,b):c.strategy===ma?function(a,b){for(var c=void 0,d=void 0,e=void 0,f=void 0,g=a.window;;){if(a.lookahead<=258){if(Da(a),a.lookahead<=258&&b===_)return 1;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(e=a.strstart-1,(d=g[e])===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+258;do{}while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=258-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(c=Z(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=Z(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(ya(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,b===ca?(ya(a,!0),0===a.strm.avail_out?3:4):a.sym_next&&(ya(a,!1),0===a.strm.avail_out)?1:2}(c,b):Ha[c.level].func(c,b);if(3!==o&&4!==o||(c.status=666),1===o||3===o)return 0===a.avail_out&&(c.last_flush=-1),ea;if(2===o&&(b===aa?$(c):b!==da&&(X(c,0,0,!1),b===ba&&(ua(c.head),0===c.lookahead&&(c.strstart=0,c.block_start=0,c.insert=0))),xa(a),0===a.avail_out))return c.last_flush=-1,ea}return b!==ca?ea:c.wrap<=0?fa:(2===c.wrap?(za(c,255&a.adler),za(c,a.adler>>8&255),za(c,a.adler>>16&255),za(c,a.adler>>24&255),za(c,255&a.total_in),za(c,a.total_in>>8&255),za(c,a.total_in>>16&255),za(c,a.total_in>>24&255)):(Aa(c,a.adler>>>16),Aa(c,65535&a.adler)),xa(a),c.wrap>0&&(c.wrap=-c.wrap),0!==c.pending?ea:fa)},deflateEnd:function(a){if(Ia(a))return ga;var b=a.state.status;return a.state=null,113===b?sa(a,ha):ea},deflateSetDictionary:function(a,b){var c=b.length;if(Ia(a))return ga;var d=a.state,e=d.wrap;if(2===e||1===e&&42!==d.status||d.lookahead)return ga;if(1===e&&(a.adler=R(a.adler,b,c,0)),d.wrap=0,c>=d.w_size){0===e&&(ua(d.head),d.strstart=0,d.block_start=0,d.insert=0);var f=new Uint8Array(d.w_size);f.set(b.subarray(c-d.w_size,c),0),b=f,c=d.w_size}var g=a.avail_in,h=a.next_in,i=a.input;for(a.avail_in=c,a.next_in=0,a.input=b,Da(d);d.lookahead>=3;){var j=d.strstart,k=d.lookahead-2;do{d.ins_h=wa(d,d.ins_h,d.window[j+3-1]),d.prev[j&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=j,j++}while(--k);d.strstart=j,d.lookahead=2,Da(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,a.next_in=h,a.input=i,a.avail_in=g,d.wrap=e,ea},deflateInfo:"pako deflate (from Nodeca project)"},Na=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},Oa=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=(void 0===c?"undefined":(0,s.default)(c)))throw new TypeError(c+"must be non-object");for(var d in c)Na(c,d)&&(a[d]=c[d])}}return a},Pa=function(a){for(var b=0,c=0,d=a.length;c<d;c++)b+=a[c].length;for(var e=new Uint8Array(b),f=0,g=0,h=a.length;f<h;f++){var i=a[f];e.set(i,g),g+=i.length}return e},Qa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){Qa=!1}for(var Ra=new Uint8Array(256),Sa=0;Sa<256;Sa++)Ra[Sa]=Sa>=252?6:Sa>=248?5:Sa>=240?4:Sa>=224?3:Sa>=192?2:1;Ra[254]=Ra[254]=1;var Ta=function(a){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(a);var b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,g=a.length,h=0;for(e=0;e<g;e++)c=a.charCodeAt(e),55296==(64512&c)&&e+1<g&&56320==(64512&(d=a.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),h+=c<128?1:c<2048?2:c<65536?3:4;for(b=new Uint8Array(h),f=0,e=0;f<h;e++)c=a.charCodeAt(e),55296==(64512&c)&&e+1<g&&56320==(64512&(d=a.charCodeAt(e+1)))&&(c=65536+(c-55296<<10)+(d-56320),e++),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},Ua=function(a,b){var c=b||a.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(a.subarray(0,b));var d=void 0,e=void 0,f=new Array(2*c);for(e=0,d=0;d<c;){var g=a[d++];if(g<128)f[e++]=g;else{var h=Ra[g];if(h>4)f[e++]=65533,d+=h-1;else{for(g&=2===h?31:3===h?15:7;h>1&&d<c;)g=g<<6|63&a[d++],h--;h>1?f[e++]=65533:g<65536?f[e++]=g:(g-=65536,f[e++]=55296|g>>10&1023,f[e++]=56320|1023&g)}}}return function(a,b){if(b<65534&&a.subarray&&Qa)return String.fromCharCode.apply(null,a.length===b?a:a.subarray(0,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}(f,e)},Va=function(a,b){(b=b||a.length)>a.length&&(b=a.length);for(var c=b-1;c>=0&&128==(192&a[c]);)c--;return c<0||0===c?b:c+Ra[a[c]]>b?c:b},Wa=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Xa=Object.prototype.toString,Ya=V.Z_NO_FLUSH,Za=V.Z_SYNC_FLUSH,$a=V.Z_FULL_FLUSH,_a=V.Z_FINISH,ab=V.Z_OK,bb=V.Z_STREAM_END,cb=V.Z_DEFAULT_COMPRESSION,db=V.Z_DEFAULT_STRATEGY,eb=V.Z_DEFLATED;g.prototype.push=function(a,b){var c=this.strm,d=this.options.chunkSize,e=void 0,f=void 0;if(this.ended)return!1;for(f=b===~~b?b:!0===b?_a:Ya,"string"==typeof a?c.input=Ta(a):"[object ArrayBuffer]"===Xa.call(a)?c.input=new Uint8Array(a):c.input=a,c.next_in=0,c.avail_in=c.input.length;;)if(0===c.avail_out&&(c.output=new Uint8Array(d),c.next_out=0,c.avail_out=d),(f===Za||f===$a)&&c.avail_out<=6)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else{if((e=Ma.deflate(c,f))===bb)return c.next_out>0&&this.onData(c.output.subarray(0,c.next_out)),e=Ma.deflateEnd(this.strm),this.onEnd(e),this.ended=!0,e===ab;if(0!==c.avail_out){if(f>0&&c.next_out>0)this.onData(c.output.subarray(0,c.next_out)),c.avail_out=0;else if(0===c.avail_in)break}else this.onData(c.output)}return!0},g.prototype.onData=function(a){this.chunks.push(a)},g.prototype.onEnd=function(a){a===ab&&(this.result=Pa(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};var fb={Deflate:g,deflate:h,deflateRaw:function(a,b){return(b=b||{}).raw=!0,h(a,b)},gzip:function(a,b){return(b=b||{}).gzip=!0,h(a,b)},constants:V},gb=16209,hb=function(a,b){var c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=a.state;c=a.next_in,y=a.input,d=c+(a.avail_in-5),e=a.next_out,z=a.output,f=e-(b-a.avail_out),g=e+(a.avail_out-257),h=A.dmax,i=A.wsize,j=A.whave,k=A.wnext,l=A.window,m=A.hold,n=A.bits,o=A.lencode,p=A.distcode,q=(1<<A.lenbits)-1,r=(1<<A.distbits)-1;a:do{n<15&&(m+=y[c++]<<n,n+=8,m+=y[c++]<<n,n+=8),s=o[m&q];b:for(;;){if(t=s>>>24,m>>>=t,n-=t,0===(t=s>>>16&255))z[e++]=65535&s;else{if(!(16&t)){if(!(64&t)){s=o[(65535&s)+(m&(1<<t)-1)];continue b}if(32&t){A.mode=16191;break a}a.msg="invalid literal/length code",A.mode=gb;break a}u=65535&s,t&=15,t&&(n<t&&(m+=y[c++]<<n,n+=8),u+=m&(1<<t)-1,m>>>=t,n-=t),n<15&&(m+=y[c++]<<n,n+=8,m+=y[c++]<<n,n+=8),s=p[m&r];c:for(;;){if(t=s>>>24,m>>>=t,n-=t,!(16&(t=s>>>16&255))){if(!(64&t)){s=p[(65535&s)+(m&(1<<t)-1)];continue c}a.msg="invalid distance code",A.mode=gb;break a}if(v=65535&s,t&=15,n<t&&(m+=y[c++]<<n,(n+=8)<t&&(m+=y[c++]<<n,n+=8)),(v+=m&(1<<t)-1)>h){a.msg="invalid distance too far back",A.mode=gb;break a}if(m>>>=t,n-=t,t=e-f,v>t){if((t=v-t)>j&&A.sane){a.msg="invalid distance too far back",A.mode=gb;break a}if(w=0,x=l,0===k){if(w+=i-t,t<u){u-=t;do{z[e++]=l[w++]}while(--t);w=e-v,x=z}}else if(k<t){if(w+=i+k-t,(t-=k)<u){u-=t;do{z[e++]=l[w++]}while(--t);if(w=0,k<u){t=k,u-=t;do{z[e++]=l[w++]}while(--t);w=e-v,x=z}}}else if(w+=k-t,t<u){u-=t;do{z[e++]=l[w++]}while(--t);w=e-v,x=z}for(;u>2;)z[e++]=x[w++],z[e++]=x[w++],
z[e++]=x[w++],u-=3;u&&(z[e++]=x[w++],u>1&&(z[e++]=x[w++]))}else{w=e-v;do{z[e++]=z[w++],z[e++]=z[w++],z[e++]=z[w++],u-=3}while(u>2);u&&(z[e++]=z[w++],u>1&&(z[e++]=z[w++]))}break}}break}}while(c<d&&e<g);u=n>>3,c-=u,n-=u<<3,m&=(1<<n)-1,a.next_in=c,a.next_out=e,a.avail_in=c<d?d-c+5:5-(c-d),a.avail_out=e<g?g-e+257:257-(e-g),A.hold=m,A.bits=n},ib=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jb=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),kb=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lb=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),mb=function(a,b,c,d,e,f,g,h){var i=h.bits,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=null,A=new Uint16Array(16),B=new Uint16Array(16),C=void 0,D=void 0,E=void 0,F=null;for(p=0;p<=15;p++)A[p]=0;for(q=0;q<d;q++)A[b[c+q]]++;for(t=i,s=15;s>=1&&0===A[s];s--);if(t>s&&(t=s),0===s)return e[f++]=20971520,e[f++]=20971520,h.bits=1,0;for(r=1;r<s&&0===A[r];r++);for(t<r&&(t=r),w=1,p=1;p<=15;p++)if(w<<=1,(w-=A[p])<0)return-1;if(w>0&&(0===a||1!==s))return-1;for(B[1]=0,p=1;p<15;p++)B[p+1]=B[p]+A[p];for(q=0;q<d;q++)0!==b[c+q]&&(g[B[b[c+q]]++]=q);if(0===a?(z=F=g,o=20):1===a?(z=ib,F=jb,o=257):(z=kb,F=lb,o=0),y=0,q=0,p=r,n=f,u=t,v=0,l=-1,x=1<<t,m=x-1,1===a&&x>852||2===a&&x>592)return 1;for(;;){C=p-v,g[q]+1<o?(D=0,E=g[q]):g[q]>=o?(D=F[g[q]-o],E=z[g[q]-o]):(D=96,E=0),j=1<<p-v,k=1<<u,r=k;do{k-=j,e[n+(y>>v)+k]=C<<24|D<<16|E}while(0!==k);for(j=1<<p-1;y&j;)j>>=1;if(0!==j?(y&=j-1,y+=j):y=0,q++,0==--A[p]){if(p===s)break;p=b[c+g[q]]}if(p>t&&(y&m)!==l){for(0===v&&(v=t),n+=r,u=p-v,w=1<<u;u+v<s&&!((w-=A[u+v])<=0);)u++,w<<=1;if(x+=1<<u,1===a&&x>852||2===a&&x>592)return 1;l=y&m,e[l]=t<<24|u<<16|n-f}}return 0!==y&&(e[n+y]=p-v<<24|64<<16),h.bits=t,0},nb=V.Z_FINISH,ob=V.Z_BLOCK,pb=V.Z_TREES,qb=V.Z_OK,rb=V.Z_STREAM_END,sb=V.Z_NEED_DICT,tb=V.Z_STREAM_ERROR,ub=V.Z_DATA_ERROR,vb=V.Z_MEM_ERROR,wb=V.Z_BUF_ERROR,xb=V.Z_DEFLATED,yb=16180,zb=16190,Ab=16191,Bb=16199,Cb=16200,Db=16209,Eb=function(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)},Fb=function(a){if(!a)return 1;var b=a.state;return!b||b.strm!==a||b.mode<yb||b.mode>16211?1:0},Gb=function(a){if(Fb(a))return tb;var b=a.state;return a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=yb,b.last=0,b.havedict=0,b.flags=-1,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,qb},Hb=function(a){if(Fb(a))return tb;var b=a.state;return b.wsize=0,b.whave=0,b.wnext=0,Gb(a)},Ib=function(a,b){var c=void 0;if(Fb(a))return tb;var d=a.state;return b<0?(c=0,b=-b):(c=5+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?tb:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,Hb(a))},Jb=function(a,b){if(!a)return tb;var c=new i;a.state=c,c.strm=a,c.window=null,c.mode=yb;var d=Ib(a,b);return d!==qb&&(a.state=null),d},Kb=void 0,Lb=void 0,Mb=!0,Nb=function(a){if(Mb){Kb=new Int32Array(512),Lb=new Int32Array(32);for(var b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(mb(1,a.lens,0,288,Kb,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;mb(2,a.lens,0,32,Lb,0,a.work,{bits:5}),Mb=!1}a.lencode=Kb,a.lenbits=9,a.distcode=Lb,a.distbits=5},Ob=function(a,b,c,d){var e=void 0,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new Uint8Array(f.wsize)),d>=f.wsize?(f.window.set(b.subarray(c-f.wsize,c),0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),f.window.set(b.subarray(c-d,c-d+e),f.wnext),(d-=e)?(f.window.set(b.subarray(c-d,c),0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0},Pb={inflateReset:Hb,inflateReset2:Ib,inflateResetKeep:Gb,inflateInit:function(a){return Jb(a,15)},inflateInit2:Jb,inflate:function(a,b){var c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=0,z=new Uint8Array(4),A=void 0,B=void 0,C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Fb(a)||!a.output||!a.input&&0!==a.avail_in)return tb;c=a.state,c.mode===Ab&&(c.mode=16192),g=a.next_out,e=a.output,i=a.avail_out,f=a.next_in,d=a.input,h=a.avail_in,j=c.hold,k=c.bits,l=h,m=i,x=qb;a:for(;;)switch(c.mode){case yb:if(0===c.wrap){c.mode=16192;break}for(;k<16;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(2&c.wrap&&35615===j){0===c.wbits&&(c.wbits=15),c.check=0,z[0]=255&j,z[1]=j>>>8&255,c.check=T(c.check,z,2,0),j=0,k=0,c.mode=16181;break}if(c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&j)<<8)+(j>>8))%31){a.msg="incorrect header check",c.mode=Db;break}if((15&j)!==xb){a.msg="unknown compression method",c.mode=Db;break}if(j>>>=4,k-=4,w=8+(15&j),0===c.wbits&&(c.wbits=w),w>15||w>c.wbits){a.msg="invalid window size",c.mode=Db;break}c.dmax=1<<c.wbits,c.flags=0,a.adler=c.check=1,c.mode=512&j?16189:Ab,j=0,k=0;break;case 16181:for(;k<16;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(c.flags=j,(255&c.flags)!==xb){a.msg="unknown compression method",c.mode=Db;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=Db;break}c.head&&(c.head.text=j>>8&1),512&c.flags&&4&c.wrap&&(z[0]=255&j,z[1]=j>>>8&255,c.check=T(c.check,z,2,0)),j=0,k=0,c.mode=16182;case 16182:for(;k<32;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.head&&(c.head.time=j),512&c.flags&&4&c.wrap&&(z[0]=255&j,z[1]=j>>>8&255,z[2]=j>>>16&255,z[3]=j>>>24&255,c.check=T(c.check,z,4,0)),j=0,k=0,c.mode=16183;case 16183:for(;k<16;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.head&&(c.head.xflags=255&j,c.head.os=j>>8),512&c.flags&&4&c.wrap&&(z[0]=255&j,z[1]=j>>>8&255,c.check=T(c.check,z,2,0)),j=0,k=0,c.mode=16184;case 16184:if(1024&c.flags){for(;k<16;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.length=j,c.head&&(c.head.extra_len=j),512&c.flags&&4&c.wrap&&(z[0]=255&j,z[1]=j>>>8&255,c.check=T(c.check,z,2,0)),j=0,k=0}else c.head&&(c.head.extra=null);c.mode=16185;case 16185:if(1024&c.flags&&(n=c.length,n>h&&(n=h),n&&(c.head&&(w=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Uint8Array(c.head.extra_len)),c.head.extra.set(d.subarray(f,f+n),w)),512&c.flags&&4&c.wrap&&(c.check=T(c.check,d,n,f)),h-=n,f+=n,c.length-=n),c.length))break a;c.length=0,c.mode=16186;case 16186:if(2048&c.flags){if(0===h)break a;n=0;do{w=d[f+n++],c.head&&w&&c.length<65536&&(c.head.name+=String.fromCharCode(w))}while(w&&n<h);if(512&c.flags&&4&c.wrap&&(c.check=T(c.check,d,n,f)),h-=n,f+=n,w)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=16187;case 16187:if(4096&c.flags){if(0===h)break a;n=0;do{w=d[f+n++],c.head&&w&&c.length<65536&&(c.head.comment+=String.fromCharCode(w))}while(w&&n<h);if(512&c.flags&&4&c.wrap&&(c.check=T(c.check,d,n,f)),h-=n,f+=n,w)break a}else c.head&&(c.head.comment=null);c.mode=16188;case 16188:if(512&c.flags){for(;k<16;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(4&c.wrap&&j!==(65535&c.check)){a.msg="header crc mismatch",c.mode=Db;break}j=0,k=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=Ab;break;case 16189:for(;k<32;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}a.adler=c.check=Eb(j),j=0,k=0,c.mode=zb;case zb:if(0===c.havedict)return a.next_out=g,a.avail_out=i,a.next_in=f,a.avail_in=h,c.hold=j,c.bits=k,sb;a.adler=c.check=1,c.mode=Ab;case Ab:if(b===ob||b===pb)break a;case 16192:if(c.last){j>>>=7&k,k-=7&k,c.mode=16206;break}for(;k<3;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}switch(c.last=1&j,j>>>=1,k-=1,3&j){case 0:c.mode=16193;break;case 1:if(Nb(c),c.mode=Bb,b===pb){j>>>=2,k-=2;break a}break;case 2:c.mode=16196;break;case 3:a.msg="invalid block type",c.mode=Db}j>>>=2,k-=2;break;case 16193:for(j>>>=7&k,k-=7&k;k<32;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if((65535&j)!=(j>>>16^65535)){a.msg="invalid stored block lengths",c.mode=Db;break}if(c.length=65535&j,j=0,k=0,c.mode=16194,b===pb)break a;case 16194:c.mode=16195;case 16195:if(n=c.length){if(n>h&&(n=h),n>i&&(n=i),0===n)break a;e.set(d.subarray(f,f+n),g),h-=n,f+=n,i-=n,g+=n,c.length-=n;break}c.mode=Ab;break;case 16196:for(;k<14;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(c.nlen=257+(31&j),j>>>=5,k-=5,c.ndist=1+(31&j),j>>>=5,k-=5,c.ncode=4+(15&j),j>>>=4,k-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=Db;break}c.have=0,c.mode=16197;case 16197:for(;c.have<c.ncode;){for(;k<3;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.lens[C[c.have++]]=7&j,j>>>=3,k-=3}for(;c.have<19;)c.lens[C[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,A={bits:c.lenbits},x=mb(0,c.lens,0,19,c.lencode,0,c.work,A),c.lenbits=A.bits,x){a.msg="invalid code lengths set",c.mode=Db;break}c.have=0,c.mode=16198;case 16198:for(;c.have<c.nlen+c.ndist;){for(;y=c.lencode[j&(1<<c.lenbits)-1],q=y>>>24,r=y>>>16&255,s=65535&y,!(q<=k);){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(s<16)j>>>=q,k-=q,c.lens[c.have++]=s;else{if(16===s){for(B=q+2;k<B;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(j>>>=q,k-=q,0===c.have){a.msg="invalid bit length repeat",c.mode=Db;break}w=c.lens[c.have-1],n=3+(3&j),j>>>=2,k-=2}else if(17===s){for(B=q+3;k<B;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}j>>>=q,k-=q,w=0,n=3+(7&j),j>>>=3,k-=3}else{for(B=q+7;k<B;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}j>>>=q,k-=q,w=0,n=11+(127&j),j>>>=7,k-=7}if(c.have+n>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=Db;break}for(;n--;)c.lens[c.have++]=w}}if(c.mode===Db)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=Db;break}if(c.lenbits=9,A={bits:c.lenbits},x=mb(1,c.lens,0,c.nlen,c.lencode,0,c.work,A),c.lenbits=A.bits,x){a.msg="invalid literal/lengths set",c.mode=Db;break}if(c.distbits=6,c.distcode=c.distdyn,A={bits:c.distbits},x=mb(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,A),c.distbits=A.bits,x){a.msg="invalid distances set",c.mode=Db;break}if(c.mode=Bb,b===pb)break a;case Bb:c.mode=Cb;case Cb:if(h>=6&&i>=258){a.next_out=g,a.avail_out=i,a.next_in=f,a.avail_in=h,c.hold=j,c.bits=k,hb(a,m),g=a.next_out,e=a.output,i=a.avail_out,f=a.next_in,d=a.input,h=a.avail_in,j=c.hold,k=c.bits,c.mode===Ab&&(c.back=-1);break}for(c.back=0;y=c.lencode[j&(1<<c.lenbits)-1],q=y>>>24,r=y>>>16&255,s=65535&y,!(q<=k);){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(r&&!(240&r)){for(t=q,u=r,v=s;y=c.lencode[v+((j&(1<<t+u)-1)>>t)],q=y>>>24,r=y>>>16&255,s=65535&y,!(t+q<=k);){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}j>>>=t,k-=t,c.back+=t}if(j>>>=q,k-=q,c.back+=q,c.length=s,0===r){c.mode=16205;break}if(32&r){c.back=-1,c.mode=Ab;break}if(64&r){a.msg="invalid literal/length code",c.mode=Db;break}c.extra=15&r,c.mode=16201;case 16201:if(c.extra){for(B=c.extra;k<B;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.length+=j&(1<<c.extra)-1,j>>>=c.extra,k-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=16202;case 16202:for(;y=c.distcode[j&(1<<c.distbits)-1],q=y>>>24,r=y>>>16&255,s=65535&y,!(q<=k);){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(!(240&r)){for(t=q,u=r,v=s;y=c.distcode[v+((j&(1<<t+u)-1)>>t)],q=y>>>24,r=y>>>16&255,s=65535&y,!(t+q<=k);){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}j>>>=t,k-=t,c.back+=t}if(j>>>=q,k-=q,c.back+=q,64&r){a.msg="invalid distance code",c.mode=Db;break}c.offset=s,c.extra=15&r,c.mode=16203;case 16203:if(c.extra){for(B=c.extra;k<B;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}c.offset+=j&(1<<c.extra)-1,j>>>=c.extra,k-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=Db;break}c.mode=16204;case 16204:if(0===i)break a;if(n=m-i,c.offset>n){if((n=c.offset-n)>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=Db;break}n>c.wnext?(n-=c.wnext,o=c.wsize-n):o=c.wnext-n,n>c.length&&(n=c.length),p=c.window}else p=e,o=g-c.offset,n=c.length;n>i&&(n=i),i-=n,c.length-=n;do{e[g++]=p[o++]}while(--n);0===c.length&&(c.mode=Cb);break;case 16205:if(0===i)break a;e[g++]=c.length,i--,c.mode=Cb;break;case 16206:if(c.wrap){for(;k<32;){if(0===h)break a;h--,j|=d[f++]<<k,k+=8}if(m-=i,a.total_out+=m,c.total+=m,4&c.wrap&&m&&(a.adler=c.check=c.flags?T(c.check,e,m,g-m):R(c.check,e,m,g-m)),m=i,4&c.wrap&&(c.flags?j:Eb(j))!==c.check){a.msg="incorrect data check",c.mode=Db;break}j=0,k=0}c.mode=16207;case 16207:if(c.wrap&&c.flags){for(;k<32;){if(0===h)break a;h--,j+=d[f++]<<k,k+=8}if(4&c.wrap&&j!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=Db;break}j=0,k=0}c.mode=16208;case 16208:x=rb;break a;case Db:x=ub;break a;case 16210:return vb;default:return tb}return a.next_out=g,a.avail_out=i,a.next_in=f,a.avail_in=h,c.hold=j,c.bits=k,(c.wsize||m!==a.avail_out&&c.mode<Db&&(c.mode<16206||b!==nb))&&Ob(a,a.output,a.next_out,m-a.avail_out),l-=a.avail_in,m-=a.avail_out,a.total_in+=l,a.total_out+=m,c.total+=m,4&c.wrap&&m&&(a.adler=c.check=c.flags?T(c.check,e,m,a.next_out-m):R(c.check,e,m,a.next_out-m)),a.data_type=c.bits+(c.last?64:0)+(c.mode===Ab?128:0)+(c.mode===Bb||16194===c.mode?256:0),(0===l&&0===m||b===nb)&&x===qb&&(x=wb),x},inflateEnd:function(a){if(Fb(a))return tb;var b=a.state;return b.window&&(b.window=null),a.state=null,qb},inflateGetHeader:function(a,b){if(Fb(a))return tb;var c=a.state;return 2&c.wrap?(c.head=b,b.done=!1,qb):tb},inflateSetDictionary:function(a,b){var c=b.length,d=void 0,e=void 0,f=void 0;return Fb(a)?tb:(d=a.state,0!==d.wrap&&d.mode!==zb?tb:d.mode===zb&&(e=1,(e=R(e,b,c,0))!==d.check)?ub:(f=Ob(a,b,c,c),f?(d.mode=16210,vb):(d.havedict=1,qb)))},inflateInfo:"pako inflate (from Nodeca project)"},Qb=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Rb=Object.prototype.toString,Sb=V.Z_NO_FLUSH,Tb=V.Z_FINISH,Ub=V.Z_OK,Vb=V.Z_STREAM_END,Wb=V.Z_NEED_DICT,Xb=V.Z_STREAM_ERROR,Yb=V.Z_DATA_ERROR,Zb=V.Z_MEM_ERROR;j.prototype.push=function(a,b){var c=this.strm,d=this.options.chunkSize,e=this.options.dictionary,f=void 0,g=void 0,h=void 0;if(this.ended)return!1;for(g=b===~~b?b:!0===b?Tb:Sb,"[object ArrayBuffer]"===Rb.call(a)?c.input=new Uint8Array(a):c.input=a,c.next_in=0,c.avail_in=c.input.length;;){for(0===c.avail_out&&(c.output=new Uint8Array(d),c.next_out=0,c.avail_out=d),(f=Pb.inflate(c,g))===Wb&&e&&(f=Pb.inflateSetDictionary(c,e),f===Ub?f=Pb.inflate(c,g):f===Yb&&(f=Wb));c.avail_in>0&&f===Vb&&c.state.wrap>0&&0!==a[c.next_in];)Pb.inflateReset(c),f=Pb.inflate(c,g);switch(f){case Xb:case Yb:case Wb:case Zb:return this.onEnd(f),this.ended=!0,!1}if(h=c.avail_out,c.next_out&&(0===c.avail_out||f===Vb))if("string"===this.options.to){var i=Va(c.output,c.next_out),j=c.next_out-i,k=Ua(c.output,i);c.next_out=j,c.avail_out=d-j,j&&c.output.set(c.output.subarray(i,i+j),0),this.onData(k)}else this.onData(c.output.length===c.next_out?c.output:c.output.subarray(0,c.next_out));if(f!==Ub||0!==h){if(f===Vb)return f=Pb.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,!0;if(0===c.avail_in)break}}return!0},j.prototype.onData=function(a){this.chunks.push(a)},j.prototype.onEnd=function(a){a===Ub&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Pa(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};var $b={Inflate:j,inflate:k,inflateRaw:function(a,b){return(b=b||{}).raw=!0,k(a,b)},ungzip:k,constants:V},_b=fb.Deflate,ac=fb.deflate,bc=fb.deflateRaw,cc=fb.gzip,dc=$b.Inflate,ec=$b.inflate,fc=$b.inflateRaw,gc=$b.ungzip,hc=_b,ic=ac,jc=bc,kc=cc,lc=dc,mc=ec,nc=fc,oc=gc,pc=V,qc={Deflate:hc,deflate:ic,deflateRaw:jc,gzip:kc,Inflate:lc,inflate:mc,inflateRaw:nc,ungzip:oc,constants:pc};a.Deflate=hc,a.Inflate=lc,a.constants=pc,a.default=qc,a.deflate=ic,a.deflateRaw=jc,a.gzip=kc,a.inflate=mc,a.inflateRaw=nc,a.ungzip=oc,Object.defineProperty(a,"__esModule",{value:!0})}(b)}(0,C.exports);var D=b(C.exports),E=function(){function a(b){if((0,o.default)(this,a),this.version=f,this.config=b,this.logger=b.logger,this.clientInfo=null,this.certParams={name:"ECDSA",namedCurve:"P-256"},this.extensionId=c(),this.pcProxies=new Map,this.audioContextProxies=new Map,this.audioNodeProxies=new Map,this.workerProxies=new Map,this.streamProxies=new Map,this.eventListeners=new Map,this.mediaElementProxies=new Map,this.transceiverProxies=new Map,this.senderProxies=new Map,this.dtmfProxies=new Map,this.receiverProxies=new Map,this.trackProxies=new Map,this.overridenApis=new Map,this.decoder=new TextDecoder("utf-8"),this.logger.debug("Checking for chrome extension.  Chrome runtime: "+chrome.runtime),void 0===chrome.runtime)throw new Error("Chrome runtime not available.  DCV WebRTC chrome extension may not be active.");this.overridenApis.set("navigator.mediaDevices.getUserMedia",navigator.mediaDevices.getUserMedia),this.overridenApis.set("navigator.mediaDevices.enumerateDevices",navigator.mediaDevices.enumerateDevices),this.overridenApis.set("window.RTCPeerConnection",window.RTCPeerConnection),this.overridenApis.set("window.RTCPeerConnection.generateCertificate",window.RTCPeerConnection.generateCertificate),this.overridenApis.set("window.AudioContext",window.AudioContext),this.overridenApis.set("window.Worker",window.Worker),this.status=v.NEW,this.statusChangeEventListeners=[],this.lastHeartbeat=Date.now(),this.heartbeatTimeout=null,this.heartbeatTimeoutMs=1e4,this.heartbeatIntervalPeriodMs=1e3,this.heartbeatInterval=null}return(0,q.default)(a,[{key:"clearHeartbeatInterval",value:function(){this.heartbeatTimeout&&(clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=null),this.hearbeatInterval&&(clearInterval(this.hearbeatInterval),this.hearbeatInterval=null)}},{key:"resetHeartbeat",value:function(a){var b=this;this.clearHeartbeatInterval(),this.heartbeatTimeoutMs=a&&a.heartbeatTimeoutMs?a.heartbeatTimeoutMs:this.heartbeatTimeoutMs,this.heartbeatIntervalPeriodMs=a&&a.heartbeatIntervalPeriodMs?a.heartbeatIntervalPeriodMs:this.heartbeatIntervalPeriodMs,this.hearbeatInterval=setInterval((0,m.default)(k.default.mark(function a(){return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b.heartbeatTimeout||(b.heartbeatTimeout=setTimeout(function(){b.logger.debug("heartbeatTimeout reached, current status: "+b.status+", last hb: "+(Date.now()-b.lastHeartbeat)+"ms ago."),b.status!==v.UNAVAILABLE&&(b.status=v.UNAVAILABLE,b.statusChangeEventListeners.forEach(function(a){a({status:b.status,data:b.clientInfo,lastHeartbeat:b.lastHeartbeat})}))},b.heartbeatTimeoutMs)),a.prev=1,a.next=4,b.sendApiRequest(n.HELLO_API_NAME,[]);case 4:if(b.clientInfo=a.sent,b.clientInfo){a.next=7;break}throw new Error("Failed to get clientInfo.");case 7:b.heartbeatTimeout&&(clearTimeout(b.heartbeatTimeout),b.heartbeatTimeout=null),b.status!==v.AVAILABLE&&(b.status=v.AVAILABLE,b.statusChangeEventListeners.forEach(function(a){a({status:b.status,data:b.clientInfo})})),b.lastHeartbeat=Date.now(),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(1),b.logger.debug("Heartbeat ping failed.  Last heartbeat received "+(Date.now()-b.lastHeartbeat)+"ms ago.");case 13:case"end":return a.stop()}},a,this,[[1,10]])})),this.heartbeatIntervalPeriodMs)}},{key:"makeMediaDeviceInfoProxies",value:function(a){return a.forEach(function(a){a.toJSON=function(){return a}}),a}},{key:"makeTrackProxy",value:function(a){var b=this;if(this.trackProxies.has(a.id)){var c=this.trackProxies.get(a.id);return Object.assign(c,a),c}return this.trackProxies.set(a.id,a),a.pendingEvents=new Map,a.stop=function(){b.sendApiRequest(n.TRACK_STOP_API_NAME,[a.id])},a.getSettings=function(){return b.sendApiRequest(n.TRACK_GET_SETTINGS,[a.id]).then(function(b){b&&(a.settings=b)}),a.settings},a.addEventListener=function(c,d,e){b.logger.debug("Setting ended event listener via addEventListener."),b.addTrackEventListener(a.id,c,d,e)},a.removeEventListener=function(c,d){b.removeEventListener(a.id,c,d)},Object.defineProperty(a,"onended",{set:function(c){b.addTrackEventListener(a.id,r.ENDED,c)},get:function(){return null}}),Object.defineProperty(a,"onmute",{set:function(c){b.addTrackEventListener(a.id,r.MUTE,c)},get:function(){return null}}),Object.defineProperty(a,"onunmute",{set:function(c){b.addTrackEventListener(a.id,r.UNMUTE,c)},get:function(){return null}}),a.trackEnabled=a.enabled,Object.defineProperty(a,"enabled",{set:function(c){a.trackEnabled=c,b.sendApiRequest(n.TOGGLE_TRACK_ENABLED_API_NAME,[a.id,c]).then(function(c){c&&(b.trackProxies.get(a.id).trackEnabled=c.enabled)})},get:function(){return a.trackEnabled}}),this.preRegisterEvents(r,a,this.addTrackEventListener),a}},{key:"makeStreamProxy",value:function(a){var b=this;this.streamProxies.set(a.id,a);var c=new MediaStream;c.type="proxy",c.proxy=a;var d=a.tracks?a.tracks.map(function(a){return b.makeTrackProxy(a)}):[];return a.tracks=d,c.getTracks=function(){return d},c.getAudioTracks=function(){return d.filter(function(a){return"audio"===a.kind})},c.getVideoTracks=function(){return d.filter(function(a){return"video"===a.kind})},c.getTrackById=function(a){return d.find(function(b){return b.id===a})},c.createMediaElement=function(a){return b.createMediaElement(a)},c.addTrack=function(c){b.sendApiRequest(n.STREAM_ADD_TRACK,[a.id,c.id])},c.removeTrack=function(c){b.sendApiRequest(n.STREAM_REMOVE_TRACK,[a.id,c.id])},c}},{key:"updateTransceiverProxy",value:function(a){var b=this.transceiverProxies.get(a.id);return b||(b={}),Object.assign(b,a),a.receiver&&"proxy"===a.receiver.type&&(b.receiver=this.updateReceiverProxy(a.receiver)),a.sender&&"proxy"===a.sender.type&&(b.sender=this.updateSenderProxy(a.sender)),this.transceiverProxies.set(a.id,b),b}},{key:"updatePCSenders",value:function(a,b){var c=this,d=b.map(function(a){return c.updateSenderProxy(a)});this.pcProxies.get(a).senders=d}},{key:"updatePCReceivers",value:function(a,b){var c=this,d=b.map(function(a){return c.updateReceiverProxy(a)});this.pcProxies.get(a).receivers=d}},{key:"updatePCTransceivers",value:function(a,b){var c=this,d=b;d.forEach(function(a){c.updateTransceiverProxy(a)}),this.pcProxies.get(a).transceivers=d}},{key:"isValidApi",value:function(a){var b=!1;for(var c in n)if(n[c]===a){b=!0;break}return b}},{key:"sendApiRequest",value:function(){function a(a,c){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(b,c){var d,e,f,g,h,i,j,l,m,n,o,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:crypto.randomUUID();return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.logger.debug(b,c,p),a.prev=1,d={api:b,args:c},e=D.deflateRaw(JSON.stringify(d)),f={requestId:p,message:e,type:"request"},this.logger.debug("Sending request:",JSON.stringify(f)),a.next=8,chrome.runtime.sendMessage(this.extensionId,f);case 8:if(g=a.sent,e=g.message,h=D.inflateRaw(e),i=this.decoder.decode(h),g.message=JSON.parse(i),this.logger.debug("Received response: ",JSON.stringify(g)),!(!g||!g.message||!g.type)){a.next=14;break}return j="Received empty message or type, extensionResponse: "+JSON.stringify(g)+", request: "+JSON.stringify(f)+", message: "+JSON.stringify(d),a.abrupt("return",(this.logger.warn(j),null));case 14:if("error"!==g.type){a.next=19;break}if(l="Received error: "+JSON.stringify(g)+", for request: "+JSON.stringify(f)+", message: "+JSON.stringify(d),m=null,this.logger.debug(l),!(g.message.error&&g.message.error.message&&g.message.error&&g.message.error.name)){a.next=18;break}throw l=g.message.error.message,m=g.message.error.name,new DOMException(l,m);case 18:return a.abrupt("return",null);case 19:if("response"===g.type||"event"===g.type||"error"===g.type){a.next=22;break}return n="Received invalid message type, type: "+JSON.stringify(g.type)+", event: "+JSON.stringify(g)+", request: "+JSON.stringify(f)+", message: "+JSON.stringify(d),a.abrupt("return",(this.logger.warn(n),null));case 22:if(!g.message.api||this.isValidApi(g.message.api)){a.next=25;break}return o="Received invalid message api, event: "+JSON.stringify(g)+", request: "+JSON.stringify(f)+", message: "+JSON.stringify(d),a.abrupt("return",(this.logger.warn(o),null));case 25:return a.abrupt("return","event"===g.type?g.message.event:g.message.response);case 28:return a.prev=28,a.t0=a.catch(1),a.abrupt("return",(this.logger.warn("Failed to send api request: api: "+b+", args: "+c+", requestId: "+p,a.t0),null));case 31:case"end":return a.stop()}},a,this,[[1,28]])}));return a}()},{key:"getUserMediaInternal",value:function(){function a(a){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(b){var c;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.sendApiRequest(n.GETUSERMEDIA_API_NAME,[b]);case 2:return c=a.sent,a.abrupt("return",c?this.makeStreamProxy(c):null);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"getOverridenApi",value:function(a){return this.overridenApis.get(a)}},{key:"getUserMedia",value:function(){function a(a){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(b){var c,d,e,f,g,h;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=Object.freeze(b),!c.audio||!c.video){a.next=14;break}return a.next=4,navigator.permissions.query({name:"microphone"});case 4:return d=a.sent,a.next=7,navigator.permissions.query({name:"camera"});case 7:if(e=a.sent,!d||"granted"!==d.state||!e||"granted"!==e.state){a.next=12;break}return a.next=11,this.getUserMediaInternal(c);case 11:return a.abrupt("return",a.sent);case 12:a.next=32;break;case 14:if(!c.audio){a.next=24;break}return a.next=17,navigator.permissions.query({name:"microphone"});case 17:if(!(f=a.sent)||"granted"!==f.state){a.next=22;break}return a.next=21,this.getUserMediaInternal(c);case 21:return a.abrupt("return",a.sent);case 22:a.next=32;break;case 24:if(!c.video){a.next=32;break}return a.next=27,navigator.permissions.query({name:"camera"});case 27:if(!(g=a.sent)||"granted"!==g.state){a.next=32;break}return a.next=31,this.getUserMediaInternal(c);case 31:return a.abrupt("return",a.sent);case 32:if(h=[],a.t0=c.video,!a.t0){a.next=39;break}return a.next=37,this.getOverridenApi("navigator.mediaDevices.enumerateDevices").apply(navigator.mediaDevices);case 37:h=a.sent,h=h.filter(function(a){return a.kind&&a.kind.indexOf("video")>-1});case 39:if(!(c.audio&&!c.video||c.video&&h.length>0)){a.next=44;break}return a.next=42,this.getOverridenApi("navigator.mediaDevices.getUserMedia").apply(navigator.mediaDevices,[c]);case 42:a.t1=function(a){a.stop()},a.sent.getTracks().forEach(a.t1);case 44:return a.next=46,this.getUserMediaInternal(c);case 46:return a.abrupt("return",a.sent);case 47:case"end":return a.stop()}},a,this)}));return a}()},{key:"enumerateDevices",value:function(){function a(){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(){var b;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.sendApiRequest(n.ENUMERATEDEVICES_API_NAME,[]);case 2:return b=a.sent,a.abrupt("return",b?this.makeMediaDeviceInfoProxies(b):null);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"getVersion",value:function(){return f}},{key:"makeReceiverProxy",value:function(a){var b=this;return a.track&&(a.track=this.makeTrackProxy(a.track)),a.getSynchronizationSources=function(){return a.synchronizationSources},a.getStats=(0,m.default)(k.default.mark(function c(){var d,e;return k.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,b.sendApiRequest(n.GET_RECEIVER_STATS_API_NAME,[a.id]);case 2:return d=c.sent,e=new Map,c.abrupt("return",(d&&d.forEach(function(a){e.set(a.id,a)}),e));case 5:case"end":return c.stop()}},c,this)})),a.createEncodedStreams=function(){var c={id:crypto.randomUUID(),type:"proxy",readable:{id:crypto.randomUUID(),type:"proxy"},writable:{id:crypto.randomUUID(),type:"proxy"}};return b.streamProxies.set(c.id,c),b.sendApiRequest(n.RECEIVER_CREATE_ENCODED_STREAMS,[a.id,c]),c},this.receiverProxies.set(a.id,a),a}},{key:"makeDTMFProxy",value:function(a){var b=this,c=a;return this.dtmfProxies.has(c.id)?(c=this.dtmfProxies.get(c.id),Object.assign(c,a)):(this.dtmfProxies.set(c.id,c),c.pendingEvents=new Map,c.insertDTMF=function(a,d,e){b.sendApiRequest(n.INSERT_DTMF_API_NAME,[c.id,a,d,e])},c.addEventListener=function(a,d,e){b.addDtmfEventListener(c.id,a,d,e)},c.removeEventListener=function(a,d){b.removeEventListener(c.id,a,d)},Object.defineProperty(c,"ontonechange",{set:function(a){b.addDtmfEventListener(c.id,t.TONECHANGE,a)},get:function(){return null}}),this.preRegisterEvents(t,c,this.addDtmfEventListener)),c}},{key:"makeSenderProxy",value:function(a){var b=this;return a.track&&(a.track=this.makeTrackProxy(a.track)),a.dtmf&&(a.dtmf=this.makeDTMFProxy(a.dtmf)),a.getStats=(0,m.default)(k.default.mark(function c(){var d;return k.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,b.sendApiRequest(n.GET_SENDER_STATS_API_NAME,[a.id]);case 2:return d=c.sent,c.abrupt("return",(d&&(d.has=function(a){return void 0!==d.find(function(b){return b.id===a})},d.get=function(a){return d.find(function(b){return b.id===a})}),d));case 4:case"end":return c.stop()}},c,this)})),a.replaceTrack=function(c){return a.track=c,b.sendApiRequest(n.REPLACE_SENDER_TRACK_API_NAME,[a.id,c])},a.createEncodedStreams=function(){var c={id:crypto.randomUUID(),type:"proxy",readable:{type:"proxy",id:crypto.randomUUID()},writable:{type:"proxy",id:crypto.randomUUID()}};return b.streamProxies.set(c.id,c),b.sendApiRequest(n.SENDER_CREATE_ENCODED_STREAMS,[a.id,c]),c},a}},{key:"updateSenderProxy",value:function(a){var b=this.senderProxies.get(a.id);return b?Object.assign(b,a):(b=a,this.senderProxies.set(a.id,b)),this.makeSenderProxy(b)}},{key:"updateReceiverProxy",value:function(a){var b=this.receiverProxies.get(a.id);return b?Object.assign(b,a):(b=a,this.receiverProxies.set(a.id,b)),this.makeReceiverProxy(b)}},{key:"addTrack",value:function(a,b){var c=this,d=crypto.randomUUID();this.sendApiRequest(n.ADD_TRACK_API_NAME,[d].concat(Array.prototype.slice.call(arguments))).then(function(a){a&&(c.updateSenderProxy(a),c.updatePCSenders(a.pcId,a.senders),c.updatePCReceivers(a.pcId,a.receivers),c.updatePCTransceivers(a.pcId,a.transceivers))});var e=this.updateSenderProxy({id:d});return this.pcProxies.get(a).senders.push(e),e}},{key:"updatePeerConnectionProxy",value:function(a){var b=this.pcProxies.get(a.pcId);Object.assign(b,a),this.updatePCSenders(a.pcId,a.senders),this.updatePCReceivers(a.pcId,a.receivers),this.updatePCTransceivers(a.pcId,a.transceivers)}},{key:"createPeerConnection",value:function(a,b){var c=this,d=crypto.randomUUID(),e=this;this.logger.debug("Creating RTCPeerConnection with id: "+d);var f={type:"proxy",id:d,signalingState:"new",connectionState:"new",iceConnectionState:"new",iceGatheringState:"new",receivers:[],senders:[],transceivers:[],pendingEvents:new Map,configuration:a,close:function(){c.close(d)},addStream:function(a){c.addStream(d,a)},getConfiguration:function(){return c.sendApiRequest(n.PC_GET_CONFIGURATION,[d]).then(function(a){a&&(f.configuration=a)}),f.configuration},getStats:function(a){return c.getStats(d,a)},createOffer:function(a){return c.createOffer(d,a)},createAnswer:function(a){return c.createAnswer(d,a)},setLocalDescription:function(a){return c.setLocalDescription(d,a)},addEventListener:function(a,b){c.addPeerConnectionEventListener(d,a,b)},removeEventListener:function(a,b){c.removeEventListener(d,a,b)},getEventListener:function(a){return c.eventListeners.get(d).get(a)},set onicecandidate(a){this.addEventListener(p.ICE_CANDIDATE,a)},get onicecandidate(){return this.getEventListener(p.ICE_CANDIDATE)},set ontrack(a){this.addEventListener(p.TRACK,a)},get ontrack(){return this.getEventListener(p.TRACK)},get onsignalingstatechange(){return this.getEventListener(p.SIG_STATE_CHANGE)},set onsignalingstatechange(a){this.addEventListener(p.SIG_STATE_CHANGE,a)},get onconnectionstatechange(){return this.getEventListener(p.CONN_STATE_CHANGE)},set onconnectionstatechange(a){this.addEventListener(p.CONN_STATE_CHANGE,a)},get oniceconnectionstatechange(){return this.getEventListener(p.ICE_CONN_STATE_CHANGE)},
set oniceconnectionstatechange(a){this.addEventListener(p.ICE_CONN_STATE_CHANGE,a)},get onicegatheringstatechange(){return this.getEventListener(p.ICE_GATHER_STATE_CHANGE)},set onicegatheringstatechange(a){this.addEventListener(p.ICE_GATHER_STATE_CHANGE,a)},get onnegotiationneeded(){return this.getEventListener(p.NEGOTIATION_NEEDED)},set onnegotiationneeded(a){this.addEventListener(p.NEGOTIATION_NEEDED,a)},setRemoteDescription:function(a){return c.setRemoteDescription(d,a)},addIceCandidate:function(a){return c.addIceCandidate(d,a)},getRemoteStreams:function(){return c.logger.warn("getRemoteStreams not implemented on proxy."),[]},getReceivers:function(){return c.getReceivers(d)},getSenders:function(){return c.getSenders(d)},addTrack:function(a){var b=[d].concat(Array.prototype.slice.call(arguments));return e.addTrack.apply(e,b)},addTransceiver:function(a,b){return c.addTransceiver(d,a,b)},getTransceivers:function(){return c.getTransceivers(d)},removeTrack:function(a){c.removeTrack(d,a)}};return this.pcProxies.set(d,f),this.sendApiRequest(n.NEWRTCPEERCONNECTION_API_NAME,[d,a,b],d).then(function(a){a&&c.updatePeerConnectionProxy(a)},function(a){c.logger.error("Error creating proxied RTCPeerConnection: "+a)}),this.preRegisterEvents(p,this.pcProxies.get(d),this.addPeerConnectionEventListener),this.pcProxies.get(d)}},{key:"preRegisterEvents",value:function(a,b,c){for(var d in a)"string"==typeof a[d]&&c.apply(this,[b.id,a[d],function(a){b.pendingEvents.has(a.eventName)||b.pendingEvents.set(a.eventName,[]),b.pendingEvents.get(a.eventName).push(a)}])}},{key:"updateAudioContextProxy",value:function(a){var b=this.audioContextProxies.get(a.id);Object.assign(b,a)}},{key:"updateAudioNodeProxy",value:function(a){var b=this.audioNodeProxies.get(a.id);Object.assign(b,a),a.stream&&this.makeStreamProxy(a.stream)}},{key:"makeAudioNodeProxy",value:function(a,b){var c=this;return{type:"proxy",id:b,context:this.audioContextProxies.get(a),connect:function(a,d,e){return c.sendApiRequest(n.AUDIO_NODE_CONNECT,[b,a,d,e]),a},disconnect:function(a,d,e){c.sendApiRequest(n.AUDIO_NODE_DISCONNECT,[b,a,d,e])}}}},{key:"createAudioNode",value:function(a,b,c){var d=this,e=crypto.randomUUID();return this.audioNodeProxies.set(e,this.makeAudioNodeProxy(a,e)),this.sendApiRequest(n.AUDIO_CTX_CREATE_AUDIO_NODE,[a,e,b,c],e).then(function(a){a&&d.updateAudioNodeProxy(a)},function(a){d.logger.error("Error creating proxied "+b+": "+a)}),this.audioNodeProxies.get(e)}},{key:"makeWorkerProxy",value:function(a){var b=this,c={id:a,pendingEvents:new Map,type:"proxy",postMessage:function(c,d){b.sendApiRequest(n.WORKER_POST_MESSAGE,[a,c,d])},terminate:function(){b.sendApiRequest(n.WORKER_TERMINATE,[a])},addEventListener:function(a,d,e){b.addWorkerEventListener(c.id,a,d,e)},removeEventListener:function(a,d){b.removeEventListener(c.id,a,d)}};return Object.defineProperty(c,"onerror",{set:function(a){b.addWorkerEventListener(c.id,u.ERROR,a)},get:function(){return null}}),Object.defineProperty(c,"onmessage",{set:function(a){b.addWorkerEventListener(c.id,u.MESSAGE,a)},get:function(){return null}}),Object.defineProperty(c,"onmessageerror",{set:function(a){b.addWorkerEventListener(c.id,u.MESSAGE_ERROR,a)},get:function(){return null}}),c}},{key:"createWorker",value:function(a,b){var c=this,d=crypto.randomUUID(),e=this.makeWorkerProxy(d);return this.workerProxies.set(d,e),fetch(a).then(function(a){a.blob().then(function(a){a.arrayBuffer().then(function(e){var f=A(e);c.sendApiRequest(n.CREATE_WORKER,[d,a.type,f,b]).then(function(a){c.logger.debug("Created worker: "+JSON.stringify(a))})})})}),this.logger.debug("Preregistering events for worker: "+JSON.stringify(e)),this.preRegisterEvents(u,e,this.addWorkerEventListener),e}},{key:"createAudioContext",value:function(){var a=this,b=crypto.randomUUID(),c=crypto.randomUUID();return this.audioContextProxies.set(b,{type:"proxy",id:b,destination:this.makeAudioNodeProxy(b,c),createGain:function(){var c=a.createAudioNode(b,"Gain",[]),d={setValueAtTime:function(b,e){return d.currentValue=b,a.sendApiRequest(n.AUDIO_PARAM_SET_VALUE_AT_TIME,[c.id,b,e]),d},linearRampToValueAtTime:function(b,e){return a.sendApiRequest(n.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME,[c.id,b,e]),d}};return Object.defineProperty(d,"value",{set:function(a){return d.setValueAtTime(a,0)},get:function(){return d.currentValue}}),c.gain=d,c},createOscillator:function(){var c=a.createAudioNode(b,"Oscillator",[]);c.start=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a.sendApiRequest(n.AUDIO_NODE_START,[c.id,b])},c.stop=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a.sendApiRequest(n.AUDIO_NODE_STOP,[c.id,b])},Object.defineProperty(c,"type",{set:function(b){c.currentType=b,a.sendApiRequest(n.AUDIO_NODE_SET_TYPE,[c.id,b])},get:function(){return c.currentType}});var d={setValueAtTime:function(b,e){return a.sendApiRequest(n.AUDIO_PARAM_SET_VALUE_AT_TIME,[c.id,b,e]),d}};return Object.defineProperty(d,"value",{set:function(a){return d.setValueAtTime(a,0)},get:function(){return d.currentValue}}),c.frequency=d,c},createMediaStreamSource:function(c){return a.createAudioNode(b,"MediaStreamSource",[c.proxy])},createAnalyser:function(){return a.createAudioNode(b,"Analyser",[])},createMediaStreamDestination:function(){var c=a.createAudioNode(b,"MediaStreamDestination",[]);return c.stream=a.makeStreamProxy({id:c.id,tracks:[{id:c.id,kind:"audio"}]}),c},close:function(){return a.sendApiRequest(n.AUDIO_CTX_CLOSE,[b])}}),this.sendApiRequest(n.NEW_AUDIO_CONTEXT,[b,c],b).then(function(b){b&&a.updateAudioContextProxy(b)},function(b){a.logger.error("Error creating proxied AudioContext: "+b)}),this.audioContextProxies.get(b)}},{key:"close",value:function(a){this.eventListeners.get(a).clear(),this.sendApiRequest(n.PC_CLOSE_API_NAME,[a])}},{key:"addStream",value:function(a,b){this.sendApiRequest(n.ADDSTREAM_API_NAME,[a,b.proxy])}},{key:"getStats",value:function(a,b){return"function"==typeof b?Promise.reject(new Error("callback based getStats is obsolete.")):this.sendApiRequest(n.GET_STATS_API_NAME,[a,b])}},{key:"createOffer",value:function(a,b){return this.sendApiRequest(n.CREATE_OFFER_API_NAME,[a,b])}},{key:"createAnswer",value:function(a,b){return this.sendApiRequest(n.CREATE_ANSWER_API_NAME,[a,b])}},{key:"setLocalDescription",value:function(a,b){return this.pcProxies.get(a).localDescription=b,this.sendApiRequest(n.SET_LOCAL_DESCRIPTION_API_NAME,[a,b])}},{key:"setRemoteDescription",value:function(a,b){return this.sendApiRequest(n.SET_REMOTE_DESCRIPTION_API_NAME,[a,b])}},{key:"handleAddEventListenerResponse",value:function(a){var b=this;a.eventName===p.SIG_STATE_CHANGE?this.updatePeerConnectionProxy(a):a.eventName===p.TRACK?(a.streams=a.streams.map(function(a){return b.makeStreamProxy(a)}),a.track=this.makeTrackProxy(a.track),this.updatePeerConnectionProxy(a)):(a.eventName===p.CONN_STATE_CHANGE||a.eventName===p.ICE_CONN_STATE_CHANGE||a.eventName===p.ICE_GATHER_STATE_CHANGE||a.eventName===p.ICE_CANDIDATE||a.eventName===p.NEGOTIATION_NEEDED)&&this.updatePeerConnectionProxy(a),this.fireUpEventHandlers(this.pcProxies.get(a.pcId),a),this.sendApiRequest(n.ADD_PC_EVENT_LISTENER,[a.pcId,a.eventName]).then(function(a){a&&b.handleAddEventListenerResponse(a)})}},{key:"fireUpEventHandlers",value:function(a,b){if(a&&this.eventListeners.get(a.id).has(b.eventName)){var c=a.pendingEvents;this.eventListeners.get(a.id).get(b.eventName).forEach(function(a,d){0===d?a(b):c.get(b.eventName).forEach(function(b){a(b)})}),c.set(b.eventName,[])}}},{key:"handleAddTrackEventListenerResponse",value:function(a){var b=this;"mute"!==a.eventName&&"unmute"!==a.eventName||(this.trackProxies.get(a.trackId).muted=a.muted),this.fireUpEventHandlers(this.trackProxies.get(a.trackId),a),this.sendApiRequest(n.ADD_TRACK_EVENT_LISTENER,[a.trackId,a.eventName]).then(function(a){a&&b.handleAddTrackEventListenerResponse(a)})}},{key:"handleAddDtmfEventListenerResponse",value:function(a){var b=this;this.fireUpEventHandlers(this.dtmfProxies.get(a.dtmfId),a),this.sendApiRequest(n.ADD_DTMF_EVENT_LISTENER,[a.dtmfId,a.eventName]).then(function(a){a&&b.handleAddDtmfEventListenerResponse(a)})}},{key:"handleAddWorkerEventListenerResponse",value:function(a){var b=this;this.fireUpEventHandlers(this.workerProxies.get(a.wId),a),this.sendApiRequest(n.ADD_WORKER_EVENT_LISTENER,[a.wId,a.eventName]).then(function(a){a&&b.handleAddWorkerEventListenerResponse(a)})}},{key:"addEventListener",value:function(a,b,c){this.eventListeners.has(a)||this.eventListeners.set(a,new Map),this.eventListeners.get(a).has(b)||this.eventListeners.get(a).set(b,[]),this.eventListeners.get(a).get(b).push(c)}},{key:"addPeerConnectionEventListener",value:function(a,b,c){var d=this;this.addEventListener(a,b,c),this.sendApiRequest(n.ADD_PC_EVENT_LISTENER,[a,b]).then(function(a){a&&d.handleAddEventListenerResponse(a)})}},{key:"addTrackEventListener",value:function(a,b,c,d){var e=this;this.addEventListener(a,b,c),this.sendApiRequest(n.ADD_TRACK_EVENT_LISTENER,[a,b,d]).then(function(a){a&&e.handleAddTrackEventListenerResponse(a)})}},{key:"addDtmfEventListener",value:function(a,b,c,d){var e=this;this.addEventListener(a,b,c),this.sendApiRequest(n.ADD_DTMF_EVENT_LISTENER,[a,b,d]).then(function(a){a&&e.handleAddDtmfEventListenerResponse(a)})}},{key:"addWorkerEventListener",value:function(a,b,c){var d=this;this.addEventListener(a,b,c),this.sendApiRequest(n.ADD_WORKER_EVENT_LISTENER,[a,b]).then(function(a){a&&d.handleAddWorkerEventListenerResponse(a)})}},{key:"removeEventListener",value:function(a,b,c){var d=this.eventListeners.get(a).get(b),e=d.indexOf(c);e>-1&&d.splice(e,1)}},{key:"addIceCandidate",value:function(a,b){var c=b?{sdpMLineIndex:b.sdpMLineIndex,sdpMid:b.sdpMid,candidate:b.candidate}:null;return this.sendApiRequest(n.ADD_ICE_CANDIDATE_API_NAME,[a,c])}},{key:"createMediaElement",value:function(a){var b=this,c=crypto.randomUUID();this.sendApiRequest(n.CREATE_MEDIA_ELEMENT_API_NAME,[c,a],c).then(function(a){a&&(b.mediaElementProxies.get(a.id).sinkId=a.sinkId)});var d={id:c,type:"proxy",classList:new Set,isMuted:!1,play:function(){b.sendApiRequest(n.MEDIA_ELEMENT_PLAY_API_NAME,[c])},pause:function(){b.sendApiRequest(n.MEDIA_ELEMENT_PAUSE_API_NAME,[c])},setSinkId:function(a){return b.sendApiRequest(n.MEDIA_ELEMENT_SET_SINK_ID_API_NAME,[c,a])},remove:function(){return b.sendApiRequest(n.MEDIA_ELEMENT_REMOVE,[c])}};return this.mediaElementProxies.set(c,d),d.classList.remove=function(a){d.classList.delete(a)},Object.assign(d,a),Object.defineProperty(d,"srcObject",{set:function(a){d.stream=a,b.sendApiRequest(n.SET_MEDIA_SRC_OBJ_API_NAME,[d.id,a&&a.proxy?a.proxy:a])},get:function(){return d.stream}}),Object.defineProperty(d,"hidden",{set:function(a){b.sendApiRequest(n.SET_MEDIA_HIDDEN_API_NAME,[d.id,a])},get:function(){return d.hidden}}),Object.defineProperty(d,"volume",{set:function(a){b.sendApiRequest(n.SET_MEDIA_VOLUME_API_NAME,[d.id,a])},get:function(){return d.volume}}),Object.defineProperty(d,"muted",{set:function(a){d.isMuted=a,b.sendApiRequest(n.MEDIA_ELEMENT_MUTED,[d.id,a]).then(function(a){a&&(d.isMuted=a.muted)})},get:function(){return d.isMuted}}),d}},{key:"generateCertificate",value:function(a){return this.sendApiRequest(n.GENERATE_CERTIFICATE_API_NAME,[a])}},{key:"getReceivers",value:function(a){var b=this;return this.sendApiRequest(n.GET_RECEIVERS_API_NAME,[a]).then(function(a){a&&b.updatePCReceivers(a.pcId,a.receivers)}),this.pcProxies.get(a).receivers}},{key:"getSenders",value:function(a){var b=this;return this.sendApiRequest(n.GET_SENDERS_API_NAME,[a]).then(function(a){a&&b.updatePCSenders(a.pcId,a.senders)}),this.pcProxies.get(a).senders}},{key:"removeTrack",value:function(a,b){this.sendApiRequest(n.PC_REMOVE_TRACK_API_NAME,[a,b])}},{key:"getTransceivers",value:function(a){var b=this;return this.sendApiRequest(n.GET_TRANSCEIVERS_API_NAME,[a]).then(function(a){a&&b.updatePCTransceivers(a.pcId,a.transceivers)}),this.pcProxies.get(a).transceivers}},{key:"addTransceiver",value:function(a,b,c){var d=this,e=crypto.randomUUID(),f={type:"proxy",id:e,sender:this.makeSenderProxy({id:crypto.randomUUID()}),receiver:this.makeReceiverProxy({id:crypto.randomUUID()}),setCodecPreferences:function(a){d.sendApiRequest(n.TRANSCEIVER_SET_CODEC_PREFS,[e,a])}};return this.transceiverProxies.set(f.id,f),this.pcProxies.get(a).transceivers.push(f),this.pcProxies.get(a).receivers.push(f.receiver),this.pcProxies.get(a).senders.push(f.sender),this.sendApiRequest(n.ADD_TRANSCEIVER_API_NAME,[a,f,"string"==typeof b?b:this.makeTrackProxy(b),c]).then(function(a){a&&(d.updateTransceiverProxy(a),d.updatePCSenders(a.pcId,a.senders),d.updatePCReceivers(a.pcId,a.receivers),d.updatePCTransceivers(a.pcId,a.transceivers))}),f}},{key:"setLogger",value:function(a){this.logger=a}},{key:"overrideWebRTC",value:function(){var a=this;this.logger.info("Overriding WebRTC interfaces for the current webapp.");var b=this;navigator.mediaDevices.getUserMedia=function(b){return a.getUserMedia(b)},navigator.mediaDevices.enumerateDevices=function(){return a.enumerateDevices()},window.RTCPeerConnection=function(a,c){return b.createPeerConnection(a,c)},window.RTCPeerConnection.generateCertificate=function(a){return b.generateCertificate(a)},window.AudioContext=function(){return b.createAudioContext()},window.Worker=function(a,c){return b.createWorker(a,c)}}},{key:"removeStatusChangeEventListener",value:function(a){this.statusChangeEventListeners=this.statusChangeEventListeners.filter(function(b){return b!==a})}},{key:"addStatusChangeEventListener",value:function(a){this.statusChangeEventListeners.push(a)}},{key:"sendHelloRequest",value:function(){function a(){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(){var b,c;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=this,a.next=3,this.sendApiRequest(n.HELLO_API_NAME,[]);case 3:return c=a.sent,a.abrupt("return",(c&&!globalThis.DCVWebRTCRedirProxy&&(this.status=v.AVAILABLE,this.logger.info("Running in a DCV WebRTC redirection env, proxy version: "+f.versionStr+" - "+f.gitHash),this.logger.info("Client info: "+JSON.stringify(c)),window.addEventListener("beforeunload",function(a){var c={pcIds:[],streamIds:[],mediaElementIds:[],transceiverIds:[],senderIds:[],receiverIds:[],trackIds:[],workerIds:[]};b.pcProxies.forEach(function(a,b){c.pcIds.push(b)}),b.streamProxies.forEach(function(a,b){c.streamIds.push(b)}),b.trackProxies.forEach(function(a,b){c.trackIds.push(b)}),b.workerProxies.forEach(function(a,b){c.workerIds.push(b)}),b.mediaElementProxies.forEach(function(a,b){c.mediaElementIds.push(b)}),b.transceiverProxies.forEach(function(a,b){c.transceiverIds.push(b)}),b.senderProxies.forEach(function(a,b){c.senderIds.push(b)}),b.receiverProxies.forEach(function(a,b){c.receiverIds.push(b)}),b.sendApiRequest(n.UNLOAD_EVENT_NAME,[c])})),c));case 5:case"end":return a.stop()}},a,this)}));return a}()}],[{key:"setInitCallback",value:function(b,c){var d=globalThis.DCVWebRTCRedirProxy;if(d)b({success:!0,proxy:d});else{a.initCallbacks||(a.initCallbacks=new Map);var e=setTimeout(function(b){b({success:!1,error:"Failed to initialize DCVWebRTCPeerConnectionProxy in "+c+"ms"}),a.initCallbacks.delete(b)},c,b);a.initCallbacks.set(b,e)}}}]),a}();try{window.DCVWebRTCPeerConnectionProxy=E;var F=new E({logger:l});F.sendHelloRequest().then(function(a){l.debug("Successfully received hello response from client: "+JSON.stringify(a)),F.clientInfo=a,F.resetHeartbeat(null),e(!0,F)}).catch(function(a){var b="Running in an invalid dcv webrtc env, skipping setting up proxy: "+JSON.stringify(a);l.debug(b),e(!1,null,b)})}catch(a){var G=a.message;e(!1,null,G),l.debug("Skipping setting up proxy in client env: "+G)}a.DCVWebRTCRedirClient=function(){function a(b){(0,o.default)(this,a),this.version=f,this.config=b,this.logger=b.logger?b.logger:l,this.channel=b.channel,this.decoder=new TextDecoder("utf-8"),this.messageBuffer=null,this.pcs=new Map,this.pcPromises=new Map,this.audioContexts=new Map,this.audioNodes=new Map,this.workers=new Map,this.workerPromises=new Map,this.certs=new Map,this.streams=new Map,this.tracks=new Map,this.offers=new Map,this.answers=new Map,this.remoteDescriptions=new Map,this.mediaElements=new Map,this.senders=new Map,this.dtmfSenders=new Map,this.receivers=new Map,this.transceivers=new Map,this.logger.info("Created WebRTC Redirection Client version: "+f.versionStr+" - "+f.gitHash)}return(0,q.default)(a,[{key:"encodeBase64",value:function(a){return A(a)}},{key:"decodeBase64",value:function(a){return B(a)}},{key:"getVersion",value:function(){return this.version}},{key:"concatUint8Arrays",value:function(a){var b=a.reduce(function(a,b){return a+b.byteLength},0),c=new Uint8Array(b),d=0;return a.forEach(function(a){c.set(a,d),d+=a.byteLength}),c}},{key:"parseHeader",value:function(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]}},{key:"onMessageReceived",value:function(a){this.logger.debug("onMessageReceived, binaryPayload.byteLength: "+a.byteLength);try{var b=0;for(null===this.messageBuffer?this.messageBuffer=new Uint8Array(a):this.messageBuffer=this.concatUint8Arrays([this.messageBuffer,new Uint8Array(a)]),this.messageBuffer.byteLength>=4&&(b=this.parseHeader(this.messageBuffer));b>0&&this.messageBuffer.byteLength>=b+4;){var c=4+b,d=this.messageBuffer.slice(4,c);this.logger.debug("Decoding payload: ",d);var e=this.decoder.decode(d);this.logger.debug("Received message: "+e);var f=JSON.parse(e);this.logger.debug("Received json: ",f),this.handleMessage(f),this.messageBuffer=this.messageBuffer.slice(c),b=this.messageBuffer.byteLength>=4?this.parseHeader(this.messageBuffer):0}}catch(a){this.logger.error("Failed to parse JSON from binaryPayload: "+a),this.messageBuffer=null}}},{key:"getPeerConnection",value:function(a){var b=this;return this.pcs.has(a)?this.pcs.get(a):(this.pcPromises.has(a)||this.pcPromises.set(a,[]),new Promise(function(c,d){b.pcPromises.get(a).push({resolve:c,reject:d})}))}},{key:"closePeerConnection",value:function(a){var b=this;if(this.pcs.has(a)){var c=this.pcs.get(a);c.getTransceivers().forEach(function(a){a.sender&&(a.sender.dtmf&&b.dtmfSenders.forEach(function(c,d){c===a.sender.dtmf&&b.dtmfSenders.delete(d)}),b.senders.forEach(function(c,d){c===a.sender&&b.senders.delete(d)})),a.receiver&&b.receivers.forEach(function(c,d){c===a.receiver&&b.receivers.delete(d)}),b.transceivers.forEach(function(c,d){c===a&&b.transceivers.delete(d)})}),c.getSenders().forEach(function(a){b.senders.forEach(function(c,d){c===a&&b.senders.delete(d)})}),c.getReceivers(function(a){b.receivers.forEach(function(c,d){c===a&&b.receivers.delete(d)})}),c.localDescription&&(this.offers.forEach(function(a,d){c.localDescription.type===a.type&&c.localDescription.sdp===a.sdp&&b.offers.delete(d)}),this.answers.forEach(function(a,d){c.localDescription.type===a.type&&c.localDescription.sdp===a.sdp&&b.offers.delete(d)})),c.remoteDescription&&this.remoteDescriptions.forEach(function(a,d){c.remoteDescription.type===a.type&&c.remoteDescription.sdp===a.sdp&&b.remoteDescriptions.delete(d)}),this.pcPromises.has(a)&&(this.pcPromises.get(a).forEach(function(a){a.reject(null)}),this.pcPromises.delete(a)),c.close(),this.pcs.delete(a)}}},{key:"getPendingEvent",value:function(a,b){return a.pendingEvents.has(b)&&a.pendingEvents.get(b).length>0?a.pendingEvents.get(b).shift():(a.eventPromises.has(b)||a.eventPromises.set(b,[]),new Promise(function(c,d){a.eventPromises.get(b).push({resolve:c,reject:d})}))}},{key:"getStream",value:function(a){return this.streams.get(a)}},{key:"makeTrackTO",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.id?a.id:crypto.randomUUID();return this.tracks.set(b,a),{type:"proxy",contentHint:a.contentHint,enabled:a.enabled,id:b,kind:a.kind,label:a.label,muted:a.muted,readyState:a.readyState,settings:a.getSettings()}}},{key:"makeStreamTO",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.id?a.id:crypto.randomUUID(),c=this;this.streams.set(b,a);var d=a.getTracks().map(function(a){return c.makeTrackTO(a)});return{type:"proxy",id:b,active:a.active,tracks:d}}},{key:"makeSyncronizationSourceTO",value:function(a){return{audioLevel:a.audioLevel,rtpTimestamp:a.rtpTimestamp,source:a.source,timestamp:a.timestamp}}},{key:"makeReceiverTO",value:function(a){var b=this,c=a.getSynchronizationSources();c=c.map(function(a){return b.makeSyncronizationSourceTO(a)});var d={id:a.id?a.id:crypto.randomUUID(),type:"proxy",track:a.track?this.makeTrackTO(a.track):null,synchronizationSources:c,stats:[]};return a.id=d.id,this.receivers.set(d.id,a),d}},{key:"makeDTMFSenderTO",value:function(a){var b={id:a.id?a.id:crypto.randomUUID(),type:"proxy",toneBuffer:a.toneBuffer};return a.id=b.id,this.dtmfSenders.set(b.id,a),b}},{key:"makeSenderTO",value:function(a){var b={id:a.id?a.id:crypto.randomUUID(),type:"proxy",track:a.track?this.makeTrackTO(a.track):null,dtmf:a.dtmf?this.makeDTMFSenderTO(a.dtmf):null};return a.id=b.id,this.senders.set(b.id,a),b}},{key:"makeTransceiverTO",value:function(a){return{id:a.id,type:"proxy",currentDirection:a.currentDirection,direction:a.direction,mid:a.mid,receiver:a.receiver?this.makeReceiverTO(a.receiver):null,sender:a.sender?this.makeSenderTO(a.sender):null,stopped:a.stopped}}},{key:"findProxySubject",value:function(a){return this.pcs.has(a)?this.pcs.get(a):this.audioContexts.has(a)?this.audioContexts.get(a):this.audioNodes.has(a)?this.audioNodes.get(a):this.workers.has(a)?this.workers.get(a):this.certs.has(a)?this.certs.get(a):this.streams.has(a)?this.streams.get(a):this.offers.has(a)?this.offers.get(a):this.answers.has(a)?this.answers.get(a):this.remoteDescriptions.has(a)?this.remoteDescriptions.get(a):this.mediaElements.has(a)?this.mediaElements.get(a):this.senders.has(a)?this.senders.get(a):this.dtmfSenders.has(a)?this.dtmfSenders.get(a):this.receivers.has(a)?this.receivers.get(a):this.transceivers.has(a)?this.transceivers.get(a):this.tracks.has(a)?this.tracks.get(a):null}},{key:"traverse",value:function(a,b){if("object"==(void 0===a?"undefined":(0,s.default)(a)))for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b.apply(this,[a,c,a[c]]),null!==a[c]&&"object"==(0,s.default)(a[c])&&this.traverse(a[c],b))}},{key:"getWorker",value:function(a){var b=this;return this.workers.has(a)?this.workers.get(a):(this.workerPromises.has(a)||this.workerPromises.set(a,[]),new Promise(function(c,d){b.workerPromises.get(a).push({resolve:c,reject:d})}))}},{key:"gatherPeerConnectionState",value:function(a,b){var c=this;a.canTrickleIceCandidates=b.canTrickleIceCandidates,a.connectionState=b.connectionState,a.currentLocalDescription=b.currentLocalDescription,a.currentRemoteDescription=b.currentRemoteDescription,a.iceConnectionState=b.iceConnectionState,a.iceGatheringState=b.iceGatheringState,a.iceGatheringState=b.iceGatheringState,a.localDescription=b.localDescription,a.peerIdentity=b.peerIdentity,a.pendingLocalDescription=b.pendingLocalDescription,a.pendingRemoteDescription=b.pendingRemoteDescription,a.remoteDescription=b.remoteDescription,a.sctp=b.sctp,a.signalingState=b.signalingState,a.configuration=b.getConfiguration(),a.transceivers=b.getTransceivers().map(function(a){return c.makeTransceiverTO(a)}),a.senders=b.getSenders().map(function(a){return c.makeSenderTO(a)}),a.receivers=b.getReceivers().map(function(a){return c.makeReceiverTO(a)})}},{key:"callWebRTCApi",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(b,c,d){var e,f,h,j,l,m,o,q,s,v,w,x,y,z,A,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,_a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,Md,Nd,Od,Pd,Qd,Rd,Sd,Td,Ud,Vd,Wd;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:e=this,a.t0=b,a.next=a.t0===n.HELLO_API_NAME?4:a.t0===n.GETUSERMEDIA_API_NAME?5:a.t0===n.ENUMERATEDEVICES_API_NAME?11:a.t0===n.STREAM_ADD_TRACK?15:a.t0===n.STREAM_REMOVE_TRACK?17:a.t0===n.GENERATE_CERTIFICATE_API_NAME?19:a.t0===n.NEWRTCPEERCONNECTION_API_NAME?25:a.t0===n.PC_GET_CONFIGURATION?31:a.t0===n.CREATE_WORKER?35:a.t0===n.WORKER_TERMINATE?37:a.t0===n.WORKER_POST_MESSAGE?39:a.t0===n.NEW_AUDIO_CONTEXT?47:a.t0===n.AUDIO_CTX_CREATE_AUDIO_NODE?49:a.t0===n.AUDIO_CTX_CLOSE?59:a.t0===n.AUDIO_NODE_CONNECT?62:a.t0===n.AUDIO_NODE_DISCONNECT?64:a.t0===n.AUDIO_NODE_SET_TYPE?66:a.t0===n.AUDIO_NODE_START?69:a.t0===n.AUDIO_NODE_STOP?72:a.t0===n.AUDIO_PARAM_SET_VALUE_AT_TIME?75:a.t0===n.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME?78:a.t0===n.GET_RECEIVERS_API_NAME?81:a.t0===n.GET_SENDERS_API_NAME?88:a.t0===n.INSERT_DTMF_API_NAME?95:a.t0===n.GET_TRANSCEIVERS_API_NAME?97:a.t0===n.TRANSCEIVER_SET_CODEC_PREFS?103:a.t0===n.ADD_TRACK_API_NAME?104:a.t0===n.ADD_TRANSCEIVER_API_NAME?121:a.t0===n.PC_CLOSE_API_NAME?134:a.t0===n.ADDSTREAM_API_NAME?136:a.t0===n.GET_STATS_API_NAME?142:a.t0===n.GET_SENDER_STATS_API_NAME?153:a.t0===n.GET_RECEIVER_STATS_API_NAME?161:a.t0===n.REPLACE_SENDER_TRACK_API_NAME?169:a.t0===n.PC_REMOVE_TRACK_API_NAME?175:a.t0===n.CREATE_OFFER_API_NAME?183:a.t0===n.CREATE_ANSWER_API_NAME?193:a.t0===n.SET_LOCAL_DESCRIPTION_API_NAME?203:a.t0===n.SET_REMOTE_DESCRIPTION_API_NAME?213:a.t0===n.ADD_ICE_CANDIDATE_API_NAME?222:a.t0===n.ADD_PC_EVENT_LISTENER?228:a.t0===n.ADD_TRACK_EVENT_LISTENER?243:a.t0===n.ADD_WORKER_EVENT_LISTENER?255:a.t0===n.ADD_DTMF_EVENT_LISTENER?270:a.t0===n.CREATE_MEDIA_ELEMENT_API_NAME?280:a.t0===n.MEDIA_ELEMENT_SET_SINK_ID_API_NAME?285:a.t0===n.SET_MEDIA_SRC_OBJ_API_NAME?291:a.t0===n.MEDIA_ELEMENT_MUTED?293:a.t0===n.SET_MEDIA_HIDDEN_API_NAME?295:a.t0===n.SET_MEDIA_VOLUME_API_NAME?297:a.t0===n.MEDIA_ELEMENT_PLAY_API_NAME?299:a.t0===n.MEDIA_ELEMENT_PAUSE_API_NAME?301:a.t0===n.MEDIA_ELEMENT_REMOVE?303:a.t0===n.TOGGLE_TRACK_ENABLED_API_NAME?305:a.t0===n.TRACK_STOP_API_NAME?307:a.t0===n.TRACK_GET_SETTINGS?309:a.t0===n.SENDER_CREATE_ENCODED_STREAMS?311:a.t0===n.RECEIVER_CREATE_ENCODED_STREAMS?316:a.t0===n.UNLOAD_EVENT_NAME?321:323;break;case 4:return a.abrupt("return",{version:this.version,platform:"web",userAgent:navigator.userAgent});case 5:return f=(0,i.default)(d,1),h=f[0],a.next=9,navigator.mediaDevices.getUserMedia(h);case 9:return j=a.sent,a.abrupt("return",this.makeStreamTO(j));case 11:return a.next=13,navigator.mediaDevices.enumerateDevices();case 13:return a.t1=function(a){return a.toJSON()},a.abrupt("return",a.sent.map(a.t1));case 15:return l=(0,i.default)(d,2),m=l[0],o=l[1],q=this.streams.get(m),s=this.tracks.get(o),a.abrupt("return",(q&&s&&q.addTrack(s),{}));case 17:return v=(0,i.default)(d,2),w=v[0],x=v[1],y=this.streams.get(w),z=this.tracks.get(x),a.abrupt("return",(y&&z&&y.removeTrack(z),{}));case 19:return A=(0,i.default)(d,1),C=A[0],a.next=23,RTCPeerConnection.generateCertificate(C);case 23:return D=a.sent,a.abrupt("return",(this.certs.set(c,D),{type:"proxy",id:c,expires:D.expires,fingerprints:D.getFingerprints()}));case 25:return E=(0,i.default)(d,3),F=E[0],G=E[1],H=E[2],G&&G.certificates&&(I=G.certificates.map(function(a){return e.certs.get(a.id)}),G.certificates=I),J=new RTCPeerConnection(G,H),this.pcs.set(F,J),this.pcPromises.has(F)&&(this.pcPromises.get(F).forEach(function(a){a.resolve(a)}),this.pcPromises.set(F,[])),K={type:"proxy",pcId:F},a.abrupt("return",(this.gatherPeerConnectionState(K,J),K));case 31:return L=(0,i.default)(d,1),M=L[0],a.next=34,this.getPeerConnection(M);case 34:return a.abrupt("return",a.sent.getConfiguration());case 35:return N=(0,i.default)(d,4),O=N[0],P=N[1],Q=N[2],R=N[3],S=B(Q),T=new Blob([S],{type:P}),U=URL.createObjectURL(T),V=new Worker(U,R),a.abrupt("return",(this.workers.set(O,V),this.workerPromises.has(O)&&(this.workerPromises.get(O).forEach(function(a){a.resolve(V)}),this.workerPromises.set(O,[])),{type:"proxy",id:O}));case 37:return W=(0,i.default)(d,1),X=W[0],a.abrupt("return",(this.workers.has(X)&&(this.workers.get(X).terminate(),this.workerPromises.has(X)&&this.workerPromises.get(X).forEach(function(a){a.reject(null)}),this.workerPromises.delete(X),this.workers.delete(X)),{}));case 39:return Y=(0,i.default)(d,3),Z=Y[0],$=Y[1],_=Y[2],a.next=45,this.getWorker(Z);case 45:return aa=a.sent,a.abrupt("return",(this.logger.debug("Message before traversing: ",JSON.stringify($)),this.traverse($,function(a,b,c){"proxy"===c.type&&c.id&&(a[b]=e.findProxySubject(c.id))}),this.logger.debug("Message after traversing: ",$),this.logger.debug("Options before traversing: ",JSON.stringify(_)),this.traverse(_,function(a,b,c){"proxy"===c.type&&c.id&&(a[b]=e.findProxySubject(c.id))}),this.logger.debug("Options after traversing: ",_),aa.postMessage($,_),{type:"proxy",id:Z}));case 47:return ba=(0,i.default)(d,2),ca=ba[0],da=ba[1],ea=new AudioContext,a.abrupt("return",(this.audioContexts.set(ca,ea),this.audioNodes.set(da,ea.destination),{type:"proxy",id:ca,baseLatency:ea.baseLatency,currentTime:ea.currentTime,outputLatency:ea.outputLatency,sampleRate:ea.sampleRate,sinkId:ea.sinkId,state:ea.state}));case 49:if(fa=(0,i.default)(d,4),ga=fa[0],ha=fa[1],ia=fa[2],ja=fa[3],!this.audioContexts.has(ga)){a.next=58;break}return ka=this.audioContexts.get(ga),la=ka["create"+ia],ja=ja.map(function(a){return"proxy"===a.type?e.findProxySubject(a.id):a}),ma=la.apply(ka,ja),this.audioNodes.set(ha,ma),na=null,ma.stream&&(oa=ma.stream.getTracks().map(function(a){return e.makeTrackTO(a,ha)}),na=this.makeStreamTO(ma.stream,ha),na.tracks=oa),a.abrupt("return",{id:ha,channelCount:ma.channelCount,channelCountMode:ma.channelCountMode,channelInterpretation:ma.channelInterpretation,numberOfInputs:ma.numberOfInputs,numberOfOutputs:ma.numberOfOutputs,fftSize:ma.fftSize,frequencyBinCount:ma.frequencyBinCount,maxDecibels:ma.maxDecibels,minDecibels:ma.minDecibels,smoothingTimeConstant:ma.smoothingTimeConstant,stream:na});case 58:return a.abrupt("return",{});case 59:return pa=(0,i.default)(d,1),qa=pa[0],this.audioContexts.has(qa)&&(this.audioContexts.get(qa).close(),this.audioContexts.delete(qa)),a.abrupt("return",{});case 62:return ra=(0,i.default)(d,4),sa=ra[0],ta=ra[1],ua=ra[2],va=ra[3],wa=this.audioNodes.get(sa),xa=this.findProxySubject(ta.id),a.abrupt("return",(wa&&xa&&wa.connect(xa,ua||0,va||0),{}));case 64:return ya=(0,i.default)(d,4),za=ya[0],Aa=ya[1],Ba=ya[2],Ca=ya[3],Da=this.audioNodes.get(za),Ea=this.findProxySubject(Aa.id),a.abrupt("return",(Da&&Ea&&Da.disconnect(Ea,Ba||0,Ca||0),{}));case 66:return Fa=(0,i.default)(d,2),Ga=Fa[0],Ha=Fa[1],this.audioNodes.has(Ga)&&(this.audioNodes.get(Ga).type=Ha),a.abrupt("return",{});case 69:return Ia=(0,i.default)(d,2),Ja=Ia[0],Ka=Ia[1],this.audioNodes.has(Ja)&&this.audioNodes.get(Ja).start(Ka),a.abrupt("return",{});case 72:return La=(0,i.default)(d,2),Ma=La[0],Na=La[1],this.audioNodes.has(Ma)&&this.audioNodes.get(Ma).stop(Na),a.abrupt("return",{});case 75:return Oa=(0,i.default)(d,3),Pa=Oa[0],Qa=Oa[1],Ra=Oa[2],this.audioNodes.has(Pa)&&(Sa=this.audioNodes.get(Pa),Sa.gain?Sa.gain.setValueAtTime(Qa,Ra||Sa.context.currentTime):Sa.frequency&&Sa.frequency.setValueAtTime(Qa,Ra||Sa.context.currentTime)),a.abrupt("return",{});case 78:return Ta=(0,i.default)(d,3),Ua=Ta[0],Va=Ta[1],Wa=Ta[2],this.audioNodes.has(Ua)&&(Xa=this.audioNodes.get(Ua),Xa.frequency&&Xa.frequency.linearRampToValueAtTime(Va,Wa||Xa.context.currentTime)),a.abrupt("return",{});case 81:return Ya=(0,i.default)(d,1),Za=Ya[0],a.t2=Za,a.next=85,this.getPeerConnection(Za);case 85:return a.t3=function(a){return e.makeReceiverTO(a)},a.t4=a.sent.getReceivers().map(a.t3),a.abrupt("return",{pcId:a.t2,receivers:a.t4});case 88:return $a=(0,i.default)(d,1),_a=$a[0],a.t5=_a,a.next=92,
this.getPeerConnection(_a);case 92:return a.t6=function(a){return e.makeSenderTO(a)},a.t7=a.sent.getSenders().map(a.t6),a.abrupt("return",{pcId:a.t5,senders:a.t7});case 95:return ab=(0,i.default)(d,4),bb=ab[0],cb=ab[1],db=ab[2],eb=ab[3],fb=this.dtmfSenders.get(bb),a.abrupt("return",(fb&&fb.insertDTMF(cb,db,eb),{}));case 97:return gb=(0,i.default)(d,1),hb=gb[0],a.next=101,this.getPeerConnection(hb);case 101:return ib=a.sent.getTransceivers(),a.abrupt("return",(ib=ib.map(function(a){return a.id=a.id?a.id:crypto.randomUUID(),e.makeTransceiverTO(a)}),{pcId:hb,transceivers:ib}));case 103:return a.abrupt("return",{});case 104:return jb=(0,g.default)(d),kb=jb[0],lb=jb[1],mb=jb[2],nb=jb.slice(3),a.next=111,this.getPeerConnection(lb);case 111:if(ob=a.sent,pb=[],nb.forEach(function(a){var b=e.streams.get(a.proxy.id);b&&pb.push(b)}),!(qb=this.tracks.get(mb.id))){a.next=120;break}return rb=[qb].concat(pb),sb=ob.addTrack.apply(ob,rb),sb.id=kb,tb=this.makeSenderTO(sb),a.abrupt("return",(tb.pcId=lb,tb.senders=ob.getSenders().map(function(a){return e.makeSenderTO(a)}),tb.receivers=ob.getReceivers().map(function(a){return e.makeReceiverTO(a)}),tb.transceivers=ob.getTransceivers().map(function(a){return e.makeTransceiverTO(a)}),tb));case 120:return a.abrupt("return",{});case 121:return ub=(0,i.default)(d,4),vb=ub[0],wb=ub[1],xb=ub[2],yb=ub[3],a.next=128,this.getPeerConnection(vb);case 128:return zb=a.sent,"string"!=typeof xb&&(xb=this.tracks.get(xb.id)),yb&&yb.streams&&(Ab=[],yb.streams.forEach(function(a){if(a.proxy){var b=e.streams.get(a.proxy.id);Ab.push(b)}}),yb.streams=Ab),Bb=zb.addTransceiver(xb,yb),Bb.id=wb.id,this.transceivers.set(wb.id,Bb),Bb.sender&&(Bb.sender.id=wb.sender.id,this.senders.set(wb.sender.id,Bb.sender)),Bb.receiver&&(Bb.receiver.id=wb.receiver.id,this.receivers.set(wb.receiver.id,Bb.receiver)),Cb=this.makeTransceiverTO(Bb),a.abrupt("return",(Cb.pcId=vb,Cb.senders=zb.getSenders().map(function(a){return e.makeSenderTO(a)}),Cb.receivers=zb.getReceivers().map(function(a){return e.makeReceiverTO(a)}),Cb.transceivers=zb.getTransceivers().map(function(a){return e.makeTransceiverTO(a)}),Cb));case 134:return Db=(0,i.default)(d,1),Eb=Db[0],a.abrupt("return",(this.closePeerConnection(Eb),{}));case 136:return Fb=(0,i.default)(d,2),Gb=Fb[0],Hb=Fb[1],Ib=this.streams.get(Hb.id),a.next=139,this.getPeerConnection(Gb);case 139:return a.t8=Ib,a.sent.addStream(a.t8),a.abrupt("return",Hb);case 142:return Jb=(0,i.default)(d,2),Kb=Jb[0],Lb=Jb[1],a.next=147,this.getPeerConnection(Kb);case 147:return Mb=a.sent,a.next=150,Mb.getStats(Lb);case 150:return Nb=a.sent,Ob=[],a.abrupt("return",(Nb.forEach(function(a){var b=Object.assign({},a);Ob.push(b)}),Ob));case 153:if(Pb=(0,i.default)(d,1),Qb=Pb[0],!this.senders.has(Qb)){a.next=160;break}return a.next=157,this.senders.get(Qb).getStats();case 157:return Rb=a.sent,Sb=[],a.abrupt("return",(Rb.forEach(function(a){var b=Object.assign({},a);Sb.push(b)}),Sb));case 160:return a.abrupt("return",[]);case 161:if(Tb=(0,i.default)(d,1),Ub=Tb[0],!this.receivers.has(Ub)){a.next=168;break}return a.next=165,this.receivers.get(Ub).getStats();case 165:return Vb=a.sent,Wb=[],a.abrupt("return",(Vb.forEach(function(a){var b={id:a.id?a.id:crypto.randomUUID(),type:a.type,concealedSamples:a.concealedSamples};Wb.push(b)}),Wb));case 168:return a.abrupt("return",{});case 169:if(Xb=(0,i.default)(d,2),Yb=Xb[0],Zb=Xb[1],$b=this.senders.get(Yb),_b=Zb?this.tracks.get(Zb.id):null,a.t9=_b&&$b,!a.t9){a.next=174;break}return a.next=174,$b.replaceTrack(_b);case 174:return a.abrupt("return",{});case 175:return ac=(0,i.default)(d,2),bc=ac[0],cc=ac[1],a.next=180,this.getPeerConnection(bc);case 180:return dc=a.sent,ec=this.senders.get(cc.id),a.abrupt("return",(ec&&dc.removeTrack(ec),{}));case 183:return fc=(0,i.default)(d,2),gc=fc[0],hc=fc[1],a.next=188,this.getPeerConnection(gc);case 188:return ic=a.sent,a.next=191,ic.createOffer(hc);case 191:return jc=a.sent,a.abrupt("return",(this.offers.set(c,jc),{id:c,type:jc.type,sdp:jc.sdp}));case 193:return kc=(0,i.default)(d,2),lc=kc[0],mc=kc[1],a.next=198,this.getPeerConnection(lc);case 198:return nc=a.sent,a.next=201,nc.createAnswer(mc);case 201:return oc=a.sent,a.abrupt("return",(this.answers.set(c,oc),{id:c,type:oc.type,sdp:oc.sdp}));case 203:if(pc=(0,i.default)(d,2),qc=pc[0],rc=pc[1],sc="offer"===rc.type?this.offers:this.answers,tc=rc.id?sc.get(rc.id):rc,!tc){a.next=212;break}return tc.sdp=rc.sdp,a.next=208,this.getPeerConnection(qc);case 208:return uc=a.sent,a.next=211,uc.setLocalDescription(tc);case 211:return a.abrupt("return",rc);case 212:return a.abrupt("return",{});case 213:return vc=(0,i.default)(d,2),wc=vc[0],xc=vc[1],a.next=218,this.getPeerConnection(wc);case 218:return yc=a.sent,a.next=221,yc.setRemoteDescription(xc);case 221:return a.abrupt("return",xc);case 222:return zc=(0,i.default)(d,2),Ac=zc[0],Bc=zc[1],Cc=Bc?new RTCIceCandidate({sdpMLineIndex:Bc.sdpMLineIndex,candidate:Bc.candidate}):null,a.next=225,this.getPeerConnection(Ac);case 225:return a.t10=Cc,a.sent.addIceCandidate(a.t10),a.abrupt("return",Bc);case 228:return Dc=(0,i.default)(d,2),Ec=Dc[0],Fc=Dc[1],a.next=233,this.getPeerConnection(Ec);case 233:if(Gc=a.sent,Gc.pendingEvents||(Gc.pendingEvents=new Map),Gc.eventPromises||(Gc.eventPromises=new Map),!Gc.pendingEvents.has(Fc)){a.next=241;break}return a.next=237,this.getPendingEvent(Gc,Fc);case 237:Hc=a.sent,this.sendEvent(n.ADD_PC_EVENT_LISTENER,c,Hc),a.next=242;break;case 241:Gc[Fc]||(Ic=function(a){var b=null;if(a.type===p.ICE_CANDIDATE){e.logger.debug("event: ",a);var d=a.candidate,f=null;d&&(f={sdpMLineIndex:d.sdpMLineIndex,sdpMid:d.sdpMid,candidate:d.candidate,type:d.type,foundation:d.foundation,protocol:d.protocol,address:d.address,port:d.port,priority:d.priority,url:d.url,relayProtocol:d.relayProtocol,component:d.compoonent,relatedAddress:d.relatedAddress,relatedPort:d.relatedPort,tcpType:d.tcpType,usernameFragment:d.usernameFragment}),b={pcId:Ec,eventName:a.type,type:"proxy",candidate:f},e.gatherPeerConnectionState(b,Gc)}else a.type===p.SIG_STATE_CHANGE?(b={pcId:Ec,eventName:a.type,type:"proxy"},e.gatherPeerConnectionState(b,Gc)):a.type===p.TRACK?(b={pcId:Ec,eventName:a.type,type:"proxy",streams:[],senders:[],receivers:[],track:e.makeTrackTO(a.track)},b.streams=a.streams.map(function(a){return e.makeStreamTO(a)}),e.gatherPeerConnectionState(b,Gc)):a.type===p.CONN_STATE_CHANGE||a.type===p.ICE_CONN_STATE_CHANGE||a.type===p.ICE_GATHER_STATE_CHANGE||a.type===p.NEGOTIATION_NEEDED?(b={pcId:Ec,eventName:a.type,type:"proxy"},e.gatherPeerConnectionState(b,Gc)):e.logger.warn("Ignored event, type: "+a.type+", event: "+JSON.stringify(a));b&&e.processPendingEvents(Gc,a,b,n.ADD_PC_EVENT_LISTENER,c)},Gc[Fc]=Ic,Gc.addEventListener(Fc,Ic));case 242:return a.abrupt("return",null);case 243:if(Jc=(0,i.default)(d,3),Kc=Jc[0],Lc=Jc[1],Mc=Jc[2],Nc=this.tracks.get(Kc),!Nc){a.next=254;break}if(Nc.pendingEvents||(Nc.pendingEvents=new Map),Nc.eventPromises||(Nc.eventPromises=new Map),!Nc.pendingEvents.has(Lc)){a.next=252;break}return a.next=248,this.getPendingEvent(Nc,Lc);case 248:Oc=a.sent,this.sendEvent(n.ADD_TRACK_EVENT_LISTENER,c,Oc),a.next=253;break;case 252:Nc[Lc]||(Pc=function(a){if(Object.values(r).includes(Lc)){var b={trackId:Kc,eventName:a.type,type:"proxy"};b&&e.processPendingEvents(Nc,a,b,n.ADD_TRACK_EVENT_LISTENER,c)}else e.logger.warn("Ignored event: "+JSON.stringify(a))},Nc[Lc]=Pc,Nc.addEventListener(Lc,Pc,Mc));case 253:return a.abrupt("return",null);case 254:return a.abrupt("return",{});case 255:return Qc=(0,i.default)(d,2),Rc=Qc[0],Sc=Qc[1],a.next=260,this.getWorker(Rc);case 260:if(Tc=a.sent,Tc.pendingEvents||(Tc.pendingEvents=new Map),Tc.eventPromises||(Tc.eventPromises=new Map),!Tc.pendingEvents.has(Sc)){a.next=268;break}return a.next=264,this.getPendingEvent(Tc,Sc);case 264:Uc=a.sent,this.sendEvent(n.ADD_WORKER_EVENT_LISTENER,c,Uc),a.next=269;break;case 268:Tc[Sc]||(Vc=function(a){if(e.logger.debug("Received event: ",a),Object.values(u).includes(Sc)){var b={wId:Rc,eventName:a.type,type:"proxy",data:a.data};b&&e.processPendingEvents(Tc,a,b,n.ADD_WORKER_EVENT_LISTENER,c)}else e.logger.warn("Ignored event: "+JSON.stringify(a),a)},Tc[Sc]=Vc,Tc.addEventListener(Sc,Vc));case 269:return a.abrupt("return",null);case 270:if(Wc=(0,i.default)(d,3),Xc=Wc[0],Yc=Wc[1],Zc=Wc[2],$c=this.dtmfSenders.get(Xc),$c.pendingEvents||($c.pendingEvents=new Map),$c.eventPromises||($c.eventPromises=new Map),!$c.pendingEvents.has(Yc)){a.next=278;break}return a.next=274,this.getPendingEvent($c,Yc);case 274:_c=a.sent,this.sendEvent(n.ADD_DTMF_EVENT_LISTENER,c,_c),a.next=279;break;case 278:$c[Yc]||(ad=function(a){if(Object.values(t).includes(Yc)){var b={dtmfId:Xc,eventName:a.type,type:a.type,tone:a.tone};e.processPendingEvents($c,a,b,n.ADD_DTMF_EVENT_LISTENER,c)}else e.logger.warn("Ignored event: "+JSON.stringify(a))},$c[Yc]=ad,$c.addEventListener(Yc,ad,Zc));case 279:return a.abrupt("return",null);case 280:if(bd=(0,i.default)(d,2),cd=bd[0],dd=bd[1],"audio"===dd.kind||"video"===dd.kind){a.next=283;break}return a.abrupt("return",(this.logger.warn("Invalid media type: "+JSON.stringify(dd)),null));case 283:return ed=document.createElement(dd.kind),a.abrupt("return",(Object.assign(ed,dd),document.body.appendChild(ed),this.mediaElements.set(cd,ed),{id:cd,sinkId:ed.sinkId}));case 285:if(fd=(0,i.default)(d,2),gd=fd[0],hd=fd[1],id=this.mediaElements.get(gd),!id){a.next=290;break}return a.next=289,id.setSinkId(hd);case 289:return a.abrupt("return",{id:gd,sinkId:id.sinkId});case 290:return a.abrupt("return",{});case 291:return jd=(0,i.default)(d,2),kd=jd[0],ld=jd[1],md=ld?this.getStream(ld.id):null,a.abrupt("return",(this.mediaElements.has(kd)&&(this.mediaElements.get(kd).srcObject=md),{}));case 293:return nd=(0,i.default)(d,2),od=nd[0],pd=nd[1],a.abrupt("return",(this.mediaElements.has(od)&&(this.mediaElements.get(od).muted=pd),{id:od,muted:pd}));case 295:return qd=(0,i.default)(d,2),rd=qd[0],sd=qd[1],td=this.mediaElements.get(rd),a.abrupt("return",(td&&(td.hidden=sd),{}));case 297:return ud=(0,i.default)(d,2),vd=ud[0],wd=ud[1],a.abrupt("return",(this.mediaElements.has(vd)&&(this.mediaElements.get(vd).volume=wd),{}));case 299:return xd=(0,i.default)(d,1),yd=xd[0],a.abrupt("return",(this.mediaElements.has(yd)&&this.mediaElements.get(yd).play(),{}));case 301:return zd=(0,i.default)(d,1),Ad=zd[0],a.abrupt("return",(this.mediaElements.has(Ad)&&this.mediaElements.get(Ad).pause(),{}));case 303:return Bd=(0,i.default)(d,1),Cd=Bd[0],a.abrupt("return",(this.mediaElements.has(Cd)&&(this.mediaElements.get(Cd).remove(),this.mediaElements.delete(Cd)),{}));case 305:return Dd=(0,i.default)(d,2),Ed=Dd[0],Fd=Dd[1],Gd=this.tracks.get(Ed),a.abrupt("return",Gd?(Gd.enabled=Fd,this.makeTrackTO(Gd)):{});case 307:return Hd=(0,i.default)(d,1),Id=Hd[0],Jd=this.tracks.get(Id),a.abrupt("return",(Jd&&(Jd.stop(),this.tracks.delete(Id)),{}));case 309:return Kd=(0,i.default)(d,1),Ld=Kd[0],Md=this.tracks.get(Ld),a.abrupt("return",Md?Md.getSettings():{});case 311:if(Nd=(0,i.default)(d,2),Od=Nd[0],Pd=Nd[1],!this.senders.has(Od)){a.next=315;break}return Qd=this.senders.get(Od).createEncodedStreams(),a.abrupt("return",(this.streams.set(Pd.id,Qd),this.streams.set(Pd.readable.id,Qd.readable),this.streams.set(Pd.writable.id,Qd.writable),Pd));case 315:return a.abrupt("return",{});case 316:if(Rd=(0,i.default)(d,2),Sd=Rd[0],Td=Rd[1],!this.receivers.has(Sd)){a.next=320;break}return Ud=this.receivers.get(Sd).createEncodedStreams(),a.abrupt("return",(this.streams.set(Td.id,Ud),this.streams.set(Td.readable.id,Ud.readable),this.streams.set(Td.writable.id,Ud.writable),Td));case 320:return a.abrupt("return",{});case 321:return Vd=(0,i.default)(d,1),Wd=Vd[0],a.abrupt("return",(Wd.pcIds.forEach(function(a){e.closePeerConnection(a)}),Wd.streamIds.forEach(function(a){var b=e.streams.get(a);b&&("function"==typeof b.getTracks&&b.getTracks().forEach(function(a){a.stop()}),e.streams.delete(a))}),Wd.trackIds.forEach(function(a){e.tracks.delete(a)}),Wd.workerIds.forEach(function(a){var b=e.workers.get(a);b&&b.terminate(),e.workers.delete(a)}),Wd.mediaElementIds.forEach(function(a){var b=e.mediaElements.get(a);b&&(b.remove(),e.mediaElements.delete(a))}),Wd.transceiverIds.forEach(function(a){e.transceivers.delete(a)}),Wd.senderIds.forEach(function(a){e.senders.delete(a)}),Wd.receiverIds.forEach(function(a){e.receivers.delete(a)}),{}));case 323:return a.abrupt("return",null);case 324:case"end":return a.stop()}},a,this)}));return a}()},{key:"sendMessage",value:function(a){this.logger.debug("Sending message: "+JSON.stringify(a));var b=a.message,c=D.deflateRaw(JSON.stringify(b));a.message=c;var d=(new TextEncoder).encode(JSON.stringify(a)),e=d.byteLength,f=new Uint8Array([e,e>>8,e>>16,e>>24]);this.channel.sendMessage(f),this.channel.sendMessage(d)}},{key:"sendEvent",value:function(a,b,c){var d={requestId:b,type:"event",message:{api:a,event:c}};this.sendMessage(d)}},{key:"sendResponse",value:function(a,b,c){var d={requestId:b,type:"response",message:{api:a,response:c}};this.sendMessage(d)}},{key:"sendError",value:function(a,b,c){var d={requestId:b,type:"error",message:{api:a,error:c}};this.sendMessage(d)}},{key:"handleWebRTCApi",value:function(){function a(a){return b.apply(this,arguments)}var b=(0,m.default)(k.default.mark(function a(b){var c;return k.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,this.callWebRTCApi(b.message.api,b.requestId,b.message.args);case 3:c=a.sent,c&&this.sendResponse(b.message.api,b.requestId,c),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),this.logger.error("Error handling WebRTC API: "+JSON.stringify(b)+", message: "+(a.t0.message?a.t0.message:"(no message)")+", error: "+JSON.stringify(a.t0)),this.logger.trace(a.t0),this.sendError(b.message.api,b.requestId,{name:a.t0.name,message:a.t0.message});case 10:case"end":return a.stop()}},a,this,[[0,7]])}));return a}()},{key:"processPendingEvents",value:function(a,b,c,d,e){if(a.pendingEvents.has(b.type)){a.pendingEvents.get(b.type).push(c);var f=a.eventPromises.get(b.type);f&&f.forEach(function(a){a.resolve(c)})}else this.sendEvent(d,e,c),a.pendingEvents.set(b.type,[])}},{key:"handleMessage",value:function(a){var b=a.message,c=D.inflateRaw(b),d=this.decoder.decode(c);a.message=JSON.parse(d),a.message.api&&a.requestId&&a.message.args?this.handleWebRTCApi(a):(this.logger.error("Invalid message format: "+JSON.stringify(a)),this.logger.trace(a))}},{key:"onClose",value:function(a){this.logger.info("WebRTC redir custom channel closed: "+JSON.stringify(a)+'"'),this.release()}},{key:"release",value:function(){var a=this;this.streams.forEach(function(a){a.getTracks().forEach(function(a){a.stop()})}),this.mediaElements.forEach(function(a){a.remove()}),this.pcs.forEach(function(b,c){a.closePeerConnection(c)}),this.certs.clear()}}]),a}()})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/asyncToGenerator":14,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/slicedToArray":20,"babel-runtime/helpers/toArray":21,"babel-runtime/helpers/typeof":22,"babel-runtime/regenerator":25}],2:[function(a,b,c){(function(a){(function(){var d={scope:{},getGlobal:function(b){return"undefined"!=typeof window&&window===b?b:void 0!==a?a:b}};d.global=d.getGlobal(this),d.initSymbol=function(){d.global.Symbol||(d.global.Symbol=d.Symbol),d.initSymbol=function(){}},d.symbolCounter_=0,d.Symbol=function(a){return"jscomp_symbol_"+a+d.symbolCounter_++},d.initSymbolIterator=function(){d.initSymbol(),d.global.Symbol.iterator||(d.global.Symbol.iterator=d.global.Symbol("iterator")),d.initSymbolIterator=function(){}},d.makeIterator=function(a){if(d.initSymbolIterator(),a[d.global.Symbol.iterator])return a[d.global.Symbol.iterator]();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}},d.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c},d.arrayFromIterable=function(a){return a instanceof Array?a:d.arrayFromIterator(d.makeIterator(a))},d.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a;for(var e in b)if(d.global.Object.defineProperties){var f=d.global.Object.getOwnPropertyDescriptor(b,e);f&&d.global.Object.defineProperty(a,e,f)}else a[e]=b[e]},d.array=d.array||{},d.array.done_=function(){return{done:!0,value:void 0}},d.array.arrayIterator_=function(a,b){a instanceof String&&(a=String(a));var c=0;d.initSymbol(),d.initSymbolIterator();var e={},f=(e.next=function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}return f.next=d.array.done_,d.array.done_()},e[Symbol.iterator]=function(){return f},e);return f},d.array.findInternal_=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}},d.array.from=function(a,b,c){b=void 0===b?function(a){return a}:b;var e=[];if(d.initSymbol(),d.initSymbolIterator(),a[Symbol.iterator]){d.initSymbol(),d.initSymbolIterator(),a=a[Symbol.iterator]();for(var f;!(f=a.next()).done;)e.push(b.call(c,f.value))}else{f=a.length;for(var g=0;g<f;g++)e.push(b.call(c,a[g]))}return e},d.array.of=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return d.array.from(b)},d.array.entries=function(){return d.array.arrayIterator_(this,function(a,b){return[a,b]})},d.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=d.array.entries)},d.array.keys=function(){return d.array.arrayIterator_(this,function(a){return a})},d.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=d.array.keys)},d.array.values=function(){return d.array.arrayIterator_(this,function(a,b){return b})},d.array.values$install=function(){Array.prototype.values||(Array.prototype.values=d.array.values)},d.array.copyWithin=function(a,b,c){var d=this.length;if(a=Number(a),b=Number(b),c=Number(null!=c?c:d),a<b)for(c=Math.min(c,d);b<c;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(c=Math.min(c,d+b-a),a+=c-b;c>b;)--c in this?this[--a]=this[c]:delete this[a];return this},d.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=d.array.copyWithin)},d.array.fill=function(a,b,c){for(null!=c&&a.length||(c=this.length||0),c=Number(c),b=Number((void 0===b?0:b)||0);b<c;b++)this[b]=a;return this},d.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=d.array.fill)},d.array.find=function(a,b){return d.array.findInternal_(this,a,b).v},d.array.find$install=function(){Array.prototype.find||(Array.prototype.find=d.array.find)},d.array.findIndex=function(a,b){return d.array.findInternal_(this,a,b).i},d.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=d.array.findIndex)},d.Map=function(a){if(a=void 0===a?[]:a,this.data_={},this.head_=d.Map.createHead_(),this.size=0,a){a=d.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.set(b[0],b[1])}},d.Map.checkBrowserConformance_=function(){var a=d.global.Map;if(!a||!a.prototype.entries||!Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a(d.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var e=c.entries(),f=e.next();return!f.done&&f.value[0]==b&&"s"==f.value[1]&&(f=e.next(),!(f.done||4!=f.value[0].x||"t"!=f.value[1]||!e.next().done))}catch(a){return!1}},d.Map.createHead_=function(){var a={};return a.previous=a.next=a.head=a},d.Map.getId_=function(a){return a instanceof Object?(d.Map.key_ in a||a instanceof Object&&Object.isExtensible&&Object.isExtensible(a)&&d.Map.defineProperty_(a,d.Map.key_,++d.Map.index_),d.Map.key_ in a?a[d.Map.key_]:" "+a):String(a)},d.Map.prototype.set=function(a,b){var c=this.maybeGetEntry_(a),d=c.id,e=c.list,c=c.entry;return e||(e=this.data_[d]=[]),c?c.value=b:(c={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.push(c),this.head_.previous.next=c,this.head_.previous=c,this.size++),this},d.Map.prototype.delete=function(a){var b=this.maybeGetEntry_(a);a=b.id;var c=b.list,d=b.index;return!(!(b=b.entry)||!c)&&(c.splice(d,1),c.length||delete this.data_[a],b.previous.next=b.next,b.next.previous=b.previous,b.head=null,this.size--,!0)},d.Map.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=d.Map.createHead_(),this.size=0},d.Map.prototype.has=function(a){return!!this.maybeGetEntry_(a).entry},d.Map.prototype.get=function(a){return(a=this.maybeGetEntry_(a).entry)&&a.value},d.Map.prototype.maybeGetEntry_=function(a){var b=d.Map.getId_(a),c=this.data_[b];if(c)for(var e=0;e<c.length;e++){var f=c[e];if(a!==a&&f.key!==f.key||a===f.key)return{id:b,list:c,index:e,entry:f}}return{id:b,list:c,index:-1,entry:void 0}},d.Map.prototype.entries=function(){return this.iter_(function(a){return[a.key,a.value]})},d.Map.prototype.keys=function(){return this.iter_(function(a){return a.key})},d.Map.prototype.values=function(){return this.iter_(function(a){return a.value})},d.Map.prototype.forEach=function(a,b){for(var c=d.makeIterator(this.entries()),e=c.next();!e.done;e=c.next())e=e.value,a.call(b,e[1],e[0],this)},d.Map.prototype.iter_=function(a){var b=this,c=this.head_;d.initSymbol(),d.initSymbolIterator();var e={};return e.next=function(){if(c){for(;c.head!=b.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:a(c)};c=null}return{done:!0,value:void 0}},e[Symbol.iterator]=function(){return this},e},d.Map.index_=0,d.Map.defineProperty_=Object.defineProperty?function(a,b,c){Object.defineProperty(a,b,{value:String(c)})}:function(a,b,c){a[b]=String(c)},d.Map.Entry_=function(){},d.Map.ASSUME_NO_NATIVE=!1,d.Map$install=function(){d.initSymbol(),d.initSymbolIterator(),!d.Map.ASSUME_NO_NATIVE&&d.Map.checkBrowserConformance_()?d.Map=d.global.Map:(d.initSymbol(),d.initSymbolIterator(),d.Map.prototype[Symbol.iterator]=d.Map.prototype.entries,d.initSymbol(),d.Map.key_=Symbol("map-id-key")),d.Map$install=function(){}},d.math=d.math||{},d.math.clz32=function(a){if(0===(a=Number(a)>>>0))return 32;var b=0;return 0==(4294901760&a)&&(a<<=16,b+=16),0==(4278190080&a)&&(a<<=8,b+=8),0==(4026531840&a)&&(a<<=4,b+=4),0==(3221225472&a)&&(a<<=2,b+=2),0==(2147483648&a)&&b++,b},d.math.imul=function(a,b){a=Number(a),b=Number(b);var c=65535&a,d=65535&b;return c*d+((a>>>16&65535)*d+c*(b>>>16&65535)<<16>>>0)|0},d.math.sign=function(a){return a=Number(a),0===a||isNaN(a)?a:0<a?1:-1},d.math.log10=function(a){return Math.log(a)/Math.LN10},d.math.log2=function(a){return Math.log(a)/Math.LN2},d.math.log1p=function(a){if(.25>(a=Number(a))&&-.25<a){for(var b=a,c=1,d=a,e=0,f=1;e!=d;)b*=a,f*=-1,d=(e=d)+f*b/++c;return d}return Math.log(1+a)},d.math.expm1=function(a){if(.25>(a=Number(a))&&-.25<a){for(var b=a,c=1,d=a,e=0;e!=d;)b*=a/++c,d=(e=d)+b;return d}return Math.exp(a)-1},d.math.cosh=function(a){return a=Number(a),(Math.exp(a)+Math.exp(-a))/2},d.math.sinh=function(a){return a=Number(a),0===a?a:(Math.exp(a)-Math.exp(-a))/2},d.math.tanh=function(a){if(0===(a=Number(a)))return a;var b=Math.exp(2*-Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b},d.math.acosh=function(a){return a=Number(a),Math.log(a+Math.sqrt(a*a-1))},d.math.asinh=function(a){if(0===(a=Number(a)))return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b},d.math.atanh=function(a){return a=Number(a),(d.math.log1p(a)-d.math.log1p(-a))/2},d.math.hypot=function(a,b,c){for(var e=[],f=2;f<arguments.length;++f)e[f-2]=arguments[f];a=Number(a),b=Number(b);for(var g=Math.max(Math.abs(a),Math.abs(b)),h=d.makeIterator(e),f=h.next();!f.done;f=h.next())g=Math.max(g,Math.abs(f.value));if(1e100<g||1e-100>g){for(a/=g,b/=g,h=a*a+b*b,e=d.makeIterator(e),f=e.next();!f.done;f=e.next())f=f.value,f=Number(f)/g,h+=f*f;return Math.sqrt(h)*g}for(g=a*a+b*b,e=d.makeIterator(e),f=e.next();!f.done;f=e.next())f=f.value,f=Number(f),g+=f*f;return Math.sqrt(g)},d.math.trunc=function(a){if(a=Number(a),isNaN(a)||1/0===a||-1/0===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b},d.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b},d.number=d.number||{},d.number.isFinite=function(a){return"number"==typeof a&&(!isNaN(a)&&1/0!==a&&-1/0!==a)},d.number.isInteger=function(a){return!!d.number.isFinite(a)&&a===Math.floor(a)},d.number.isNaN=function(a){return"number"==typeof a&&isNaN(a)},d.number.isSafeInteger=function(a){return d.number.isInteger(a)&&Math.abs(a)<=d.number.MAX_SAFE_INTEGER},d.number.EPSILON=Math.pow(2,-52),d.number.MAX_SAFE_INTEGER=9007199254740991,d.number.MIN_SAFE_INTEGER=-9007199254740991,d.object=d.object||{},d.object.assign=function(a,b){for(var c=[],e=1;e<arguments.length;++e)c[e-1]=arguments[e];for(c=d.makeIterator(c),e=c.next();!e.done;e=c.next())if(e=e.value)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f]);return a},d.object.is=function(a,b){return a===b?0!==a||1/a==1/b:a!==a&&b!==b},d.Set=function(a){if(a=void 0===a?[]:a,this.map_=new d.Map,a){a=d.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}this.size=this.map_.size},d.Set.checkBrowserConformance_=function(){var a=d.global.Set;if(!a||!a.prototype.entries||!Object.seal)return!1;var b=Object.seal({x:4}),a=new a(d.makeIterator([b]));if(a.has(b)||1!=a.size||a.add(b)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var a=a.entries(),c=a.next();return!c.done&&c.value[0]==b&&c.value[1]==b&&(c=a.next(),!c.done&&c.value[0]!=b&&4==c.value[0].x&&c.value[1]==c.value[0]&&a.next().done)},d.Set.prototype.add=function(a){return this.map_.set(a,a),this.size=this.map_.size,this},d.Set.prototype.delete=function(a){return a=this.map_.delete(a),this.size=this.map_.size,a},d.Set.prototype.clear=function(){this.map_.clear(),this.size=0},d.Set.prototype.has=function(a){return this.map_.has(a)},d.Set.prototype.entries=function(){return this.map_.entries()},d.Set.prototype.values=function(){return this.map_.values()},d.Set.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})},d.Set.ASSUME_NO_NATIVE=!1,d.Set$install=function(){!d.Set.ASSUME_NO_NATIVE&&d.Set.checkBrowserConformance_()?d.Set=d.global.Set:(d.Map$install(),d.initSymbol(),d.initSymbolIterator(),d.Set.prototype[Symbol.iterator]=d.Set.prototype.values),d.Set$install=function(){}},d.string=d.string||{},d.string.noRegExp_=function(a,b){if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression")},d.string.fromCodePoint=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];for(var c="",b=d.makeIterator(b),e=b.next();!e.done;e=b.next()){if(e=e.value,0>(e=+e)||1114111<e||e!==Math.floor(e))throw new RangeError("invalid_code_point "+e);65535>=e?c+=String.fromCharCode(e):(e-=65536,c+=String.fromCharCode(e>>>10&1023|55296),c+=String.fromCharCode(1023&e|56320))}return c},d.string.repeat=function(a){var b=this.toString();if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)1&a&&(c+=b),(a>>>=1)&&(b+=b);return c},d.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=d.string.repeat)},d.string.codePointAt=function(a){var b=this.toString(),c=b.length;if(0<=(a=Number(a)||0)&&a<c){a|=0;var d=b.charCodeAt(a);return 55296>d||56319<d||a+1===c?d:(a=b.charCodeAt(a+1),56320>a||57343<a?d:1024*(d-55296)+a+9216)}},d.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=d.string.codePointAt)},d.string.includes=function(a,b){return b=void 0===b?0:b,d.string.noRegExp_(a,"includes"),-1!==this.toString().indexOf(a,b)},d.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=d.string.includes)},d.string.startsWith=function(a,b){b=void 0===b?0:b,d.string.noRegExp_(a,"startsWith");var c=this.toString();a+="";for(var e=c.length,f=a.length,g=Math.max(0,Math.min(0|b,c.length)),h=0;h<f&&g<e;)if(c[g++]!=a[h++])return!1;return h>=f},d.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=d.string.startsWith)},d.string.endsWith=function(a,b){d.string.noRegExp_(a,"endsWith");var c=this.toString();a+="",void 0===b&&(b=c.length);for(var e=Math.max(0,Math.min(0|b,c.length)),f=a.length;0<f&&0<e;)if(c[--e]!=a[--f])return!1;return 0>=f},d.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=d.string.endsWith)},function(a,d){"object"==typeof c&&"object"==typeof b?b.exports=d():"function"==typeof define&&define.amd?define([],d):"object"==typeof c?c.CitrixWebRTC=d():a.CitrixWebRTC=d()}(self,function(){return function(){function a(d){var e=c[d];return void 0!==e?e.exports:(e=c[d]={exports:{}},b[d].call(e.exports,e,e.exports,a),e.exports)}var b={945:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.AudioElement=void 0;var e,f=c(658),g=c(550),h=c(851),i=c(946);!function(a){a.Init="Init",a.PlayStarted="PlayStarted",a.PauseCalled="PauseCalled"}(e||(e={})),a=function(a){function b(){var b=a.call(this,null,g.class_id_t.AudioElement,0,f.ProxyMode.Local)||this;return b.sinkId_="",b.srcObject_=null,b.loop_=!1,b.notiState=e.Init,b}return d(b,a),b.prototype.setSinkId=function(a){var b=this;return h.logger.log(this.user_friendly_id()+".setSinkId: set sinkId to "+a),new Promise(function(c,d){b.waitUntilConnected("AudioElement.sinkId").then(function(){var d=b.remoteInvoke(!0,g.method_id_AudioElement_t.sinkId,a);return i.getRedirector().getFeatureValue(g.FEATURE_ms_teams_pstn)||(b.sinkId_=a,c()),d}).then(function(){h.logger.log(b.user_friendly_id()+".setSinkId: success! resolving..."),b.sinkId_=a,c()}).catch(function(a){a=b.logRemoteInvokeError(a,".sinkId setter: failed to connect!"),d(a)})})},Object.defineProperty(b.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(a){this.setSinkId(a)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(a)),a!==this.srcObject_&&(this.srcObject_=a,this.waitUntilConnected("AudioElement.srcObject").then(function(){return a.syncBarrier()}).then(function(a){return h.logger.log(b.user_friendly_id()+".srcObject: set srcObject to s "+JSON.stringify(a)),b.remoteInvoke(!0,g.method_id_AudioElement_t.srcObject,null!==a&&void 0!==a?a.id:"null")}).then(function(){h.logger.log(b.user_friendly_id()+".srcObject setter: remote success!")}).catch(function(a){b.logRemoteInvokeError(a,".srcObject setter: failed to connect!")}))},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"src",{get:function(){return this.src_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".src: set src to "+a),this.src_=a,this.waitUntilConnected("AudioElement.src").then(function(){b.remoteInvoke(!0,g.method_id_AudioElement_t.src,a)}).catch(function(a){b.logRemoteInvokeError(a,".src setter: failed to connect!")})},enumerable:!1,configurable:!0}),b.prototype.play=function(){var a=this;return h.logger.log(this.user_friendly_id()+".play() called."),this.toggleAudio(!0),new Promise(function(b,c){a.waitUntilConnected("AudioElement.play").then(function(){return a.remoteInvoke(!1,g.method_id_AudioElement_t.play)}).then(function(){b()}).catch(function(b){a.logRemoteInvokeError(b,".play: failed to connect!"),c(b)})})},b.prototype.playEx=function(a,b,c){var d=this;h.logger.log(this.user_friendly_id()+".playEx() src:"+a+" sinkId:"+b+" loop:"+c),this.notiState=e.PlayStarted,
this.waitUntilConnected("AudioElement.playEx").then(function(){var a=[];return b&&a.push(d.setSinkId(b)),void 0!==c&&null!==c&&(d.loop_=c,a.push(d.remoteInvoke(!0,g.method_id_AudioElement_t.loop,c))),Promise.all(a)}).then(function(){return d.src_=a,d.remoteInvoke(!0,g.method_id_AudioElement_t.src,a)}).then(function(){return d.play()}).then(function(){if(d.notiState==e.PauseCalled)return h.logger.log(d.user_friendly_id()+".playEx() run deferred pause"),d.doPauseAndDispose()}).then(function(){d.notiState=e.Init,h.logger.log(d.user_friendly_id()+".playEx() done")}).catch(function(a){d.notiState=e.Init,d.logRemoteInvokeError(a,".playEx() failed!")})},b.prototype.pause=function(){var a=this;return h.logger.log(this.user_friendly_id()+".pause() called."),this.toggleAudio(!1),new Promise(function(b,c){a.waitUntilConnected("AudioElement.pause").then(function(){return a.remoteInvoke(!1,g.method_id_AudioElement_t.pause)}).then(function(){b()}).catch(function(b){a.logRemoteInvokeError(b,".pause: failed!"),c()})})},b.prototype.doPauseAndDispose=function(){var a=this;return h.logger.log(this.user_friendly_id()+".doPauseAndDispose() called."),this.toggleAudio(!1),new Promise(function(b,c){a.waitUntilConnected("AudioElement.doPauseAndDispose").then(function(){return a.remoteInvoke(!1,g.method_id_AudioElement_t.pause,[])}).then(function(){h.logger.log(a.user_friendly_id()+".doPauseAndDispose() resolving..."),b(),a.dispose()}).catch(function(b){a.logRemoteInvokeError(b,".doPauseAndDispose: failed to connect!")})})},b.prototype.pauseAndDispose=function(){this.notiState==e.PlayStarted?(h.logger.log(this.user_friendly_id()+".pauseAndDispose() deferred"),this.notiState=e.PauseCalled):this.doPauseAndDispose()},b.prototype.toggleAudio=function(a){this.srcObject_&&(h.logger.log(this.user_friendly_id()+".toggleAudio() toggle audio tracks:"+a),this.srcObject_.toggleAudio(a))},Object.defineProperty(b.prototype,"loop",{get:function(){return this.loop_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".loop: set loop to "+a),this.loop_=a,this.waitUntilConnected("AudioElement.loop").then(function(){b.remoteInvoke(!0,g.method_id_AudioElement_t.loop,a)}).catch(function(a){b.logRemoteInvokeError(a,".loop setter: failed to connect!")})},enumerable:!1,configurable:!0}),b.prototype.dispose=function(){h.logger.log(this.user_friendly_id()+".dispose()"),this.src_=this.sinkId_="",this.srcObject_=null,this.loop_=!1,this.release()},b}(f.ProxyObject),b.AudioElement=a},239:function(a,b,c){b.E=void 0;var d=c(945),e=c(851),f=function(){function a(){this.sinkId=void 0,this.src="",this.loop=void 0,this.element=null}return a.prototype.getSrc=function(){return this.src},a.prototype.setSinkId=function(a){this.sinkId=a},a.prototype.getLoop=function(){return!0===this.loop},a.prototype.setLoop=function(a){this.loop=a},a.prototype.play=function(a){this.element=new d.AudioElement,this.src=a,this.element.playEx(this.src,this.sinkId,this.loop)},a.prototype.pause=function(){this.element&&(this.element.pauseAndDispose(),this.element=null)},a.prototype.release=function(){this.element&&(this.element.dispose(),this.element=null)},a}();a=function(){function a(){this.audioIdMap=null,this.audioIdMap=new Map}return a.prototype.getNotificationInfo=function(a){if(this.audioIdMap.has(a))return this.audioIdMap.get(a);var b=new f;return this.audioIdMap.set(a,b),b},a.prototype.playNotifyAudio=function(a,b){b&&(e.logger.log("AudioNotification.playNotifyAudio, Remote to Thin Client audioId:"+a+" src:"+b),this.getNotificationInfo(a).play(b))},a.prototype.pauseNotifyAudio=function(a,b){if(this.audioIdMap.has(a)){var c=this.audioIdMap.get(a);b&&b!=c.getSrc()&&e.logger.log("AudioNotification.pauseNotifyAudio warning: for audioId:"+a+", different param src:"+b+" from org src:"+c.getSrc()),c.pause()}else e.logger.log("AudioNotification.pauseNotifyAudio no audioId:"+a+" src:"+b)},a.prototype.setSinkId=function(a,b){if(null!=b&&b.startsWith("speaker:")){e.logger.log("AudioNotification.setSinkId before parsing audioId:"+a+" sinkId:"+b);var c=b.slice(8);e.logger.log("AudioNotification.setSinkId after parsing audioId:"+a+" speakersinkId:"+c),b=c}this.getNotificationInfo(a).setSinkId(b)},a.prototype.getLoop=function(a){return this.getNotificationInfo(a).getLoop()},a.prototype.setLoop=function(a,b){this.getNotificationInfo(a).setLoop(b)},a.prototype.release=function(){this.audioIdMap.forEach(function(a,b,c){a.release()}),this.audioIdMap.clear()},a}(),b.E=a},613:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.E911Service=void 0;var e=c(550),f=c(658),g=c(851);a=function(a){function b(){var b=a.call(this,null,e.class_id_t.E911Service,0,f.ProxyMode.Local)||this;return b.preE911Info_=null,b}return d(b,a),b.prototype.isSameInfo=function(a){if(null==this.preE911Info_&&null!=a||null!=this.preE911Info_&&null==a||this.preE911Info_.e911.length!=a.e911.length||this.preE911Info_.bssid!=a.bssid||this.preE911Info_.ipv4!=a.ipv4||this.preE911Info_.subnetLengthIpv4!=a.subnetLengthIpv4||this.preE911Info_.ipv6!=a.ipv6||this.preE911Info_.subnetLengthIpv6!=a.subnetLengthIpv6||this.preE911Info_.mac!=a.mac||1e-4<=Math.abs(this.preE911Info_.latitude-a.latitude)||1e-4<=Math.abs(this.preE911Info_.longitude-a.longitude))return!1;for(var b=0;b<a.e911.length;b++)if(this.preE911Info_.e911[b].chassisId!=a.e911[b].chassisId||this.preE911Info_.e911[b].portId!=a.e911[b].portId)return!1;return!0},Object.defineProperty(b.prototype,"onupdate",{get:function(){return this.onupdate_},set:function(a){var b=this;this.onupdate_=a,this.waitUntilConnected(this.user_friendly_id()+".onupdate").then(function(){var a=b.registerCallbacks(!1,b.isNullCallback(b.onupdate_),e.method_id_E911Service_t.onupdate);return a.then(function(a){a=a.params;var c=a[0];a.slice(1),null!==b.preE911Info_&&b.isSameInfo(c)||(g.logger.log(b.user_friendly_id()+".onupdate",JSON.stringify(c)),b.onupdate_&&b.onupdate_(c),b.preE911Info_=c)}),b.remoteInvoke(!0,e.method_id_E911Service_t.onupdate,a.success)}).catch(function(){return g.logger.log(b.user_friendly_id()+".onupdate, could not set listener")})},enumerable:!1,configurable:!0}),b.prototype.getE911Info=function(){var a=this;return new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".getE911Info").then(function(){return a.remoteInvoke(!1,e.method_id_E911Service_t.getE911Info)}).then(function(c){g.logger.log(a.user_friendly_id()+".getE911Info",JSON.stringify(a.param0(c))),b(a.param0(c))}).catch(function(){g.logger.log(a.user_friendly_id()+".getE911Info promise rejected"),c()})})},b.prototype.updateE911Info=function(){var a=this;this.getE911Info().then(function(b){return a.onupdate&&a.onupdate(b)}).catch(function(){return g.logger.log("Fail to get e911 information!")})},b}(f.ProxyObject),b.E911Service=a},9:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.EngineControl=b.VersionType=void 0;var e=c(550),f=c(946),g=c(658),h=c(851);!function(a){a[a.Webrpc=0]="Webrpc",a[a.WebrtcCodecs=1]="WebrtcCodecs",a[a.Receiver=2]="Receiver",a[a.Vda=3]="Vda",a[a.Endpoint=4]="Endpoint",a[a.TypeScript=5]="TypeScript",a[a.HdxRtcEngine=6]="HdxRtcEngine",a[a.Max=7]="Max"}(b.VersionType||(b.VersionType={})),a=function(a){function b(b){var c=a.call(this,null,e.class_id_t.EngineControl,0,g.ProxyMode.Local)||this;return c.clientInfo_="",c.clientInfo_=b,c}return d(b,a),b.prototype.bind=function(){h.logger.log(this.user_friendly_id()+".bind() called."),this.reconstructor(null,e.class_id_t.EngineControl,0)},b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,e.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),a.remoteInvoke(!1,e.method_id_EngineControl_t.feature_flags,[])])}).then(function(b){h.logger.log(a.user_friendly_id()+"received webrpc version and supported feature list."),b=b.map(function(b){return a.param0(b)}),a.version_=b[0],a.features_=b[1],f.getRedirector().setFeatures(a.features_),a.remoteInvoke(!1,e.method_id_EngineControl_t.set_client_info,(a.clientInfo_||"Unknown")+"; vdiShim/"+e.HDXMS_VERSION,f.getRedirector().sessionClientId).catch(function(){return h.logger.log(a.user_friendly_id()+" could not set client info")}),b=[];for(var c=0,d=a.features_;c<d.length;c++){var g=d[c];"ms_teams_desktop_sharing"===g.name&&g.value?b.push(a.remoteInvoke(!1,e.method_id_EngineControl_t.version_info,[])):"ms_teams_osinfo"===g.name&&g.value?b.push(a.remoteInvoke(!1,e.method_id_EngineControl_t.osinfo,{family:"",version:"",architecture:"",distro:"",edition:""})):"ms_teams_endpoint_id"===g.name&&g.value?b.push(a.remoteInvoke(!1,e.method_id_EngineControl_t.endpoint_id,{machine_id:"",user_id:""})):"ms_teams_hardware_info"===g.name&&g.value&&b.push(a.remoteInvoke(!1,e.method_id_EngineControl_t.hardware_info))}if(0<b.length)return Promise.all(b)}).then(function(b){if(void 0===b)h.logger.log(a.user_friendly_id()+"release-1905 client.");else{h.logger.log(a.user_friendly_id()+"release-1906 or later client: received detailed client version list.");for(var c=0;c<b.length;c++){var d=b[c];d.hdr.proc.iid==e.class_id_t.EngineControl&&d.hdr.proc.methodid==e.method_id_EngineControl_t.version_info?a.versions_=a.param0(d):d.hdr.proc.iid==e.class_id_t.EngineControl&&d.hdr.proc.methodid==e.method_id_EngineControl_t.osinfo?a.osinfo_=a.param0(d):d.hdr.proc.iid==e.class_id_t.EngineControl&&d.hdr.proc.methodid==e.method_id_EngineControl_t.endpoint_id?a.endpointid_=a.param0(d):d.hdr.proc.iid==e.class_id_t.EngineControl&&d.hdr.proc.methodid==e.method_id_EngineControl_t.hardware_info&&(a.hardwareinfo_=a.param0(d))}}a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,"failure to retrieve version/feature related client info."),a.syncBarrierReject(b)})})},b}(g.ProxyObject),b.EngineControl=a},368:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.Frames=b.FrameTracker=void 0;var d=c(851),e=c(946),f=c(679),g=function(){return function(a,b){this.resolve=a,this.reject=b}}(),h=function(){function a(){this.name="overlay",this.reqs_=[],e.getRedirector().addProtocolHandler(this)}return a.prototype.init=function(a){},a.prototype.reset=function(){this.reqs_.forEach(function(a,b){a.reject()}),this.reqs_=[]},a.prototype.on_message=function(a){var b=this;if(d.logger.log("HDXMS: Overlay <<< "+JSON.stringify(a)),"capabilities"==a.command)new Promise(function(a,c){b.reqs_.push(new g(a,c)),e.getRedirector().WSSendObject({v:"overlay",command:"configure",caps:[]})});else{var c=this.reqs_.shift();void 0!=c?1==a.status&&("track_window"==a.command?c.resolve(a.windowId):"untrack_window"==a.command?c.resolve(a.windowHandle):"configure"==a.command?c.resolve({}):c.reject({})):d.logger.log("spurious response for message: "+a.command)}},a.prototype.registerWindowWithService=function(a){var b=this;return new Promise(function(c,f){var h=e.getRedirector();if(void 0==a){d.logger.log("FrameTrackerProtocol.registerWindowWithService: legacy case");var i=window.getWindowHandleAsHex.bind(window);void 0!==i&&null!==i||(d.logger.log("FrameTrackerProtocol.registerWindowWithService: getWindowHandle method is undefined or null"),f({})),Promise.all([i(),h.startRedirection(!1,"registerWindowWithService")]).then(function(a){d.logger.log("FrameTracker.registerWindowWithService: set window handle: "+a[0]),h.WSSendObject({v:"overlay",command:"window",windowHandle:a[0]}),c(void 0)})}else d.logger.log("FrameTrackerProtocol.registerWindowWithService: new MW case"),h.startRedirection(!1,"registerWindowWithService").then(function(){b.reqs_.push(new g(c,f)),h.WSSendObject({v:"overlay",command:"track_window",windowHandle:a})})})},a.prototype.unregisterWindowWithService=function(a){var b=this;return d.logger.log("FrameTrackerProtocol.unregisterWindowWithService(handle: "+a+")"),new Promise(function(c,d){void 0==a?d({}):(b.reqs_.push(new g(c,d)),e.getRedirector().WSSendObject({v:"overlay",command:"untrack_window",windowHandle:a}))})},a}(),i=function(){function a(a){var b=this;this.running_=!1,this.elements_=[],this.clipRects=new Set,this.videos_=[],this.connected_=!1,this.yClientAreaOffset_=this.xClientAreaOffset_=0,this.wheelEventHandler=function(a){setTimeout(function(){b.updateAll()},10)},this.scrollEventHandler=function(a){b.updateAll()},this.keyupEventHandler=function(a){"Tab"!=a.code&&"ArrowUp"!=a.code&&"ArrowDown"!=a.code&&"ArrowLeft"!=a.code&&"ArrowRight"!=a.code&&"PageUp"!=a.code&&"PageDown"!=a.code&&"Home"!=a.code&&"End"!=a.code||b.updateAll()},this.resizeEventHandler=function(a){d.logger.log("onWindowResize... update video elements position"),b.updateAll()},d.logger.log("FrameTracker.constructor: (handle: "+a+")"),this.handle_=a,this.connectToService(),this.observer_=new MutationObserver(function(a){b.updateAll()})}return a.prototype.connectToService=function(){var b=this;a.Protocol.registerWindowWithService(this.handle_).then(function(a){d.logger.log("FrameTracker: connected to service. (windowId="+a+")"),b.connected_=!0,b.windowId_=a,b.videos_.forEach(function(a){a.sinkId=JSON.stringify(b.windowId_)}),b.videos_=[]})},Object.defineProperty(a.prototype,"handle",{get:function(){return this.handle_},enumerable:!1,configurable:!0}),a.prototype.getWindowFromElement=function(a){return a.ownerDocument.defaultView},a.prototype.rectanglesIntersect=function(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y},a.prototype.intersectingRect=function(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top);return new DOMRect(c,d,Math.min(a.right,b.right)-c,Math.min(a.bottom,b.bottom)-d)},a.prototype.pedigreeCount=function(a,b){for(var c=0,d=a.parentElement;null!=d&&d!=b;)c++,d=d.parentElement;return{isAncestor:null!=d,pedigree:c}},a.prototype.selectTopmost=function(a,b){var c=this.getBoundingClientRect(a),d=this.getBoundingClientRect(b),c=this.intersectingRect(c,d),d=a.ownerDocument.elementFromPoint(c.left+c.width/2,c.top+c.height/2);if(d==a)return a;if(d==b)return b;if(c=this.pedigreeCount(a,d),d=this.pedigreeCount(b,d),c.isAncestor&&d.isAncestor){if(c.pedigree<d.pedigree)return a;if(d.pedigree<c.pedigree)return b}else{if(c.isAncestor)return a;if(d.isAncestor)return b}},a.prototype.checkOverlappingVideos=function(a){var b=this,c=this.getBoundingClientRect(a.target);a.overlaps.forEach(function(b){a.target.remoteVideoElement.removeClipRect(b.rect)}),a.overlaps=[],this.elements_.forEach(function(d){if(d!=a){var e=d.overlaps.map(function(a){return a.element}).indexOf(a.target);if(-1!=e&&(e=d.overlaps.splice(e,1)[0],d.target.remoteVideoElement.removeClipRect(e.rect)),e=b.getBoundingClientRect(d.target),b.rectanglesIntersect(c,e)){var f=b.selectTopmost(a.target,d.target);f==a.target?(d.overlaps.push({element:a.target,rect:c}),d.target.remoteVideoElement.addClipRect(c)):f==d.target&&(a.overlaps.push({element:d.target,rect:e}),a.target.remoteVideoElement.addClipRect(e))}}})},a.prototype.updateAll=function(){var a=this;this.elements_.forEach(function(b){var c=a.getBoundingClientRect(b.target);if(void 0!==c){var d=b.clientRect;void 0!==d&&d.x===c.x&&d.y===c.y&&d.width===c.width&&d.height===c.height||(b.clientRect=c,b.callback(c),a.checkOverlappingVideos(b))}})},a.prototype.track=function(a,b){var c=this,e=this.getBoundingClientRect(a);d.logger.log("Track (handle: "+this.handle_+") element frame",a,JSON.stringify(e)),console.log(a),this.elements_.push({target:a,clientRect:void 0,callback:b,overlaps:[]});try{d.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach(function(b){c.applyOcclusion(a,JSON.parse(b))})}catch(a){d.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+a)}this.running_||(d.logger.log("Start FrameTracker observer..."),this.observer_.observe(a.ownerDocument.body,{attributes:!0,childList:!0,subtree:!0}),e=this.getWindowFromElement(a),e.addEventListener("wheel",this.wheelEventHandler),e.addEventListener("scroll",this.scrollEventHandler),e.addEventListener("keyup",this.keyupEventHandler),e.addEventListener("resize",this.resizeEventHandler),this.running_=!0),this.updateAll()},a.prototype.untrack=function(a){d.logger.log("Untrack (handle: "+this.handle_+") element frame",a);var b=-1;if(this.elements_.forEach(function(c,d){c.target===a&&(b=d)}),0<=b&&(this.elements_.splice(b,1),0===this.elements_.length)){d.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect();var c=this.getWindowFromElement(a);c.removeEventListener("wheel",this.wheelEventHandler),c.removeEventListener("scroll",this.scrollEventHandler),c.removeEventListener("keyup",this.keyupEventHandler),c.removeEventListener("resize",this.resizeEventHandler),this.running_=!1}},a.prototype.applyOcclusion=function(a,b){var c=this.getBoundingClientRect(a);this.rectanglesIntersect(b,c)&&void 0!==a.remoteVideoElement&&a.remoteVideoElement.addClipRect(b)},a.prototype.addOcclusion=function(a){var b=this;d.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(a)),d.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.add(JSON.stringify(a)),this.elements_.forEach(function(c){b.applyOcclusion(c.target,a)})},a.prototype.removeOcclusion=function(a){d.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(a)),d.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.delete(JSON.stringify(a)),this.elements_.forEach(function(b){void 0!==b.target.remoteVideoElement&&b.target.remoteVideoElement.removeClipRect(a)})},a.prototype.setClientAreaOffset=function(a,b){this.xClientAreaOffset_=a,this.yClientAreaOffset_=b},a.prototype.getBoundingClientRect=function(a){return a=a.getBoundingClientRect(),a.x+=this.xClientAreaOffset_,a.y+=this.yClientAreaOffset_,a},a.prototype.newVideoElement=function(b){var c=this;if(d.logger.log("FrameTracker.newVideoElement: (id: "+b.id+")"),void 0!==b.remoteVideoElement)d.logger.log("Video element is already configured!!!");else{b.id||(b.id="ctx-vid-"+a.videoElementIDs++);var e=new f.VideoElement(b.id,this.getWindowFromElement(b));this.connected_?(d.logger.log("FrameTracker.newVideoElement: initializing video element with sink id "+this.windowId_),e.sinkId=JSON.stringify(this.windowId_)):(d.logger.log("FrameTracker.newVideoElement: video element awaiting stable window state"),this.videos_.push(e)),e.onloadedmetadata=function(){b.dispatchEvent(new Event("loadedmetadata"))},e.ontimeupdate=function(){b.dispatchEvent(new Event("timeupdate"))},e.onconnectionstatechange=function(){"connected"==e.connectionState?c.track(b,function(a){e.setFrame(a)}):c.untrack(b)},delete b.remoteVideoElement,Object.defineProperty(b,"remoteVideoElement",{writable:!0,configurable:!0,value:null}),b.remoteVideoElement=e,delete b.srcObject,Object.defineProperty(b,"srcObject",{configurable:!0,get:function(){return e.srcObject},set:function(a){d.logger.log("VDI Shim set video element srcObject "+a),e.srcObject=a}}),delete b.videoWidth,Object.defineProperty(b,"videoWidth",{configurable:!0,get:function(){return e.videoWidth}}),delete b.videoHeight,Object.defineProperty(b,"videoHeight",{configurable:!0,get:function(){return e.videoHeight}})}},a.prototype.disposeVideoElement=function(a){d.logger.log("FrameTracker.disposeVideoElement: (id: "+a.id+")");var b=a.remoteVideoElement;if(void 0!=b){var c=this.videos_.findIndex(function(a){return a.Id==b.Id});-1<c&&this.videos_.splice(c,1),b.dispose(),a.remoteVideoElement=void 0}},a.videoElementIDs=0,a.Protocol=new h,a}();b.FrameTracker=i,a=function(){function a(a){this.frames_=[],a&&this.frames_.push(new i(void 0))}return a.prototype.newFrame=function(a){d.logger.log("Frames.newFrame: (handle: "+a+")");var b=this.findFrame(a);return void 0==b&&(b=new i(a),this.frames_.push(b)),b},a.prototype.disposeFrame=function(a){d.logger.log("Frames.disposeFrame: (handle: "+a+")");var b=this.frames_.findIndex(function(b){return b.handle==a});-1<b&&(i.Protocol.unregisterWindowWithService(a).then(function(a){d.logger.log("Untrack window (handle: "+a+") successful")}),this.frames_.splice(b,1))},a.prototype.findFrame=function(a){return d.logger.log("Frames.findFrame: (handle: "+a+")"),void 0!=a?this.frames_.find(function(b){return b.handle==a}):this.frames_[0]},a.prototype.reconnect=function(){d.logger.log("Frames.reconnect()"),this.frames_.forEach(function(a){a.connectToService()})},a}(),b.Frames=a},247:function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getGC=b.GC=void 0;var c=function(){function a(a){this.parent_=this.object_=null,this.children_=[],this.object_=a}return a.prototype.addChild=function(a){a.parent_!=this&&(a.parent_=this,this.children_.push(a))},a.prototype.removeChild=function(a){var b=this.children_.indexOf(a);this.children_.splice(b,1),a.parent_=null},a}(),d=function(){function a(){this.root_=new c(null)}return a.prototype.trackObject=function(a,b){if(void 0===b&&(b=null),null===this.findNode(a,this.root_)){var d=this.findNode(b,this.root_),e=new c(a);d?d.addChild(e):this.root_.addChild(e)}},a.prototype.releaseObject=function(a){return null!==(a=this.findNode(a,this.root_))&&a!==this.root_&&(this.destroyNodeObjectRecurse(a),a.parent_.removeChild(a),!0)},a.prototype.destroyNodeObjectRecurse=function(a){for(var b=0,c=a.children_;b<c.length;b++)this.destroyNodeObjectRecurse(c[b]);a.object_.destroy()},a.prototype.setParent=function(a,b){var c=this.findNode(a,this.root_);if(null===c)return!1;var d=this.findNode(b,this.root_);return null!==d&&(c.parent_===d||(c.parent_.removeChild(c),d.addChild(c),!0))},a.prototype.reset=function(){this.root_.children_=[]},a.prototype.findNode=function(a,b){if(b.object_===a)return b;for(var c=null,d=0,e=b.children_;d<e.length&&null===(c=this.findNode(a,e[d]));d++);return c},a}();b.GC=d;var e=new d;b.getGC=function(){return e}},946:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.getRedirector=b.HdxMediaStream=b.RedirectionStatus=b.WebrpcStatusCode=void 0;var d,e=c(658),f=c(851),g=c(550),h=c(545),i=c(394),j=c(691),k=function(){return function(a,b,c,d,e,f,g,h){void 0===h&&(h=void 0),this.resolve=a,this.reject=b,this.iid=c,this.oid=d,this.cbid=e,this.oneShot=f,this.mid=g,this.completion_cb=h}}();!function(a){a[a.rpc_status_success=0]="rpc_status_success",a[a.rpc_status_unspecified_error=1]="rpc_status_unspecified_error",a[a.rpc_status_unexpected=2]="rpc_status_unexpected",a[a.rpc_status_index_out_of_bounds=3]="rpc_status_index_out_of_bounds",a[a.rpc_status_missing_parameter=4]="rpc_status_missing_parameter",a[a.rpc_status_missing_return_value=5]="rpc_status_missing_return_value",a[a.rpc_status_invalid_object=6]="rpc_status_invalid_object",a[a.rpc_status_user_exception=7]="rpc_status_user_exception",a[a.rpc_status_system_error=8]="rpc_status_system_error"}(d=b.WebrpcStatusCode||(b.WebrpcStatusCode={}));var l;!function(a){a[a.NotRedirected=0]="NotRedirected",a[a.Connecting=1]="Connecting",a[a.Binding=2]="Binding",a[a.Redirected=3]="Redirected"}(l=b.RedirectionStatus||(b.RedirectionStatus={})),a=function(){function a(){this.sessionId_="",this.handlers_=[],this.pingactive=!1,this.status=l.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=[],this.telemetry_=new i.Telemetry,this.screenshare_=new j.ScreenShareUtil,this.stateChangeNotifcations=[],this.vdafeatures_=[]}return Object.defineProperty(a.prototype,"telemetry",{get:function(){return this.telemetry_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"screenshare",{get:function(){return this.screenshare_},enumerable:!1,configurable:!0}),a.prototype.setRemoteSessionInfoCb=function(a){this.remoteSessionInfoCb=a},a.prototype.setFeatures=function(a){this.features=a,this.screenshare.onInitComplete(),this.handlers_.forEach(function(b,c){b.init(a)})},a.prototype.getFeatureValue=function(a){if(this.features){var b=this.features.find(function(b){return b.name===a});return void 0!==b&&b.value}return!1},a.prototype.getVDAFeatureValue=function(a){return void 0!==this.vdafeatures_.find(function(b){return b===a})},a.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==l.Redirected)},a.prototype.connectToService=function(){return f.logger.log("Redirection status: Connecting..."),this.status=l.Connecting,new Promise(function(a,b){var c=new WebSocket("wss://127.0.0.1:9002");c.onopen=function(){a(c)},c.onerror=function(a){f.logger.log("websocket connection error: "+a.type),b(a)}})},a.prototype.waitUntilRedirected=function(a){var b=this;return new Promise(function(c,d){b.status==l.Redirected?c():0>=a?d():setTimeout(function(){f.logger.log("waitUntilRedirected() timeout. count="+a),b.status!=l.Redirected?b.waitUntilRedirected(--a).then(function(){c()}).catch(function(){d()}):c()},2e3)})},a.prototype.handleRemoteSessionInfo=function(){var a=this;f.logger.log("handleRemoteSessionInfo called.");var b=this;b.remoteSessionInfoCb?b.remoteSessionInfoCb().then(function(c){f.logger.log("remoteSessionInfo success! info:"+JSON.stringify(c)),f.logger.log("Redirection status: Redirected"),b.status=l.Redirected,b.pingConnectionEnd(),(c=window.onVdiClientConnected)&&c(),a.telemetry.SendTelemetryInit(),b.onRedirectionComplete()}).catch(function(){f.logger.log("remoteSessionInfo failure!"),b.suspendRedirection(!0),b.onRedirectionComplete()}):(f.logger.log("remoteSessionInfoCb is invalid!"),b.suspendRedirection(!0),b.onRedirectionComplete())},a.prototype.startRedirection=function(a,b){var c=this,d=window.onVdiClientDisconnected;return new Promise(function(g,h){c.status!=l.Redirected?(f.logger.log("Attempting to start redirection: "+b),!1===a?c.deferredActions.push(new e.deferred_action(g,h,b)):c.connectToService().then(function(a){f.logger.log("Redirection status: Binding..."),c.status=l.Binding,c.websocket=a,c.websocket.onmessage=function(a){c.onWSMessage(a)},c.websocket.onclose=function(a){c.onWSClose(a)},g(),c.handleRemoteSessionInfo()}).catch(function(a){f.logger.log("Unable to connect to websocket service! "+a),h(),c.suspendRedirection(!0),c.onRedirectionComplete(),d&&d(!0)})):(f.logger.log("Redirection already started."),g())})},a.prototype.terminateOptimization=function(){this.websocket.close(1e3,"normal disconnecting!")},a.prototype.suspendRedirection=function(a){var b=this;f.logger.log("Suspending redirection."),this.handlers_.forEach(function(a,b){a.reset()});var c=window.onVdiClientDisconnected;try{c&&c(!1)}catch(a){f.logger.log("suspendRedirection(): exception during vdiClientDisconnect: "+a.message)}f.logger.log("Redirection status: NotRedirected");var d=this.status;this.status=l.NotRedirected;var e,g=!1,c=window.getCitrixMSTeamsRedir,h=window.getCitrixWebrtcRedir;c?e=c:h&&(e=h),e&&e().then(function(c){f.logger.log("sucesss on disconnect"+c),"1"==c&&(g=!0,f.logger.log("Reg key exists while disconnecting")),a&&d===l.Redirected&&1==g&&(f.logger.log("Calling ping not normal disconnect"),b.pingConnectionBegin(!1))}).catch(function(){f.logger.log("Failure to Read MS Teams redir Reg Key, not retrying...")}),this.dispatchStateChangeNotifications()},a.prototype.onWSOpen=function(){},a.prototype.onWSClose=function(a){f.logger.log("disconnected from websocket service. "+JSON.stringify(a));try{a&&1e3==a.code?this.suspendRedirection(!1):this.suspendRedirection(!0)}catch(a){f.logger.log("suspendRedirection(): exception closing WebSocket: "+a.message)}},a.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(a){f.logger.log("suspendRedirection(): exception on WebSocket error: "+a.message)}},a.prototype.WSSendObjectWrapper=function(a,b,c,d){var e=!0;b!=g.class_id_t.EngineControl||c!=g.method_id_EngineControl_t.ctor&&c!=g.method_id_EngineControl_t.version&&c!=g.method_id_EngineControl_t.feature_flags||(e=!1);var f=!0;if(e&&(f=!1,void 0!=this.features))for(var e=0,h=this.features;e<h.length;e++){var i=h[e];if(!0===i.value&&i.name==a){f=!0;break}}return 1==f?this.WSSendObject(d):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+b+") mid("+c+")")},a.prototype.WSSendObject=function(a){var b=this;return new Promise(function(c,d){if("webrtc"==a.v){var e=a.hdr.proc.iid,h=a.hdr.proc.methodid,i=a.objref.oid;a.hdr.destroy||(e=new k(c,d,e,i,0,!0,h),b.reqs.push(e)),e=JSON.stringify(a),f.logger.trace("WSSendObject: >>> "+g.WebrpcClassLibInfoUtil.composeClassInfoData(a)+" "+e);try{b.websocket.readyState==WebSocket.OPEN?b.websocket.send(e):(f.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),c({}))}catch(a){f.logger.log("WSSendObject(): exception: "+a.message),d(a.message)}}else if("overlay"==a.v){e=JSON.stringify(a),f.logger.log("HDXMS: SendOverlayData: >>> "+e+"'");try{b.websocket.readyState==WebSocket.OPEN?b.websocket.send(e):(f.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),c({}))}catch(a){f.logger.log("WSSendObject(): exception: "+a.message),d(a.message)}}else if("telemetry"==a.v){e=JSON.stringify(a),f.logger.log("HDXMS: SendTelemetryData: >>> "+e+"'");try{b.websocket.readyState==WebSocket.OPEN?b.websocket.send(e):(f.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),c({}))}catch(a){f.logger.log("WSSendObject(): exception: "+a.message),d(a.message)}}else if("appsharing"==a.v){e=JSON.stringify(a),f.logger.log("HDXMS: SendScreenSharingData: >>> "+e+"'");try{b.websocket.readyState==WebSocket.OPEN?b.websocket.send(e):(f.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),c({}))}catch(a){f.logger.log("WSSendObject(): exception: "+a.message),d(a.message)}}else f.logger.log("HDXMS: WSSendObject: Unknown protocol: '"+JSON.stringify(a)+"'")})},a.prototype.webrpcStatusCodeToName=function(a){switch(a){case d.rpc_status_success:a="rpc_status_success";break;case d.rpc_status_unspecified_error:a="rpc_status_unspecified_error";break;case d.rpc_status_unexpected:a="rpc_status_unexpected";break;case d.rpc_status_index_out_of_bounds:a="rpc_status_index_out_of_bounds";break;case d.rpc_status_missing_parameter:a="rpc_status_missing_parameter";break;case d.rpc_status_missing_return_value:a="rpc_status_missing_return_value";break;case d.rpc_status_invalid_object:a="rpc_status_invalid_object";break;case d.rpc_status_user_exception:a="rpc_status_user_exception";break;case d.rpc_status_system_error:a="rpc_status_system_error";break;default:a="unknown"}return a},a.prototype.parceWebrpcError=function(a,b){void 0===a&&(a=b&&0<b.length?b[0].category||b[0].code||b[0].message?d.rpc_status_system_error:d.rpc_status_user_exception:d.rpc_status_unspecified_error);var c;switch(a){case d.rpc_status_unspecified_error:case d.rpc_status_unexpected:case d.rpc_status_index_out_of_bounds:case d.rpc_status_missing_parameter:case d.rpc_status_missing_return_value:case d.rpc_status_invalid_object:c=new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a));break;case d.rpc_status_user_exception:c=b&&0<b.length?new DOMException(b[0],this.webrpcStatusCodeToName(a)):new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a));break;case d.rpc_status_system_error:if(b&&0<b.length){c=Object.create(DOMException);var e={value:null,writable:!0,enumerable:!1,Configurable:!0}
;e.value=b[0].category,Object.defineProperty(c,"name",e),e.value=b[0].code,Object.defineProperty(c,"code",e),e.value=b[0].message,Object.defineProperty(c,"message",e)}else c=new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a))}return c},a.prototype.onWSMessage=function(a){a=a.data;var b;try{b=JSON.parse(a)}catch(b){return f.logger.log("invalid JSON!!!"),f.logger.log(b),void f.logger.log(a)}if("webrtc"==b.v){f.logger.trace("onWSMessage: <<< "+g.WebrpcClassLibInfoUtil.composeClassInfoData(b)+" "+a);var c=b.hdr.proc.iid,d=b.hdr.proc.methodid,e=b.objref.oid,i=b.status;if(b.hdr.msg_type==h.WsJsonUtil.getMsgType(h.ws_msg_type_t.reply))a=this.reqs.findIndex(function(a){return a.iid==c&&a.oid==e&&a.mid==d}),0<=a?0==i?this.reqs.splice(a,1).shift().resolve(b):(i=this.parceWebrpcError(i,b.params),this.reqs.splice(a,1).shift().reject(i)):(f.logger.log("HDXMS didnt find this one. (reqs)"),f.logger.log(this.reqs));else if(b.hdr.msg_type==h.WsJsonUtil.getMsgType(h.ws_msg_type_t.event_req)){var k=b.func.id;a=this.cbs.findIndex(function(a){return a.iid==c&&a.oid==e&&a.cbid==k>>16}),0<=a?(0==(65535&k)?this.cbs[a].resolve(b):(i=this.parceWebrpcError(i,b.params),this.cbs[a].reject(i)),1==this.cbs[a].oneShot&&(this.cbs[a].completion_cb?this.cbs[a].completion_cb(this.cbs[a].cbid,this.cbs[a].mid):f.logger.log("HDXMS didnt find completion_cb for oneShot callback, something went wrong!!!! cbid="+this.cbs[a].cbid+" (iid, mid)=("+this.cbs[a].iid,","+this.cbs[a].mid+")"))):(f.logger.log("HDXMS didnt find this one. (cbs)"),f.logger.log(JSON.stringify(this.cbs)))}else f.logger.log("HDXMS Received bogus message: "+a+"'")}else if("telemetry"==b.v)0==b.status&&2==(2147483647&(i=b.hdr.command))&&(a=b.hdr.id,this.telemetry.onInitialized(a),f.logger.log("Telemetry init response received"));else if("features"==b.v){if(a=b.features,"feature-support"==b.command)for(f.logger.log("features capabilities received, features:"+a),this.vdafeatures_=a,i=0;i<a.length;i++)a[i]===g.FEATURE_vda_app_sharing&&this.screenshare.onInitialized(!0);this.clientViewportMode_=b.client_viewport_mode,f.logger.log("features client_viewport_mode value: "+this.clientViewportMode_),this.sessionId_=b.client_session_id}else"appsharing"==b.v?(a=b.status,0==a?(i=b.hdr.command,a=b.hdr.id,(2147483647&i)==j.sshare_cmd.GetSources?(f.logger.log("appsharing GetSources response received"),i=b.data,this.screenshare.onGetSources(a,i)):(2147483647&i)==j.sshare_cmd.SetActive?(f.logger.log("appsharing SetActive response received"),i=b.data,this.screenshare.onSetActive(a,i)):(2147483647&i)==j.sshare_cmd.TopologyChanged?(f.logger.log("appsharing Window topology changed cmd received"),this.screenshare.onToplogyChanged()):(f.logger.log("invalid command reply:"+i),this.screenshare.onError(a))):(f.logger.log("invalid status reply:"+a),a=b.hdr.id,this.screenshare.onError(a))):void 0!=(i=this.handlers_.find(function(a){return a.name==b.v}))?i.on_message(b):f.logger.log("HDXMS: onWSMessage: Unknown protocol: "+a+"'")},a.prototype.clearReqs=function(){f.logger.log("clearReqs()"),this.reqs.forEach(function(a,b){a.reject()}),this.reqs=[]},a.prototype.registerHandler=function(a,b,c,d){a=new k(d.resolve.bind(d),d.reject.bind(d),a,b,d.id,d.oneShot,c,d.completion_cb),this.cbs.push(a)},a.prototype.unregisterHandler=function(a,b,c){var d=this.cbs.findIndex(function(d){return d.iid==a&&d.oid==b&&d.cbid==c});0<=d?this.cbs.splice(d,1):(f.logger.log("HDXMS Didnt find this callback in the list!"),f.logger.log(JSON.stringify(this.cbs)))},a.prototype.isRedirected=function(){return this.status===l.Redirected||this.status===l.Binding||this.status===l.Connecting},a.prototype.isConnected=function(){return this.status==l.Redirected},a.prototype.isPingActive=function(){return this.pingactive},a.prototype.pingConnectionBegin=function(a){f.logger.log("Started timer"),this.pingactive=!0;var b=window.onVdiClientDisconnectedTimer;1==a?(f.logger.log("checking if we are connected..."),b()):this.conntimer=setTimeout(function(){f.logger.log("checking if we are connected..."),b&&b()},15e3)},a.prototype.pingConnectionEnd=function(){this.pingactive=!1,clearTimeout(this.conntimer)},a.prototype.SendTelemetryData_Speaker=function(a){this.telemetry.SendTelemetryData(i.tel_cmd.Data,i.tel_key_SpeakerDeviceUsed,a,0)},a.prototype.registerStateChangeNotification=function(a){this.stateChangeNotifcations.push(a)},a.prototype.unregisterStateChangeNotification=function(a){this.stateChangeNotifcations=this.stateChangeNotifcations.filter(function(b){return b!=a})},a.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach(function(a){a()})},a.prototype.vdabufferNoLimit=function(){for(var a=!1,b=0,c=this.vdafeatures_;b<c.length;b++)if(c[b]===g.FEATURE_vda_service_no_buffer_limit){a=!0;break}return a},Object.defineProperty(a.prototype,"clientViewportMode",{get:function(){return this.clientViewportMode_||"unknown"},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"sessionClientId",{get:function(){return this.sessionId_||""},enumerable:!1,configurable:!0}),a.prototype.addProtocolHandler=function(a){void 0==this.handlers_.find(function(b){return b.name==a.name})&&this.handlers_.push(a)},a}(),b.HdxMediaStream=a;var m=new a;b.getRedirector=function(){return m}},985:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a};Object.defineProperty(b,"__esModule",{value:!0}),b.IceCandidatePair=b.IceCandidate=void 0;var f=c(658),g=c(550),h=c(851);a=function(a){function b(b,c,d){for(var f=[],h=3;h<arguments.length;h++)f[h-3]=arguments[h];return a.apply(this,e([b,g.class_id_t.RTCIceCandidate,c,d,null,[]],f))||this}return d(b,a),Object.defineProperty(b.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!1,configurable:!0}),b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_RTCIceCandidate_t.candidate,""),a.remoteInvoke(!1,g.method_id_RTCIceCandidate_t.sdpMid,""),a.remoteInvoke(!1,g.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(b){b=b.map(function(b){return a.param0(b)}),a.candidate_=b[0],a.sdpMid_=b[1],a.sdpMLineIndex_=b[2],a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!"),a.syncBarrierReject(b)})})},b}(f.ProxyObject),b.IceCandidate=a,a=function(a){function b(b,c){return a.call(this,b,g.class_id_t.RTCIceCandidatePair,c,f.ProxyMode.Remote)||this}return d(b,a),Object.defineProperty(b.prototype,"local",{get:function(){return this.local_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"remote",{get:function(){return this.remote_},enumerable:!1,configurable:!0}),b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("IceCandidatePair.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_RTCIceCandidatePair_t.local,{}),a.remoteInvoke(!1,g.method_id_RTCIceCandidatePair_t.remote,{})])}).then(function(b){b=b.map(function(b){return a.param0(b)}),a.local_=b[0],a.remote_=b[1],a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!"),a.syncBarrierReject(b)})})},b}(f.ProxyObject),b.IceCandidatePair=a},851:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.logger=b.Logger=void 0;var d=c(550);a=function(){function a(a){this.tracing=!1,this.mslogger_=void 0,this.enable_timestamp_=!1,this.tag=a,this.enabled=!0,d.BUILD_TYPE_SDK&&(this.enable_timestamp_=!0)}return a.prototype.setMSLogger=function(a,b){this.mslogger_=a,void 0!=b&&(this.enable_timestamp_=b)},a.prototype.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.enabled&&(a=this.tag+" "+a,this.enable_timestamp_&&(b=new Date,a="["+b.getTime()+"] "+b.toISOString()+" "+a),void 0!=this.mslogger_?this.mslogger_.info(a):console.log(a))},a.prototype.logx=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a||this.log(b)},a.prototype.trace=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.tracing&&this.log.apply(this,a)},a}(),b.Logger=a,b.logger=new a("[HdxWebRTC.js]"),b.logger.enabled=!0},360:function(a,b,c){var e=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},g=this&&this.__generator||function(a,b){function c(a){return function(b){return e([a,b])}}function e(c){if(f)throw new TypeError("Generator is already executing.");for(;j;)try{if(f=1,g&&(h=2&c[0]?g.return:c[0]?g.throw||((h=g.return)&&h.call(g),0):g.next)&&!(h=h.call(g,c[1])).done)return h;switch(g=0,h&&(c=[2&c[0],h.value]),c[0]){case 0:case 1:h=c;break;case 4:return j.label++,{value:c[1],done:!1};case 5:j.label++,g=c[1],c=[0];continue;case 7:c=j.ops.pop(),j.trys.pop();continue;default:if(h=j.trys,!(h=0<h.length&&h[h.length-1])&&(6===c[0]||2===c[0])){j=0;continue}if(3===c[0]&&(!h||c[1]>h[0]&&c[1]<h[3]))j.label=c[1];else if(6===c[0]&&j.label<h[1])j.label=h[1],h=c;else{if(!(h&&j.label<h[2])){h[2]&&j.ops.pop(),j.trys.pop();continue}j.label=h[2],j.ops.push(c)}}c=b.call(a,j)}catch(a){c=[6,a],g=0}finally{f=h=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var f,g,h,i,j={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return d.initSymbol(),d.initSymbol(),d.initSymbolIterator(),i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},h=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a};Object.defineProperty(b,"__esModule",{value:!0}),b.PeerConnection=b.SessionDescription=b.SessionDescriptionInit=b.RtcConfiguration=b.RtcIceServer=b.IceCandidateEvent=void 0;var i=c(946),j=c(144),k=c(589),l=c(658),m=c(985),n=c(377),o=c(650),p=c(24),q=c(550),r=c(851),s=c(517),t=c(394),u=function(a){function b(b,c,d){return b=a.call(this,b,q.class_id_t.RTCIceCandidateEvent,c,l.ProxyMode.Remote)||this,b.target=d,b.type="icecandidate",b}return e(b,a),Object.defineProperty(b.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!1,configurable:!0}),b.prototype.syncBarrier=function(){var a=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){return a.remoteInvoke(!1,q.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(b){return b=a.param0(b),!1===b.is_null?new m.IceCandidate(a,b.oid,l.ProxyMode.Remote).syncBarrier():Promise.resolve(null)}).then(function(b){r.logger.log(a.user_friendly_id()+".onicecandidate: icecandidate available!"),a.candidate_=b,a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".onicecandidate() failed!"),a.syncBarrierReject(b)})})},b}(l.ProxyObject);b.IceCandidateEvent=u;var v=function(){function a(a,b){this.state_="new",this.candidates_=[],this.gatheringstateupdatecb_=void 0,this.pc_=a,this.gatheringstateupdatecb_=b}return a.prototype.pushState=function(a){r.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+a),this.state_=a,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},a.prototype.addIceCandidate=function(a){var b=this;this.candidates_.push(a);var c=[];c.push(a.syncBarrier()),c.push(this.pc_.updateSdpDescription(!0)),Promise.all(c).then(function(a){r.logger.log(b.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),b.postIceCandidate(a[0])})},a.prototype.postIceCandidate=function(a){r.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(a):r.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},a.prototype.postUpdate=function(){r.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var a=new A("onicegatheringstatechange",this.pc_);this.gatheringstateupdatecb_&&this.gatheringstateupdatecb_(this.state_),this.pc_.onicegatheringstatechange(a)},a.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):r.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(a){return a.object_id()})+"], state="+this.state_)},a}(),w=function(){function a(){}return a.toRtcIceServer=function(a,b){var c={urls:[],credential:"",username:""};if(a&&(a.urls?Array.isArray(a.urls)?c.urls=a.urls:c.urls.push(a.urls):r.logger.log("RtcIceServer.toRtcIceServer().urls property is missing! this is required property!"),a.credential&&(a.credential.hasOwnProperty("accessToken")?c.credential=a.credential.accessToken:c.credential=a.credential),a.username&&(c.username=a.username)),1==b)for(var d in a)"urls"!=d&&"credential"!=d&&"username"!=d&&r.logger.log("RtcIceServer.toRtcIceServer() warning: unsupported property:"+d);return c},a}();b.RtcIceServer=w;var x=function(){function a(){}return a.toRtcConfiguration=function(a,b){1==b&&r.logger.log("RtcConfiguration.toRtcConfiguration() in RTCConfiguration config:"+JSON.stringify(a));var c={};if(a){if(a.iceServers){c.iceServers=[];for(var d=0,e=a.iceServers;d<e.length;d++)c.iceServers.push(w.toRtcIceServer(e[d],b))}a.iceTransportPolicy&&(c.iceTransportPolicy=a.iceTransportPolicy),a.bundlePolicy&&(c.bundlePolicy=a.bundlePolicy),a.rtcpMuxPolicy&&(c.rtcpMuxPolicy=a.rtcpMuxPolicy),a.iceTransports&&(c.iceTransports=a.iceTransports),a.sdpSemantics&&(c.sdpSemantics=a.sdpSemantics),a.enableDtlsSrtp&&(c.enableDtlsSrtp=a.enableDtlsSrtp),a.enableDscp&&(c.enableDscp=a.enableDscp)}if(1==b){for(var f in a)"iceServers"!=f&&"iceTransportPolicy"!=f&&"bundlePolicy"!=f&&"rtcpMuxPolicy"!=f&&"iceTransports"!=f&&"sdpSemantics"!=f&&"enableDtlsSrtp"!=f&&"enableDscp"!=f&&r.logger.log("RtcConfiguration.toRtcConfiguration() warning: unsupported property:"+f);r.logger.log("RtcConfiguration.toRtcConfiguration() converted RtcConfiguration config:"+JSON.stringify(c))}return c},a}();b.RtcConfiguration=x;var y=function(){return function(a,b){this.sdp=b,this.type=a}}();b.SessionDescriptionInit=y;var z=function(a){function b(b,c,d){for(var e=[],f=3;f<arguments.length;f++)e[f-3]=arguments[f];return a.apply(this,h([b,q.class_id_t.RTCSessionDescription,c,d,null,[]],e))||this}return e(b,a),b.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(b.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"type",{get:function(){return this.type_},enumerable:!1,configurable:!0}),b.prototype.syncBarrier=function(){var a=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,q.method_id_RTCSessionDescription_t.type,0),a.remoteInvoke(!1,q.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(b){a.type_=a.convertType(a.param0(b[0])),a.sdp_=a.param0(b[1]),a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},b.prototype.convertType=function(a){return 0==a?"offer":1==a?"pranswer":2==a?"answer":"rollback"},b.convertC2H=function(a){return"offer"==a?0:"pranswer"==a?1:"answer"==a?2:3},b}(l.ProxyObject);b.SessionDescription=z;var A=function(){return function(a,b){this.type=a,this.target=b}}(),B=function(){return function(){}}(),C=function(){function a(a,b){this.local=a,this.remote=b}return Object.defineProperty(a.prototype,"active",{get:function(){var a=!1;return 1!=this.local&&1!=this.remote||(a=!0),a},enumerable:!1,configurable:!0}),a}();a=function(a){function b(c){var d=a.call(this,null,q.class_id_t.RTCPeerConnection,0,l.ProxyMode.Local,null,[],b.ensure_config_defined(c,!1),{})||this;if(d.timeerstarted_=!1,d.firsttimeremoteoffer_=!1,d.firststable_=!1,d.firsttimelocaloffer_=!1,d.audiocall_=new C(!1,!1),d.videocall_=new C(!1,!1),d.screensharingcall_=new C(!1,!1),d.conferencecall_=!1,d.incomingcall_=!1,d.outgoingcall_=!1,d.usingasynconly_=!1,d.rtcconfig_=b.ensure_config_defined(c,!0),r.logger.log(d.user_friendly_id()+".constructor sdpSemantics="+d.rtcconfig_.sdpSemantics),!q.BUILD_TYPE_SDK&&d.isUnified()&&!i.getRedirector().getFeatureValue(q.FEATURE_ms_teams_webrtc_1dot0))throw new DOMException("CWA client does not support unified sdpSemantic","createPeerConnection");return d.pendingtransceiver_=0,d.pendingtrack_=0,d.deferredOfferAnswers=[],d.localStreams=[],d.remoteStreams=[],d.onaddstream_=null,d.signalingState_="stable",d.iceConnectionState_="new",d.iceGatheringState_="new",d.iceQ_=new v(d,function(a){d.onicegatheringstateupdate(a)}),d.receivers_=[],d.senders_=[],d.transceivers_=[],d.registerStateChangeNotification(d.onStateChange),d.localdatachannel_=null,d.remotedatachannel_=null,d}return e(b,a),b.ensure_config_defined=function(a,b){return x.toRtcConfiguration(a,b)},b.prototype.dumpSdp=function(a){r.logger.log(this.user_friendly_id()+".dumpSdp"),a&&(r.logger.log(this.user_friendly_id()+"  -- type: "+a.type),r.logger.log(this.user_friendly_id()+"  -- sdp: "+a.sdp))},Object.defineProperty(b.prototype,"localDescription",{get:function(){return r.logger.log(this.user_friendly_id()+".get_localDescription() called."),this.localDescription_},set:function(a){r.logger.log(this.user_friendly_id()+".set_localDescription() called."),this.localDescription_=a},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"remoteDescription",{get:function(){return r.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_},set:function(a){r.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_=a},enumerable:!1,configurable:!0}),b.prototype.isUnified=function(){return"unified"==this.rtcconfig_.sdpSemantics||"unified-plan"==this.rtcconfig_.sdpSemantics},b.prototype.onStateChange=function(){var a=new A("iceconnectionstatechange",this);this.oniceconnectionstatechange_&&this.oniceconnectionstatechange_(a)},b.prototype.addIceCandidate=function(a){var b=this;r.logger.log(this.user_friendly_id()+".addIceCandidate() called."),this.waitUntilConnected(this.user_friendly_id()+".addIceCandidate").then(function(){var c={candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex};return void 0!=c.candidate&&null!=c.candidate||(c.candidate=""),void 0==c.sdpMid&&(c.sdpMid=null),void 0==c.sdpMLineIndex&&(c.sdpMLineIndex=null),new m.IceCandidate(b,0,l.ProxyMode.Local,c).syncBarrier()}).then(function(a){return b.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.addIceCandidate,[a],{})}).then(function(){return r.logger.log(b.user_friendly_id()+".addIceCandidate() success."),b.updateSdpDescription(!1)}).then(function(){r.logger.log(b.user_friendly_id()+".addIceCandidate() - sync remote sdp success.")}).catch(function(a){b.logRemoteInvokeError(a,".addIceCandidate() failed!")})},Object.defineProperty(b.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=a,this.waitUntilConnected(this.user_friendly_id()+".onicecandidate").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onicecandidate);return c.then(function(a){r.logger.log(b.user_friendly_id()+".onicecandidate callback received!!!"),a=new u(b,b.param0(a).oid,b),null!=b.iceQ_&&b.iceQ_.addIceCandidate(a)}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onicecandidate,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onicecandidate() failed!")})},enumerable:!1,configurable:!0}),b.prototype.convertIceConnectionState=function(a){return 0==a?"new":1==a?"checking":2==a?"connected":3==a?"completed":4==a?"failed":5==a?"disconnected":"closed"},b.prototype.convertConnectionState=function(a){if(0!=a){if(1==a)return"connecting";if(2==a)return"connected";if(3==a)return"disconnected";if(4==a)return"failed";if(5==a)return"closed"}return"new"},Object.defineProperty(b.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=a,this.waitUntilConnected(this.user_friendly_id()+".onconnectionstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onconnectionstatechange);return c.then(function(a){r.logger.log(b.user_friendly_id()+".onconnectionstatechange(): success callback received!!!"),b.connectionState_=b.convertConnectionState(b.param0(a)),r.logger.log(b.user_friendly_id()+" connectionState=:"+b.connectionState_),a=new A("connectionstatechange",b),b.onconnectionstatechange_&&b.onconnectionstatechange_(a)}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onconnectionstatechange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onconnectionstatechange() failed!")})},enumerable:!1,configurable:!0}),b.prototype.get_connectionState=function(){return r.logger.log(this.user_friendly_id()+".get_connectionState() called, value = "+this.connectionState_),this.isRedirected()?this.connectionState_:"failed"},Object.defineProperty(b.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=a,this.waitUntilConnected(this.user_friendly_id()+".oniceconnectionstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return c.then(function(a){r.logger.log(b.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),b.iceConnectionState_=b.convertIceConnectionState(b.param0(a)),a=new A("iceconnectionstatechange",b),b.oniceconnectionstatechange_&&b.oniceconnectionstatechange_(a)}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.oniceconnectionstatechange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_oniceconnectionstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"iceConnectionState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!1,configurable:!0}),b.prototype.convertIceGatheringState=function(a){return 0==a?"new":1==a?"gathering":"complete"},b.prototype.onicegatheringstateupdate=function(a){r.logger.log(this.user_friendly_id()+".onicegatheringstateupdate() current:"+this.iceGatheringState_+" updating to:"+a),this.iceGatheringState_=a,r.logger.log(this.user_friendly_id()+".onicegatheringstateupdate() after update: iceGatheringState_:"+this.iceGatheringState_)},Object.defineProperty(b.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=a,this.waitUntilConnected(this.user_friendly_id()+".onicegatheringstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onicegatheringstatechange);return c.then(function(a){r.logger.log(b.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),a=b.convertIceGatheringState(b.param0(a)),null!=b.iceQ_&&b.iceQ_.pushState(a)}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onicegatheringstatechange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onicegatheringstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"iceGatheringState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!1,configurable:!0}),b.prototype.convertSignalState=function(a){return 0==a?"stable":1==a?"have-local-offer":2==a?"have-local-pranswer":3==a?"have-remote-offer":4==a?"have-remote-pranswer":"closed"},b.prototype.TelemtryReadings_=function(){var a=this;if("have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),0==this.outgoingcall_&&(this.SendTelemetryData(t.tel_key_PerfCallState,t.tel_CallState.active,1),this.SendTelemetryData(t.tel_key_PerfCallDirection,t.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0),"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(t.tel_key_PerfCallState,t.tel_CallState.active,1),this.SendTelemetryData(t.tel_key_PerfCallDirection,t.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0),"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.firststable_=this.timeerstarted_=!0),"stable"==this.signalingState_){for(var b=0,c=this.localStreams;b<c.length;b++){var d=c[b];if(1<=d.getAudioTracks().length&&0==this.audiocall_.local&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.audio,1),this.audiocall_.local=!0),d=d.getVideoTracks(),1<=d.length)for(var e=0,f=d;e<f.length;e++)d=f[e],1==d.getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.video,1),this.videocall_.local=!0)}for(b=0,c=this.remoteStreams;b<c.length;b++)if(d=c[b],1<=d.getAudioTracks().length&&0==this.audiocall_.remote&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.audio,1),this.audiocall_.remote=!0),e=d.getVideoTracks(),1<=e.length)for(d=0;d<e.length;d++)1==e[d].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.video,1),this.videocall_.remote=!0);this.getReceiversAsync().then(function(b){2<b.length&&0==a.conferencecall_&&(a.SendTelemetryData(t.tel_key_PerfCallType,t.tel_CallType.multi,1),a.conferencecall_=!0)})}},Object.defineProperty(b.prototype,"onsignalingstatechange",{set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=a,this.waitUntilConnected(this.user_friendly_id()+".onsignalingstatechanged").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onsignalingstatechange);return c.then(function(a){r.logger.log(b.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),b.signalingState_=b.convertSignalState(b.param0(a)),a=new A("onsignalingstatechange",b),b.onsignalingstatechange_&&b.onsignalingstatechange_(a),b.TelemtryReadings_()}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onsignalingstatechange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onsignalingstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"ontrack",{get:function(){return this.ontrack_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_ontrack() called."),this.ontrack_=a,this.waitUntilConnected(this.user_friendly_id()+".ontrack").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.ontrack);return c.then(function(a){return f(b,void 0,void 0,function(){var b,c,d,e,f,h,i,m,p,q,s,t=this;return g(this,function(g){if(r.logger.log(this.user_friendly_id()+".ontrack(): callback received!!!"),b=new B,c=[],d=this.param0(a),void 0!=d.track&&!1===d.track.is_null&&(r.logger.log(this.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+d.track.oid),e=new j.RemoteMediaTrack(this,d.track.oid),c.push(e.syncBarrier())),b.track=e,void 0!=d.receiver&&!1===d.receiver.is_null&&(f=this.receivers_.find(function(a){return a.object_id()===d.receiver.oid}),void 0===f&&(r.logger.log(this.user_friendly_id()+" adding a RtpReceiver with oid:"+d.receiver.oid),f=new k.RtpReceiver(this,d.receiver.oid,l.ProxyMode.Remote,this.isUnified(),e)),c.push(f.syncBarrier())),b.receiver=f,o.RemoteSession.isFeatureWebrtc1dot0Supported()&&void 0!=d.transceiver&&!1===d.transceiver.is_null&&(h=this.transceivers_.find(function(a){return a.object_id()===d.transceiver.oid}),void 0===h&&(r.logger.log(this.user_friendly_id()+" adding a RtpTransceiver with oid:"+d.transceiver.oid),h=new n.RtpTransceiver(this,d.transceiver.oid,l.ProxyMode.Remote,this.isUnified(),n.RtcRtpTransceiverDirection.inactive,f),this.transceivers_.push(h)),c.push(h.syncBarrier())),b.transceiver=h,b.streams=[],void 0!=d.streams)for(i=function(a){var d=m.remoteStreams.find(function(b){return!1===a.is_null&&b.object_id()===a.oid});void 0===d&&(r.logger.log(m.user_friendly_id()+" adding a RemoteStream with oid:"+a.oid),d=new j.RemoteStream(m,a.oid,l.ProxyMode.Remote),m.remoteStreams.push(d)),c.push(d.syncBarrier()),b.streams.push(d)},m=this,p=0,q=d.streams;p<q.length;p++)s=q[p],i(s);return r.logger.log(this.user_friendly_id()+".ontrack(): .prop.syncBarrier start"),Promise.all(c).then(function(){r.logger.log(t.user_friendly_id()+".ontrack(): notified!!! with evt: "+b);for(var a=0,c=b.streams;a<c.length;a++)c[a].toggleAudio(!1);t.ontrack_&&t.ontrack_(b)}).catch(function(a){t.logRemoteInvokeError(a,".ontrack(): .prop.syncBarrier failed.")}),[2]})})}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.ontrack,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_ontrack(): failed.")})},enumerable:!1,configurable:!0}),
Object.defineProperty(b.prototype,"signalingState",{get:function(){return r.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=a,this.waitUntilConnected(this.user_friendly_id()+".onnegotiationneeded").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onnegotiationneeded);return c.then(function(){r.logger.log(b.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var a=new A("negotiationneeded",b);b.onnegotiationneeded_&&b.onnegotiationneeded_(a)}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onnegotiationneeded,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onnegotiationneeded(): failed.")})},enumerable:!1,configurable:!0}),b.prototype.dumpConstraints=function(a){r.logger.log(this.user_friendly_id()+"constraints: "+a),void 0!==a&&0!==Object.keys(a).length||r.logger.log(this.user_friendly_id()+"constraints either undefined or empty!"),a&&(r.logger.log(this.user_friendly_id()+"  -- video: "+a.offerToReceiveVideo),r.logger.log(this.user_friendly_id()+"  -- audio: "+a.offerToReceiveAudio),r.logger.log(this.user_friendly_id()+"  -- iceRestart: "+a.iceRestart),r.logger.log(this.user_friendly_id()+"  -- voiceActivityDetection: "+a.voiceActivityDetection))},b.prototype.fix_constraints=function(a){this.dumpConstraints(a);var b={};return this.isUnified()||(b={audio:!0,video:!0}),a&&(void 0===a.video&&void 0===a.offerToReceiveVideo||(b.video=a.offerToReceiveVideo),void 0===a.audio&&void 0===a.offerToReceiveAudio||(b.audio=a.offerToReceiveAudio),void 0!==a.iceRestart&&(b.iceRestart=a.iceRestart),void 0!==a.voiceActivityDetection&&(b.voiceActivityDetection=a.voiceActivityDetection)),b},b.prototype.createOffer=function(a,b,c){return r.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(a)),this.isUnified()?void 0==a?this.createOffer_v2():a?this.createOffer_v2(a):this.createOffer_v1(a,b,c):this.createOffer_v1(a,b,c)},b.prototype.createOffer_v2=function(a){var b=this;return r.logger.log(this.user_friendly_id()+".createOffer_v2() called.",JSON.stringify(a)),new Promise(function(c,d){b.createOffer_v1(function(a){r.logger.log(b.user_friendly_id()+".createOffer_v2(): got sdp!!!",JSON.stringify(a)),a=new y(a.type,a.sdp),c(a)},function(a){void 0!=a&&(a=b.logRemoteInvokeError(a,".createOffer_v2() failed."),d(a))},a)})},b.prototype.createOffer_v1=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".createOffer_v1().",JSON.stringify(c));var e=[this.waitUntilConnected(this.user_friendly_id()+".createOffer_v1"),this.waitTransceiverAndTrackReady(this.user_friendly_id()+".createOffer_v1")];Promise.all(e).then(function(){var a=d.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.createOffer);return d.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.createOffer,a.success,a.fail,d.fix_constraints(c)),a.prom()}).then(function(a){return r.logger.log(d.user_friendly_id()+".createOffer_v1(): success callback received!!!"),new z(d,d.param0(a).oid,l.ProxyMode.Remote).syncBarrier()}).then(function(b){a&&a(b)}).catch(function(a){void 0!=a&&(a=d.logRemoteInvokeError(a,".createOffer_v1() failed."),b&&b(a))})},b.prototype.createAnswer=function(a,b,c){return r.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(a)),this.isUnified()?void 0==a?this.createAnswer_v2():a?this.createAnswer_v2(a):this.createAnswer_v1(a,b,c):this.createAnswer_v1(a,b,c)},b.prototype.createAnswer_v2=function(a){var b=this;return r.logger.log(this.user_friendly_id()+".createAnswer_v2() called.",JSON.stringify(a)),new Promise(function(c,d){b.createAnswer_v1(function(a){r.logger.log(b.user_friendly_id()+".createAnswer_v2(): got sdp!!!",JSON.stringify(a)),a=new y(a.type,a.sdp),c(a)},function(a){void 0!=a&&(a=b.logRemoteInvokeError(a,".createAnswer_v2() failed."),d(a))},a)})},b.prototype.createAnswer_v1=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".createAnswer_v1() called.",JSON.stringify(c));var e=[this.waitUntilConnected(this.user_friendly_id()+".createAnswer_v1"),this.waitTransceiverAndTrackReady(this.user_friendly_id()+".createAnswer_v1")];Promise.all(e).then(function(){var a=d.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.createAnswer);return d.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.createAnswer,a.success,a.fail,d.fix_constraints(c),{}),a.prom()}).then(function(a){return r.logger.log(d.user_friendly_id()+".createAnswer_v1(): success callback received!!!"),new z(d,d.param0(a).oid,l.ProxyMode.Remote).syncBarrier()}).then(function(b){a&&a(b)}).catch(function(a){a=d.logRemoteInvokeError(a,".createAnswer_v1() failed."),b&&b(a.message)})},b.prototype.updateSdpDescription=function(a){r.logger.log(this.user_friendly_id()+".updateSdpDescription() called.");var b=this;return new Promise(function(c,d){var e=[];1==a?e.push(b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.localDescription,{oid:0})):e.push(b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.remoteDescription,{oid:0})),Promise.all(e).then(function(a){return r.logger.log(b.user_friendly_id()+".updateSdpDescription() resolved."),new z(b,b.param0(a[0]).oid,l.ProxyMode.Remote).syncBarrier()}).then(function(d){1==a?b.localDescription_=d:b.remoteDescription_=d,r.logger.log(b.user_friendly_id()+".updateSdpDescription() updated sdp"),c()}).catch(function(a){b.logRemoteInvokeError(a,"sdp.syncBarrier() failed!"),d()})})},b.prototype.sdpToString=function(a){var b="",c=0;for(a=a?a.split(/\r?\n/):[];c<a.length;c++){var d=a[c];-1!=d.indexOf("m=",0)?b+=d+"\\r\\n":-1!=d.indexOf("o=-",0)?b+=d+"\\r\\n":-1!=d.indexOf("a=ssrc",0)&&(b+=d+"\\r\\n")}return b},b.prototype.setLocalDescription=function(a,b,c){return r.logger.log(this.user_friendly_id()+".setLocalDescription() called.",this.sdpToString(a.sdp)),a instanceof y?this.setLocalDescription_v2(a):a instanceof RTCSessionDescription&&b?this.setLocalDescription_v1(a,b,c):(b=void 0,a?b=new y(a.type,a.sdp):(r.logger.log(this.user_friendly_id()+".setLocalDescription() empty param1, setting sdp type to rollback"),a=void 0,a="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",b=new y(a,"")),this.setLocalDescription_v2(b))},b.prototype.setLocalDescription_v2=function(a){var b=this;return r.logger.log(this.user_friendly_id()+".setLocalDescription_v2() called."),new Promise(function(c,d){b.waitUntilConnected(b.user_friendly_id()+".setLocalDescription_v2").then(function(){return new z(b,0,l.ProxyMode.Local,{type:z.convertC2H(a.type),sdp:a.sdp}).syncBarrier()}).then(function(e){var f=b.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.setLocalDescription_v2),g={type:z.convertC2H(a.type),sdp:a.sdp};b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.setLocalDescription_v2,g,f.success,f.fail),f.prom().then(function(){r.logger.log(b.user_friendly_id()+".setLocalDescription_v2(): success callback received!!!"),b.localDescription_=e,r.logger.log(b.user_friendly_id()+".setLocalDescription_v2(): updated localDescription_"),Promise.all([]).then(function(){r.logger.log(b.user_friendly_id()+".setLocalDescription_v2() success."),c()}).catch(function(a){a=b.logRemoteInvokeError(a,".prop.setLocalDescription_v2() failed!"),d(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,"setLocalDescription_v2() error callback received!"),d(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,".setLocalDescription_v2() failed."),d(a)})})},b.prototype.setLocalDescription_v1=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".setLocalDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setLocalDescription_v1").then(function(){return new z(d,0,l.ProxyMode.Local,{type:z.convertC2H(a.type),sdp:a.sdp}).syncBarrier()}).then(function(a){var e=d.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.setLocalDescription);d.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.setLocalDescription,[a],e.success,e.fail),e.prom().then(function(){r.logger.log(d.user_friendly_id()+".setLocalDescription_v1(): success callback received!!!"),d.localDescription_=a,r.logger.log(d.user_friendly_id()+".setLocalDescription_v1(): updated localDescription_"),Promise.all([]).then(function(){r.logger.log(d.user_friendly_id()+".setLocalDescription_v1() success."),b&&b()}).catch(function(a){a=d.logRemoteInvokeError(a,".prop.setLocalDescription_v1() failed."),c&&c(a.message)})}).catch(function(a){a=d.logRemoteInvokeError(a,".setLocalDescription_v1() error callback received."),c&&c(a.message)})}).catch(function(a){a=d.logRemoteInvokeError(a,".setLocalDescription_v1() failed."),c&&c(a.message)})},b.prototype.setRemoteDescription=function(a,b,c){return r.logger.log(this.user_friendly_id()+".setRemoteDescription() called.",this.sdpToString(a.sdp)),a instanceof y?this.setRemoteDescription_v2(a):a instanceof RTCSessionDescription&&b?this.setRemoteDescription_v1(a,b,c):(b=void 0,a?b=new y(a.type,a.sdp):(r.logger.log(this.user_friendly_id()+".setRemoteDescription() empty param1, setting sdp type to rollback"),a=void 0,a="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",b=new y(a,"")),this.setRemoteDescription_v2(b))},b.prototype.setRemoteDescription_v2=function(a){var b=this;return r.logger.log(this.user_friendly_id()+".setRemoteDescription_v2() called."),new Promise(function(c,d){b.waitUntilConnected(b.user_friendly_id()+".setRemoteDescription_v2").then(function(){var e=new z(b,0,l.ProxyMode.Local,{type:z.convertC2H(a.type),sdp:a.sdp}),f=[];f.push(e.syncBarrier());var e=b.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.setRemoteDescription_v2),g={type:z.convertC2H(a.type),sdp:a.sdp};b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.setRemoteDescription_v2,g,e.success,e.fail),f.push(e.prom()),Promise.all(f).then(function(a){r.logger.log(b.user_friendly_id()+".setRemoteDescription_v2(): remote success."),b.remoteDescription_=a[0],f=[],b.usingasynconly_||(b.isUnified()?f.push(b.getTransceiversAsync()):f.push(b.getSendersAsync())),Promise.all(f).then(function(a){r.logger.log(b.user_friendly_id()+".setRemoteDescription_v2(): final success."),c()}).catch(function(a){a=b.logRemoteInvokeError(a,".prop.setRemoteDescription_v2() final failed."),d(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,".prop.setRemoteDescription_v2() remote failed."),d(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,".setRemoteDescription_v2() failed."),d(a)})})},b.prototype.setRemoteDescription_v1=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".setRemoteDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setRemoteDescription_v1").then(function(){return new z(d,0,l.ProxyMode.Local,{type:z.convertC2H(a.type),sdp:a.sdp}).syncBarrier()}).then(function(a){var e=d.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.setRemoteDescription);d.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.setRemoteDescription,[a],e.success,e.fail),e.prom().then(function(){r.logger.log(d.user_friendly_id()+".setRemoteDescription_v1(): success callback received!!!"),d.remoteDescription_=a,r.logger.log(d.user_friendly_id()+".setRemoteDescription_v1(): updated remoteDescription_");var e=[];d.usingasynconly_||(d.isUnified()?e.push(d.getTransceiversAsync()):e.push(d.getSendersAsync())),Promise.all(e).then(function(){r.logger.log(d.user_friendly_id()+".setRemoteDescription_v1(): success."),b&&b()}).catch(function(a){a=d.logRemoteInvokeError(a,".prop.setRemoteDescription_v1() failed."),c&&c(a.message)})})}).catch(function(a){a=d.logRemoteInvokeError(a,".setRemoteDescription_v1() failed."),c&&c(a.message)})},b.prototype.getLocalStreams=function(){r.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]");for(var a=0,b=this.localStreams;a<b.length;a++)r.logger.log(JSON.stringify(b[a]));return this.localStreams},b.prototype.getRemoteStreams=function(){r.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var a=0,b=this.remoteStreams;a<b.length;a++)r.logger.log(JSON.stringify(b[a]));return this.remoteStreams},b.prototype.addTrack=function(a,b){return this.addTrackInternal(a,b,!1)},b.prototype.addTrackAsync=function(a,b){return this.addTrackInternal(a,b,!0)},b.prototype.addTrackInternal=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".addTrackInternal() called. track.id = "+a.id+", streams = "+JSON.stringify(b)+", isAsync = "+c),this.incrementPendingTrackCount();var e=[];if(b)if(b instanceof j.RemoteStream)e.push(b.id),this.localStreams.push(b);else for(var f=0;f<b.length;f++)e.push(b[f].id),this.localStreams.push(b[f]);else r.logger.log(this.user_friendly_id()+".addTrackInternal() empty streams passed in, continue with empty array");var g=new k.RtpSender(this,0,l.ProxyMode.Pseudo,this.isUnified());return this.senders_.push(g),b=new Promise(function(b,c){d.waitUntilConnected(d.user_friendly_id()+".addTrackInternal").then(function(){return d.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.addTrack,[a],e)}).then(function(a){r.logger.log(d.user_friendly_id()+".addTrackInternal() success with oid: "+d.param0(a).oid),g.bind(d,d.param0(a).oid),g.syncBarrier().then(function(){r.logger.log(d.user_friendly_id()+"sender.syncBarrier(): success"),!d.usingasynconly_&&d.isUnified()?d.getTransceiversAsync().then(function(){d.decrementPendingTrackCount(),b(g)}).catch(function(a){d.logRemoteInvokeError(a,".addTrackInternal() getTransceiversAsync() failed!"),d.decrementPendingTrackCount(),c()}):(d.decrementPendingTrackCount(),b(g))}).catch(function(a){d.logRemoteInvokeError(a,"sender.syncBarrier() failed!"),d.decrementPendingTrackCount(),c()})}).catch(function(a){d.logRemoteInvokeError(a,"addTrack() failed!"),d.decrementPendingTrackCount(),c()})}),c?b:(r.logger.log(this.user_friendly_id()+".addTrack() returning: "+g),g)},b.prototype.removeTrack=function(a){r.logger.log(this.user_friendly_id()+".removeTrack() called."),this.removeTrackAsync(a)},b.prototype.removeTrackAsync=function(a){var b=this;r.logger.log(this.user_friendly_id()+".removeTrackAsync() called."),this.incrementPendingTrackCount();for(var c=0;c<this.senders_.length;c++)this.senders_[c]==a&&this.senders_.splice(c,1);return new Promise(function(c,d){b.waitUntilConnected(b.user_friendly_id()+".removeTrackAsync").then(function(){return b.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.removeTrack,[a])}).then(function(){r.logger.log(b.user_friendly_id()+".removeTrackAsync() success."),!b.usingasynconly_&&b.isUnified()?b.getTransceiversAsync().then(function(){b.decrementPendingTrackCount(),c()}).catch(function(a){b.logRemoteInvokeError(a,"removeTrackAsync() getTransceiversAsync() failed!"),b.decrementPendingTrackCount(),d(a)}):(b.decrementPendingTrackCount(),c())}).catch(function(a){b.logRemoteInvokeError(a,"removeTrackAsync() failed!"),b.decrementPendingTrackCount(),d(a)})})},b.prototype.addStream=function(a){var b=this;r.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(a)),this.localStreams.push(a),this.waitUntilConnected(this.user_friendly_id()+".addStream").then(function(){return b.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.addStream,[a],{})}).then(function(){r.logger.log(b.user_friendly_id()+".addStream() success.")}).catch(function(a){b.logRemoteInvokeError(a,"addStream() failed.")})},b.prototype.removeStream=function(a){var b=this;r.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(a));for(var c=0;c<this.localStreams.length;c++)this.localStreams[c]==a&&this.localStreams.splice(c,1);this.waitUntilConnected(this.user_friendly_id()+".removeStream").then(function(){return b.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.removeStream,[a])}).then(function(){r.logger.log(b.user_friendly_id()+".removeStream() success.")}).catch(function(a){b.logRemoteInvokeError(a,"removeStream() failed.")})},Object.defineProperty(b.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=a,this.waitUntilConnected(this.user_friendly_id()+".onaddstream").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onaddstream);return c.then(function(a){new j.RemoteStreamEvent(b,b.param0(a).oid).syncBarrier().then(function(a){r.logger.log(b.user_friendly_id()+".onaddstream callback received!"),void 0===b.remoteStreams.find(function(b){return void 0!=a.stream&&b.object_id()===a.stream.object_id()})&&b.remoteStreams.push(a.stream),b.onaddstream_&&(r.logger.log(b.user_friendly_id()+".onaddstream notified!!! "+a.stream.id),b.onaddstream_(a))})}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onaddstream,c.success)}).catch(function(a){b.logRemoteInvokeError(a,"set_onaddstream() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=a,this.waitUntilConnected(this.user_friendly_id()+".onremovestream").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.onremovestream);return c.then(function(a){new j.RemoteStreamEvent(b,b.param0(a).oid).syncBarrier().then(function(a){r.logger.log(b.user_friendly_id()+".onremovestream callback received! "+a.stream.id);var c=b.remoteStreams.findIndex(function(b){return b.id==a.stream.id});0<=c&&b.remoteStreams.splice(c,1),b.onremovestream_&&b.onremovestream_(a)})}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.onremovestream,c.success)}).catch(function(a){b.logRemoteInvokeError(a,"set_onremovestream() failed!")})},enumerable:!1,configurable:!0}),b.prototype.getStats=function(a){var b=this;return new Promise(function(c,d){b.isRedirected()?b.waitUntilConnected(b.user_friendly_id()+".getStats").then(function(){var d=b.registerCallbacks(!0,!1,q.method_id_RTCPeerConnection_t.getStats);return d.then(function(b){void 0===b.params||0===b.params.length||0===b.params[0].length?c():a?(a(s.StatsReport.fromJSON(JSON.parse(b.params[0]))),c()):c(s.StatsReport.toRTCStatsReport(JSON.parse(b.params[0])))}),a?b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.getStats,d.success):b.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.getStats_v2,d.success)}).catch(function(a){b&&(a=b.logRemoteInvokeError(a,".getStats() failed!"),d(a))}):(a({}),c())})},b.prototype.SendTelemetryData=function(a,b,c){i.getRedirector().telemetry.SendTelemetryData(t.tel_cmd.Data,a,b,c)},b.prototype.MillisecondstoDisplayformat_=function(a){var b,c;c=Math.floor(a/1e3),b=Math.floor(c/60),a=Math.floor(b/60),r.logger.log(Math.floor(a/24)+":"+a%24+":"+b%60+":"+c%60)},b.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.timeerstarted_=!1,this.callendTime_=(new Date).getTime();var a=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(a),a=Math.round(a/1e3),r.logger.log("Call Duration "+a),1==this.conferencecall_?this.SendTelemetryData(t.tel_key_ConferenceCallDuration,a,1):(1==this.audiocall_.active&&this.SendTelemetryData(t.tel_key_AudioCallDuration,a,1),1==this.videocall_.active&&this.SendTelemetryData(t.tel_key_VideoCallDuration,a,1),1==this.screensharingcall_.active&&this.SendTelemetryData(t.tel_key_ScreensharingCallDuration,a,1));var b;1==this.firsttimelocaloffer_&&(b=this.callstartTime_-this.outgoingcallstart_),1==this.firsttimeremoteoffer_&&(b=this.callstartTime_-this.incomingcallstart_),this.MillisecondstoDisplayformat_(b),b=Math.round(b/1e3),r.logger.log("Call Establish Time "+b),1==this.incomingcall_?this.SendTelemetryData(t.tel_key_CallEstIncoming,b,1):1==this.outgoingcall_&&this.SendTelemetryData(t.tel_key_CallEstOutgoing,b,1),this.SendTelemetryData(t.tel_key_PerfCallState,t.tel_CallState.idle,1)}},b.prototype.close=function(){var a=this;r.logger.log(this.user_friendly_id()+".close() called."),this.CalculateCallDurationandType_(),this.unregisterStateChangeNotification(this.onStateChange),this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=null,this.waitUntilConnected(this.user_friendly_id()+".close").then(function(){return a.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.close)}).then(function(){a.iceQ_=null,a.release(),r.logger.log(a.user_friendly_id()+".close() success.")}).catch(function(b){a.logRemoteInvokeError(b,".close() failed."),a.iceQ_=null,a.release()})},b.prototype.createDTMFSender=function(a){r.logger.log(this.user_friendly_id()+".createDTMFSender() called.");var b,c=this.senders_;return void 0!==c&&0!==c.length||(c=this.getSenders()),void 0!=c&&void 0!=(c=c.find(function(b){return b.track.id===a.id}))&&(r.logger.log(this.user_friendly_id()+" returning RtpSender with oid:"+c.object_id()),b=c.dtmf),b},Object.defineProperty(b.prototype,"usingAsyncOnly",{get:function(){return this.usingasynconly_},set:function(a){r.logger.log(this.user_friendly_id()+".usingAsyncOnly() called with async:"+a),void 0!=a&&null!=a&&(this.usingasynconly_=a)},enumerable:!1,configurable:!0}),b.prototype.getSendersAsync=function(){return r.logger.log(this.user_friendly_id()+".getSendersAsync() called."),this.getSendersAsyncInternal()},b.prototype.getSenders=function(){if(r.logger.log(this.user_friendly_id()+".getSenders() called. "),this.usingasynconly_)throw r.logger.log(this.user_friendly_id()+".getSenders(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getSenders() not allowed when usingAsyncOnly is true!!!");return this.getSendersAsyncInternal(),r.logger.log(this.user_friendly_id()+".getSenders() returning:"+this.senders_.length+" items"),this.senders_},b.prototype.getSendersAsyncInternal=function(){var a=this;return r.logger.log(this.user_friendly_id()+".getSendersAsyncInternal() called. "+this.senders_),new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".getSendersAsyncInternal").then(function(){return r.logger.log(a.user_friendly_id()+".getSendersAsyncInternal invoking remote"),a.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.getSenders)}).then(function(c){r.logger.log(a.user_friendly_id()+".getSendersAsyncInternal remote success");var d=[],e=[];c.params[0].forEach(function(b){var c=a.senders_.find(function(a){return a.object_id()===b.oid});void 0===c&&(r.logger.log(a.user_friendly_id()+" adding a RtpSender with oid:"+b.oid),c=new k.RtpSender(a,b.oid,l.ProxyMode.Remote,a.isUnified())),e.push(c.syncBarrier()),d.push(c)}),Promise.all(e).then(function(){a.senders_=d,r.logger.log(a.user_friendly_id()+".getSendersAsyncInternal: returning senders with ids ["+a.senders_.map(function(a){return a.object_id()})+"]"),b(a.senders_)}).catch(function(c){a.logRemoteInvokeError(c,".prop.getSendersAsyncInternal() failed."),a.senders_=[],b(a.senders_)})}).catch(function(c){a.logRemoteInvokeError(c,".getSendersAsyncInternal() failed."),a.senders_=[],b(a.senders_)})})},b.prototype.getReceiversAsync=function(){return r.logger.log(this.user_friendly_id()+".getReceiversAsync() called."),this.getReceiversAsyncInternal()},b.prototype.getReceivers=function(){if(r.logger.log(this.user_friendly_id()+".getReceivers() called. "),this.usingasynconly_)throw r.logger.log(this.user_friendly_id()+".getReceivers(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getReceivers() not allowed when usingAsyncOnly is true!!!");return this.getReceiversAsyncInternal(),r.logger.log(this.user_friendly_id()+".getReceivers() returning:"+this.receivers_.length+" items"),this.receivers_},b.prototype.getReceiversAsyncInternal=function(){var a=this;return r.logger.log(this.user_friendly_id()+".getReceiversAsyncInternal() called. "+this.receivers_),new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".getReceiversAsyncInternal").then(function(){return a.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.getReceivers)}).then(function(c){r.logger.log(a.user_friendly_id()+".getReceiversAsyncInternal: remote success.");var d=[],e=[];c.params[0].forEach(function(b){var c=a.receivers_.find(function(a){return a.object_id()===b.oid});void 0===c&&(r.logger.log(a.user_friendly_id()+" adding a RtpReceiver with oid:"+b.oid),c=new k.RtpReceiver(a,b.oid,l.ProxyMode.Remote,a.isUnified())),e.push(c.syncBarrier()),d.push(c)}),Promise.all(e).then(function(){a.receivers_=d,r.logger.log(a.user_friendly_id()+".getReceiversAsyncInternal: returning receiver with ids ["+a.receivers_.map(function(a){return a.object_id()})+"]"),b(a.receivers_)}).catch(function(c){a.logRemoteInvokeError(c,".prop.getReceiversAsyncInternal() failed!"),a.receivers_=[],b(a.receivers_)})}).catch(function(c){a.logRemoteInvokeError(c,".getReceiversAsyncInternal() failed!"),a.receivers_=[],b(a.receivers_)})})},b.prototype.addTransceiver=function(a,b){return r.logger.log(this.user_friendly_id()+".addTransceiver() called: "+JSON.stringify(a)+" init="+JSON.stringify(b)),this.addTransceiverInternal(a,b,!1)},b.prototype.addTransceiverAsync=function(a,b){return r.logger.log(this.user_friendly_id()+".addTransceiverAsync() called: "+JSON.stringify(a)+" init="+JSON.stringify(b)),this.addTransceiverInternal(a,b,!0)},b.prototype.addTransceiverInternal=function(a,b,c){var d=this;r.logger.log(this.user_friendly_id()+".addTransceiverInternal() called: "+JSON.stringify(a)+" init="+JSON.stringify(b)),this.incrementPendingTransceiverCount();var e=n.RtcRtpTransceiverDirection.sendrecv,f=void 0;b&&(f=n.RtcRtpTransceiverInit.toRtcRtpTransceiverInit(b),f.direction&&(e=f.direction));var g=b;o.RemoteSession.isFeatureCallConstraintsSupported()&&(g=f);var h=new n.RtpTransceiver(this,0,l.ProxyMode.Pseudo,this.isUnified(),e);return this.transceivers_.push(h),b=new Promise(function(b,c){d.waitUntilConnected(d.user_friendly_id()+".addTransceiverInternal").then(function(){return"string"==typeof a?d.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.addTransceiverWithKind,a,g):d.remoteInvokeEx(!1,q.method_id_RTCPeerConnection_t.addTransceiverWithTrack,[a],g)}).then(function(a){r.logger.log(d.user_friendly_id()+".addTransceiverInternal() success with oid: "+d.param0(a).oid),h.bind(d,d.param0(a).oid),h.syncBarrier().then(function(){r.logger.log(d.user_friendly_id()+".addTransceiverInternal(): success"),d.decrementPendingTransceiverCount(),b(h)}).catch(function(a){d.logRemoteInvokeError(a,".prop.addTransceiverInternal() failed!"),d.decrementPendingTransceiverCount(),c()})}).catch(function(a){d.logRemoteInvokeError(a,"addTransceiverInternal() failed!"),d.decrementPendingTransceiverCount(),c()})}),r.logger.log(this.user_friendly_id()+".addTransceiverInternal() returning:"),c?b:h},b.prototype.incrementPendingTransceiverCount=function(){++this.pendingtransceiver_},b.prototype.decrementPendingTransceiverCount=function(){0<this.pendingtransceiver_&&--this.pendingtransceiver_},b.prototype.incrementPendingTrackCount=function(){++this.pendingtrack_},b.prototype.decrementPendingTrackCount=function(){0<this.pendingtrack_&&--this.pendingtrack_},b.prototype.waitTransceiverAndTrackReady=function(a){var b=this;return new Promise(function(c,d){if(r.logger.trace(b.user_friendly_id()+".waitTransceiverAndTrackReady(): pendingtransceiver_="+b.pendingtransceiver_+", pendingtrack_="+b.pendingtrack_),0==b.pendingtransceiver_&&0==b.pendingtrack_){for(;b.deferredOfferAnswers&&0<b.deferredOfferAnswers.length;)b.deferredOfferAnswers.shift().post(!0);c()}else b.deferredOfferAnswers.push(new l.deferred_action(c,d,a)),b.checkTransceiverAndTrack(600,25)})},b.prototype.checkTransceiverAndTrack=function(a,b){var c=this;if(0>=a)for(r.logger.log(".checkTransceiverAndTrack() timeout waiting for transceiver ready!");this.deferredOfferAnswers&&0<this.deferredOfferAnswers.length;)this.deferredOfferAnswers.shift().post(!1);else setTimeout(function(a){if(0==c.pendingtransceiver_&&0==c.pendingtrack_)for(;c.deferredOfferAnswers&&0<c.deferredOfferAnswers.length;)c.deferredOfferAnswers.shift().post(!0);else r.logger.log('.checkTransceiverAndTrack(): count= "'+a),c.checkTransceiverAndTrack(--a,b)},b,a)},b.prototype.getTransceivers=function(){if(r.logger.log(this.user_friendly_id()+".getTransceivers() called. "),this.usingasynconly_)throw r.logger.log(this.user_friendly_id()+".getTransceivers(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getTransceivers() not allowed when usingAsyncOnly is true!!!");return this.getTransceiversAsync(),r.logger.log(this.user_friendly_id()+".getTransceivers() returning:"+this.transceivers_.length+" items"),this.transceivers_},b.prototype.getTransceiversAsync=function(){var a=this;return r.logger.log(this.user_friendly_id()+".getTransceiversAsync() called. "),new Promise(function(b,c){if(!a.isUnified())return r.logger.log(a.user_friendly_id()+".getTransceiversAsync() called in non-Unified. "),Promise.resolve(a.transceivers_);a.waitUntilConnected(a.user_friendly_id()+".getTransceiversAsync").then(function(){return a.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.getTransceivers)}).then(function(c){r.logger.log(a.user_friendly_id()+".getTransceiversAsync() remote success.");var d=[],e=[];c.params[0].forEach(function(b){var c=a.transceivers_.find(function(a){return a.object_id()===b.oid});void 0===c&&(r.logger.log(a.user_friendly_id()+" adding a RtpTransceiver with oid:"+b.oid),c=new n.RtpTransceiver(a,b.oid,l.ProxyMode.Remote,a.isUnified())),e.push(c.syncBarrier()),d.push(c)}),Promise.all(e).then(function(){a.transceivers_=d,r.logger.log(a.user_friendly_id()+".prop.getTransceiversAsync: returning transceiver with ids ["+a.transceivers_.map(function(a){return a.object_id()})+"]"),b(a.transceivers_)}).catch(function(c){a.logRemoteInvokeError(c,".prop.getTransceiversAsync() failed!"),a.transceivers_=[],b(a.transceivers_)})}).catch(function(c){a.logRemoteInvokeError(c,".getTransceiversAsync() failed!"),a.transceivers_=[],b(a.transceivers_)})})},Object.defineProperty(b.prototype,"sctp",{get:function(){return this.sctp_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"ondatachannel",{get:function(){return this.ondatachannel_},set:function(a){var b=this;r.logger.log(this.user_friendly_id()+".set_ondatachannel() called."),this.ondatachannel_=a,this.waitUntilConnected(this.user_friendly_id()+".ondatachannel").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),q.method_id_RTCPeerConnection_t.ondatachannel);return c.then(function(a){r.logger.log(b.user_friendly_id()+".ondatachannel callback received!!!"),null!==b.remotedatachannel_&&b.remotedatachannel_.object_id()==b.param0(a).oid||(b.remotedatachannel_=new p.RtcDataChannel(b,b.param0(a).oid,l.ProxyMode.Remote),b.remotedatachannel_.syncBarrier().then(function(){r.logger.log(b.user_friendly_id()+"remotedatachannel_.syncBarrier(): success");var a=new Event("ondatachannel");a.channel=b.remotedatachannel_,b.localdatachannel_&&!b.localdatachannel_.isdestroyed()?b.localdatachannel_.syncBarrier().then(function(){r.logger.log(b.user_friendly_id()+"ondatachannel(): notifying..."),b.ondatachannel_&&b.ondatachannel_(a)}).catch(function(){r.logger.log(b.user_friendly_id()+"localdatachannel_.syncBarrier(): failed!")}):(r.logger.log(b.user_friendly_id()+"ondatachannel(): notifying..."),b.ondatachannel_&&b.ondatachannel_(a))}).catch(function(){r.logger.log(b.user_friendly_id()+"remotedatachannel_.syncBarrier(): failed!")}))}),b.remoteInvoke(!0,q.method_id_RTCPeerConnection_t.ondatachannel,c.success)}).catch(function(){
r.logger.log(b.user_friendly_id()+".ondatachannel() failed.")})},enumerable:!1,configurable:!0}),b.prototype.fixDataChannelConfig=function(a){return r.logger.log(this.user_friendly_id()+".fixDataChannelConfig() called: "+a),void 0==a&&(a={}),void 0==a.negotiated&&void 0==a.id&&(a.negotiated=!1,a.id=-1),a},b.prototype.createDataChannel=function(a,b){var c=this;return r.logger.log(this.user_friendly_id()+".createDataChannel() called. label:"+a),this.localdatachannel_=new p.RtcDataChannel(this,0,l.ProxyMode.Pseudo),this.waitUntilConnected(this.user_friendly_id()+".createDataChannel").then(function(){return c.remoteInvoke(!1,q.method_id_RTCPeerConnection_t.createDataChannel,a,c.fixDataChannelConfig(b))}).then(function(a){r.logger.log(c.user_friendly_id()+".createDataChannel() success with oid: "+c.param0(a).oid),c.localdatachannel_.bind(c,c.param0(a).oid),c.localdatachannel_.syncBarrier().then(function(){r.logger.log(c.user_friendly_id()+"channel.syncBarrier(): success")}).catch(function(){r.logger.log(c.user_friendly_id()+"channel.syncBarrier(): failed!")})}).catch(function(a){a=c.param0(a),r.logger.log(c.user_friendly_id()+".createDataChannel() failed with error: "+a)}),r.logger.log(this.user_friendly_id()+".createDataChannel() returning: "+this.localdatachannel_),this.localdatachannel_},b}(l.ProxyObject),b.PeerConnection=a},658:function(a,b,c){var d=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a};Object.defineProperty(b,"__esModule",{value:!0}),b.ProxyObject=b.ProxyMode=b.ProxyReadyState=b.number_allocator=b.callback=b.rpc_callback=b.deferred_action=void 0;var e=c(946),f=c(851),g=c(545),h=c(247),i=c(550),j=function(){function a(a,b,c){this.resolve=a,this.reject=b,this.name_=c}return Object.defineProperty(a.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),a.prototype.post=function(a){1==a?(f.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve()):(f.logger.log('deferred_action.post(): rejecting "'+this.name_+'"'),this.reject())},a.prototype.postWithResult=function(a,b){1==a?(f.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve(b)):(f.logger.log('deferred_action.post(): rejecting "'+this.name_+'"'),this.reject())},a.prototype.postResolve=function(a){this.resolve(a)},a.prototype.postReject=function(a){void 0==a?this.reject():this.reject(a)},a}();b.deferred_action=j;var k=function(){return function(a,b){this.id=a,this.is_null=b}}();b.rpc_callback=k;var l=function(){function a(a,b,c){this.success=new k(a<<16,b),this.fail=new k(a<<16|1,b),this.id=a,this.oneShot=c}return a.prototype.resolve=function(a){f.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(a)},a.prototype.reject=function(a){null!=this.err_handler&&this.err_handler(a)},a.prototype.then=function(a){this.handler=a},a.prototype.prom=function(){var a=this;return new Promise(function(b,c){a.handler=b,a.err_handler=c})},a}();b.callback=l;var m=function(){function a(b,c,d){this.min_=b<a.BOUND_LOW||b>a.BOUND_HIGH?a.DEF_MIN:b,this.max_=c<a.BOUND_LOW||c>a.BOUND_HIGH?a.DEF_MAX:c,this.interval_=d<a.BOUND_LOW||d>a.BOUND_HIGH?a.DEF_INTERVAL:d,this.numbers_=new Map,this.numbers_.set(this.min_,this.max_)}return Object.defineProperty(a.prototype,"max",{get:function(){return this.max_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"min",{get:function(){return this.min_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"interval",{get:function(){return this.interval_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"numbers",{get:function(){return this.numbers_},enumerable:!1,configurable:!0}),a.prototype.allocate=function(){var a=-1;if(0<this.numbers_.size){var b=Array.from(this.numbers_.keys()).sort(function(a,b){return a-b})[0],c=this.numbers_.get(b),a=this.min_+(b-this.min_)*this.interval_;this.numbers_.delete(b),b+=1,b<c&&this.numbers_.set(b,c)}return a},a.prototype.deallocate=function(a){var b=Array.from(this.numbers_.keys()).sort(function(a,b){return a-b});a=(a-this.min_)/this.interval_;for(var c=!1,d=0;d<b.length&&(b[d]==a+1?(this.numbers_.set(a,this.numbers_.get(b[d])),this.numbers_.delete(b[d]),c=!0):this.numbers_.get(b[d])==a&&(this.numbers_.set(b[d],a+1),d+1<b.length&&b[d+1]==a+1&&(this.numbers_.set(b[d],this.numbers_.get(b[d+1])),this.numbers_.delete(b[d+1])),c=!0),!c);d++);c||this.numbers_.set(a,a+1)},a.BOUND_LOW=0,a.BOUND_HIGH=4294967295,a.DEF_MIN=0,a.DEF_MAX=1024,a.DEF_INTERVAL=1,a}();b.number_allocator=m;var n;!function(a){a[a.NotConfigured=0]="NotConfigured",a[a.Configured=1]="Configured",a[a.Error=2]="Error",a[a.Destroyed=3]="Destroyed"}(n=b.ProxyReadyState||(b.ProxyReadyState={}));var o;!function(a){a[a.Local=0]="Local",a[a.Remote=1]="Remote",a[a.Pseudo=2]="Pseudo"}(o=b.ProxyMode||(b.ProxyMode={})),a=function(){function a(b,c,j,k,l,m){var p=this;void 0===l&&(l=null),void 0===m&&(m=[]);for(var q=[],r=6;r<arguments.length;r++)q[r-6]=arguments[r];if(this.hdxms=e.getRedirector(),this.iid=c,this.oid=j,this.mode=k,this.proxystate=n.NotConfigured,this.deferredActions=[],this.pendingSyncBarriers=[],this.cbs=new Map,k===o.Local){r=!1,this.iid===i.class_id_t.EngineControl&&(r=!0);var s=this;this.hdxms.startRedirection(r,this.user_friendly_id()).then(function(){return p.oid=a.nextId++,f.logger.log(p.user_friendly_id()+" assigned local oid:"+p.oid),new Promise(function(a,b){s.waitUntilConnectedEx(s.user_friendly_id()+".ctor()",m).then(function(){f.logger.log(s.user_friendly_id()+".ctor() all parameter rpc objects are ready.");var a=s.oidsFromProxyOjbects(m).concat(q),b=i.WebrpcClassLibInfoUtil.getMethodFeatureByid(c,0);return s.hdxms.WSSendObjectWrapper(b,c,0,g.WsJsonUtil.createMessageByid.apply(g.WsJsonUtil,d([!1,!1,g.ws_msg_type_t.req,c,0,s.oid],a)))}).then(function(b){f.logger.log(s.user_friendly_id()+".ctor() success."),a(b)}).catch(function(){f.logger.log(s.user_friendly_id()+".ctor() failed."),b()})})}).then(function(a){f.logger.trace("ProxyObject: setting state to configured. (iid: "+p.iid+" oid: "+p.oid+")");var c=p.oid;s.proxystate=n.Configured,s.oid=p.param0(a),f.logger.log(p.user_friendly_id()+" assigned remote oid for local oid:"+c),s.onConnected(),l&&l(),h.getGC().trackObject(p,b)}).catch(function(){s.proxystate=n.Error,s.onConnected()})}else k===o.Remote&&(this.proxystate=n.Configured,h.getGC().trackObject(this,b))}return a.prototype.syncBarrierDeep=function(a,b){var c=!0;return 0<this.pendingSyncBarriers.length&&(c=!1),this.pendingSyncBarriers.push(new j(a,b,this.user_friendly_id()+".syncBarrier")),f.logger.log(this.user_friendly_id()+".syncBarrierDeep() queing request for:"+this.oid+", rv:"+c+", items:"+this.pendingSyncBarriers.length),c},a.prototype.syncBarrierResolve=function(a){for(f.logger.log(this.user_friendly_id()+".syncBarrierResolve() items:"+this.pendingSyncBarriers.length);this.pendingSyncBarriers&&0<this.pendingSyncBarriers.length;)f.logger.log(this.user_friendly_id()+".syncBarrierResolve() items:"+this.pendingSyncBarriers.length+" resolving request for:"+this.oid),this.pendingSyncBarriers.shift().postResolve(a)},a.prototype.syncBarrierReject=function(a){for(f.logger.log(this.user_friendly_id()+".syncBarrierReject() items:"+this.pendingSyncBarriers.length);this.pendingSyncBarriers&&0<this.pendingSyncBarriers.length;)f.logger.log(this.user_friendly_id()+".syncBarrierReject() rejecting request for:"+this.oid),this.pendingSyncBarriers.shift().postReject(a)},Object.defineProperty(a.prototype,"proxyreadystate",{get:function(){return this.proxystate},set:function(a){this.proxystate=a},enumerable:!1,configurable:!0}),a.prototype.bind=function(a,b){if(f.logger.trace("ProxyObject: binding object. (iid: "+this.iid+" oid: "+b+" mode: "+this.mode+")"),this.mode===o.Pseudo){this.proxystate=n.Configured;var c=this.oid;this.oid=b,f.logger.log(this.user_friendly_id()+" assigned remote oid for local oid:"+c),this.onConnected(),h.getGC().trackObject(this,a),this.mode=o.Remote}else this.mode===o.Remote?f.logger.log("ProxyObject: binding already complete."):f.logger.log("ProxyObject: binding failure. incorrect mode!")},a.prototype.reconstructor=function(a,b,c){for(var e=this,j=[],k=3;k<arguments.length;k++)j[k-3]=arguments[k];this.proxystate=n.NotConfigured,this.deferredActions=[],k=i.WebrpcClassLibInfoUtil.getMethodFeatureByid(b,0),this.hdxms.WSSendObjectWrapper(k,b,0,g.WsJsonUtil.createMessageByid.apply(g.WsJsonUtil,d([!1,!1,g.ws_msg_type_t.req,b,0,this.oid],j))).then(function(b){f.logger.trace("ProxyObject: setting state to configured. (iid: "+e.iid+" oid: "+e.oid+")");var c=e.oid;e.proxystate=n.Configured,e.oid=e.param0(b),f.logger.log(e.user_friendly_id()+" assigned remote oid for local oid:"+c),e.onConnected(),h.getGC().trackObject(e,a)}).catch(function(){e.proxystate=n.Error,e.onConnected()})},a.prototype.setParent=function(a){h.getGC().setParent(this,a)},a.prototype.release=function(){f.logger.log(this.user_friendly_id()+".release() called."),h.getGC().releaseObject(this)},a.prototype.destroy=function(){f.logger.log(this.user_friendly_id()+".destroy() called."),this.proxystate=n.Destroyed;var a=i.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(a,this.iid,0,g.WsJsonUtil.createMessageByid(!1,!0,g.ws_msg_type_t.req,this.iid,0,this.oid)),this.clearCallbacks()},a.prototype.isdestroyed=function(){return this.proxystate==n.Destroyed},a.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.proxystate==n.Configured)},a.prototype.isPseudo=function(){return this.mode==o.Pseudo},a.prototype.checkState=function(a,b,c){var d=this;0>=a?(f.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+d.iid+" oid: "+d.oid+"name: "+c+")"),d.onConnected()):setTimeout(function(a,c){d.proxystate==n.Configured?d.onConnected():d.proxystate==n.Error?d.onConnected():d.proxystate==n.Destroyed?d.onConnected():d.checkState(--a,b,c)},b,a,c)},a.prototype.waitUntilConnected=function(a){var b=this;return new Promise(function(c,d){b?(f.logger.trace("ProxyObject.waitUntilConnected(): readyState="+b.proxystate+". (iid: "+b.iid+" oid: "+b.oid+")"),b.proxystate==n.Destroyed?(b.onConnected(),f.logger.trace("rejecting already destroyed Object:"+b.user_friendly_id()),d("Object already destroyed :"+b.user_friendly_id())):b.proxystate==n.Configured?(b.onConnected(),c()):b.proxystate==n.Error?(f.logger.trace("ProxyObject.waitUntilConnected(): readyState="+b.proxystate+". (iid: "+b.iid+" oid: "+b.oid+")"),b.onConnected(),d()):(f.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+a+'". (iid: '+b.iid+" oid: "+b.oid+")"),b.deferredActions.push(new j(c,d,a)),b.checkState(600,25,a))):d("Invalid Object")})},a.prototype.remoteInvoke=function(a,b){for(var c=[],e=2;e<arguments.length;e++)c[e-2]=arguments[e];return this.proxystate==n.Destroyed?(f.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id())):this.proxystate==n.Error?(f.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id())):(e=i.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,b),this.hdxms.WSSendObjectWrapper(e,this.iid,b,g.WsJsonUtil.createMessageByid.apply(g.WsJsonUtil,d([a,!1,g.ws_msg_type_t.req,this.iid,b,this.oid],c))))},a.prototype.waitUntilConnectedEx=function(a,b){var c=this;return new Promise(function(d,e){if(c){for(var g=[],h=0;h<b.length;h++){var i=b[h];if(i instanceof Array)for(var j=0;j<i.length;j++){var k=i[j];g.push(k.waitUntilConnected(a+"."+k.user_friendly_id()))}else g.push(i.waitUntilConnected(a+"."+i.user_friendly_id()))}Promise.all(g).then(function(){f.logger.log(c.user_friendly_id()+".waitUntilConnectedEx() success."),d()}).catch(function(a){c.logRemoteInvokeError(a,".waitUntilConnectedEx(): failed."),e()})}else e("Invalid Object")})},a.prototype.oidsFromProxyOjbects=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d instanceof Array){for(var e=[],f=0;f<d.length;f++)e.push({oid:d[f].object_id()});b.push(e)}else b.push({oid:d.object_id()})}return b},a.prototype.remoteInvokeEx=function(a,b,c){for(var e=[],h=3;h<arguments.length;h++)e[h-3]=arguments[h];if(this.proxystate==n.Destroyed)return f.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id());if(this.proxystate==n.Error)return f.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id());var j=this;return new Promise(function(h,k){j.waitUntilConnectedEx(j.user_friendly_id()+".remoteInvokeEx",c).then(function(){f.logger.log(j.user_friendly_id()+".remoteInvokeEx() all parameter rpc objects are ready.");var h=j.oidsFromProxyOjbects(c).concat(e),k=i.WebrpcClassLibInfoUtil.getMethodFeatureByid(j.iid,b);return j.hdxms.WSSendObjectWrapper(k,j.iid,b,g.WsJsonUtil.createMessageByid.apply(g.WsJsonUtil,d([a,!1,g.ws_msg_type_t.req,j.iid,b,j.oid],h)))}).then(function(a){f.logger.log(j.user_friendly_id()+".remoteInvokeEx() success."),h(a)}).catch(function(){f.logger.log(j.user_friendly_id()+".remoteInvokeEx() failed."),k()})})},a.prototype.logRemoteInvokeError=function(a,b){var c="",d=a;return d?c=b+" with error: "+JSON.stringify(d.message):(c=this.param0(a),d=0!==Object.keys(c).length?new DOMException(b+" with error: "+JSON.stringify(c),this.user_friendly_id()):new DOMException(b,this.user_friendly_id()),c=d.message),f.logger.logx(this.isdestroyed(),this.user_friendly_id()+c),d},a.prototype.allocate_cbid=function(){return a.cbid_allocator_.allocate()},a.prototype.deallocate_cbid=function(b){a.cbid_allocator_.deallocate(b)},a.prototype.registerCallbacks=function(a,b,c){var d=this,e=this.allocate_cbid();return a=new l(e,b,a),0>e&&f.logger.log(this.user_friendly_id()+".registerCallbacks(). !!!! ran out of cbid !!!!"),b||(this.cbs.set(e,c),a.completion_cb=function(a,b){d.unregisterCallbacks(a)},this.hdxms.registerHandler(this.iid,this.oid,c,a)),a},a.prototype.unregisterCallbacks=function(a){this.cbs.has(a)?(this.hdxms.unregisterHandler(this.iid,this.oid,a),this.deallocate_cbid(a),this.cbs.delete(a)):f.logger.log(this.user_friendly_id()+".unregisterCallbacks(). mid="+this.cbs.get(a)+" cbid="+a+" Cant find callback handler registration!!!!")},a.prototype.clearCallbacks=function(){f.logger.log(this.user_friendly_id()+".clearCallbacks().");for(var a=0,b=Array.from(this.cbs.keys());a<b.length;a++){var c=b[a];this.hdxms.unregisterHandler(this.iid,this.oid,c),this.deallocate_cbid(c)}this.cbs.clear()},a.prototype.object_id=function(){return this.oid},a.prototype.param0=function(a){var b={};return a&&a.params&&(b=a.params[0]),b},a.prototype.isNullCallback=function(a){return void 0==a||null==a},a.prototype.user_friendly_id=function(){var a=this.constructor.name;return 0<=this.iid&&(a=i.class_id_t[this.iid]),a+"["+this.oid+"]"},a.prototype.isRedirected=function(){return this.hdxms.isRedirected()},a.prototype.isValid=function(){return!(this.proxystate===n.Error||this.proxystate===n.Destroyed)},a.prototype.registerStateChangeNotification=function(a){this.hdxms.registerStateChangeNotification(a)},a.prototype.unregisterStateChangeNotification=function(a){this.hdxms.unregisterStateChangeNotification(a)},a.nextId=0,a.CBID_MAX=65536,a.cbid_allocator_=new m(0,a.CBID_MAX,1),a}(),b.ProxyObject=a},144:function(a,b,c){var e=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},g=this&&this.__generator||function(a,b){function c(a){return function(b){return e([a,b])}}function e(c){if(f)throw new TypeError("Generator is already executing.");for(;j;)try{if(f=1,g&&(h=2&c[0]?g.return:c[0]?g.throw||((h=g.return)&&h.call(g),0):g.next)&&!(h=h.call(g,c[1])).done)return h;switch(g=0,h&&(c=[2&c[0],h.value]),c[0]){case 0:case 1:h=c;break;case 4:return j.label++,{value:c[1],done:!1};case 5:j.label++,g=c[1],c=[0];continue;case 7:c=j.ops.pop(),j.trys.pop();continue;default:if(h=j.trys,!(h=0<h.length&&h[h.length-1])&&(6===c[0]||2===c[0])){j=0;continue}if(3===c[0]&&(!h||c[1]>h[0]&&c[1]<h[3]))j.label=c[1];else if(6===c[0]&&j.label<h[1])j.label=h[1],h=c;else{if(!(h&&j.label<h[2])){h[2]&&j.ops.pop(),j.trys.pop();continue}j.label=h[2],j.ops.push(c)}}c=b.call(a,j)}catch(a){c=[6,a],g=0}finally{f=h=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var f,g,h,i,j={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return d.initSymbol(),d.initSymbol(),d.initSymbolIterator(),i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(b,"__esModule",{value:!0}),b.NavigatorUserMedia=b.RemoteMediaStreamConstraints=b.RemoteMediaTrackConstraints=b.RemoteMediaTrackConstraintSet=b.RemoteDevices=b.RemoteDeviceInfo=b.DeviceInfo=b.RemoteStreamEvent=b.RemoteStream=b.RemoteMediaTrack=b.enumeratedDevices=void 0;var h,i=c(550),j=c(658),k=c(851),l=c(946),m=c(394),n=c(259),o=c(650),p=c(973);b.enumeratedDevices=h;var q=function(){return function(a,b){this.type=a,this.target=b}}(),r=function(){function a(){this.is_local_clone=!1,this.clone_id=this.clone_count=0}return a.prototype.clone=function(){this.clone_count++;var b=new a;return b.is_local_clone=!0,b.clone_id=this.clone_count,b},a.prototype.synchronize=function(a){return f(this,void 0,void 0,function(){return g(this,function(b){return this.is_local_clone?[2,a.asyncClone()]:[2,Promise.resolve(a)]})})},a}(),s=function(a){function b(b,c,d){return void 0===d&&(d=j.ProxyMode.Remote),b=a.call(this,b,i.class_id_t.MediaStreamTrack,c,d)||this,b.refCount_=0,b.refCount_++,b.clone_state=new r,b}return e(b,a),b.prototype.dumpInfo=function(){k.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] kind="+this.kind+" label="+this.label+" refcount="+this.refcount+" enabled="+this.enabled+" readyState="+this.readyState)},Object.defineProperty(b.prototype,"refcount",{get:function(){return this.refCount_},enumerable:!1,configurable:!0}),b.prototype.addRef=function(){this.refCount_++,k.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)},Object.defineProperty(b.prototype,"onended",{get:function(){return k.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(a){var b=this;k.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=a,this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),i.method_id_MediaStreamTrack_t.onended);return c.then(function(a){k.logger.log(b.user_friendly_id()+"onended event received!!!"),a=new q("ended",b),b.readyState_="ended",b.onended_(a)}),b.remoteInvoke(!0,i.method_id_MediaStreamTrack_t.onended,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".onended failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onmute",{get:function(){return k.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(a){var b=this;k.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=a,this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),i.method_id_MediaStreamTrack_t.onmute);return c.then(function(a){k.logger.log(b.user_friendly_id()+"onmute event received!!!"),a=new q("mute",b),b.muted=!0,b.onmute_(a)}),b.remoteInvoke(!0,i.method_id_MediaStreamTrack_t.onmute,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".onmute failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onunmute",{get:function(){return k.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(a){var b=this;k.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=a,this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),i.method_id_MediaStreamTrack_t.onunmute);return c.then(function(a){k.logger.log("onunmute event received!!!"),a=new q("unmute",b),b.muted=!1,b.onunmute_(a)}),b.remoteInvoke(!0,i.method_id_MediaStreamTrack_t.onunmute,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".onunmute failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onstop",{set:function(a){this.onstop_=a},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"enabled",{get:function(){return k.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(a){k.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+a+"]"),this.enabled_=a,this.remoteInvoke(!0,i.method_id_MediaStreamTrack_t.enabled,a)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"readyState",{get:function(){return k.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!1,configurable:!0}),b.prototype.asyncClone=function(){return f(this,void 0,void 0,function(){var a,c,d;return g(this,function(e){switch(e.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return e.sent(),[4,this.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.clone)];case 2:return a=e.sent(),c=this.param0(a),d=new b(this,c.oid),[2,d.syncBarrier()]}})})},b.prototype.deepClone=function(a){var c=this;if(k.logger.log(this.user_friendly_id()+".deepClone() called. [id="+this.id+"]"),o.RemoteSession.isFeatureTrackCloneWithIdSupported()){var d=new b(null,0,j.ProxyMode.Pseudo),e=new r;return d.id=a||this.id+"."+e.clone_id.toString(),d.label=this.label,d.kind=this.kind,d.enabled_=this.enabled_,d.muted=this.muted,d.readyState_=this.readyState_,d.trackSettings_=this.trackSettings_,d.clone_state=e,d.constraints_=this.constraints_,d.capabilities_=this.capabilities_,d.onended=this.onended,d.onmute=this.onmute,d.onunmute=this.onunmute,d.onstop=this.onstop,this.waitUntilConnected("RemoteMediaTrack.deepClone").then(function(){return c.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.clone,d.id)}).then(function(a){k.logger.log(c.user_friendly_id()+".deepClone() success with oid: "+c.param0(a).oid),d.bind(null,c.param0(a).oid),d.syncBarrier().then(function(){k.logger.log(c.user_friendly_id()+"track.syncBarrier(): success")}).catch(function(a){c.logRemoteInvokeError(a,"track.syncBarrier() failed!")})}).catch(function(a){c.logRemoteInvokeError(a,".deepClone() failed!")}),d}k.logger.log(this.user_friendly_id()+".deepClone() is not supported!")},b.prototype.localClone=function(){k.logger.log(this.user_friendly_id()+".localClone() called. [id="+this.id+"]");var a=this.clone_state.clone(),c=new b(this,this.object_id());return c.id=this.id+"."+a.clone_id.toString(),c.label=this.label,c.kind=this.kind,c.enabled_=this.enabled_,c.muted=this.muted,c.readyState_=this.readyState_,c.trackSettings_=this.trackSettings_,c.clone_state=a,c.constraints_=this.constraints_,c.capabilities_=this.capabilities_,c},b.prototype.clone=function(){return k.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]"),o.RemoteSession.isFeatureTrackCloneWithIdSupported()?this.deepClone():this.localClone()},b.prototype.stop=function(){var a=this;k.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+this.refCount_),this.readyState_="ended",0<this.refCount_&&0===--this.refCount_&&(k.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.stop).catch(function(b){a.logRemoteInvokeError(b,".stop failed!")}),"video"==this.kind&&"remoteapp-track"==this.label&&p.ScreenSharing.screenSharingInstance().stopAppshare(),null!==this.onstop_&&void 0!=this.onstop_)&&this.onstop_()},b.prototype.getCapabilities=function(){return this.capabilities_},b.prototype.getConstraints=function(){return this.constraints_},b.prototype.getSettings=function(){return"audio"==this.kind?function(a){return{deviceId:a.deviceId,echoCancellation:a.echoCancellation}}(this.trackSettings_):function(a){return{aspectRatio:a.aspectRatio,deviceId:a.deviceId,frameRate:a.frameRate,height:a.height,width:a.width}}(this.trackSettings_)},b.prototype.getChannelCount=function(){return 2},b.prototype.applyConstraints=function(a){var b=this;return k.logger.log(this.user_friendly_id()+".applyConstraints() called."),new Promise(function(c,d){b.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return Promise.all([b.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.applyConstraints,a),b.syncBarrier()])}).catch(function(a){b.logRemoteInvokeError(a,"applyConstraints failed!"),d({name:"OverconstrainedError",message:"Failed to apply constraints."})}).then(function(){return b.constraints_=a,b.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.getConstraints)}).then(function(a){b.constraints_=b.param0(a)}).catch(function(a){b.logRemoteInvokeError(a,".syncBarrier() remote client does not support getConstraints method. Ignore it")}).then(function(){return c()})})},b.convertReadyState=function(a){return 0==a?"live":"ended"},b.prototype.syncBarrier=function(){var a=this;return k.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){a.syncBarrierDeep(c,d)&&a.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.kind,""),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.id,""),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.label,""),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.enabled,!1),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.muted,!1),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.readyState,0),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.getSettings),a.remoteInvoke(!1,i.method_id_MediaStreamTrack_t.getCapabilities)])}).then(function(c){var d=0;c=c.map(function(b){return a.param0(b)}),a.kind=c[0],a.id=c[1],a.label=c[2],a.enabled_=c[3],a.muted=c[4],d=c[5],a.trackSettings_=c[6],a.capabilities_=c[7],a.readyState_=b.convertReadyState(d),a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},b.prototype.dispose=function(){k.logger.log(this.user_friendly_id()+".dispose() called. [id="+this.id+"]"),this.stop(),0===this.refCount_&&this.release()},b}(j.ProxyObject);b.RemoteMediaTrack=s;var t=function(){return function(){}}(),u=function(a){function b(c,d,e,f,g){void 0===e&&(e=j.ProxyMode.Local),void 0===f&&(f=[]);var h=this;return k.logger.log("RemoteStream.ctor() streamid="+g+" num tracks="+f.length),e==j.ProxyMode.Remote||g||(g=b.uuidv4()),h=g&&o.RemoteSession.isFeatureTrackCloneWithIdSupported()?a.call(this,c,i.class_id_t.MediaStream,d,e,null,[f],g)||this:a.call(this,c,i.class_id_t.MediaStream,d,e,null,[f])||this,h.id=g,h.tracks_=f,h.clone_state=new r,h.active_=!0,h.tracks_.forEach(function(a){a.setParent(h)}),h}return e(b,a),b.uuidv4=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})},b.prototype.dumpInfo=function(){k.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] active="+this.active_+" num tracks="+this.tracks_.length);for(var a=0,b=this.tracks_;a<b.length;a++){var c=b[a];c&&c.dumpInfo()}},b.prototype.toggleAudio=function(a){k.logger.log(this.user_friendly_id()+".toggleAudio() called: "+a);for(var b=0,c=this.getAudioTracks();b<c.length;b++)c[b].enabled=a},b.prototype.toJSON=function(){var a=new t;return a.id=this.id,a.active=this.active_,a.oid=this.object_id(),"RemoteStream:"+JSON.stringify(a)},Object.defineProperty(b.prototype,"active",{get:function(){var a=this;return k.logger.log(this.user_friendly_id()+".get active() called. [id="+this.id+"] active="+this.active_),l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_stream_active_status)?this.waitUntilConnected("MediaStream.active").then(function(){return k.logger.log(a.user_friendly_id()+".get active() remote invoking"),a.remoteInvoke(!1,i.method_id_MediaStream_t.active,!1)}).then(function(b){a.active_=a.param0(b),k.logger.log(a.user_friendly_id()+".get active() success, active="+a.active_)}).catch(function(b){a.active_=!0,a.logRemoteInvokeError(b,".get active() failed! active="+a.active_)}):this.active_=!0,this.active_},enumerable:!1,configurable:!0}),b.prototype.getAudioTracks=function(){k.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var a=[],b=0,c=this.tracks_;b<c.length;b++){var d=c[b];"audio"==d.kind&&a.push(d)}return a},b.prototype.getVideoTracks=function(){k.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var a=[],b=0,c=this.tracks_;b<c.length;b++){var d=c[b];"video"==d.kind&&a.push(d)}return a},b.prototype.getTracks=function(){return k.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},b.prototype.getTrackById=function(a){k.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var b=0,c=this.tracks_;b<c.length;b++){var d=c[b];if(d.id==a)return d}},b.prototype.addTrack=function(a){var b=this;k.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(a),a&&a.dumpInfo();var c=this;this.waitUntilConnected("MediaStream.addTrack").then(function(){return k.logger.log(c.user_friendly_id()+".addTrack remote invoking"),c.remoteInvokeEx(!1,i.method_id_MediaStream_t.addTrack,[a])}).then(function(){k.logger.log(c.user_friendly_id()+".addTrack success")}).catch(function(a){b.logRemoteInvokeError(a,".addTrack failed!")})},b.prototype.removeTrack=function(a){var b=this;k.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var c=this.tracks_.indexOf(a);this.tracks_.splice(c,1);var d=this;this.waitUntilConnected("MediaStream.removeTrack").then(function(){return k.logger.log(d.user_friendly_id()+".removeTrack remote invoking"),d.remoteInvokeEx(!1,i.method_id_MediaStream_t.removeTrack,[a])}).then(function(){k.logger.log(d.user_friendly_id()+".removeTrack success")}).catch(function(a){b.logRemoteInvokeError(a,".removeTrack failed!")})},b.prototype.asyncClone=function(){return f(this,void 0,void 0,function(){var a,c,d;return g(this,function(e){switch(e.label){case 0:return k.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return e.sent(),[4,this.remoteInvoke(!1,i.method_id_MediaStream_t.clone)];case 2:return a=e.sent(),k.logger.log(a),c=this.param0(a),d=new b(this,c.oid,j.ProxyMode.Remote),[2,d.syncBarrier()]}})})},b.prototype.deepClone=function(a){var c=this;if(k.logger.log(this.user_friendly_id()+".deepClone() called. [id="+this.id+"]"),o.RemoteSession.isFeatureTrackCloneWithIdSupported()){var d=[];this.tracks_.forEach(function(a){d.push(a.deepClone())});var e=new r;a=a||this.id+"."+e.clone_id.toString()
;var f=new b(null,0,j.ProxyMode.Local,d,a);return f.id=a,f.active_=this.active_,f.clone_state=e,f.tracks_=d,f.waitUntilConnected("RemoteStream.deepClone").then(function(){f.syncBarrier().then(function(){k.logger.log(c.user_friendly_id()+"stream.syncBarrier(): success")}).catch(function(a){c.logRemoteInvokeError(a,"stream.syncBarrier() failed!")})}).catch(function(a){c.logRemoteInvokeError(a,".deepClone() failed!")}),f}k.logger.log(this.user_friendly_id()+".deepClone() is not supported!")},b.prototype.localClone=function(){k.logger.log(this.user_friendly_id()+".localClone() called. [id="+this.id+"]");var a=this.clone_state.clone(),c=new b(this,this.object_id(),j.ProxyMode.Remote);return c.id=this.id+"."+a.clone_id.toString(),c.active_=this.active_,this.tracks_.forEach(function(a){a.addRef()}),c.tracks_=this.tracks_,c.clone_state=a,c},b.prototype.clone=function(){return k.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]"),o.RemoteSession.isFeatureTrackCloneWithIdSupported()?this.deepClone():this.localClone()},b.prototype.syncBarrier=function(){var a=this;return k.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("MediaStream.syncBarrier").then(function(){var b=[];return b.push(a.remoteInvoke(!1,i.method_id_MediaStream_t.id,"")),l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_stream_active_status)&&b.push(a.remoteInvoke(!1,i.method_id_MediaStream_t.active,!0)),b.push(a.remoteInvoke(!1,i.method_id_MediaStream_t.getTracks)),Promise.all(b)}).then(function(b){k.logger.log(a.user_friendly_id()+".syncBarrier() remote success");var c;l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_stream_active_status)?(b=b.map(function(b){return a.param0(b)}),a.id=b[0],a.active_=b[1],c=b[2]):(b=b.map(function(b){return a.param0(b)}),a.id=b[0],c=b[1],a.active_=!0);var d=[];b=function(b){var c=a.tracks_.find(function(a){return a.object_id()===b.oid});void 0===c&&(k.logger.log(a.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+b.oid),c=new s(a,b.oid)),d.push(c.syncBarrier())};for(var e=0;e<c.length;e++)b(c[e]);return Promise.all(d)}).then(function(b){a.tracks_=[],b.forEach(function(b){i.BUILD_TYPE_SDK||(b.onstop=function(){var b=!0;a.tracks_.forEach(function(a){"ended"!=a.readyState&&(b=!1)}),b&&a.release()}),a.tracks_.push(b)}),a.syncBarrierResolve(a)}).catch(function(b){a.logRemoteInvokeError(b,".syncBarrier failed!"),a.syncBarrierReject()})})},b.prototype.dispose=function(){k.logger.log(this.user_friendly_id()+".dispose() called. [id="+this.id+"]"),this.tracks_.forEach(function(a){a.dispose()}),this.release()},b}(j.ProxyObject);b.RemoteStream=u,a=function(a){function b(b,c){return a.call(this,b,i.class_id_t.MediaStreamEvent,c,j.ProxyMode.Remote)||this}return e(b,a),b.prototype.syncBarrier=function(){var a=this;return k.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return a.remoteInvoke(!1,i.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(b){return new u(a,b.params[0].oid,j.ProxyMode.Remote).syncBarrier()}).then(function(b){a.stream=b,a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},b}(j.ProxyObject),b.RemoteStreamEvent=a;var v=function(){return function(a,b,c,d){this.deviceId=a,this.groupId=b,this.kind=c,this.label=d}}();b.DeviceInfo=v;var w=function(a){function b(b){return a.call(this,null,i.class_id_t.MediaDeviceInfo,b,j.ProxyMode.Remote)||this}return e(b,a),b.convertKind=function(a){return 0==a?"audioinput":1==a?"audiooutput":"videoinput"},b.prototype.syncBarrier=function(){var a=this;return k.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){a.syncBarrierDeep(c,d)&&a.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,i.method_id_MediaDeviceInfo_t.deviceId,""),a.remoteInvoke(!1,i.method_id_MediaDeviceInfo_t.kind,0),a.remoteInvoke(!1,i.method_id_MediaDeviceInfo_t.label,""),a.remoteInvoke(!1,i.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(c){a.kind=b.convertKind(a.param0(c.splice(1,1)[0])),c=c.map(function(b){return a.param0(b)}),a.deviceId=c[0],a.label=c[1],a.groupId=c[2],a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},b}(j.ProxyObject);b.RemoteDeviceInfo=w,a=function(a){function c(){var b=a.call(this,null,i.class_id_t.MediaDevices,0,j.ProxyMode.Local,function(){b.setDeviceChangeCallback()})||this;return b.devices_=[],b.enumerateMarker="enumerateDevicesPrivate",b.enumerateRemoteMarker="enumeratedDevicesPrivate-Remote",b.shareSystemAudio_=!1,b.pendingEnumerateDevice_=[],b.panelid_=-1,b}return e(c,a),Object.defineProperty(c.prototype,"panelid",{set:function(a){this.panelid_=a},enumerable:!1,configurable:!0}),c.prototype.clearPanelId=function(){this.panelid_=-1},c.prototype.enumerateDevices=function(){var a=this;return 0<this.devices_.length&&0==this.pendingEnumerateDevice_.length?new Promise(function(b,c){k.logger.log(a.user_friendly_id()+".enumerateDevices: returning cached devices"),b(a.devices_)}):this.enumerateDevicesPrivate(!1)},c.prototype.enumerateDevicesPrivate=function(a){return l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_enumerate_devices_v2)?this.enumerateDevicesPrivateV2(a):this.enumerateDevicesPrivateV1(a)},c.prototype.postEnumerateDevicesResult=function(){for(var a=!0,b=0,c=0,d=this.pendingEnumerateDevice_;c<d.length;c++){var e=d[c];if(0==a&&e.name==this.enumerateRemoteMarker)break;e.postWithResult(!0,this.devices_),b++,a=!1}0<b&&this.pendingEnumerateDevice_.splice(0,b)},c.prototype.enumerateDevicesPrivateV2=function(a){var c=this;return k.logger.log(this.user_friendly_id()+".enumerateDevicesPrivateV2() called. refresh:"+a+" pending:"+this.pendingEnumerateDevice_.length),new Promise(function(d,e){1==a||0==c.pendingEnumerateDevice_.length?(c.pendingEnumerateDevice_.push(new j.deferred_action(d,e,c.enumerateRemoteMarker)),c.waitUntilConnected("RemoteDevices.enumerateDevicesPrivateV2").then(function(){return k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV2() remote invoking..."),c.remoteInvoke(!1,i.method_id_MediaDevices_t.enumerateDevicesV2)}).then(function(a){var d=[];a.params[0].forEach(function(a){a=new v(a.deviceId,a.groupId,w.convertKind(a.kind),a.label),d.push(a)}),c.devices_=d,b.enumeratedDevices=h=d,k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV2: resolving enumerated devices: "+JSON.stringify(c.devices_)),c.postEnumerateDevicesResult()}).catch(function(a){c.devices_=[],b.enumeratedDevices=h=[],c.logRemoteInvokeError(a,".enumerateDevicesPrivateV2() failed, resolving with empty list."),c.postEnumerateDevicesResult()})):(c.pendingEnumerateDevice_.push(new j.deferred_action(d,e,c.enumerateMarker)),k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV2() not remoting this call..."))})},c.prototype.enumerateDevicesPrivateV1=function(a){var c=this;return k.logger.log(this.user_friendly_id()+".enumerateDevicesPrivateV1() called. refresh:"+a+" pending:"+this.pendingEnumerateDevice_.length),new Promise(function(d,e){1==a||0==c.pendingEnumerateDevice_.length?(c.pendingEnumerateDevice_.push(new j.deferred_action(d,e,c.enumerateRemoteMarker)),c.waitUntilConnected("RemoteDevices.enumerateDevicesPrivateV1").then(function(){return k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV1() remote invoking..."),c.remoteInvoke(!1,i.method_id_MediaDevices_t.enumerateDevices)}).then(function(a){var b=[];return a.params[0].forEach(function(a){a=new w(a.oid),b.push(a.syncBarrier())}),Promise.all(b)}).then(function(a){var d=[];a.forEach(function(a){var b=new v(a.deviceId,a.groupId,a.kind,a.label);d.push(b),a.release()}),c.devices_=d,b.enumeratedDevices=h=d,k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV1: resolving enumerated devices: "+JSON.stringify(c.devices_)),c.postEnumerateDevicesResult()}).catch(function(a){b.enumeratedDevices=h=[],c.devices_=[],c.logRemoteInvokeError(a,".enumerateDevicesPrivateV1() failed, resolving with empty list."),c.postEnumerateDevicesResult()})):(c.pendingEnumerateDevice_.push(new j.deferred_action(d,e,c.enumerateMarker)),k.logger.log(c.user_friendly_id()+".enumerateDevicesPrivateV1() not remoting this call..."))})},c.prototype.getDisplayMedia=function(a){var b=this;return new Promise(function(c,d){b.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){return p.ScreenSharing.screenSharingInstance().setActiveSource(b.panelid_,o.RemoteSession.isFeaturAppshareSupported())}).then(function(c){return void 0!==a.video&&null!==a.video&&void 0!==c&&(a.video.deviceId=c),l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_share_system_audio)&&(void 0!==a.audio&&"boolean"!=typeof a.audio?k.logger.log("Non-boolean audio constraints"):a.audio=a.audio||b.shareSystemAudio_),c=b.prepareDisplayConstraints(a),c=z.toRemoteMediaStreamConstraints(c,!0),b.remoteInvoke(!1,i.method_id_MediaDevices_t.getDisplayMedia,c)}).then(function(a){return new u(null,a.params[0].oid,j.ProxyMode.Remote).syncBarrier()}).then(function(a){c(a)}).catch(function(a){p.ScreenSharing.screenSharingInstance().isAppshareActive()&&p.ScreenSharing.screenSharingInstance().stopAppshare(),a=b.logRemoteInvokeError(a,".getDisplayMedia() failed!"),d(a)})})},c.prototype.setDeviceChangeCallback=function(){var a=this;k.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called."),this.waitUntilConnected("MediaDevices.ondevicechange").then(function(){var b=a.registerCallbacks(!1,!1,i.method_id_MediaDevices_t.ondevicechange);return b.then(function(){k.logger.log(a.user_friendly_id()+".ondevicechange(): callback received!!!"),a.enumerateDevicesPrivate(!0).then(function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))}).catch(function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))})}),a.remoteInvoke(!0,i.method_id_MediaDevices_t.ondevicechange,b.success)}).catch(function(b){a.logRemoteInvokeError(b,".set_ondevicechange() failed!")})},c.prototype.prepareDisplayConstraints=function(a){if(l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_common_media_constraints))return a;var b={frameRate:15,width:{max:1920},height:{max:1080}};if(void 0!==a.video&&null!==a.video){var c=a.video;void 0!==c.frameRate&&void 0!==c.width&&void 0!==c.height&&(b.frameRate=c.frameRate,b.width.max=c.width.max||c.width,b.height.max=c.height.max||c.height)}return a.audio?{video:b,audio:a.audio}:{video:b}},c}(j.ProxyObject),b.RemoteDevices=a;var x=function(){function a(){}return a.toRemoteMediaTrackConstraintSet=function(a){var b=void 0;return n.Util.hasValue(a)&&(b={},n.Util.hasValue(a.width)&&(b.width=a.width),n.Util.hasValue(a.height)&&(b.height=a.height),n.Util.hasValue(a.aspectRatio)&&(b.aspectRatio=a.aspectRatio),n.Util.hasValue(a.frameRate)&&(b.frameRate=a.frameRate),n.Util.hasValue(a.facingMode)&&(b.facingMode=a.facingMode),n.Util.hasValue(a.sampleRate)&&(b.sampleRate=a.sampleRate),n.Util.hasValue(a.sampleSize)&&(b.sampleSize=a.sampleSize),n.Util.hasValue(a.volume)&&(b.volume=a.volume),n.Util.hasValue(a.echoCancellation)&&(b.echoCancellation=a.echoCancellation),n.Util.hasValue(a.autoGainControl)&&(b.autoGainControl=a.autoGainControl),n.Util.hasValue(a.noiseSuppression)&&(b.noiseSuppression=a.noiseSuppression),n.Util.hasValue(a.latency)&&(b.latency=a.latency),n.Util.hasValue(a.channelCount)&&(b.channelCount=a.channelCount),n.Util.hasValue(a.deviceId)&&(b.deviceId=a.deviceId),n.Util.hasValue(a.groupId)&&(b.groupId=a.groupId),n.Util.hasValue(a.maxFrameRate)&&(b.maxFrameRate=a.maxFrameRate),n.Util.hasValue(a.maxHeight)&&(b.maxHeight=a.maxHeight),n.Util.hasValue(a.maxWidth)&&(b.maxWidth=a.maxWidth),n.Util.hasValue(a.minHeight)&&(b.minHeight=a.minHeight),n.Util.hasValue(a.minWidth)&&(b.minWidth=a.minWidth),n.Util.hasValue(a.sourceId)&&(b.sourceId=a.sourceId)),b},a}();b.RemoteMediaTrackConstraintSet=x;var y=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.defMandatory=function(a){var b=a;return n.Util.hasValue(a)?(n.Util.hasValue(a.maxFrameRate)||(b.maxFrameRate=30),n.Util.hasValue(a.minWidth)||(b.minWidth=360),n.Util.hasValue(a.maxWidth)||(b.maxWidth=1920),n.Util.hasValue(a.minHeight)||(b.minHeight=180),n.Util.hasValue(a.maxHeight)||(b.maxHeight=1080)):b={maxFrameRate:30,minWidth:360,maxWidth:1920,minHeight:180,maxHeight:1080},b},b.toRemoteMediaTrackConstraints=function(a){var b=void 0;return n.Util.hasValue(a)&&(b=x.toRemoteMediaTrackConstraintSet(a),b.advanced=[],n.Util.hasValue(a.advanced)&&a.advanced.forEach(function(a){a=x.toRemoteMediaTrackConstraintSet(a),b.advanced.push(a)}),n.Util.hasValue(a.mandatory)&&(b.mandatory="boolean"!=typeof a.mandatory?x.toRemoteMediaTrackConstraintSet(a.mandatory):a.mandatory)),b},b}(x);b.RemoteMediaTrackConstraints=y;var z=function(){function a(){}return a.getDefaultAudioDeviceId=function(){if(void 0!==h){var a=h.find(function(a){return"audioinput"===a.kind&&"default"===a.deviceId});if(void 0!==a)return a.deviceId}return""},a.getDefaultVideoDeviceId=function(){if(void 0!==h){var a=h.find(function(a){return"videoinput"===a.kind});if(void 0!==a)return a.deviceId}return""},a.toRemoteMediaStreamConstraints=function(b,c){void 0===c&&(c=!1),k.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() in constraints:"+JSON.stringify(b));var d={};return n.Util.hasValue(b)&&(n.Util.hasValue(b.audio)&&("boolean"!=typeof b.audio?(d.audio=y.toRemoteMediaTrackConstraints(b.audio),0!=Object.keys(d.audio).length&&n.Util.hasValue(d.audio)||(d.audio={dummy:1}),i.BUILD_TYPE_SDK&&0==c&&a.isConstraintsAudioDeviceIdEmpty(b)&&(d.audio.deviceId=a.getDefaultAudioDeviceId(),k.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default audio deviceId:'"+d.audio.deviceId+"'"))):d.audio=b.audio),n.Util.hasValue(b.peerIdentity)&&(d.peerIdentity=b.peerIdentity),n.Util.hasValue(b.video)&&("boolean"!=typeof b.video?(d.video=y.toRemoteMediaTrackConstraints(b.video),0==c&&"boolean"!=typeof d.video.mandatory&&(d.video.mandatory=y.defMandatory(d.video.mandatory),i.BUILD_TYPE_SDK&&a.isConstraintsVideoSourceIdEmpty(b)&&(d.video.mandatory.sourceId=a.getDefaultVideoDeviceId(),k.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default video sourceId:'"+d.video.mandatory.sourceId+"'")))):(d.video=b.video,1==b.video&&0==c&&i.BUILD_TYPE_SDK&&a.isConstraintsVideoSourceIdEmpty(b)&&(d.video={},d.video.mandatory=y.defMandatory(void 0),d.video.mandatory.sourceId=a.getDefaultVideoDeviceId(),k.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default video sourceId:'"+d.video.mandatory.sourceId+"'"))))),k.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() out constraints:"+JSON.stringify(d)),d},a.isConstraintsAudioDeviceIdEmpty=function(a){var b=!1;return n.Util.hasValue(a)&&n.Util.hasValue(a.audio)&&("boolean"==typeof a.audio?1==a.audio&&(b=!0):!(a=a.audio)||!1!==n.Util.hasValue(a.deviceId)&&""!==a.deviceId||(b=!0)),b},a.isConstraintsVideoSourceIdEmpty=function(a){var b=!1;return n.Util.hasValue(a)&&n.Util.hasValue(a.video)&&("boolean"==typeof a.video?1==a.video&&(b=!0):(a=a.video)&&((a=a.mandatory)&&!1!==n.Util.hasValue(a.sourceId)&&""!==a.sourceId||(b=!0))),b},a}();b.RemoteMediaStreamConstraints=z;var A=function(){function a(){this.video=this.audio=a.EmptyCapabilities}return a.EmptyCapabilities={codecs:[],headerExtensions:[]},a}();a=function(a){function b(){return a.call(this,null,i.class_id_t.NavigatorUserMedia,0,j.ProxyMode.Local)||this}return e(b,a),b.getCapabilities=function(a){return k.logger.log("NavigatorUserMedia.getCapabilities for type="+a+" capabilities="+JSON.stringify(b.capabilities[a])),b.capabilities[a]},b.resetCapabilities=function(){b.capabilities=new A},b.prototype.getCapabilities=function(){var a=this;return k.logger.log(this.user_friendly_id()+".getCapabilities..."),new Promise(function(c,d){a.waitUntilConnected("NavigatorUserMedia.getCapabilities").then(function(){return Promise.all([a.remoteInvoke(!1,i.method_id_NavigatorUserMedia_t.getCapabilities,"audio"),a.remoteInvoke(!1,i.method_id_NavigatorUserMedia_t.getCapabilities,"video")])}).then(function(d){b.capabilities.audio=a.param0(d[0]),b.capabilities.video=a.param0(d[1]),k.logger.log(a.user_friendly_id()+".getCapabilities capabilities="+JSON.stringify(b.capabilities)),c(b.capabilities)}).catch(function(b){d(a.logRemoteInvokeError(b,".getCapabilities failed!"))})})},b.prototype.setCodecCapabilities=function(a){var b=this;return k.logger.log(this.user_friendly_id()+".setCodecCapabilities : set codecCapabilities to "+JSON.stringify(a)),new Promise(function(c,d){b.waitUntilConnected("NavigatorUserMedia.setCodecCapabilities").then(function(){return b.remoteInvoke(!1,i.method_id_NavigatorUserMedia_t.setCodecCapabilities,a)}).then(function(){k.logger.log(b.user_friendly_id()+".setCodecCapabilities() success."),c(!0),b.getCapabilities()}).catch(function(a){a=b.logRemoteInvokeError(a,".setCodecCapabilities() failed!"),d(a)})})},b.prototype.webkitGetUserMedia=function(a,b,c){return this.getUserMedia(a,b,c)},b.prototype.LogTelemetryDevice_=function(a){try{if(void 0!==a.audio){var b,c=a.audio.deviceId;h.forEach(function(a){c==a.deviceId&&(b=a.label)}),k.logger.log(b),this.SendTelemetryData(m.tel_key_AudioDeviceUsed,b,0)}if(void 0!==a.video){var d,e=a.video.mandatory;e&&h.forEach(function(a){e.sourceId==a.deviceId&&(d=a.label)}),k.logger.log(d),this.SendTelemetryData(m.tel_key_VideoDeviceUsed,d,0)}}catch(a){k.logger.log(a)}},b.prototype.getUserMedia=function(a,b,c){return k.logger.log(this.user_friendly_id()+".getUserMedia() called: "+JSON.stringify(a)),b&&c?this.getUserMedia_v1(a,b,c):this.getUserMedia_v2(a)},b.prototype.getUserMedia_v2=function(a){var b=this;return k.logger.log(this.user_friendly_id()+".getUserMedia_v2() called: "+JSON.stringify(a)),new Promise(function(c,d){b.getUserMediaPrivate(a,function(a){k.logger.log(b.user_friendly_id()+"getUserMedia_v2: resolving stream"),c(a)},function(a){k.logger.log(b.user_friendly_id()+"getUserMedia_v2: rejecting stream"),d(a)})})},b.prototype.getUserMedia_v1=function(a,b,c){return k.logger.log(this.user_friendly_id()+".getUserMedia_v1() called: "+JSON.stringify(a)),this.getUserMediaPrivate(a,b,c)},b.prototype.getUserMediaPrivate=function(a,b,c){var d=this;this.waitUntilConnected("NavigatorUserMedia.getUserMediaPrivate").then(function(){var b=d.registerCallbacks(!0,!1,i.method_id_NavigatorUserMedia_t.getUserMedia),c=z.toRemoteMediaStreamConstraints(a);return d.remoteInvoke(!1,i.method_id_NavigatorUserMedia_t.getUserMedia,c,b.success,b.fail),b.prom()}).then(function(a){return k.logger.log(d.user_friendly_id()+".getUserMediaPrivate: received success callback!"),new u(null,d.param0(a).oid,j.ProxyMode.Remote).syncBarrier()}).then(function(e){k.logger.log(d.user_friendly_id()+".getUserMediaPrivate: MediaStream ready to deliver",JSON.stringify(e)),0==e.getTracks().length?(k.logger.log(d.user_friendly_id()+".getUserMediaPrivate: reporting no tracks as error."),c({constraintName:"",name:"OverconstrainedError",message:""})):(d.LogTelemetryDevice_(a),b(e))}).catch(function(a){d.logRemoteInvokeError(a,".getUserMediaPrivate() failed!"),c(l.getRedirector().getFeatureValue(i.FEATURE_ms_teams_1912)?d.param0&&a?d.param0(a):{constraintName:"",name:"OverconstrainedError",message:""}:{constraintName:"",name:"OverconstrainedError",message:""})})},b.prototype.SendTelemetryData=function(a,b,c){l.getRedirector().telemetry.SendTelemetryData(m.tel_cmd.Data,a,b,c)},b.capabilities=new A,b}(j.ProxyObject),b.NavigatorUserMedia=a},650:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.RemoteSession=b.SessionInfo=b.RemoteType=void 0;var d,e=c(946),f=c(550),g=c(9),h=c(851),i=c(550),j=c(394);!function(a){a[a.Unknown=0]="Unknown",a[a.Windows=1]="Windows",a[a.Linux=2]="Linux"}(d=b.RemoteType||(b.RemoteType={}));var k=function(){return function(){}}();b.SessionInfo=k,a=function(){function a(a,b){var c=this;this.isremote_=!1,this.isremote_=!0,this.type_=d.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,e.getRedirector().setRemoteSessionInfoCb(function(){return c.remoteSessionInfo()}),this.enginecontrol_=new g.EngineControl(a+"::"+b)}return a.prototype.release=function(){e.getRedirector().setRemoteSessionInfoCb(null)},a.prototype.user_friendly_id=function(){return"[RemoteSession]"},a.prototype.getFeatureFlags=function(){var a={};return null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach(function(b){a[b.name]=b.value}),a},a.prototype.isFeatureSupported=function(a){if("video"===a)return!0;if("givecontrol"===a&&this.sessioninfo_.clientPlatform.includes("Linux")||!(a in i.featureNameMap))return!1;for(var b=i.featureNameMap[a],c=this.getFeatureFlags(),d=0;d<b.length;d++)if(!(b[d]in c)||!0!==c[b[d]])return!1;return!(a in i.vdaFeatureNameMap)||i.vdaFeatureNameMap[a].map(function(a){return e.getRedirector().getVDAFeatureValue(a)}).reduce(function(a,b){return a&&b},!0)},a.isFeaturePstnSupported=function(){return a.pstn_},a.isFeatureDtmfSupported=function(){return a.dtmfswitch_},a.isFeaturAppshareSupported=function(){return a.appshare_},a.isFeatureWebrtc1dot0Supported=function(){return a.webrtc1dot0_},a.isFeatureDataChannelSupported=function(){return a.datachannel_},a.isFeatureVdNoBufferLimitSupported=function(){return a.vdnobuflimit_},a.isFeatureCallConstraintsSupported=function(){return a.callconstraints_},a.isFeatureTrackCloneWithIdSupported=function(){return a.trackclonewithid_},a.isFeatureSenderStatsFixSupported=function(){return a.senderstatsfix_},a.prototype.getSessionInfo=function(){return h.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()},a.prototype.remoteSessionInfo=function(){var b=this,c=this;return h.logger.log(c.user_friendly_id()+".remoteSessionInfo() called."),new Promise(function(d,i){c.enginecontrol_.syncBarrier().then(function(e){if(h.logger.log(c.user_friendly_id()+"enginecontrol info received!"),c.sessioninfo_=new k,c.sessioninfo_.type_script=f.HDXMS_VERSION,c.sessioninfo_.webrpc=e.version_.major.toString()+"."+e.version_.minor.toString()+"."+e.version_.revision.toString()+"."+e.version_.build.toString(),void 0!=e.versions_&&null!=e.versions_){c.SendTelemetryData(j.tel_key_VerTypeScript,f.HDXMS_VERSION,0);for(var i=0,l=0,m=e.versions_;l<m.length;l++){var n=m[l],n=n.major.toString()+"."+n.minor.toString()+"."+n.revision.toString()+"."+n.build.toString();switch(i){case g.VersionType.Webrpc:c.sessioninfo_.webrpc=n,c.SendTelemetryData(j.tel_key_VerWebrpc,n,0);break;case g.VersionType.WebrtcCodecs:c.sessioninfo_.webrtc_codecs=n,c.SendTelemetryData(j.tel_key_VerWebrtcCodecs,n,0);break;case g.VersionType.Receiver:c.sessioninfo_.receiver=n,c.SendTelemetryData(j.tel_key_VerReceiver,n,0);break;case g.VersionType.Vda:c.sessioninfo_.vda=n,c.SendTelemetryData(j.tel_key_VerVda,n,0);break;case g.VersionType.Endpoint:c.sessioninfo_.endpoint=n,c.SendTelemetryData(j.tel_key_VerEndpoint,n,0);break;case g.VersionType.HdxRtcEngine:c.sessioninfo_.hdxrtcengine=n,c.SendTelemetryData(j.tel_key_VerHdxRtcEngine,n,0);break;default:h.logger.log(c.user_friendly_id()+"Unknown version type!")}i++}}void 0!=e.osinfo_&&null!=e.osinfo_&&(c.sessioninfo_.osinfo=e.osinfo_,e.osinfo_.family.includes("Darwin")&&["Mac OS X","macOS","OS X"].some(function(a){return e.osinfo_.edition.startsWith(a)})?c.sessioninfo_.clientPlatform="Mac":c.sessioninfo_.clientPlatform=e.osinfo_.family,c.SendTelemetryData(j.tel_key_OSFamily,e.osinfo_.family,0),c.SendTelemetryData(j.tel_key_OSVersion,e.osinfo_.version,0),c.SendTelemetryData(j.tel_key_OSArchitecture,e.osinfo_.architecture,0),c.SendTelemetryData(j.tel_key_OSDistro,e.osinfo_.distro,0),c.SendTelemetryData(j.tel_key_OSEdition,e.osinfo_.edition,0)),void 0!=e.endpointid_&&null!=e.endpointid_&&(c.sessioninfo_.endpointId=e.endpointid_.machine_id),void 0!=e.hardwareinfo_&&null!=e.hardwareinfo_&&(c.sessioninfo_.hardware_info=e.hardwareinfo_,c.SendTelemetryData(j.tel_key_CPUModel,e.hardwareinfo_.cpu_info.cpumodel,0),c.SendTelemetryData(j.tel_key_CPUProcessors,e.hardwareinfo_.cpu_info.numberofprocessors,0),c.SendTelemetryData(j.tel_key_CPUGpuinfo,JSON.stringify(e.hardwareinfo_.gpu_info.gpus),0),c.SendTelemetryData(j.tel_key_CPUTotalmemory,e.hardwareinfo_.memory_info.totalmemory,0)),a.pstn_=b.isFeatureSupported(f.Features.FEATURE_public_pstn),a.dtmfswitch_=b.isFeatureSupported(f.Features.FEATURE_public_dtmf),a.appshare_=b.isFeatureSupported(f.Features.FEATURE_public_app_sharing),a.webrtc1dot0_=b.isFeatureSupported(f.Features.FEATURE_public_webrtc1dot0),a.datachannel_=b.isFeatureSupported(f.Features.FEATURE_public_data_channel),a.vdnobuflimit_=b.isFeatureSupported(f.Features.FEATURE_public_vdnobuflimit),a.callconstraints_=b.isFeatureSupported(f.Features.FEATURE_public_stream_resolution),a.trackclonewithid_=b.isFeatureSupported(f.Features.FEATURE_public_track_clone_with_id),a.senderstatsfix_=b.isFeatureSupported(f.Features.FEATURE_public_sender_stats_fix),d(c.sessioninfo_),c.enginecontrol_.release()}).catch(function(){e.getRedirector().isPingActive()?c.retrySessionInfo():(i(),c.enginecontrol_.release(),c.enginecontrol_=null)})})},a.prototype.retrySessionInfo=function(){var a=this;setTimeout(function(){h.logger.log("checking if we are connected..."),a.enginecontrol_.bind(),e.getRedirector().handleRemoteSessionInfo()},15e3)},a.prototype.SendTelemetryData=function(a,b,c){e.getRedirector().telemetry.SendTelemetryData(j.tel_cmd.Data,a,b,c)},a.pstn_=!1,a.dtmfswitch_=!1,a.appshare_=!1,a.webrtc1dot0_=!1,a.datachannel_=!1,a.vdnobuflimit_=!1,a.callconstraints_=!1,a.trackclonewithid_=!1,a.senderstatsfix_=!1,a}(),b.RemoteSession=a},24:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.RtcDataChannel=b.RTCSctpTransport=void 0;var e,f=c(658),g=c(550),h=c(851),i=c(589);!function(a){a[a.new=0]="new",a[a.connecting=1]="connecting",a[a.connected=2]="connected",a[a.closed=3]="closed",a[a.max=4]="max"}(e||(e={})),a=function(a){function b(b,c){var d=a.call(this,b,g.class_id_t.RTCSctpTransport,c,f.ProxyMode.Remote)||this;return h.logger.log(d.user_friendly_id()+".constructor"),d}return d(b,a),b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("RTCSctpTransport.syncBarrier").then(function(){return h.logger.log(a.user_friendly_id()+".syncBarrierBase success."),Promise.all([a.remoteInvoke(!1,g.method_id_RTCSctpTransport_t.transport,{oid:0}),a.remoteInvoke(!1,g.method_id_RTCSctpTransport_t.state,0),a.remoteInvoke(!1,g.method_id_RTCSctpTransport_t.maxMessageSize,0),a.remoteInvoke(!1,g.method_id_RTCSctpTransport_t.maxChannels,0)])}).then(function(b){var c;c=b.map(function(b){return a.param0(b)}),b=c[0],a.sctpstate_=c[1],a.maxMessageSize_=c[2],a.maxChannels_=c[3],c=a.transport_,void 0==b||!1!==b.is_null||null!==a.transport_&&a.transport_.object_id()==b.oid||(c=new i.DtlsTransport(a,b.oid)),c.syncBarrier().then(function(b){h.logger.log(a.user_friendly_id()+"transport.syncBarrier(): success"),a.transport_=b,a.syncBarrierResolve(a)}).catch(function(){h.logger.log(a.user_friendly_id()+"transport.syncBarrier(): failed!"),a.transport_=null,a.syncBarrierResolve(a)})}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},Object.defineProperty(b.prototype,"transport",{get:function(){return h.logger.log(this.user_friendly_id()+".get_transport() called: "+this.transport_),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"state",{get:function(){return h.logger.log(this.user_friendly_id()+".get_state() called: "+this.sctpstate_),this.sctpstate_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"maxMessageSize",{get:function(){return h.logger.log(this.user_friendly_id()+".get_maxMessageSize() called: "+this.maxMessageSize_),this.maxMessageSize_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"maxChannels",{get:function(){return h.logger.log(this.user_friendly_id()+".get_maxChannels() called: "+this.maxChannels_),this.maxChannels_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onstatechange",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onstatechange() called: "+this.onstatechange_),this.onstatechange_},set:function(a){var c=this;h.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=a,this.waitUntilConnected(this.user_friendly_id()+".onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),g.method_id_RTCSctpTransport_t.onstatechange);return d.then(function(a){h.logger.log(c.user_friendly_id()+".onstatechange callback received!!!"),c.sctpstate_=b.convertState(c.param0(a)),h.logger.log(c.user_friendly_id()+"sctpstate_: "+c.sctpstate_),a=new Event("onstatechange"),c.onstatechange_(a)}),c.remoteInvoke(!0,g.method_id_RTCSctpTransport_t.onstatechange,d.success)}).catch(function(){h.logger.log(c.user_friendly_id()+".onstatechange() failed.")})},enumerable:!1,configurable:!0}),b.convertState=function(a){return a==e.new?"closed":a==e.connecting?"connecting":a==e.connected?"connected":"closed"},b}(f.ProxyObject),b.RTCSctpTransport=a;var j;!function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"}(j||(j={})),a=function(a){function b(b,c,d){return b=a.call(this,b,g.class_id_t.RTCDataChannel,c,d)||this,b.binaryType_="blob",h.logger.log(b.user_friendly_id()+".constructor"),b}return d(b,a),b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("RtcDataChannel.syncBarrier").then(function(){return h.logger.log(a.user_friendly_id()+".syncBarrier remote invoking."),Promise.all([a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.label,""),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.ordered,!0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.maxPacketLifeTime,0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.maxRetransmits,0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.protocol,""),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.negotiated,!1),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.id,0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.readyState,0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.bufferedAmount,0),a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.bufferedAmountLowThreshold,0)])}).then(function(b){h.logger.log(a.user_friendly_id()+".syncBarrier success.");var c;b=b.map(function(b){return a.param0(b)}),a.label_=b[0],a.ordered_=b[1],a.maxPacketLifeTime_=b[2],a.maxRetransmits_=b[3],a.protocol_=b[4],a.negotiated_=b[5],a.id_=b[6],c=b[7],a.bufferedAmount_=b[8],a.bufferedAmountLowThreshold_=b[9],a.readyState_=a.toRTCDataChannelState(c),a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},Object.defineProperty(b.prototype,"label",{get:function(){return h.logger.log(this.user_friendly_id()+".get_label() called: "+this.label_),this.label_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"ordered",{get:function(){
return h.logger.log(this.user_friendly_id()+".get_ordered() called: "+this.ordered_),this.ordered_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"maxPacketLifeTime",{get:function(){return h.logger.log(this.user_friendly_id()+".get_maxPacketLifeTime() called: "+this.maxPacketLifeTime_),this.maxPacketLifeTime_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"maxRetransmits",{get:function(){return h.logger.log(this.user_friendly_id()+".get_maxRetransmits() called: "+this.maxRetransmits_),this.maxRetransmits_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"protocol",{get:function(){return h.logger.log(this.user_friendly_id()+".get_protocol() called: "+this.protocol_),this.protocol_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"negotiated",{get:function(){return h.logger.log(this.user_friendly_id()+".get_negotiated() called: "+this.negotiated_),this.negotiated_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"id",{get:function(){return h.logger.log(this.user_friendly_id()+".get_id() called: "+this.id_),this.id_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"readyState",{get:function(){return h.logger.log(this.user_friendly_id()+".get_readyState() called: "+this.readyState_),this.readyState_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"bufferedAmount",{get:function(){return h.logger.log(this.user_friendly_id()+".get_bufferedAmount() called: "+this.bufferedAmount_),this.bufferedAmount_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"bufferedAmountLowThreshold",{get:function(){return h.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+this.bufferedAmountLowThreshold_),this.bufferedAmountLowThreshold_},set:function(a){h.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+a),this.bufferedAmountLowThreshold_=a},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"binaryType",{get:function(){return h.logger.log(this.user_friendly_id()+".get_binaryType() called: "+this.binaryType_),this.binaryType_},set:function(a){h.logger.log(this.user_friendly_id()+".set_binaryType() called: "+a),this.binaryType_="blob"==a||"arraybuffer"==a?a:"blob"},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onopen",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onopen() called."),this.onopen_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onopen() called."),this.onopen_=a,this.waitUntilConnected(this.user_friendly_id()+".onopen").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onopen);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onopen callback received!!!"),b.syncBarrier().then(function(){h.logger.log(b.user_friendly_id()+".onopen notifying...");var a=new Event("open",{});Object.defineProperty(a,"target",{writable:!1,value:b}),b.onopen_(a)}).catch(function(){h.logger.log(b.user_friendly_id()+".syncBarrier(): failed!")})}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onopen,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onopen() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onbufferedamountlow",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onbufferedamountlow() called."),this.onbufferedamountlow_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onbufferedamountlow() called."),this.onbufferedamountlow_=a,this.waitUntilConnected(this.user_friendly_id()+".onbufferedamountlow").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onbufferedamountlow);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onbufferedamountlow callback received!!!"),a=new Event("onbufferedamountlow"),Object.defineProperty(a,"target",{writable:!1,value:b}),b.onbufferedamountlow_(a)}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onbufferedamountlow,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onbufferedamountlows() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onerror",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onerror() called."),this.onerror_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=a,this.waitUntilConnected(this.user_friendly_id()+".onerror").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onerror);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onerror callback received!"),a=b.param0(a),h.logger.log(b.user_friendly_id()+"error: "+a),a=new Event("onerror"),Object.defineProperty(a,"target",{writable:!1,value:b}),b.onerror_(a)}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onerror,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onerror() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onclosing",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onclosing() called."),this.onclosing_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onclosing() called."),this.onclosing_=a,this.waitUntilConnected(this.user_friendly_id()+".onclosing").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onclosing);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onclosing callback received!!!"),a=new Event("onclosing"),Object.defineProperty(a,"target",{writable:!1,value:b}),b.onclosing_(a)}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onclosing,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onclosing() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onclose",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onclose() called."),this.onclose_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onclose() called."),this.onclose_=a,this.waitUntilConnected(this.user_friendly_id()+".onclose").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onclose);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onclose callback received!!!"),a=new Event("onclose"),Object.defineProperty(a,"target",{writable:!1,value:b}),b.onclose_(a)}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onclose,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onclose() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onmessage",{get:function(){return h.logger.log(this.user_friendly_id()+".get_onmessage() called."),this.onmessage_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onmessage() called."),this.onmessage_=a,this.waitUntilConnected(this.user_friendly_id()+".onmessage").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDataChannel_t.onmessage);return c.then(function(a){h.logger.log(b.user_friendly_id()+".onmessage callback received!!!");var c=b.param0(a);a=new Event("onmessage"),c.binary?a.data=c.data_ab:(c=atob(c.data_sz),a.data=c),b.onmessage_(a)}),b.remoteInvoke(!0,g.method_id_RTCDataChannel_t.onmessage,c.success)}).catch(function(){h.logger.log(b.user_friendly_id()+".onmessage() failed.")})},enumerable:!1,configurable:!0}),b.prototype.close=function(){var a=this;h.logger.log(this.user_friendly_id()+".close() called."),this.waitUntilConnected("RTCDataChannel.close").then(function(){return a.remoteInvoke(!1,g.method_id_RTCDataChannel_t.close)}).then(function(){h.logger.log(a.user_friendly_id()+".close: success.")}).catch(function(){h.logger.log(a.user_friendly_id()+".close: failed.")})},b.prototype.toByteArray=function(a){var b=[];a=new Uint8Array(a instanceof ArrayBuffer?a:a.buffer);for(var c in a)b.push(a[c]);return b},b.prototype.send=function(a){var b=this;h.logger.log(this.user_friendly_id()+".send() called."),this.waitUntilConnected("RTCDataChannel.send").then(function(){if("string"==typeof a)return h.logger.log(b.user_friendly_id()+"data(string): "+a),b.remoteInvoke(!1,g.method_id_RTCDataChannel_t.send_text,a);if(!(a instanceof Blob)){var c=b.toByteArray(a);return b.remoteInvoke(!1,g.method_id_RTCDataChannel_t.send_binary,c)}a.arrayBuffer().then(function(a){return a=b.toByteArray(a),b.remoteInvoke(!1,g.method_id_RTCDataChannel_t.send_binary,a)}).catch(function(){h.logger.log(b.user_friendly_id()+".arrayBuffer(): failed.")})}).then(function(){h.logger.log(b.user_friendly_id()+".send: success.")}).catch(function(){h.logger.log(b.user_friendly_id()+".send: failed.")})},b.prototype.toRTCDataChannelState=function(a){var b="closed";return a==j.connecting?b="connecting":a==j.open?b="open":a==j.closing?b="closing":a==j.closed&&(b="closed"),b},b}(f.ProxyObject),b.RtcDataChannel=a},484:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.RtcRtpReceiveParameters=b.RtcRtpSendParameters=b.RtcRtpEncodingParameters=b.RtcRtpParameters=b.RtcRtcpParameters=b.RtcRtpHeaderExtensionParameters=b.RtcRtpCodecParameters=void 0;var e=c(851),f=function(){function a(){}return a.defRtcRtpCodecParameters=function(){return{mimeType:"",payloadType:0,sdpFmtpLine:""}},a.defRTCRtpCodecParameters=function(){return{clockRate:0,mimeType:"",payloadType:0}},a.toRtcRtpCodecParameters=function(b){var c=a.defRtcRtpCodecParameters();return b&&(b.channels&&(c.channels=b.channels),b.clockRate&&(c.clockRate=b.clockRate),b.mimeType&&(c.mimeType=b.mimeType),b.payloadType&&(c.payloadType=b.payloadType),b.sdpFmtpLine&&(c.sdpFmtpLine=b.sdpFmtpLine)),c},a.toRTCRtpCodecParameters=function(b){var c=a.defRTCRtpCodecParameters();return b&&(b.channels&&(c.channels=b.channels),b.clockRate&&(c.clockRate=b.clockRate),b.mimeType&&(c.mimeType=b.mimeType),b.payloadType&&(c.payloadType=b.payloadType),b.sdpFmtpLine&&(c.sdpFmtpLine=b.sdpFmtpLine)),c},a}();b.RtcRtpCodecParameters=f;var g=function(){function a(){}return a.defRtcRtpHeaderExtensionParameters=function(){return{encrypted:!1,id:0,uri:""}},a.defRTCRtpHeaderExtensionParameters=function(){return{id:0,uri:""}},a.toRtcRtpHeaderExtensionParameters=function(b){var c=a.defRtcRtpHeaderExtensionParameters();if(b){var d=b.encrypted;void 0!=d&&null!=d&&(c.encrypted=d),b.id&&(c.id=b.id),b.uri&&(c.uri=b.uri)}return c},a.toRTCRtpHeaderExtensionParameters=function(b){var c=a.defRTCRtpHeaderExtensionParameters();if(b){var d=b.encrypted;void 0!=d&&null!=d&&(c.encrypted=d),b.id&&(c.id=b.id),b.uri&&(c.uri=b.uri)}return c},a}();b.RtcRtpHeaderExtensionParameters=g;var h=function(){function a(){}return a.defRtcRtcpParameters=function(){return{cname:"",reducedSize:!1}},a.defRTCRtcpParameters=function(){return{}},a.toRtcRtcpParameters=function(b){var c=a.defRtcRtcpParameters();return b&&(b.cname&&(c.cname=b.cname),void 0!=(b=b.reducedSize)&&null!=b&&(c.reducedSize=b)),c},a.toRTCRtcpParameters=function(b){var c=a.defRTCRtcpParameters();return b&&(b.cname&&(c.cname=b.cname),void 0!=(b=b.reducedSize)&&null!=b&&(c.reducedSize=b)),c},a}();b.RtcRtcpParameters=h;var i=function(){function a(){}return a.defRtcRtpParameters=function(){return{codecs:[],headerExtensions:[],rtcp:h.defRtcRtcpParameters()}},a.defRTCRtpParameters=function(){return{codecs:[],headerExtensions:[],rtcp:h.defRTCRtcpParameters()}},a.toRtcRtpParameters=function(b){var c=a.defRtcRtpParameters();if(b){if(b.codecs)for(var d=0,e=b.codecs;d<e.length;d++)c.codecs.push(f.toRtcRtpCodecParameters(e[d]));if(b.headerExtensions)for(d=0,e=b.headerExtensions;d<e.length;d++)c.headerExtensions.push(g.toRtcRtpHeaderExtensionParameters(e[d]));b.rtcp&&(c.rtcp=h.toRtcRtcpParameters(b.rtcp))}return c},a.toRTCRtpParameters=function(b){var c=a.defRTCRtpParameters();if(b){if(b.codecs)for(var d=0,e=b.codecs;d<e.length;d++)c.codecs.push(f.toRTCRtpCodecParameters(e[d]));if(b.headerExtensions)for(d=0,e=b.headerExtensions;d<e.length;d++)c.headerExtensions.push(g.toRTCRtpHeaderExtensionParameters(e[d]));b.rtcp&&(c.rtcp=h.toRtcRtcpParameters(b.rtcp))}return c},a}();b.RtcRtpParameters=i;var j=function(){function a(){}return a.defRtcRtpEncodingParameters=function(){return{active:!0,rid:""}},a.defRTCRtpEncodingParameters=function(){return{}},a.toRtcRtpEncodingParameters=function(b){var c=a.defRtcRtpEncodingParameters();if(b){var d=b.active;void 0!=d&&null!=d&&(c.active=d),b.maxBitrate&&(c.maxBitrate=b.maxBitrate),b.maxFramerate&&(c.maxFramerate=b.maxFramerate),b.scaleResolutionDownBy&&(c.scaleResolutionDownBy=b.scaleResolutionDownBy),b.rid&&(c.rid=b.rid),b.networkPriority&&(c.networkPriority=b.networkPriority)}return c},a.toRTCRtpEncodingParameters=function(b){var c=a.defRTCRtpEncodingParameters();if(b){var d=b.active;void 0!=d&&null!=d&&(c.active=d),b.maxBitrate&&(c.maxBitrate=b.maxBitrate),b.maxFramerate&&(c.maxFramerate=b.maxFramerate),b.scaleResolutionDownBy&&(c.scaleResolutionDownBy=b.scaleResolutionDownBy),b.rid&&(c.rid=b.rid),b.networkPriority&&(c.networkPriority=b.networkPriority)}return c},a}();b.RtcRtpEncodingParameters=j,a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.defRtcRtpSendParameters=function(){var a=i.defRtcRtpParameters();return a.encodings=[],a.transaction_id="",a},b.defRTCRtpSendParameters=function(){var a=i.defRTCRtpParameters();return a.encodings=[],a.transactionId="",a},b.toRtcRtpSendParameters=function(a){e.logger.log("RtcRtpSendParameters.toRtcRtpSendParameters() in param:"+JSON.stringify(a));var c=b.defRtcRtpSendParameters(),d=i.toRtcRtpParameters(a);if(d.codecs.forEach(function(a){return c.codecs.push(a)}),d.headerExtensions.forEach(function(a){return c.headerExtensions.push(a)}),c.rtcp=d.rtcp,a){if(a.encodings)for(var d=0,f=a.encodings;d<f.length;d++)c.encodings.push(j.toRtcRtpEncodingParameters(f[d]));a.transactionId&&(c.transaction_id=a.transactionId)}return e.logger.log("RtcRtpSendParameters.toRtcRtpSendParameters() out param:"+JSON.stringify(c)),c},b.toRTCRtpSendParameters=function(a){e.logger.log("RtcRtpSendParameters.toRTCRtpSendParameters() in param:"+JSON.stringify(a));var c=b.defRTCRtpSendParameters(),d=i.toRTCRtpParameters(a);if(d.codecs.forEach(function(a){return c.codecs.push(a)}),d.headerExtensions.forEach(function(a){return c.headerExtensions.push(a)}),c.rtcp=d.rtcp,a){if(a.encodings)for(var d=0,f=a.encodings;d<f.length;d++)c.encodings.push(j.toRTCRtpEncodingParameters(f[d]));a.transaction_id&&(c.transactionId=a.transaction_id)}return e.logger.log("RtcRtpSendParameters.toRTCRtpSendParameters() out param:"+JSON.stringify(c)),c},b}(i),b.RtcRtpSendParameters=a,a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.defRtcRtpReceiveParameters=function(){return i.defRtcRtpParameters()},b.defRTCRtpReceiveParameters=function(){return i.defRTCRtpParameters()},b.toRtcRtpReceiveParameters=function(a){return e.logger.log("RtcRtpReceiveParameters.toRtcRtpReceiveParameters() in param:"+JSON.stringify(a)),a=i.toRtcRtpParameters(a),e.logger.log("RtcRtpReceiveParameters.toRtcRtpReceiveParameters() out param:"+JSON.stringify(a)),a},b.toRTCRtpReceiveParameters=function(a){return e.logger.log("RtcRtpReceiveParameters.toRTCRtpReceiveParameters() in param:"+JSON.stringify(a)),a=i.toRTCRtpParameters(a),e.logger.log("RtcRtpReceiveParameters.toRTCRtpReceiveParameters() out param:"+JSON.stringify(a)),a},b}(i),b.RtcRtpReceiveParameters=a},589:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.RtpReceiver=b.RtpSender=b.RtpSenderReceiver=b.DtlsTransport=b.IceTransport=b.DtmfSender=b.DTMFToneChangeEvent=void 0;var e=c(658),f=c(550),g=c(851),h=c(144),i=c(517),j=c(650),k=c(484),l=function(a){function b(b,c){var d=a.call(this,b,f.class_id_t.RTCDTMFToneChangeEvent,c,e.ProxyMode.Remote)||this;return g.logger.log(d.user_friendly_id()+".constructor"),d}return d(b,a),b.prototype.syncBarrier=function(){var a=this;return g.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){Promise.all([a.remoteInvoke(!1,f.method_id_RTCDTMFToneChangeEvent_t.tone,""),a.remoteInvoke(!1,f.method_id_RTCDTMFToneChangeEvent_t.tone_buffer,"")]).then(function(b){g.logger.log(a.user_friendly_id()+".syncBarrier(): success."),b=b.map(function(b){return a.param0(b)}),a.tone=b[0],a.tone_buffer_=b[1],a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".prop.syncBarrier() failed."),a.syncBarrierReject(b)})}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed."),a.syncBarrierReject(b)})})},Object.defineProperty(b.prototype,"tone_buffer",{get:function(){return this.tone_buffer_},enumerable:!1,configurable:!0}),b}(e.ProxyObject);b.DTMFToneChangeEvent=l;var m=function(a){function b(b,c){var d=a.call(this,b,f.class_id_t.RTCDTMFSender,c,e.ProxyMode.Remote)||this;return g.logger.log(d.user_friendly_id()+".constructor"),d.canInsertDTMF=!0,d.toneBuffer_="",d}return d(b,a),b.prototype.insertDTMF=function(a,b,c){var d=this;void 0===b&&(b=100),void 0===c&&(c=70),g.logger.log(this.user_friendly_id()+".insertDTMF() called, tones: "+a),this.waitUntilConnected("DtmfSender.insertDTMF").then(function(){return d.remoteInvoke(!1,f.method_id_RTCDTMFSender_t.insertDTMF,a,b,c)}).then(function(){g.logger.log(d.user_friendly_id()+".insertDTMF() success, tones: "+a)}).catch(function(a){d.logRemoteInvokeError(a,".insertDTMF() failed!")})},Object.defineProperty(b.prototype,"ontonechange",{get:function(){return this.ontonechange_},set:function(a){var b=this;g.logger.log(this.user_friendly_id()+".set_ontonechange() called."),this.ontonechange_=a,this.waitUntilConnected("DtmfSender.ontonechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),f.method_id_RTCDTMFSender_t.ontonechange);return c.then(function(a){g.logger.log(b.user_friendly_id()+".ontonechange callback received!"),new l(b,b.param0(a).oid).syncBarrier().then(function(a){g.logger.log(b.user_friendly_id()+"tone: "+a.tone+" tone_buffer: "+a.tone_buffer),b.toneBuffer_=a.tone_buffer,b.ontonechange_(a)}).catch(function(a){b.logRemoteInvokeError(a,".toneEvt.syncBarrier() failed!")})}),b.remoteInvoke(!0,f.method_id_RTCDTMFSender_t.ontonechange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_ontonechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"toneBuffer",{get:function(){return g.logger.log(this.user_friendly_id()+".toneBuffer() called."),this.toneBuffer_},enumerable:!1,configurable:!0}),b}(e.ProxyObject);b.DtmfSender=m;var n=function(a){function b(b,c){var d=a.call(this,b,f.class_id_t.RTCIceTransport,c,e.ProxyMode.Remote)||this;return g.logger.log(d.user_friendly_id()+".constructor"),d.selectedPair=null,d.localCandidates_=[],d.remoteCandidates_=[],d}return d(b,a),b.prototype.syncBarrier=function(){var a=this;return g.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){a.syncBarrierDeep(c,d)&&a.waitUntilConnected("IceTransport.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.role,0),a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.component,0),a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.state,0),a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.gatheringState,0)])}).then(function(c){g.logger.log(a.user_friendly_id()+".syncBarrier success.");var d=0,e=0;c=c.map(function(b){return a.param0(b)}),a.role_=c[0],a.component_=c[1],d=c[2],e=c[3],a.state_=b.convertState(d),a.gatheringState_=b.convertGatheringState(e),a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},b.prototype.syncCandidates=function(){var a=this;return g.logger.log(this.user_friendly_id()+".syncCandidates() called."),new Promise(function(b,c){a.waitUntilConnected("IceTransport.syncCandidates").then(function(){return Promise.all([a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.localcandidates,[]),a.remoteInvoke(!1,f.method_id_RTCIceTransport_t.remotecandidates,[])])}).then(function(c){g.logger.log(a.user_friendly_id()+".syncCandidates success."),c=c.map(function(b){return a.param0(b)}),a.localCandidates_=c[0],a.remoteCandidates_=c[1],b(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncCandidates() failed!"),c(b)})})},Object.defineProperty(b.prototype,"role",{get:function(){return this.role_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"component",{get:function(){return this.component_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"State",{get:function(){return this.state_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"gatheringState",{get:function(){return this.gatheringState_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(a){var c=this;g.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=a,this.waitUntilConnected("IceTransport.onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),f.method_id_RTCIceTransport_t.onstatechange);return d.then(function(a){g.logger.log(c.user_friendly_id()+".onstatechange callback received!"),c.syncCandidates().then(function(a){g.logger.log(c.user_friendly_id()+"received updated ice candidates!")}),c.state_=b.convertState(c.param0(a)),g.logger.log(c.user_friendly_id()+"state: "+c.state_),c.onstatechange_()}),c.remoteInvoke(!0,f.method_id_RTCIceTransport_t.onstatechange,d.success)}).catch(function(a){c.logRemoteInvokeError(a,".set_onstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"ongatheringstatechange",{get:function(){return this.ongatheringstatechange_},set:function(a){var c=this;g.logger.log(this.user_friendly_id()+".set_ongatheringstatechange() called."),this.ongatheringstatechange_=a,this.waitUntilConnected("IceTransport.ongatheringstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),f.method_id_RTCIceTransport_t.ongatheringstatechange);return d.then(function(a){g.logger.log(c.user_friendly_id()+".ongatheringstatechange callback received!"),c.syncCandidates().then(function(a){g.logger.log(c.user_friendly_id()+"received updated ice candidates!")}),c.gatheringState_=b.convertGatheringState(c.param0(a)),g.logger.log(c.user_friendly_id()+"gatheringState: "+c.gatheringState_),c.ongatheringstatechange_()}),c.remoteInvoke(!0,f.method_id_RTCIceTransport_t.ongatheringstatechange,d.success)}).catch(function(a){c.logRemoteInvokeError(a,".set_ongatheringstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onselectedcandidatepairchange",{get:function(){return this.onselectedcandidatepairchange_},set:function(a){var b=this;g.logger.log(this.user_friendly_id()+".set_onselectedcandidatepairchange() called."),this.onselectedcandidatepairchange_=a,this.waitUntilConnected("IceTransport.onselectedcandidatepairchange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),f.method_id_RTCIceTransport_t.onselectedcandidatepairchange);return c.then(function(a){g.logger.log(b.user_friendly_id()+".onselectedcandidatepairchange callback received!"),b.syncCandidates().then(function(a){g.logger.log(b.user_friendly_id()+"received updated ice candidates!")}),b.selectedPair=b.param0(a),g.logger.log(b.user_friendly_id()+"selectedPair: "+b.selectedPair),b.onselectedcandidatepairchange_()}),b.remoteInvoke(!0,f.method_id_RTCIceTransport_t.onselectedcandidatepairchange,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onselectedcandidatepairchange failed!")})},enumerable:!1,configurable:!0}),b.prototype.getLocalCandidates=function(){return this.localCandidates_},b.prototype.getRemoteCandidates=function(){return this.remoteCandidates_},b.prototype.getLocalParameters=function(){return null},b.prototype.getRemoteParameters=function(){return null},b.prototype.getSelectedCandidatePair=function(){return this.selectedPair},b.convertState=function(a){return 0==a?"new":1==a?"checking":2==a?"connected":3==a?"completed":4==a?"failed":5==a?"disconnected":"closed"},b.convertGatheringState=function(a){return 0==a?"new":1==a?"gathering":"complete"},b}(e.ProxyObject);b.IceTransport=n;var o;!function(a){a[a.new=0]="new",a[a.connecting=1]="connecting",a[a.connected=2]="connected",a[a.closed=3]="closed",a[a.failed=4]="failed",a[a.max=5]="max"}(o||(o={}));var p=function(a){function b(b,c){var d=a.call(this,b,f.class_id_t.RTCDtlsTransport,c,e.ProxyMode.Remote)||this;return g.logger.log(d.user_friendly_id()+".constructor"),d.state_="new",d.transport_=null,d.remoteCertificates_=[],d}return d(b,a),b.prototype.dumpInfo=function(){g.logger.log("DtlsTransport["+this.object_id()+"].dumpInfo():"),g.logger.log("    - state:"+this.state_),g.logger.log("    - transport:"+this.transport_)},b.prototype.syncBarrier=function(){var a=this;return g.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){a.syncBarrierDeep(c,d)&&a.waitUntilConnected("DtlsTransport.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,f.method_id_RTCDtlsTransport_t.transport,{}),a.remoteInvoke(!1,f.method_id_RTCDtlsTransport_t.state,0),a.remoteInvoke(!1,f.method_id_RTCDtlsTransport_t.getRemoteCertificates)])}).then(function(c){var d;g.logger.log(a.user_friendly_id()+".syncBarrier remote success.");var e;d=c.map(function(b){return a.param0(b)}),c=d[0],e=d[1],a.remoteCertificates_=d[2],a.state_=b.convertState(e),d=[],void 0!=c&&0==c.is_null?(e=a.transport_,null!==a.transport_&&a.transport_.object_id()==c.oid||(e=new n(a,c.oid)),d.push(e.syncBarrier())):d.push(Promise.resolve(null)),Promise.all(d).then(function(b){g.logger.log(a.user_friendly_id()+".syncBarrier success"),a.transport_=b[0],a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".prop.syncBarrier failed!"),a.syncBarrierReject(b)})}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!"),a.syncBarrierReject(b)})})},Object.defineProperty(b.prototype,"transport",{get:function(){return this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"state",{get:function(){return g.logger.log(this.user_friendly_id()+".get_state() called: "+this.state_),this.state_},enumerable:!1,configurable:!0}),b.prototype.getRemoteCertificates=function(){return this.remoteCertificates_},Object.defineProperty(b.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(a){var c=this;g.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=a,this.waitUntilConnected("DtlsTransport.onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),f.method_id_RTCDtlsTransport_t.onstatechange);return d.then(function(a){g.logger.log(c.user_friendly_id()+".onstatechange callback received!"),c.state_=b.convertState(c.param0(a)),g.logger.log(c.user_friendly_id()+"state_: "+c.state_),c.onstatechange_()}),c.remoteInvoke(!0,f.method_id_RTCDtlsTransport_t.onstatechange,d.success)}).catch(function(a){c.logRemoteInvokeError(a,".set_onstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onerror",{get:function(){return this.onerror_},set:function(a){var b=this;g.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=a,this.waitUntilConnected("DtlsTransport.onerror").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),f.method_id_RTCDtlsTransport_t.onerror);return c.then(function(a){g.logger.log(b.user_friendly_id()+".onerror callback received!"),a=b.param0(a),g.logger.log(b.user_friendly_id()+"error: "+a),b.onerror_(a)}),b.remoteInvoke(!0,f.method_id_RTCDtlsTransport_t.onerror,c.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onerror failed!")})},enumerable:!1,configurable:!0}),b.convertState=function(a){return a==o.new?"new":a==o.connecting?"connecting":a==o.connected?"connected":a==o.closed?"closed":"failed"},b}(e.ProxyObject);b.DtlsTransport=p,a=function(a){function b(b,c,d,e){return b=a.call(this,b,c,d,e)||this,g.logger.log(b.user_friendly_id()+".constructor base"),b.track_=null,b.transport_=null,b}return d(b,a),b.prototype.syncBarrierBase=function(){g.logger.log(this.user_friendly_id()+".syncBarrierBase() called.");var a,b,c=[];return this instanceof q?(a=f.method_id_RTCRtpSender_t.track,b=f.method_id_RTCRtpSender_t.transport):this instanceof r&&(a=f.method_id_RTCRtpReceiver_t.track,b=f.method_id_RTCRtpReceiver_t.transport),j.RemoteSession.isFeaturePstnSupported()&&j.RemoteSession.isFeatureDtmfSupported()?(c.push(this.remoteInvoke(!1,a,{oid:0})),c.push(this.remoteInvoke(!1,b,{oid:0}))):c.push(this.remoteInvoke(!1,a,{oid:0})),c},b.prototype.syncBarrierBaseResults=function(a){var b,c=this;b=0,g.logger.log(this.user_friendly_id()+".syncBarrierBaseResults");var d;j.RemoteSession.isFeaturePstnSupported()&&j.RemoteSession.isFeatureDtmfSupported()?(b=a.map(function(a){return c.param0(a)}),a=b[0],d=b[1],b=2):(a=a.map(function(a){return c.param0(a)})[0],b=1);var e=[];if(void 0!=a&&!1===a.is_null){var f=this.track_;null===this.track_||this.track_.object_id()!=a.oid?f=new h.RemoteMediaTrack(this,a.oid):this.track_.bind(this,a.oid),e.push(f.syncBarrier())}else e.push(Promise.resolve(null));return void 0!=d&&!1===d.is_null?(a=this.transport_,null!==this.transport_&&this.transport_.object_id()==d.oid||(a=new p(this,d.oid)),e.push(a.syncBarrier())):e.push(Promise.resolve(null)),[b,e]},b.prototype.syncBarrierBaseResultsWithAllPromisesFulFilled=function(a){this.track_=a[0],this.transport_=a[1]},Object.defineProperty(b.prototype,"transport",{get:function(){return g.logger.log(this.user_friendly_id()+".get transport() called."),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"rtcpTransport",{get:function(){return g.logger.log(this.user_friendly_id()+".get rtcpTransport() called."),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"track",{get:function(){return this.track_},enumerable:!1,configurable:!0}),b.prototype.reinitTrack=function(a){this.track_=a},b.prototype.getStats=function(){g.logger.log(this.user_friendly_id()+".getStats() called.");var a=this;return new Promise(function(b,c){a.isRedirected()?a.waitUntilConnected("RtpReceiver.getStats").then(function(){if(j.RemoteSession.isFeatureSenderStatsFixSupported()){var c;a instanceof q?c=f.method_id_RTCRtpSender_t.getStats:a instanceof r&&(c=f.method_id_RTCRtpReceiver_t.getStats);var d=a.registerCallbacks(!0,!1,c);return d.then(function(a){void 0===a.params||0===a.params.length||0===a.params[0].length?b():b(i.StatsReport.fromJSON(JSON.parse(a.params[0])))}),a.remoteInvoke(!1,c,d.success)}b()}).catch(function(b){b=a.logRemoteInvokeError(b,".getStats() failed!"),c(b)}):(g.logger.log(a.user_friendly_id()+".getStats(): not in active redirection!"),b())})},b}(e.ProxyObject),b.RtpSenderReceiver=a;var q=function(a){function b(b,c,d,e){return b=a.call(this,b,f.class_id_t.RTCRtpSender,c,d)||this,g.logger.log(b.user_friendly_id()+".constructor"),b.dtmf_=null,b.params_=k.RtcRtpSendParameters.defRtcRtpSendParameters(),b.unified_=e,b}return d(b,a),b.prototype.dumpInfo=function(){
g.logger.log("RtpSender["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo()},b.prototype.syncBarrier=function(){var b=this;return g.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){b.syncBarrierDeep(c,d)&&b.waitUntilConnected("RtpSender.syncBarrier").then(function(){var c=a.prototype.syncBarrierBase.call(b);return j.RemoteSession.isFeaturePstnSupported()&&j.RemoteSession.isFeatureDtmfSupported()&&(c.push(b.remoteInvoke(!1,f.method_id_RTCRtpSender_t.dtmf,{oid:0})),c.push(b.remoteInvoke(!1,f.method_id_RTCRtpSender_t.getParameters))),Promise.all(c)}).then(function(a){var c,d;c=b.syncBarrierBaseResults(a),d=c[0],c=c[1],a=a.slice(d).map(function(a){return b.param0(a)}),d=a[0],b.params_=a[1],void 0==d||!1!==d.is_null||null!==b.dtmf_&&b.dtmf_.object_id()==d.oid||(b.dtmf_=new m(b,d.oid)),Promise.all(c).then(function(a){b.syncBarrierBaseResultsWithAllPromisesFulFilled(a),g.logger.log(b.user_friendly_id()+".syncBarrierBase success."),b.syncBarrierResolve(b)}).catch(function(a){a=b.logRemoteInvokeError(a,".syncBarrier() promises_base failed!"),b.syncBarrierReject(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,".syncBarrier failed!"),b.syncBarrierReject(a)})})},b.getCapabilities=function(a){return g.logger.log(this.constructor.name+".getCapabilities() called."),h.NavigatorUserMedia.getCapabilities(a)},Object.defineProperty(b.prototype,"dtmf",{get:function(){return g.logger.log(this.user_friendly_id()+".get dtmf() called."),this.dtmf_},enumerable:!1,configurable:!0}),b.prototype.setParameters=function(a){return this.setParametersAsync(a)},b.prototype.setParametersAsync=function(a){var b=this;return g.logger.log(this.user_friendly_id()+".setParametersAsync() called."),new Promise(function(c,d){b.waitUntilConnected("RtpSender.setParametersAsync").then(function(){return Promise.all([b.remoteInvoke(!1,f.method_id_RTCRtpSender_t.setParameters,k.RtcRtpSendParameters.toRtcRtpSendParameters(a))])}).then(function(d){g.logger.log(b.user_friendly_id()+".setParametersAsync(): success."),c(),b.params_=k.RtcRtpSendParameters.toRtcRtpSendParameters(a)}).catch(function(a){a=b.logRemoteInvokeError(a,".setParametersAsync() failed!"),d(a)})})},b.prototype.getParameters=function(){return g.logger.log(this.user_friendly_id()+".getParameters() called."),this.getParametersInternal(!1)},b.prototype.getParametersAsync=function(){return g.logger.log(this.user_friendly_id()+".getParametersAsync() called."),this.getParametersInternal(!0)},b.prototype.getParametersInternal=function(a){var b=this,c=new Promise(function(a,c){b.waitUntilConnected(b.user_friendly_id()+".getParametersInternal").then(function(){return g.logger.log(b.user_friendly_id()+".getParametersInternal() remote invoking"),b.remoteInvoke(!1,f.method_id_RTCRtpSender_t.getParameters)}).then(function(c){b.params_=b.param0(c),g.logger.log(b.user_friendly_id()+".getParametersInternal() success returning: "+b.params_),a(k.RtcRtpSendParameters.toRTCRtpSendParameters(b.params_))}).catch(function(a){a=b.logRemoteInvokeError(a,".getParametersInternal() failed!"),c(a)})});return a?c:(g.logger.log(this.user_friendly_id()+".getParametersInternal() returning: "+this.params_),k.RtcRtpSendParameters.toRTCRtpSendParameters(this.params_))},b.prototype.replaceTrack=function(a){var b=this;return g.logger.log(this.user_friendly_id()+".replaceTrack() called. current track:"+(this.track_?this.track_.object_id():"null")+" with track="+(a?a.object_id():"null")),new Promise(function(c,d){b.waitUntilConnected("RtpSender.replaceTrack").then(function(){return a||j.RemoteSession.isFeatureWebrtc1dot0Supported()?a?b.remoteInvokeEx(!1,f.method_id_RTCRtpSender_t.replaceTrack,[a]):b.remoteInvoke(!1,f.method_id_RTCRtpSender_t.replaceTrack,{oid:-1}):Promise.reject(new DOMException("Does not support replace track with null in non-Unified SDP semantic!"))}).then(function(d){g.logger.log(b.user_friendly_id()+".replaceTrack(): success."),c(),b.reinitTrack(a)}).catch(function(a){a=b.logRemoteInvokeError(a,".replaceTrack() failed!"),d(a)})})},b}(a);b.RtpSender=q;var r=function(a){function b(b,c,d,e,h){return b=a.call(this,b,f.class_id_t.RTCRtpReceiver,c,d)||this,g.logger.log(b.user_friendly_id()+".constructor"),b.contribsources_=[],b.syncsources_=[],b.params_=k.RtcRtpParameters.defRtcRtpParameters(),b.unified_=e,h&&(b.track_=h),b}return d(b,a),b.prototype.dumpInfo=function(){g.logger.log("RtpReceiver["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo(),this.transport&&this.transport.dumpInfo()},b.prototype.syncBarrier=function(){var b=this;return g.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(c,d){b.syncBarrierDeep(c,d)&&b.waitUntilConnected("RtpReceiver.syncBarrier").then(function(){var c=a.prototype.syncBarrierBase.call(b);return j.RemoteSession.isFeaturePstnSupported()&&j.RemoteSession.isFeatureDtmfSupported()?(c.push(b.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getContributingSources)),c.push(b.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getSynchronizationSources)),c.push(b.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getParameters))):c.push(b.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getContributingSources)),Promise.all(c)}).then(function(a){var c,d;c=b.syncBarrierBaseResults(a),d=c[0],c=c[1],a=a.slice(d).map(function(a){return b.param0(a)}),b.contribsources_=a[0],b.syncsources_=a[1],b.params_=a[2],Promise.all(c).then(function(a){b.syncBarrierBaseResultsWithAllPromisesFulFilled(a),g.logger.log(b.user_friendly_id()+".syncBarrier success."),b.syncBarrierResolve(b)}).catch(function(a){a=b.logRemoteInvokeError(a,".syncBarrier() promises_base failed!"),b.syncBarrierReject(a)})}).catch(function(a){a=b.logRemoteInvokeError(a,".syncBarrier() failed!"),b.syncBarrierReject(a)})})},b.getCapabilities=function(a){return g.logger.log(this.constructor.name+".getCapabilities() called."),h.NavigatorUserMedia.getCapabilities(a)},b.prototype.getContributingSources=function(){var a=this;return g.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources_)),this.waitUntilConnected("RtpReceiver.getContributingSources").then(function(){return Promise.all([a.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getContributingSources)])}).then(function(b){a.contribsources_=b.map(function(b){return a.param0(b)})[0],g.logger.log(a.user_friendly_id(),".getContributingSources() success: "+JSON.stringify(a.contribsources_))}).catch(function(b){a.logRemoteInvokeError(b,".getContributingSources() failed!"),a.contribsources_=[]}),this.contribsources_},b.prototype.getParameters=function(){var a=this;return g.logger.log(this.user_friendly_id()+".getParameters() called."),this.waitUntilConnected(this.user_friendly_id()+".getParameters").then(function(){return g.logger.log(a.user_friendly_id()+".getParameters() remote invoking"),a.remoteInvoke(!1,f.method_id_RTCRtpReceiver_t.getParameters)}).then(function(b){g.logger.log(a.user_friendly_id()+".getParameters() success"),a.params_=a.param0(b)}).catch(function(b){a.logRemoteInvokeError(b,".getParameters() failed!")}),g.logger.log(this.user_friendly_id()+".getParameters() returning: "+this.params_),k.RtcRtpReceiveParameters.toRTCRtpReceiveParameters(this.params_)},b.prototype.getSynchronizationSources=function(){return g.logger.log(this.user_friendly_id()+".getSynchronizationSources() called."),this.syncsources_},b}(a);b.RtpReceiver=r},377:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.RtpTransceiver=b.RtcRtpTransceiverInit=b.RtcRtpTransceiverDirection=void 0;var e,f=c(658),g=c(550),h=c(851),i=c(589),j=c(484);!function(a){a[a.sendrecv=0]="sendrecv",a[a.sendonly=1]="sendonly",a[a.recvonly=2]="recvonly",a[a.inactive=3]="inactive",a[a.stopped=4]="stopped"}(e=b.RtcRtpTransceiverDirection||(b.RtcRtpTransceiverDirection={}));var k=function(){function a(){}return a.toRtcRtpTransceiverDirection=function(a){switch(a){case"inactive":a=e.inactive;break;case"recvonly":a=e.recvonly;break;case"sendonly":a=e.sendonly;break;case"sendrecv":a=e.sendrecv;break;case"stopped":a=e.stopped;break;default:a=e.sendrecv}return a},a.toRTCRtpTransceiverDirection=function(a){switch(a){case e.inactive:a="inactive";break;case e.recvonly:a="recvonly";break;case e.sendonly:a="sendonly";break;case e.sendrecv:a="sendrecv";break;case e.stopped:a="stopped";break;default:a="sendrecv"}return a},a.toRtcRtpTransceiverInit=function(b){h.logger.log("RtcRtpTransceiverInit.toRtcRtpTransceiverInit() in init:"+JSON.stringify(b));var c={};return b&&(b.direction&&(c.direction=a.toRtcRtpTransceiverDirection(b.direction)),b.sendEncodings&&(c.sendEncodings=[],b.sendEncodings.forEach(function(a){return c.sendEncodings.push(j.RtcRtpEncodingParameters.toRtcRtpEncodingParameters(a))})),b.streams&&(c.streams=b.streams)),h.logger.log("RtcRtpTransceiverInit.toRtcRtpTransceiverInit() out init:"+JSON.stringify(c)),c},a}();b.RtcRtpTransceiverInit=k,a=function(a){function b(b,c,d,j,k,l){return b=a.call(this,b,g.class_id_t.RTCRtpTransceiver,c,d)||this,h.logger.log(b.user_friendly_id()+".constructor"),b.unified_=j,b.sender_=new i.RtpSender(b,0,f.ProxyMode.Pseudo,j),b.receiver_=l||new i.RtpReceiver(b,0,f.ProxyMode.Pseudo,j),k?(b.direction_=k,b.currentDirection_=k):(b.direction_=e.sendrecv,b.currentDirection_=e.sendrecv),b}return d(b,a),b.prototype.dumpInfo=function(){h.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.mid+"] direction="+k.toRTCRtpTransceiverDirection(this.direction_)+" currentDirection="+k.toRTCRtpTransceiverDirection(this.currentDirection_)),this.sender&&this.sender.dumpInfo(),this.receiver&&this.receiver.dumpInfo()},b.prototype.syncBarrier=function(){var a=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected("RtpTransceiver.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_RTCRtpTransceiver_t.mid,""),a.remoteInvoke(!1,g.method_id_RTCRtpTransceiver_t.direction,0),a.remoteInvoke(!1,g.method_id_RTCRtpTransceiver_t.currentDirection,0),a.remoteInvoke(!1,g.method_id_RTCRtpTransceiver_t.sender,{oid:0}),a.remoteInvoke(!1,g.method_id_RTCRtpTransceiver_t.receiver,{oid:0})])}).then(function(b){var c;h.logger.log(a.user_friendly_id()+".syncBarrier remote success."),c=b.map(function(b){return a.param0(b)}),a.mid_=c[0],a.direction_=c[1],a.currentDirection_=c[2],b=c[3],c=c[4];var d=[];if(void 0!=b&&!1===b.is_null&&(a.sender_.bind(a,b.oid),d.push(a.sender_.syncBarrier())),void 0!=c&&!1===c.is_null&&(a.receiver_.bind(a,c.oid),d.push(a.receiver_.syncBarrier())),0!=d.length)return h.logger.log(a.user_friendly_id()+".prop.syncBarrier start"),Promise.all(d);h.logger.log(a.user_friendly_id()+".syncBarrier success"),a.syncBarrierResolve(a)}).then(function(){h.logger.log(a.user_friendly_id()+".syncBarrier success"),a.syncBarrierResolve(a)}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!"),a.syncBarrierReject(b)})})},Object.defineProperty(b.prototype,"mid",{get:function(){return h.logger.log(this.user_friendly_id()+".get_mid() called: "+this.mid_),this.mid_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"sender",{get:function(){return this.sender_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"receiver",{get:function(){return this.receiver_},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"direction",{get:function(){return h.logger.log(this.user_friendly_id()+".get_direction() called. "+k.toRTCRtpTransceiverDirection(this.direction_)),k.toRTCRtpTransceiverDirection(this.direction_)},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_direction() called. "+a),this.direction_=k.toRtcRtpTransceiverDirection(a),this.waitUntilConnected("RtpTransceiver.set_direction").then(function(){return b.remoteInvoke(!0,g.method_id_RTCRtpTransceiver_t.direction,k.toRtcRtpTransceiverDirection(a))}).then(function(){h.logger.log(b.user_friendly_id()+".set_direction: success.")}).catch(function(a){b.logRemoteInvokeError(a,".set_direction() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"currentDirection",{get:function(){return h.logger.log(this.user_friendly_id()+".get_currentDirection() called. "+k.toRTCRtpTransceiverDirection(this.currentDirection_)),k.toRTCRtpTransceiverDirection(this.currentDirection_)},enumerable:!1,configurable:!0}),b.prototype.stop=function(){var a=this;h.logger.log(this.user_friendly_id()+".stop() called."),this.waitUntilConnected("RtpTransceiver.stop").then(function(){return a.remoteInvoke(!0,g.method_id_RTCRtpTransceiver_t.stop)}).then(function(){h.logger.log(a.user_friendly_id()+".stop: success.")}).catch(function(b){a.logRemoteInvokeError(b,".stop() failed!")})},b.prototype.setCodecPreferences=function(a){var b=this;h.logger.log(this.user_friendly_id()+".setCodecPreferences() called."),this.waitUntilConnected("RtpTransceiver.setCodecPreferences").then(function(){return b.remoteInvoke(!0,g.method_id_RTCRtpTransceiver_t.setCodecPreferences,a)}).then(function(){h.logger.log(b.user_friendly_id()+".setCodecPreferences: success.")}).catch(function(a){b.logRemoteInvokeError(a,".setCodecPreferences() failed!")})},b}(f.ProxyObject),b.RtpTransceiver=a},973:function(a,b,c){function d(a,b){return void 0!==a.find(function(a){return a===b})}function e(a,b,c){b/=a.width,c/=a.height;var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a.width*b,d.height=a.height*c,e.putImageData(a,0,0),1==b&&1==c||(e.scale(b,c),e.drawImage(d,0,0)),d}function f(a,b,c){return a=e(a,b,c),b=document.createElement("img"),b.src=a.toDataURL(),b}function g(a,b,c,d){return c=void 0!==c?c:r.Width,d=void 0!==d?d:r.Height,!0===b?f(a,c,d):(b=null,c==a.width&&d===a.height?b=a:(a=e(a,c,d),b=a.getContext("2d").getImageData(0,0,a.width,a.height)),b)}var h=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.ScreenSource=b.ScreenSourceVda=b.ScreenSharingVda=b.ScreenSharingRemote=b.ScreenSharing=b.ImageDataRemote=void 0;var i,j=c(658),k=c(550),l=c(851),m=c(946),n=c(691),o=c(650);!function(a){a[a.Legacy=0]="Legacy",a[a.MonitorsAndApps=10]="MonitorsAndApps"}(i||(i={})),a=function(){return function(a,b,c){this.data=a,this.height=b,this.width=c}}(),b.ImageDataRemote=a,a=function(){function a(){this.local_=this.remote_=null}return a.screenSharingInstance=function(b){return a.instance||(a.instance=new a,b&&(a.instance.onscreentopologychanged=b)),a.instance},a.destroyInstance=function(){a.instance&&a.instance.remote_&&a.instance.remote_.release(),a.instance=null},a.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(a.prototype,"onscreentopologychanged",{set:function(a){this.remote_||(this.remote_=new p),this.remote_.onscreentopologychanged=a,this.local_||(this.local_=new q),this.local_.onscreentopologychanged=a},enumerable:!1,configurable:!0}),a.prototype.getWindowsAsync=function(){var a=this;return l.logger.log(this.user_friendly_id()+".getWindowsAsync() called."),null==this.local_&&(this.local_=new q),new Promise(function(b,c){var d=[];a.local_.getWindowsAsync().then(function(c){c&&(d=c),l.logger.log(a.user_friendly_id()+".getWindowsAsync() returning sources"),b(d)}).catch(function(){l.logger.log("ScreenSharing.getWindowsAsync(): rejected"),b(d)})})},a.prototype.getScreensAsync=function(){var a=this;return l.logger.log(this.user_friendly_id()+".getScreensAsync() called."),null==this.remote_&&(this.remote_=new p),new Promise(function(b,c){var d=[];a.remote_.getScreensAsync().then(function(c){c&&(d=c),l.logger.log(a.user_friendly_id()+".getScreensAsync() returning sources"),b(d)}).catch(function(){l.logger.log("ScreenSharing.getScreensAsync(): rejected"),b(d)})})},a.prototype.setActiveSource=function(a,b){var c=this;return l.logger.log(this.user_friendly_id()+".setActiveSource() called. id="+a+" appshare="+b),new Promise(function(d,e){c.remote_.contains(a)?c.remote_.setActive(a).then(function(a){d(a)}).catch(function(){l.logger.log("ScreenSharing.setActiveSource(): rejected"),e()}):b&&c.local_.contains(a)?c.local_.setActive(!0,a).then(function(a){d(a)}).catch(function(){l.logger.log("ScreenSharing.setActiveSource(): rejected"),e()}):(l.logger.log("ScreenSharing.setActiveSource(): legacy screen sharing"),d(""))})},a.prototype.isAppshareActive=function(){return this.local_&&-1!==this.local_.lastActive},a.prototype.stopAppshare=function(){l.logger.log(this.user_friendly_id()+".stopAppshare() called."),this.local_&&this.local_.setActive(!1).then(function(a){l.logger.log("ScreenSharing.stopAppshare(): success, deviceid=",a)}).catch(function(){l.logger.log("ScreenSharing.stopAppshare(): failure or timeout due to nonresponsive WS Agent")})},a.instance=null,a}(),b.ScreenSharing=a;var p=function(a){function b(){var b=a.call(this,null,k.class_id_t.ScreenSharingRemote,0,j.ProxyMode.Local)||this;return l.logger.log(b.user_friendly_id()+".constructor"),b.sources_=[],b}return h(b,a),b.prototype.getSourceById=function(a){return this.sources_.find(function(b){return b.getId()==a})},b.prototype.contains=function(a){return void 0!==this.getSourceById(a)},Object.defineProperty(b.prototype,"onscreentopologychanged",{get:function(){return this.onscreentopologychanged_},set:function(a){var b=this;this.onscreentopologychanged_=a,this.waitUntilConnected(this.user_friendly_id()+".onscreentopologychanged").then(function(){var a=b.registerCallbacks(!1,b.isNullCallback(b.onscreentopologychanged_),k.method_id_VDISharingRemote_t.onscreentopologychanged);return a.then(function(){l.logger.log(b.user_friendly_id()+"onscreentopologychanged event received!!!"),b.onscreentopologychanged_&&b.onscreentopologychanged_()}),b.remoteInvoke(!0,k.method_id_VDISharingRemote_t.onscreentopologychanged,a.success)}).catch(function(a){b.logRemoteInvokeError(a,".set_onscreentopologychanged() failed!")})},enumerable:!1,configurable:!0}),b.prototype.getScreensAsync=function(){var a=this;l.logger.log(this.user_friendly_id()+".getScreensAsync() called.");var b=this.sources_;this.sources_=[];var c=m.getRedirector().vdabufferNoLimit()&&o.RemoteSession.isFeatureVdNoBufferLimitSupported();return new Promise(function(e,f){a.waitUntilConnected(a.user_friendly_id()+".getScreensAsync").then(function(){return a.remoteInvoke(!1,k.method_id_VDISharingRemote_t.getScreensAsync,c)}).then(function(c){var g=[];c.params[0].forEach(function(c){var d=b.find(function(a){return a.object_id()===c.oid});void 0===d&&(l.logger.log(a.user_friendly_id()+" create a ScreenSource with oid:"+c.oid),d=new s(a,c.oid,j.ProxyMode.Remote)),g.push(d.syncBarrier())}),Promise.all(g.map(function(a){return a.then(function(a){return{value:a,status:"fulfilled"}},function(a){return{value:a,status:"rejected"}})})).then(function(c){var f=c.filter(function(a){return"fulfilled"===a.status}).map(function(a){return a.value});a.sources_=f,b.filter(function(a){return!d(f,a)}).forEach(function(a){return a.release()}),e(f)}).catch(function(c){c=a.logRemoteInvokeError(c,".getScreensAsync() failed!"),b.forEach(function(a){a.release()}),f(c)})}).catch(function(c){c=a.logRemoteInvokeError(c,".getScreensAsync() failed!"),b.forEach(function(a){a.release()}),f(c)})})},b.prototype.setActive=function(a){var b=this;return l.logger.log(this.user_friendly_id()+".setActive() called. uniqueid="+a),new Promise(function(c,d){-1!=a?c(b.getSourceById(a).getDeviceId()):d()})},b}(j.ProxyObject);b.ScreenSharingRemote=p;var q=function(){function a(){l.logger.log(this.user_friendly_id()+".constructor"),this.sources_=[],this.lastactive_=-1}return a.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(a.prototype,"onscreentopologychanged",{set:function(a){m.getRedirector().screenshare.setTopologyChangeCB(a)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"lastActive",{get:function(){return this.lastactive_},enumerable:!1,configurable:!0}),a.prototype.getSourceById=function(a){return this.sources_.find(function(b){return b.getId()==a})},a.prototype.contains=function(a){return void 0!==this.getSourceById(a)},a.prototype.getWindowsAsync=function(){var a=this;l.logger.log(this.user_friendly_id()+".getWindowsAsync() called.");var b=this.sources_;return this.sources_=[],new Promise(function(c,d){m.getRedirector().screenshare.getSources(new n.getSourcesReqData(2)).then(function(d){if(d=d.map(function(c){var d=b.find(function(a){return a.equivalent(c)});return void 0!==d?(d.setDescription(c.getDescription()),c.getIcon().then(function(a){d.setIcon(a)}).catch(function(){l.logger.log(a.user_friendly_id()+".getWindowsAsync() failed to retrieve new icon.")}),c.getPreviewAsync().then(function(a){d.setPreview(a)}).catch(function(){l.logger.log(a.user_friendly_id()+".getWindowsAsync() failed to retrieve new preview.")}),d):c}),-1!=a.lastactive_){var e=b.find(function(b){return b.getId()==a.lastactive_}),f=d.find(function(b){return b.getId()==a.lastactive_});void 0!==e&&void 0===f&&d.push(e)}a.sources_=d,c(a.sources_)}).catch(function(){l.logger.log(a.user_friendly_id()+".getWindowsAsync(): rejected"),d()})})},a.prototype.activateSource=function(a,b){var c=this;return new Promise(function(d,e){var f=b?"activate":"deactivate";l.logger.log(c.user_friendly_id()+".activateSource() called. action="+f);var g=new n.setActiveReqData(a.srcid,a.hwnd,a.origin,a.pid,!0,!0,b);m.getRedirector().screenshare.setActive(g).then(function(b){l.logger.log(c.user_friendly_id()+": "+f+" success: srcid="+b.srcid+" deviceid="+b.bufferid),a.deviceid=b.bufferid,d(b.bufferid)}).catch(function(){l.logger.log(c.user_friendly_id()+"failed to "+f+": srcid="+a.srcid+", maybe WS Agent is too slow to respond"),e()})})},a.prototype.setActive=function(a,b){var c=this;return l.logger.log(this.user_friendly_id()+".setActive() called. uniqueid="+b),new Promise(function(d,e){a||(b=c.lastactive_),-1!=b?(a?(b!=c.lastactive_&&-1!=c.lastactive_&&c.activateSource(c.getSourceById(c.lastactive_),!1),c.lastactive_=b):c.lastactive_=-1,c.activateSource(c.getSourceById(b),a).then(function(b){d(a?"RemoteApplication-"+b:b)}).catch(function(){e()})):e()})},a}();b.ScreenSharingVda=q;var r=function(){function a(){}return a.Width=140,a.Height=90,a}();a=function(){function a(a,b,c,d,e,f,g,h,i,j){this.uniqueid_=s.nextId_++,this.srcid_=a,this.deviceid_=b,this.type_=c,this.imagedata_=d,this.icon_=e,this.name_=f,this.hwnd_=g,this.origin_=h,this.caption_=i,this.pid_=j}return a.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},Object.defineProperty(a.prototype,"srcid",{get:function(){return this.srcid_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"hwnd",{get:function(){return this.hwnd_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"origin",{get:function(){return this.origin_},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pid",{get:function(){return this.pid_},enumerable:!1,configurable:!0}),a.prototype.getId=function(){return this.uniqueid_},a.prototype.getDeviceId=function(){return this.deviceid_},Object.defineProperty(a.prototype,"deviceid",{set:function(a){this.deviceid_=a},enumerable:!1,configurable:!0}),a.prototype.getType=function(){return 2},a.prototype.getPreview=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreview() called, width:"+a+" height:"+b+" asImage:"+c),Promise.reject(null)},a.prototype.setPreview=function(a){this.imagedata_=a},a.prototype.getPreviewAsync=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+a+" height:"+b),!0===c?(a=f(this.imagedata_,r.Width,r.Height),Promise.resolve({data:a.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},a.prototype.getPreviewImage=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreviewImage() called, width:"+b+" height:"+c),Promise.resolve(g(this.imagedata_,a,b,c))},a.prototype.getDescription=function(){return this.name_},a.prototype.setDescription=function(a){this.name_=a},a.prototype.getIcon=function(a,b,c){return!0===c?(a=f(this.icon_,r.Width,r.Height),Promise.resolve({data:a.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.icon_)},a.prototype.getIconImage=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getIconImage() called, width:"+b+" height:"+c),Promise.resolve(g(this.icon_,a,void 0!==b?b:this.icon_.width,void 0!==c?c:this.icon_.height))},a.prototype.setIcon=function(a){this.icon_=a},a.prototype.getBounds=function(){return{x:0,y:0,width:0,height:0}},a.prototype.equivalent=function(a){return this.pid_===a.pid_&&this.hwnd_===a.hwnd_},a}(),b.ScreenSourceVda=a;var s=function(a){function b(c,d,e){return c=a.call(this,c,k.class_id_t.ScreenSource,d,e)||this,c.screenshare_=new n.ScreenShareUtil,c.uniqueid_=b.nextId_++,l.logger.log(c.user_friendly_id()+".constructor"),c}return h(b,a),b.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},b.prototype.toJSImageData=function(a){var b=atob(a.data.toString()),b=this.screenshare_.str2ab(b),b=new Uint8ClampedArray(b,0,b.byteLength);this.imagedata_=new ImageData(b,a.width,a.height)},b.prototype.syncBarrier=function(){var a=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(b,c){a.syncBarrierDeep(b,c)&&a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){Promise.all([a.remoteInvoke(!1,k.method_id_ScreenSource_t.srcid,0),a.remoteInvoke(!1,k.method_id_ScreenSource_t.deviceid,""),a.remoteInvoke(!1,k.method_id_ScreenSource_t.type,0),a.remoteInvoke(!1,k.method_id_ScreenSource_t.name,""),a.remoteInvoke(!1,k.method_id_ScreenSource_t.imagedata),a.remoteInvoke(!1,k.method_id_ScreenSource_t.hwnd,""),a.remoteInvoke(!1,k.method_id_ScreenSource_t.origin,0),a.remoteInvoke(!1,k.method_id_ScreenSource_t.caption,""),a.remoteInvoke(!1,k.method_id_ScreenSource_t.pid,0)]).then(function(b){l.logger.log(a.user_friendly_id()+".syncBarrier(): success.");var c;b=b.map(function(b){return a.param0(b)}),a.srcid_=b[0],a.deviceid_=b[1],a.type_=b[2],a.name_=b[3],c=b[4],a.hwnd_=b[5],a.origin_=b[6],a.caption_=b[7],a.pid_=b[8],a.toJSImageData(c),a.remoteInvoke(!1,k.method_id_ScreenSource_t.bounds,0).then(function(b){a.bounds_=a.param0(b),a.syncBarrierResolve(a)}).catch(function(b){a.bounds_=void 0,b=a.logRemoteInvokeError(b,".prop.syncBarrier() getBounds failed."),a.syncBarrierReject(b)})}).catch(function(b){b=a.logRemoteInvokeError(b,".prop.syncBarrier() failed."),a.syncBarrierReject(b)})}).catch(function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed."),a.syncBarrierReject(b)})})},b.prototype.getId=function(){return this.uniqueid_},b.prototype.getDeviceId=function(){return this.deviceid_},b.prototype.getType=function(){return 1},b.prototype.getPreview=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreview() called, width:"+a+" height:"+b+" asImage:"+c),Promise.reject(null)},b.prototype.getPreviewAsync=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+a+" height:"+b),!0===c?(a=f(this.imagedata_,r.Width,r.Height),Promise.resolve({data:a.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},b.prototype.getPreviewImage=function(a,b,c){return l.logger.log(this.user_friendly_id()+".getPreviewImage() called, width:"+b+" height:"+c),Promise.resolve(g(this.imagedata_,a,b,c))},b.prototype.getDescription=function(){return this.name_},b.prototype.getIcon=function(a,b){return Promise.resolve(this.imagedata_)},b.prototype.getBounds=function(){return this.bounds_||{x:0,y:0,width:0,height:0}},b.nextId_=i.MonitorsAndApps,b}(j.ProxyObject);b.ScreenSource=s},691:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.ScreenShareUtil=b.Bitmap=b.BitmapInfoHeader=b.BitmapFileHeader=b.setActiveRespData=b.setActiveReqData=b.getSourcesReqData=b.sshare_state=b.sshare_cmd=void 0;var d,e=c(946),f=c(973),g=c(851);!function(a){a[a.Unknown=0]="Unknown",a[a.Cap=1]="Cap",a[a.GetSources=2]="GetSources",a[a.SetActive=3]="SetActive",a[a.TopologyChanged=4]="TopologyChanged"}(d=b.sshare_cmd||(b.sshare_cmd={}));var h;!function(a){a[a.Unknown=0]="Unknown",a[a.Initialized=1]="Initialized",a[a.Error=2]="Error"}(h=b.sshare_state||(b.sshare_state={})),a=function(){return function(a){this.origin=a}}(),b.getSourcesReqData=a,a=function(){return function(a,b,c,d,e,f,g){this.srcid=a,this.hwnd=b,this.origin=c,this.pid=d,this.border=e,this.cursor=f,this.activate=g}}(),b.setActiveReqData=a;var i=function(){return function(a,b,c){this.srcid=a,this.origin=b,this.bufferid=c}}();b.setActiveRespData=i;var j=function(){function a(a,b,c,d,e){this.id_=a,this.resolve_=b,this.reject_=c,this.cmd_=d,this.data_=e,this.sent_=!1,this.timeoutId=void 0}return a.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.id_+"]"},a.prototype.cmdString=function(){return this.cmd_==d.Cap?"Cap":this.cmd_==d.GetSources?"GetSources":this.cmd_==d.SetActive?"SetActive":"Unknown"},a}(),k=function(){return function(){}}();b.BitmapFileHeader=k;var l=function(){return function(){}}();b.BitmapInfoHeader=l;var m=function(){return function(){}}();b.Bitmap=m,a=function(){function a(){this.cmdque_=[]}return a.prototype.reqid=function(){return a.nextId++},a.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},a.prototype.stateString=function(){return a.state_==h.Initialized?"Initialized":a.state_==h.Error?"Error":"Unknown"},a.prototype.reset=function(){a.state_=h.Unknown,this.cmdque_=[]},a.prototype.dispatchCmds=function(){var b=this;a.state_==h.Initialized?this.cmdque_.forEach(function(a){0==a.sent_&&(a.cmd_==d.GetSources?(b.WSSendGetSources(a.id_,a.data_),a.sent_=!0,a.timeoutId=setTimeout(b.abortCmd.bind(b,a.id_),5e3)):a.cmd_==d.SetActive?(b.WSSendSetActive(a.id_,a.data_),a.sent_=!0,a.timeoutId=setTimeout(b.abortCmd.bind(b,a.id_),5e3)):g.logger.log(a.user_friendly_id()+".dispatchCmds(): invalid cmd: "+a.cmdString()))}):a.state_==h.Error?(this.cmdque_.forEach(function(a){g.logger.log(a.user_friendly_id()+".dispatchCmds(): purging cmd: "+a.cmdString()),a.reject_()}),this.cmdque_=[]):g.logger.log(this.user_friendly_id()+".dispatchCmds(): invalid state: "+this.stateString())},a.prototype.abortCmd=function(a){var b=this.cmdque_.findIndex(function(b){return b.id_===a});-1!==b?(b=this.cmdque_.splice(b,1)[0],g.logger.log(b.user_friendly_id()+NaN+b.cmdString()+"]: aborted due to nonresponsive WS Agent!"),b.cmd_===d.SetActive&&b.data_.activate&&f.ScreenSharing.screenSharingInstance().stopAppshare(),b.reject_()):g.logger.log(this.user_friendly_id()+".abortCmd(): Cmd not found!")},a.prototype.finalizeCmd=function(a,b,c){for(var d=0;d<this.cmdque_.length;d++){var e=this.cmdque_[d];if(void 0!=b&&b==e.id_&&1==e.sent_||void 0==b&&1==e.sent_){clearTimeout(e.timeoutId),g.logger.log(e.user_friendly_id()+".finalizeCmd(): purging cmd: "+e.cmdString()),a?void 0!=c?e.resolve_(c):e.resolve_():e.reject_(),this.cmdque_.splice(d,1);break}}},a.prototype.onInitialized=function(b){g.logger.log(this.user_friendly_id()+".onInitialized(): init: "+b+" state:"+this.stateString()),a.state_!=h.Initialized&&(a.state_=b?h.Initialized:h.Error),this.dispatchCmds()},a.prototype.onInitComplete=function(){
g.logger.log(this.user_friendly_id()+".onInitComplete(): state:"+this.stateString()),a.state_==h.Unknown&&(a.state_=h.Error,g.logger.log(this.user_friendly_id()+".onInitComplete(): items in queue:"+this.cmdque_.length),this.dispatchCmds())},a.prototype.onError=function(b){g.logger.log(this.user_friendly_id()+".onError(): state: "+this.stateString()),a.state_==h.Unknown?(a.state_=h.Error,this.dispatchCmds()):a.state_==h.Initialized&&this.finalizeCmd(!1,b)},a.prototype.ab2str=function(a){return String.fromCharCode.apply(null,new Uint8Array(a))},a.prototype.str2ab=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b},a.prototype.getBMP=function(a){var b=new DataView(a),c=new m;return c.fileheader=new k,c.fileheader.bfType=b.getUint16(0,!0),c.fileheader.bfSize=b.getUint32(2,!0),c.fileheader.bfReserved1=b.getUint16(6,!0),c.fileheader.bfReserved2=b.getUint16(8,!0),c.fileheader.bfOffBits=b.getUint32(10,!0),c.infoheader=new l,c.infoheader.biSize=b.getUint32(14,!0),c.infoheader.biWidth=b.getUint32(18,!0),c.infoheader.biHeight=b.getUint32(22,!0),c.infoheader.biPlanes=b.getUint16(26,!0),c.infoheader.biBitCount=b.getUint16(28,!0),c.infoheader.biCompression=b.getUint32(30,!0),c.infoheader.biSizeImage=b.getUint32(34,!0),c.infoheader.biXPelsPerMeter=b.getUint32(38,!0),c.infoheader.biYPelsPerMeter=b.getUint32(42,!0),c.infoheader.biClrUsed=b.getUint32(46,!0),c.infoheader.biClrImportant=b.getUint32(50,!0),b=c.fileheader.bfOffBits,c.stride=4*Math.floor((c.infoheader.biBitCount*c.infoheader.biWidth+31)/32),c.pixels=new Uint8Array(a,b),c},a.prototype.convertToImageData=function(a){var b=document.createElement("canvas").getContext("2d"),c=a.infoheader.biWidth,d=a.infoheader.biHeight,b=b.createImageData(c,d),e=b.data,f=a.pixels;a=a.stride;for(var g=0;g<d;++g)for(var h=0;h<c;++h){var i=4*(h+c*(d-g)),j=4*h+a*g;e[i]=f[j+2],e[i+1]=f[j+1],e[i+2]=f[j],e[i+3]=255}return b},a.prototype.onGetSources=function(a,b){this.sources_=[];var c=this;b.sources.forEach(function(a){var b=a.image,d=atob(b.data),d=c.str2ab(d),d=new Uint8ClampedArray(d,0,d.byteLength),b=new ImageData(d,b.width,b.height),d=a.icon,e=atob(d.data),e=c.str2ab(e),e=new Uint8ClampedArray(e,0,e.byteLength),d=new ImageData(e,d.width,d.height);a=new f.ScreenSourceVda(a.srcid,a.devicdid,a.type,b,d,a.name,a.hwnd,a.origin,a.caption,a.pid),c.sources_.push(a)}),this.finalizeCmd(!0,a,this.sources_)},a.prototype.getSources=function(b){var c=this;return new Promise(function(e,f){if(a.state_!=h.Error){var g=new j(c.reqid(),e,f,d.GetSources,b);c.cmdque_.push(g)}else f();a.state_==h.Initialized&&c.dispatchCmds()})},a.prototype.onSetActive=function(a,b){var c=new i(b.srcid,b.origin,b.bufferid);this.finalizeCmd(!0,a,c)},a.prototype.setActive=function(b){var c=this;return new Promise(function(e,f){if(a.state_!=h.Error){var g=new j(c.reqid(),e,f,d.SetActive,b);c.cmdque_.push(g)}else f();a.state_==h.Initialized&&c.dispatchCmds()})},a.prototype.setTopologyChangeCB=function(a){this.onwindowtopologychanged_=a},a.prototype.onToplogyChanged=function(){this.onwindowtopologychanged_&&this.onwindowtopologychanged_()},a.prototype.WSSendGetSources=function(a,b){try{e.getRedirector().WSSendObject({v:"appsharing",hdr:{command:d.GetSources,id:a},data:{origin:b.origin}})}catch(a){g.logger.log(a)}},a.prototype.WSSendSetActive=function(a,b){try{e.getRedirector().WSSendObject({v:"appsharing",hdr:{command:d.SetActive,id:a},data:{srcid:b.srcid,hwnd:b.hwnd,origin:b.origin,pid:b.pid,border:b.border,cursor:b.cursor,activate:b.activate}})}catch(a){g.logger.log(a)}},a.state_=h.Unknown,a.nextId=0,a}(),b.ScreenShareUtil=a},517:function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.Stats=b.StatsReport=void 0;var c=function(){function a(){this.items=[]}return a.fromJSON=function(b){for(var c=new a,e=0;e<b.length;e++){var f=d.fromJSON(b[e]);c.items.push(f)}return c},a.toRTCStatsReport=function(a){return a},a.prototype.toJSON=function(){return JSON.stringify(this.items)},a.prototype.result=function(){return this.items},a}();b.StatsReport=c;var d=function(){function a(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return a.fromJSON=function(b){var c=new a;return c.id=b.id||"",c.timestamp=b.timestamp||"",c.type=b.type||"",Object.keys(b).forEach(function(a){"id"!==a&&"timestamp"!==a&&"type"!==a&&(c.names_.push(a),c.stat_.set(a,b[a]))}),c},a.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},a.prototype.names=function(){return this.names_},a.prototype.stat=function(a){return this.stat_.get(a)},a}();b.Stats=d},704:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.StreamResolution=b.RemoteCallConstraints=void 0;var e=c(550),f=c(658),g=c(851);a=function(){return function(){}}(),b.RemoteCallConstraints=a,a=function(a){function b(){var b=a.call(this,null,e.class_id_t.StreamResolution,0,f.ProxyMode.Local)||this;return b.lastSentConstraints_=null,b}return d(b,a),Object.defineProperty(b.prototype,"onupdate",{get:function(){return this.onupdate_},set:function(a){var c=this;this.onupdate_=a,this.waitUntilConnected(this.user_friendly_id()+".onupdate").then(function(){var a=c.registerCallbacks(!1,c.isNullCallback(c.onupdate_),e.method_id_StreamResolution_t.onupdate);return a.then(function(a){a=a.params;var d=a[0];a.slice(1),g.logger.log(c.user_friendly_id()+".onupdate",JSON.stringify(d)),c.lastSentConstraints_&&JSON.stringify(c.lastSentConstraints_)==JSON.stringify(d)?g.logger.log(c.user_friendly_id()+".onupdate constraints unchanged, ignoring"):c.onupdate_&&(b.isValidRemoteConstraints(d)?(c.lastSentConstraints_=d,c.onupdate_(c.toICallConstraints(c.lastSentConstraints_))):g.logger.log(c.user_friendly_id()+".onupdate invalid RemoteCallConstraints"))}),c.remoteInvoke(!0,e.method_id_StreamResolution_t.onupdate,a.success)}).catch(function(){return g.logger.log(c.user_friendly_id()+".onupdate, could not set listener")})},enumerable:!1,configurable:!0}),b.prototype.toICallConstraints=function(a){var b={maxParticipantResolutions:null};if(a.max_participant_resolutions_dynamic){b.maxParticipantResolutions={};for(var c=0,d=a.max_participant_resolutions_dynamic;c<d.length;c++){var e=d[c];b.maxParticipantResolutions[e.count]=e.resolution}}else a.max_participant_resolutions_static&&(b.maxParticipantResolutions=a.max_participant_resolutions_static);return b.maxIncomingStreams=a.max_incoming_streams,b.maxOutgoingResolution=a.max_outgoing_resolution,b.maxSimulcastLayers=a.max_simulcast_layers,g.logger.log(this.user_friendly_id()+".toICallConstraints: "+JSON.stringify(b)),b},b.isValidRemoteConstraints=function(a){return null!=a&&(null!=a.max_participant_resolutions_dynamic||null!=a.max_participant_resolutions_static)&&null!=a.max_incoming_streams&&null!=a.max_outgoing_resolution&&null!=a.max_simulcast_layers},b.prototype.getCallConstraints=function(){var a=this;return new Promise(function(c,d){a.waitUntilConnected(a.user_friendly_id()+".getCallConstraints").then(function(){return a.remoteInvoke(!1,e.method_id_StreamResolution_t.getCallConstraints)}).then(function(e){e=a.param0(e),g.logger.log(a.user_friendly_id()+".getCallConstraints",JSON.stringify(e)),b.isValidRemoteConstraints(e)?(a.onupdate_&&(a.lastSentConstraints_=e),c(a.toICallConstraints(e))):(g.logger.log(a.user_friendly_id()+".getCallConstraints invalid RemoteCallConstraints"),d())}).catch(function(){g.logger.log(a.user_friendly_id()+".getCallConstraints promise rejected"),d()})})},b.getDefaultConstraints=function(){var a={maxParticipantResolutions:{1:720,2:720,3:360,more:360},maxIncomingStreams:4,maxOutgoingResolution:720,maxSimulcastLayers:0};return g.logger.log("StreamResolution.getDefaultConstraints: "+JSON.stringify(a)),a},b.prototype.updateStreamResolution=function(){var a=this;this.getCallConstraints().then(function(b){return a.onupdate&&a.onupdate(b)}).catch(function(){return g.logger.log("Failed to get stream resolution information!")})},b}(f.ProxyObject),b.StreamResolution=a},394:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.Telemetry=b.tel_key_CPUTotalmemory=b.tel_key_CPUGpuinfo=b.tel_key_CPUMachineid=b.tel_key_CPUProcessors=b.tel_key_CPUCores=b.tel_key_CPUModel=b.tel_key_CPUSpeed=b.tel_key_OSEdition=b.tel_key_OSDistro=b.tel_key_OSArchitecture=b.tel_key_OSVersion=b.tel_key_OSFamily=b.tel_key_VerHdxRtcEngine=b.tel_key_VerTypeScript=b.tel_key_VerEndpoint=b.tel_key_VerVda=b.tel_key_VerReceiver=b.tel_key_VerWebrtcCodecs=b.tel_key_VerWebrpc=b.tel_key_PerfCallType=b.tel_key_PerfCallState=b.tel_key_PerfCallDirection=b.tel_key_SpeakerDeviceUsed=b.tel_key_VideoDeviceUsed=b.tel_key_AudioDeviceUsed=b.tel_key_CallEstOutgoing=b.tel_key_CallEstIncoming=b.tel_key_ScreensharingCallDuration=b.tel_key_VideoCallDuration=b.tel_key_AudioCallDuration=b.tel_key_ConferenceCallDuration=b.tel_cmd=b.tel_CallType=b.tel_CallDirection=b.tel_CallState=void 0;var d=c(946),e=c(851);!function(a){a[a.unknown=0]="unknown",a[a.active=1]="active",a[a.idle=2]="idle"}(b.tel_CallState||(b.tel_CallState={})),function(a){a[a.unknown=0]="unknown",a[a.incoming=1]="incoming",a[a.outgoing=2]="outgoing"}(b.tel_CallDirection||(b.tel_CallDirection={})),function(a){a[a.unknown=0]="unknown",a[a.audio=1]="audio",a[a.video=2]="video",a[a.multi=3]="multi",a[a.dshare=4]="dshare"}(b.tel_CallType||(b.tel_CallType={}));var f;!function(a){a[a.Unknown=0]="Unknown",a[a.Cap=1]="Cap",a[a.Init=2]="Init",a[a.Data=3]="Data"}(f=b.tel_cmd||(b.tel_cmd={})),b.tel_key_ConferenceCallDuration="ConferenceCallDuration",b.tel_key_AudioCallDuration="AudioCallDuration",b.tel_key_VideoCallDuration="VideoCallDuration",b.tel_key_ScreensharingCallDuration="ScreensharingCallDuration",b.tel_key_CallEstIncoming="CallEstIncoming",b.tel_key_CallEstOutgoing="CallEstOutgoing",b.tel_key_AudioDeviceUsed="AudioDeviceUsed",b.tel_key_VideoDeviceUsed="VideoDeviceUsed",b.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed",b.tel_key_PerfCallDirection="PerfCallDirection",b.tel_key_PerfCallState="PerfCallState",b.tel_key_PerfCallType="PerfCallType",b.tel_key_VerWebrpc="VerWebrpc",b.tel_key_VerWebrtcCodecs="VerWebrtcCodecs",b.tel_key_VerReceiver="VerReceiver",b.tel_key_VerVda="VerVda",b.tel_key_VerEndpoint="VerEndpoint",b.tel_key_VerTypeScript="VerTypeScript",b.tel_key_VerHdxRtcEngine="VerHdxRtcEngine",b.tel_key_OSFamily="OSFamily",b.tel_key_OSVersion="OSVersion",b.tel_key_OSArchitecture="OSArchitecture",b.tel_key_OSDistro="OSDistro",b.tel_key_OSEdition="OSEdition",b.tel_key_CPUSpeed="CPUSpeed",b.tel_key_CPUModel="CPUModel",b.tel_key_CPUCores="CPUCores",b.tel_key_CPUProcessors="CPUProcessors",b.tel_key_CPUMachineid="CPUMachineid",b.tel_key_CPUGpuinfo="CPUGpuinfo",b.tel_key_CPUTotalmemory="CPUTotalmemory";var g=function(){function a(a,b,c,d){this.cmd=a,this.key=b,this.value=c,this.flags=d}return a.prototype.SendTelemetryData=function(a){a.SendTelemetryData(this.cmd,this.key,this.value,this.flags)},a}();a=function(){function a(){this.id=0,this.deferredData=[]}return a.prototype.reset=function(){this.id=0,this.deferredData=[]},a.prototype.onInitialized=function(a){for(this.id=a;this.deferredData&&0<this.deferredData.length;)this.deferredData.shift().SendTelemetryData(this)},a.prototype.SendTelemetryInit=function(){0<this.id&&this.reset();try{d.getRedirector().WSSendObject({v:"telemetry",hdr:{command:f.Init,id:0},init:{domain:"HDXMM Teams",subdomain:"Teams",feature:"msteams",version:"1.1.1.1"}})}catch(a){e.logger.log(a)}},a.prototype.SendTelemetryData=function(a,b,c,h){if(a!=f.Data)e.logger.log("invalid telemetry command!");else if(0==this.id)this.deferredData.push(new g(a,b,c,h));else try{d.getRedirector().WSSendObject({v:"telemetry",hdr:{command:a,id:this.id},data:{key:b,value:c,flags:h}})}catch(a){e.logger.log(a)}},a}(),b.Telemetry=a},259:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.Util=void 0;var d=c(851);a=function(){function a(){}return a.stringifyArray=function(a){for(var b="[",c=0;c<a.length;++c)0!=c&&(b+=","),b+=this.stringify(a[c]);return b+"]"},a.stringifyObject=function(a){var b,c="{",d=!0;for(b in a)d?d=!1:c+=",",c=c+'"'+b+'":',c=a[b]instanceof Array?c+this.stringifyArray(a[b]):"object"==typeof a[b]?c+this.stringifyObject(a[b]):c+JSON.stringify(a[b]);return c+"}"},a.stringify=function(a){return"object"==typeof a?"[object Array]"==Object.prototype.toString.call(a)?this.stringifyArray(a):this.stringifyObject(a):JSON.stringify(a)},a.GetObjectPropertyDescriptor=function(a,b){for(var c=void 0;a!=Object.prototype&&void 0===(c=Object.getOwnPropertyDescriptor(a,b));)a=a.__proto__;return c},a.sendEvent=function(a,b){try{var c=document.createEvent("Event");c.initEvent(b,!0,!0),a.dispatchEvent(c)}catch(a){d.logger.log('sendEvent(): exception dispatching "'+b+'" event: '+a.message)}},a.hasValue=function(a){var b=!1;return null!==a&&void 0!==a&&(b=!0),b},a}(),b.Util=a},307:function(a,b,c){var e=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},f=this&&this.__generator||function(a,b){function c(a){return function(b){return e([a,b])}}function e(c){if(f)throw new TypeError("Generator is already executing.");for(;j;)try{if(f=1,g&&(h=2&c[0]?g.return:c[0]?g.throw||((h=g.return)&&h.call(g),0):g.next)&&!(h=h.call(g,c[1])).done)return h;switch(g=0,h&&(c=[2&c[0],h.value]),c[0]){case 0:case 1:h=c;break;case 4:return j.label++,{value:c[1],done:!1};case 5:j.label++,g=c[1],c=[0];continue;case 7:c=j.ops.pop(),j.trys.pop();continue;default:if(h=j.trys,!(h=0<h.length&&h[h.length-1])&&(6===c[0]||2===c[0])){j=0;continue}if(3===c[0]&&(!h||c[1]>h[0]&&c[1]<h[3]))j.label=c[1];else if(6===c[0]&&j.label<h[1])j.label=h[1],h=c;else{if(!(h&&j.label<h[2])){h[2]&&j.ops.pop(),j.trys.pop();continue}j.label=h[2],j.ops.push(c)}}c=b.call(a,j)}catch(a){c=[6,a],g=0}finally{f=h=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var f,g,h,i,j={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return d.initSymbol(),d.initSymbol(),d.initSymbolIterator(),i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},g=c(360),h=c(144);c(679);var i=c(945),j=c(368),k=c(851).logger,l=c(650),m=c(973),n=c(247).getGC,o=c(946),p=c(613).E911Service;a=c(550);var q=a.Features,r=a.FEATURE_vda_delete_viewport,s=c(704).StreamResolution,t=c(239).E;!function(a,b){a.CitrixWebRTC=function(){function a(a,b){k.log("VDI Shim createMediaStreamInternal"),w();var c=new h.RemoteStream(null,0,0,a),d=new Promise(function(a,b){c.syncBarrier().then(function(b){k.log("stream.syncBarrier(): success."),a(b)}).catch(function(a){k.log("stream.syncBarrier(): failed with error: "+JSON.stringify(a)),c.release(),b()})});return b?d:c}function b(a){null==K&&(K=new j.Frames(!Q.isFeatureSupported(q.FEATURE_public_multi_window))),a(K)}function c(a,c){b(function(b){var d=b.findFrame(a);void 0==d&&(d=b.newFrame(a)),c(d)})}function d(a,c){b(function(b){null!=(b=b.findFrame(a))&&c(b)})}function u(a){o.getRedirector().SendTelemetryData_Speaker(a)}function v(a,b){if(M)try{"vdiE911InfoChanged"===a?a="vdiE911DataChanged":"vdiCallConstraintsChanged"===a&&(a="vdiStreamConstraintsChanged");var c=Object.assign({event:a},b);k.log("Dispatching VM event:"+JSON.stringify(c)),M(c)}catch(b){k.log("Exception onVMEvent(), eventName:"+a+" message:"+b.message)}}function w(){var a=window.getCitrixWebrtcRedir;void 0!==a?a().then(function(a){k.log("sucesss on connect, getCitrixWebrtcRedir reg value:"+a),"1"!==a||Q||(k.log("supported client"),y(T))}).catch(function(){k.log("Failure to Read Webrtc redir Reg Key"),C()}):(k.log("window.getCitrixWebrtcRedir() method is not available yet"),C())}function x(a){if(k.log("VDI Event: vdiClientDisconnected"),E(),!0===a&&!1===P){k.log("VDI Event: vdiClientDisconnected with failure reported"),P=!0;try{M({event:"vdiClientDisconnected",reason:"failure",msg:"Websocket Connection Failure"})}catch(a){k.log("onVMEvent(): exception: "+a.message)}}else{P=!1;try{M({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(a){k.log("onVMEvent(): exception: "+a.message)}}}function y(a){k.log("initRemoteSession with vendor:"+a),Q||(Q=new l.RemoteSession("CitrixWebRTCSDK",a))}function z(){k.log("VDI Event: onVdiClientDisconnectedTimer"),y(T)}function A(){var a=this;k.log("VDI Shim onVdiClientConnected..."),Q?Q.getSessionInfo().then(function(c){return e(a,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return k.log("VDI Shim onVdiClientConnected, client endpoint info:"+JSON.stringify(c)),J&&J.isValid()||(J=new h.RemoteDevices),H&&H.isValid()||(H=new h.NavigatorUserMedia),b(function(a){a.reconnect()}),v("vdiClientConnected",{version:c,endpointId:c.endpointId}),[4,H.getCapabilities().then(function(a){k.log("VDI Shim onVdiClientConnected, caps = "+a)}).catch(function(){k.log("VDI Shim onVdiClientConnected, could not get capabilities")})];case 1:return a.sent(),N||(N=new p,N.onupdate=function(a){v("vdiE911InfoChanged",a)},N.updateE911Info()),O||(v("vdiCallConstraintsChanged",s.getDefaultConstraints()),null!==Q&&l.RemoteSession.isFeatureCallConstraintsSupported()&&(O=new s,O.onupdate=function(a){v("vdiCallConstraintsChanged",a)},O.updateStreamResolution())),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange")),[2]}})})}).catch(function(){k.log("VDI Shim onVdiClientConnected, getSessionInfo failure! Session is not fully connected yet...")}):k.log("VDI Shim onVdiClientConnected, remoteSession does not exist")}function B(a){if("1"===a)k.log("Supported client"),o.getRedirector().pingConnectionBegin(!0);else if("0"===a){k.log("VDI Event: Unsupported client reported");try{M({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(a){k.log("onVMEvent(): exception: "+a.message)}}else k.log("Citrix Webrtc Redir Reg Key value is incorrect")}function C(){!1===R&&(k.log("starting MS Reg retry..."),R=!0,D(10))}function D(a){if(0>=a){R=!1,k.log("VDI Event: Reg Key not Updated after timer reported, Fallback");try{M({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix Webrtc Redir Reg Key not Present"})}catch(a){k.log("onVMEvent(): exception: "+a.message)}}else{var b=window.getCitrixWebrtcRedir;void 0!==b?b().then(function(b){k.log("CitrixMSTeamsRedir reg value:"+b),"0"===b||"1"===b?(B(b),R=!1):(k.log("MS Teams Redir Reg key not updated - Start timer"),setTimeout(function(){k.log("Timer waiting for registry to be updated count :"+a),D(--a)},1e3))}).catch(function(){k.log("Failure to Read MS Teams redir Reg Key - Start timer"),setTimeout(function(){k.log("Timer waiting for registry to be updated count :"+a),D(--a)},1e3)}):(k.log("window.getCitrixWebrtcRedir() method is not available yet"),setTimeout(function(){k.log("Timer waiting for registry to be updated count :"+a),D(--a)},1e3))}}function E(){k.log("VDI : cleanup"),o.getRedirector().clearReqs(),h.NavigatorUserMedia.resetCapabilities(),K=J=H=null,L&&L.release(),Q&&Q.release(),Q=null,m.ScreenSharing.destroyInstance(),N&&(N.release(),N=null),O&&(O.release(),O=null),n().reset(),k.log("VDI : cleanup done")}function F(){return m.ScreenSharing.screenSharingInstance(function(){if(M)try{M({event:"vdiScreenTopologyChanged"})}catch(a){k.log("onVMEvent('vdiScreenTopologyChanged'): exception: "+a.message)}})}function G(a){if(!S)throw k.log("VDI Shim "+a+": throwing exception: not initialized!!"),new DOMException("UCSDK is not initialized!!!")}var H=null,I=h.NavigatorUserMedia.getCapabilities,J=null,K=null,L=null,M=null,N=null,O=null,P=!1,Q=void 0,R=!1,S=!1,T=void 0;return{Features:q,CitrixPeerConnection:g.PeerConnection,getUserMedia:function(a,b,c){G("getUserMedia"),w(),k.log("VDI Shim getUserMedia"),null!==H&&H.isValid()||(H=new h.NavigatorUserMedia);var d=h.RemoteMediaStreamConstraints.isConstraintsAudioDeviceIdEmpty(a),e=h.RemoteMediaStreamConstraints.isConstraintsVideoSourceIdEmpty(a);return d||e?new Promise(function(d,e){J.enumerateDevices().then(function(d){return H.webkitGetUserMedia(a,b,c)}).then(function(a){k.log("webkitGetUserMedia for default was resolved"),d(a)}).catch(function(a){k.log("getUserMedia() for default failed with error:"+JSON.stringify(a)),e()})}):H.webkitGetUserMedia(a,b,c)},getDisplayMedia:function(a){return G("getDisplayMedia"),w(),k.log("VDI Shim getDisplayMedia"),null!==J&&J.isValid()||(J=new h.RemoteDevices),J.getDisplayMedia(a)},enumerateDevices:function(){return G("enumerateDevices"),w(),k.log("VDI Shim enumerateDevices"),null!==J&&J.isValid()||(J=new h.RemoteDevices),J.enumerateDevices()},onWindowClose:function(a,c,d){G("onWindowClose"),k.log("VDI Shim onWindowClose: (handle: "+a+")"),o.getRedirector().getVDAFeatureValue(r)&&b(function(b){b.disposeFrame(a)})},setClientAreaOffset:function(a,b,d){G("setClientAreaOffset"),k.log("VDI setClientAreaOffset with xOffset = "+a+", yOffset = "+b+", windowHandle = "+d),w(),c(d,function(c){c.setClientAreaOffset(a,b)})},mapVideoElement:function(a,b){G("mapVideoElement"),k.log("VDI New Video Element Created, Creating Mapping to Thin Client DOM"),w(),c(b,function(b){b.newVideoElement(a)})},mapAudioElement:function(a){if(G("mapAudioElement"),k.log("VDI New Audio Element Created, Creating Mapping to VDA"),void 0!==a.remoteAudioElement)k.log("Audio element is already configured!");else{w(),delete a.remoteAudioElement,Object.defineProperty(a,"remoteAudioElement",{writable:!0,configurable:!0,value:null}),a.remoteAudioElement=new i.AudioElement,delete a.sinkId,Object.defineProperty(a,"sinkId",{configurable:!0,get:function(){return a.remoteAudioElement?a.remoteAudioElement.sinkId:void 0},set:function(b){k.log("VDI Shim set audio element SinkId value = "+b),a.setSinkId(b).then(function(){k.log("VDI Shim set audio element SinkId success")}).catch(function(){k.log("VDI Shim set audio element SinkId failure")})}});var b=a.remoteAudioElement.play;a.play=function(){return k.log("VDI Shim remote audio play"),b.apply(a.remoteAudioElement,arguments)};var c=a.remoteAudioElement.pause;a.pause=function(){return k.log("VDI Shim remote audio pause"),c.apply(a.remoteAudioElement,arguments)},a.setSinkId=function(b){k.log("VDI Shim set audio element SinkId value = "+b);var c,d=a.remoteAudioElement.setSinkId(b);return h.enumeratedDevices.forEach(function(a){b===a.deviceId&&(c=a.label)}),u(c),d},delete a.srcObject,Object.defineProperty(a,"srcObject",{configurable:!0,get:function(){return a.remoteAudioElement?a.remoteAudioElement.srcObject:void 0},set:function(b){k.log("VDI Shim set audio element srcObject "+JSON.stringify(b)),a.remoteAudioElement.srcObject=b}})}},disposeVideoElement:function(a,b){G("disposeVideoElement"),k.log("VDI Shim disposeVideoElement: "),d(b,function(b){b.disposeVideoElement(a)})},disposeAudioElement:function(a,b,c){G("disposeAudioElement"),k.log("VDI Shim disposeAudioElement: "),a&&(b=a.remoteAudioElement)&&(b.dispose(),a.remoteAudioElement=void 0)},setVMEventCallback:function(a){var b=this;M=a,o.getRedirector().isConnected()&&Q.getSessionInfo().then(function(a){return e(b,void 0,void 0,function(){return f(this,function(b){return k.log("VDI Shim onVdiClientConnected, client endpoint info:"+JSON.stringify(a)),v("vdiClientConnected",{version:a,endpointId:a.endpointId}),[2]})})}),k.log("VDI Event Callback Set")},playNotifyAudio:function(a,b){G("playNotifyAudio"),k.log("VDI Shim Audio playNotifyAudio audioId:"+a+" src:"+b),L&&L.playNotifyAudio(a,b)},stopNotifyAudio:function(a,b){G("stopNotifyAudio"),k.log("VDI Shim Audio pauseNotifyAudio audioId:"+a+" src:"+b),L&&L.pauseNotifyAudio(a,b)},setSinkId:function(a,b){G("setSinkId"),k.log("VDI Shim Audio setSinkId audioId:"+a+" sinkId:"+b),L&&L.setSinkId(a,b)},getLoop:function(a){G("getLoop");var b;return L&&(b=L.getLoop(a)),k.log("VDI Shim Audio getLoop audioId:"+a+" loop: "+b),b},setLoop:function(a,b){G("setLoop"),k.log("VDI Shim Audio setLoop audioId:"+a+" bool:"+b),L&&L.setLoop(a,b)},addClipRect:function(a,b){G("addClipRect"),k.log("VDI Adding Occlusion "+JSON.stringify(a)),c(b,function(b){b.addOcclusion(a)})},removeClipRect:function(a,b){G("removeClipRect"),k.log("VDI Removing Occlusion "+JSON.stringify(a)),c(b,function(b){b.removeOcclusion(a)})},initLog:function(a,b){k.setMSLogger(a,b),k.log("VDI init logger")},isFeatureOn:function(a){return G("isFeatureOn"),!!Q&&Q.isFeatureSupported(a)},onConnectionChange:function(a){G("onConnectionChange"),k.log("VDI : onConnectionChange to "+a),!1===a?k.log("Disconnecting from the VDA"):(k.log("Connecting to the VDA"),a=window.getCitrixWebrtcRedir,void 0!==a?a().then(function(a){k.log("Sucesss on connect, CitrixRedir reg value:"+a),"0"===a||"1"===a?B(a):(k.log("MS Teams Redir Reg key not updated yet"),C())}).catch(function(){k.log("Failure to Read MS Teams redir Reg Key"),C()}):(k.log("window.getCitrixWebrtcRedir() method is not available yet"),C()))},getScreensAsync:function(){G("getScreensAsync"),k.log("VDI Shim getScreensAsync"),w();var a=F();return a.getScreensAsync.apply(a,arguments)},getWindowsAsync:function(){G("getWindowsAsync"),k.log("VDI Shim getWindowsAsync"),w();var a=F();return a.getWindowsAsync.apply(a,arguments)},setScreenSharePanelId:function(a){G("setScreenSharePanelId"),k.log("VDI: setScreenSharePanelId set to "+JSON.stringify(a)),w(),null!==J&&J.isValid()||(J=new h.RemoteDevices),J.panelid=a},setCodecCapabilities:function(a){return G("setCodecCapabilities"),w(),k.log("VDI Shim setCodecCapabilities"),null!==H&&H.isValid()||(H=new h.NavigatorUserMedia),H.setCodecCapabilities(a)},getE911Data:function(){return G("getE911Data"),N?N.getE911Info():null},createMediaStream:function(b){return G("createMediaStream"),k.log("VDI Shim createMediaStream"),a(b,!1)},createMediaStreamAsync:function(b){return G("createMediaStreamAsync"),k.log("VDI Shim createMediaStreamAsync"),a(b,!0)},disposeMediaStream:function(a){G("disposeMediaStream"),k.log("VDI Shim disposeMediaStream: ");for(var b=0;b<a.length;b++){var c=a[b];c&&c.dispose()}},getCapabilities:function(a){return G("getCapabilities"),w(),k.log("VDI Shim getCapabilities"),null!==H&&H.isValid()||(H=new h.NavigatorUserMedia,I=h.NavigatorUserMedia.getCapabilities),I.apply(H,arguments)},initUCSDK:function(a){k.log("VDI Shim initUCSDK vendor:"+a);var b=!0;if(void 0==a||null==a||"string"!=typeof a||0==a.length?b=!1:0==a.split(" ").join("").length&&(b=!1),!b)throw k.log("VDI Shim initUCSDK: throwing exception: vendor info cannot be empty!!!"),new DOMException("vendor info cannot be empty, please pass vendor info string!!!");S||(T=a,H=new h.NavigatorUserMedia,J=new h.RemoteDevices,L=new t,J=new h.RemoteDevices,y(T),window.onVdiClientDisconnected=x,window.onVdiClientDisconnectedTimer=z,window.onVdiClientConnected=A,S=!0)},deinitUCSDK:function(){k.log("VDI Shim deinitUCSDK"),S&&(o.getRedirector().terminateOptimization(),E(),window.onVdiClientDisconnected=void 0,window.onVdiClientDisconnectedTimer=void 0,T=window.onVdiClientConnected=void 0,S=!1)}}}()}("undefined"!=typeof self?self:this)},679:function(a,b,c){var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0}),b.VideoElement=b.VideoRect=void 0;var e=c(658),f=c(550),g=c(851),h=c(946),i=c(550),j=function(){return function(a,b){this.x=Math.round(a.x)*b.devicePixelRatio,this.y=Math.round(a.y)*b.devicePixelRatio,this.width=Math.round(a.width)*b.devicePixelRatio,this.height=Math.round(a.height)*b.devicePixelRatio}}();b.VideoRect=j;var k;!function(a){a[a.pixels=0]="pixels",a[a.percent=1]="percent"}(k||(k={}));var l,m=function(){function a(a){this.value=parseInt(a),this.units=this.detectUnits(a)}return a.prototype.detectUnits=function(a){return-1===a.toLowerCase().indexOf("px")?k.pixels:k.percent},a}();!function(a){a[a.fill=0]="fill",a[a.contain=1]="contain",a[a.cover=2]="cover"}(l||(l={}));var n,o=function(){return function(a,b){this.x=a,this.y=b}}(),p=function(){function a(a,b,c){this.fit=this.convertFit(a),this.position=new o(b,c)}return a.prototype.convertFit=function(a){return"fill"==a?l.fill:"contain"==a?l.contain:"cover"==a?l.cover:l.fill},a}();!function(a){a[a.NotReady=0]="NotReady",a[a.Ready=1]="Ready"}(n||(n={})),a=function(a){function b(b,c){var d=a.call(this,null,f.class_id_t.VideoElement,0,e.ProxyMode.Local)||this;return d.srcObject_=null,d.sinkId_="",d.videoWidth=0,d.videoHeight=0,d.isLoaded=!1,d.connectionState="disconnected",d.styleObserver=null,d.readyState_=n.NotReady,d.deferredVideoActions=[],d.pendingRelease_=!1,d.activeConnectionEvent_=null,d.connectionEventQueue_=[],d.window_=c,d.elementId=b,g.logger.log("VideoElement.constructor (elementid: "+b+")"),d}return d(b,a),b.prototype.dispose=function(){var a=this;g.logger.log("VideoElement.dispose (elementId: "+this.elementId+" oid: "+this.object_id()+")"),this.pendingRelease_=!0,this.srcObject=this.ontimeupdate=this.onloadedmetadata=null,this.waitUntilReady("VideoElement.dispose").then(function(){}).catch(function(){a.pendingRelease_=!1,a.setState("disconnected"),a.onconnectionstatechange=null,a.release()}),this.onReady()},b.prototype.setState=function(a){this.connectionState=a,this.onconnectionstatechange_&&this.onconnectionstatechange_()},Object.defineProperty(b.prototype,"Id",{get:function(){return this.elementId},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(a){var b=this;g.logger.log("VideoElement.sinkId: (id="+a+")"),this.waitUntilConnected("VideoElement.sinkId").then(function(){return void 0!=a?b.remoteInvoke(!0,f.method_id_VideoElement_t.sinkId,a):new Promise(function(a){return a(void 0)})}).then(function(){g.logger.log("videoElement: setting state to ready. (oid: "+b.object_id()+")"),b.sinkId_=a,b.readyState_=n.Ready,b.onReady()}).catch(function(a){b.logRemoteInvokeError(a,".set_sinkId() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(a){if(g.logger.log(this.user_friendly_id()+".srcObject: set srcObject... this.srcObject:"+this.srcObject+" obj:"+a),this.srcObject_!==a){var b=h.getRedirector().getFeatureValue(i.FEATURE_ms_teams_1911);null!==this.srcObject_&&(null===a&&b&&this.disconnect(),b||this.disconnect(),this.isLoaded=!1),this.srcObject_=a,null!==this.srcObject_&&this.connectTo(this.srcObject_)}},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(a){g.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=a},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onloadedmetadata",{set:function(a){g.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=a},enumerable:!1,configurable:!0}),b.prototype.setupOnVideoFrameChanged=function(){var a=this,b=this.registerCallbacks(!1,!1,f.method_id_VideoElement_t.onvideoframechanged);b.then(function(b){g.logger.log(a.user_friendly_id()+".onvideoframechanged",b.params),a.videoWidth=b.params[0]||0,a.videoHeight=b.params[1]||0,a.isLoaded||(a.isLoaded=!0,a.onloadedmetadata_&&a.onloadedmetadata_())}),
this.remoteInvoke(!0,f.method_id_VideoElement_t.onvideoframechanged,b.success)},b.prototype.processConnectionEvent=function(){var a=this;if(0!==this.connectionEventQueue_.length&&!this.activeConnectionEvent_){var b=this.connectionEventQueue_.pop();"connectTo"==b.operation?this.activeConnectionEvent_=this.connectToAsync(b.param):"disconnect"==b.operation&&(this.activeConnectionEvent_=this.disconnectAsync()),this.activeConnectionEvent_.then(function(){a.activeConnectionEvent_=void 0,a.processConnectionEvent()}).catch(function(){g.logger.log(a.user_friendly_id()+" : Failed to handle connection event! "),a.activeConnectionEvent_=void 0,a.processConnectionEvent()})}},b.prototype.connectTo=function(a){this.connectionEventQueue_.push({operation:"connectTo",param:a}),this.processConnectionEvent()},b.prototype.disconnect=function(){this.connectionEventQueue_.push({operation:"disconnect",param:null}),this.processConnectionEvent()},b.prototype.connectToAsync=function(a){var b=this;return new Promise(function(c,d){g.logger.log(b.user_friendly_id()+".connectTo: connect media stream with id = "+a.id+", clone_id = "+a.clone_state.clone_id),b.streamId_=a.id,b.waitUntilReady("VideoElement.connectTo").then(function(){return a.waitUntilConnected("MediaStream.connectTo")}).then(function(){return b.setupOnVideoFrameChanged(),a.clone_state.synchronize(a)}).then(function(a){g.logger.log(b.user_friendly_id()+".connectTo: remote invoking");var c=b.registerCallbacks(!0,!1,f.method_id_VideoElement_t.connectTo);return Promise.all([b.remoteInvokeEx(!1,f.method_id_VideoElement_t.connectTo,[a],c.success,c.fail),c.prom()])}).then(function(a){g.logger.log(b.user_friendly_id()+".connectTo: remote media stream is connected!"),b.setState("connected"),b.watch(),b.updateTimer=setInterval(function(){b.ontimeupdate&&b.ontimeupdate()},250),(a=b.window_.document.getElementById(b.elementId))&&b.updateStyle(a),c()}).catch(function(a){b.logRemoteInvokeError(a,".connectTo: failed to connect!"),d()})})},b.prototype.disconnectAsync=function(){var a=this;return new Promise(function(b,c){g.logger.log(a.user_friendly_id()+".disconnect: disconnecting stream : "+a.streamId_),a.unwatch(),a.waitUntilReady("VideoElement.disconnect").then(function(){a.updateTimer&&clearInterval(a.updateTimer);var b=a.registerCallbacks(!1,!0,f.method_id_VideoElement_t.onvideoframechanged);return a.remoteInvoke(!0,f.method_id_VideoElement_t.onvideoframechanged,b.success),a.remoteInvoke(!1,f.method_id_VideoElement_t.disconnect)}).then(function(){g.logger.log(a.user_friendly_id()+".disconnect: remote media stream is disconnected!"),a.setState("disconnected"),1==a.pendingRelease_&&(a.pendingRelease_=!1,a.onconnectionstatechange=null,a.release()),b()}).catch(function(b){a.logRemoteInvokeError(b,".disconnect: failed to connect!"),c()})})},b.prototype.setFrame=function(a){var b=this;g.logger.log(this.user_friendly_id()+".setFrame: set video frame to",a.x,a.y,a.width,a.height),this.waitUntilReady("VideoElement.setFrame").then(function(){var c=new j(a,b.window_);return b.remoteInvoke(!1,f.method_id_VideoElement_t.setFrame,c)}).then(function(){g.logger.log(b.user_friendly_id()+".setFrame: success!")}).catch(function(a){b.logRemoteInvokeError(a,".setFrame: failed to connect!")})},b.prototype.addClipRect=function(a){var b=this;g.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(a)),this.waitUntilReady("VideoElement.addClipRect").then(function(){var c=new j(a,b.window_);return b.remoteInvoke(!1,f.method_id_VideoElement_t.addClipRect,c)}).catch(function(a){b.logRemoteInvokeError(a,".addClipRect failed!")})},b.prototype.removeClipRect=function(a){var b=this;g.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(a)),this.waitUntilReady("VideoElement.removeClipRect").then(function(){var c=new j(a,b.window_);return b.remoteInvoke(!1,f.method_id_VideoElement_t.removeClipRect,c)}).catch(function(a){b.logRemoteInvokeError(a,".removeClipRect failed!")})},b.prototype.watch=function(){var a=this;if(h.getRedirector().getFeatureValue(i.FEATURE_ms_teams_video_placement)){var b=this.window_.document.getElementById(this.elementId);b&&(this.unwatch(),this.styleObserver=new MutationObserver(function(b){b.forEach(function(b){"style"==b.attributeName?a.updateStyle(b.target):a.elementId=b.target.id})}),this.styleObserver.observe(b,{attributes:!0,attributeOldValue:!0,attributeFilter:["style","id"]}))}},b.prototype.unwatch=function(){this.styleObserver&&(this.styleObserver.disconnect(),this.styleObserver=null)},b.prototype.updateStyle=function(a){if("connected"==this.connectionState){var b=this.window_.getComputedStyle(a).getPropertyValue("object-fit"),c=this.window_.getComputedStyle(a).getPropertyValue("object-position").split(" ");a=new m(c[0]),c=new m(c[1]),this.placement=new p(b,a,c)}else g.logger.log(this.user_friendly_id()+".updateStyle: video element is not connected")},Object.defineProperty(b.prototype,"placement",{get:function(){return this.placement_},set:function(a){var b=this;h.getRedirector().getFeatureValue(i.FEATURE_ms_teams_video_placement)?this.waitUntilReady("VideoElement.placement").then(function(){return b.remoteInvoke(!0,f.method_id_VideoElement_t.placement,a)}).then(function(){b.placement_=a}).catch(function(a){b.logRemoteInvokeError(a,".placement setter: failed to connect!")}):g.logger.log(this.user_friendly_id()+".placement: video placement feature is not supported on a client")},enumerable:!1,configurable:!0}),b.prototype.waitUntilReady=function(a){var b=this;return new Promise(function(c,d){g.logger.log("VideoElement.waitUntilReady(): readyState="+b.readyState_+". (oid: "+b.object_id()+")"),b.readyState_==n.Ready?c():(g.logger.log('videoElement.waitUntilReady(): deferring action "'+a+'". (oid: '+b.object_id()+")"),b.deferredVideoActions.push(new e.deferred_action(c,d,a)))})},b.prototype.onReady=function(){for(;this.deferredVideoActions&&0<this.deferredVideoActions.length;)this.deferredVideoActions.shift().post(this.readyState_==n.Ready)},b}(e.ProxyObject),b.VideoElement=a},269:function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.HardwareInfo=b.MemoryInfo=b.GPUInfo=b.GPU=b.CPUInfo=b.WebrpcClassLibInfo=b.WebrpcClassInfo=b.WebrpcMethodInfo=b.EndpointId=b.OSInfo=b.WebrpcFeatureInfo=b.FeatureData=b.VersionData=b.FEATURE_unsupported=b.FEATURE_ms_teams_redirection=void 0,b.FEATURE_ms_teams_redirection="ms_teams_redirection",b.FEATURE_unsupported="unsupported";var c=function(){return function(a,b,c,d){this.major=a,this.minor=b,this.revision=c,this.build=d}}();b.VersionData=c,c=function(){return function(){}}(),b.FeatureData=c,c=function(){return function(a,b){this.fature=a,this.version=b}}(),b.WebrpcFeatureInfo=c,c=function(){return function(a,b,c,d,e){this.family=a,this.version=b,this.architecture=c,this.distro=d,this.edition=e}}(),b.OSInfo=c,c=function(){return function(a,b){this.machine_id=a,this.user_id=b}}(),b.EndpointId=c,c=function(){return function(a,c,d,e,f){void 0===f&&(f=b.FEATURE_ms_teams_redirection),this.iid=a,this.mid=c,this.name=d,this.isprop=e,this.feature=f}}(),b.WebrpcMethodInfo=c,c=function(){return function(a,b,c){this.id=a,this.name=b,this.methods=c}}(),b.WebrpcClassInfo=c,c=function(){return function(a,b){this.name=a,this.classes=b}}(),b.WebrpcClassLibInfo=c,c=function(){return function(a,b){this.cpumodel=a,this.numberofprocessors=b}}(),b.CPUInfo=c,c=function(){return function(a,b){this.name=a,this.driver=b}}(),b.GPU=c,c=function(){return function(a){this.gpus=a}}(),b.GPUInfo=c,c=function(){return function(a){this.totalmemory=a}}(),b.MemoryInfo=c,c=function(){return function(a,b,c){this.cpu_info=a,this.gpu_info=b,this.memory_info=c}}(),b.HardwareInfo=c},550:function(a,b,c){var d=this&&this.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c),Object.defineProperty(a,d,{enumerable:!0,get:function(){return b[c]}})}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]});a=this&&this.__exportStar||function(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||d(b,a,c)},Object.defineProperty(b,"__esModule",{value:!0}),b.WebrpcClassLibInfoUtil=void 0;var e=c(187);a(c(187),b),c=function(){function a(){}return a.getInterfaceByid=function(a){for(var b=0,c=e.class_lib_info.classes;b<c.length;b++){var d=c[b];if(d.id==a)return d}return null},a.getMethodByid=function(a,b){var c=this.getInterfaceByid(a);if(null!=c)for(var d=0,c=c.methods;d<c.length;d++){var e=c[d];if(e.mid==b)return e}return null},a.getMethodFeatureByid=function(a,b){var c=this.getInterfaceByid(a);if(null!=c)for(var d=0,c=c.methods;d<c.length;d++){var e=c[d];if(e.mid==b)return e.feature}return null},a.composeClassInfoData=function(a){if(void 0==(a=a.hdr))return"*** Invalid packet: Couldn't find hdr object ***";var b=a.proc;if(void 0==b)return"";a=b.iid;for(var b=b.methodid,c=0,d=e.class_lib_info.classes;c<d.length;c++){var f=d[c];if(f.id==a)for(var g=0,h=f.methods;g<h.length;g++){var i=h[g];if(i.mid==b)return f.name+"::"+i.name}}return""},a}(),b.WebrpcClassLibInfoUtil=c},187:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.class_lib_info=b.method_id_StreamResolution_t=b.method_id_RTCSctpTransport_t=b.method_id_RTCDataChannel_t=b.method_id_E911Service_t=b.method_id_ScreenSource_t=b.method_id_VDISharingRemote_t=b.method_id_RTCRtpTransceiver_t=b.method_id_RTCIceCandidatePair_t=b.method_id_RTCDTMFToneChangeEvent_t=b.method_id_RTCDTMFSender_t=b.method_id_RTCIceTransport_t=b.method_id_RTCDtlsTransport_t=b.method_id_RTCRtpSender_t=b.method_id_RTCRtpReceiver_t=b.method_id_AudioElement_t=b.method_id_VideoElement_t=b.method_id_MediaStreamEvent_t=b.method_id_RTCIceCandidateEvent_t=b.method_id_RTCIceCandidate_t=b.method_id_NavigatorUserMedia_t=b.method_id_MediaStream_t=b.method_id_MediaStreamTrack_t=b.method_id_RTCSessionDescription_t=b.method_id_MediaDeviceInfo_t=b.method_id_MediaDevices_t=b.method_id_RTCPeerConnection_t=b.method_id_EngineControl_t=b.class_id_t=b.vdaFeatureNameMap=b.featureNameMap=b.Features=b.FEATURE_ms_teams_sender_stats_fix=b.FEATURE_ms_teams_enumerate_devices_v2=b.FEATURE_ms_teams_track_clone_with_id=b.FEATURE_ms_teams_audio_notifications_loop=b.FEATURE_ms_teams_share_system_audio=b.FEATURE_ms_teams_stream_active_status=b.FEATURE_ms_teams_hardware_info=b.FEATURE_ms_teams_secondary_audio_notifications=b.FEATURE_ms_teams_stream_resolution=b.FEATURE_ms_teams_client_info=b.FEATURE_ms_teams_no_vd_buffer_limit=b.FEATURE_ms_teams_data_channel=b.FEATURE_ms_teams_webrtc_1dot0=b.FEATURE_ms_teams_multi_window=b.FEATURE_ms_teams_gtc=b.FEATURE_ms_teams_e911=b.FEATURE_ms_teams_codec_capability=b.FEATURE_ms_teams_app_sharing=b.FEATURE_ms_teams_monitor_sharing=b.FEATURE_ms_teams_video_placement=b.FEATURE_ms_teams_dtmf=b.FEATURE_ms_teams_device_group_id=b.FEATURE_ms_teams_remote_audio_notifications=b.FEATURE_ms_teams_endpoint_id=b.FEATURE_ms_teams_osinfo=b.FEATURE_ms_teams_mstrack_constraints=b.FEATURE_ms_teams_1912=b.FEATURE_ms_teams_pstn=b.FEATURE_ms_teams_1911=b.FEATURE_ms_teams_common_media_constraints=b.FEATURE_ms_teams_speaking_indicator=b.FEATURE_ms_teams_desktop_sharing=b.FEATURE_vda_delete_viewport=b.FEATURE_vda_multi_window=b.FEATURE_vda_app_sharing=b.FEATURE_vda_service_no_buffer_limit=b.HDXMS_VERSION=b.BUILD_TYPE_SDK=void 0,a=c(269);var d=c(269);Object.defineProperty(b,"VersionData",{enumerable:!0,get:function(){return d.VersionData}}),Object.defineProperty(b,"FeatureData",{enumerable:!0,get:function(){return d.FeatureData}}),Object.defineProperty(b,"OSInfo",{enumerable:!0,get:function(){return d.OSInfo}}),Object.defineProperty(b,"EndpointId",{enumerable:!0,get:function(){return d.EndpointId}}),Object.defineProperty(b,"HardwareInfo",{enumerable:!0,get:function(){return d.HardwareInfo}}),b.BUILD_TYPE_SDK=!0,b.HDXMS_VERSION="3.1.0",b.FEATURE_vda_service_no_buffer_limit="wsservice_no_buffer_limit",b.FEATURE_vda_app_sharing="webrtc_app_sharing",b.FEATURE_vda_multi_window="webrtc_multi_window",b.FEATURE_vda_delete_viewport="overlay_delete_viewport",b.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing",b.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator",b.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints",b.FEATURE_ms_teams_1911="ms_teams_1911",b.FEATURE_ms_teams_pstn="ms_teams_pstn",b.FEATURE_ms_teams_1912="ms_teams_1912",b.FEATURE_ms_teams_mstrack_constraints="ms_teams_mstrack_constraints",b.FEATURE_ms_teams_osinfo="ms_teams_osinfo",b.FEATURE_ms_teams_endpoint_id="ms_teams_endpoint_id",b.FEATURE_ms_teams_remote_audio_notifications="ms_teams_remote_audio_notifications",b.FEATURE_ms_teams_device_group_id="ms_teams_device_group_id",b.FEATURE_ms_teams_dtmf="ms_teams_dtmf",b.FEATURE_ms_teams_video_placement="ms_teams_video_placement",b.FEATURE_ms_teams_monitor_sharing="ms_teams_multi_monitor_sharing",b.FEATURE_ms_teams_app_sharing="ms_teams_app_sharing",b.FEATURE_ms_teams_codec_capability="ms_teams_codec_capability",b.FEATURE_ms_teams_e911="ms_teams_e911",b.FEATURE_ms_teams_gtc="ms_teams_gtc",b.FEATURE_ms_teams_multi_window="ms_teams_multi_windows",b.FEATURE_ms_teams_webrtc_1dot0="ms_teams_webrtc_1.0",b.FEATURE_ms_teams_data_channel="ms_teams_data_channel",b.FEATURE_ms_teams_no_vd_buffer_limit="ms_teams_no_vd_buffer_limit",b.FEATURE_ms_teams_client_info="ms_teams_client_info",b.FEATURE_ms_teams_stream_resolution="ms_teams_stream_resolution",b.FEATURE_ms_teams_secondary_audio_notifications="ms_teams_secondary_audio_notifications",b.FEATURE_ms_teams_hardware_info="ms_teams_hardware_info",b.FEATURE_ms_teams_stream_active_status="ms_teams_stream_active_status",b.FEATURE_ms_teams_share_system_audio="ms_teams_share_system_audio",b.FEATURE_ms_teams_audio_notifications_loop="ms_teams_audio_notifications_loop",b.FEATURE_ms_teams_track_clone_with_id="ms_teams_track_clone_with_id",b.FEATURE_ms_teams_enumerate_devices_v2="ms_teams_enumerate_devices_v2",b.FEATURE_ms_teams_sender_stats_fix="ms_teams_sender_stats_fix",new a.WebrpcFeatureInfo(a.FEATURE_ms_teams_redirection,new a.VersionData(1,1,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_desktop_sharing,new a.VersionData(1,2,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_speaking_indicator,new a.VersionData(1,2,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_common_media_constraints,new a.VersionData(1,4,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_1911,new a.VersionData(1,4,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_1912,new a.VersionData(1,5,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_mstrack_constraints,new a.VersionData(1,6,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_pstn,new a.VersionData(1,6,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_osinfo,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_endpoint_id,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_remote_audio_notifications,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_device_group_id,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_codec_capability,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_dtmf,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_video_placement,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_monitor_sharing,new a.VersionData(1,7,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_app_sharing,new a.VersionData(1,8,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_webrtc_1dot0,new a.VersionData(1,8,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_data_channel,new a.VersionData(1,8,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_e911,new a.VersionData(1,13,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_multi_window,new a.VersionData(1,14,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_client_info,new a.VersionData(1,19,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_stream_resolution,new a.VersionData(1,25,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_secondary_audio_notifications,new a.VersionData(1,21,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_hardware_info,new a.VersionData(1,35,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_stream_active_status,new a.VersionData(1,32,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_audio_notifications_loop,new a.VersionData(1,33,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_track_clone_with_id,new a.VersionData(1,33,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_enumerate_devices_v2,new a.VersionData(1,35,0,0)),new a.WebrpcFeatureInfo(b.FEATURE_ms_teams_sender_stats_fix,new a.VersionData(1,36,0,0)),c=function(){function a(){}return a.FEATURE_public_screenshare="screenshare",a.FEATURE_public_redirection="redirection",a.FEATURE_public_speaking_indicator="speaking_indicator",a.FEATURE_public_pstn="pstn",a.FEATURE_public_osinfo="osinfo",a.FEATURE_public_endpoint_id="endpointid",a.FEATURE_public_remote_audio_notifications="remoteaudionotifications",a.FEATURE_public_device_group_id="compositedevices",a.FEATURE_public_dtmf="dtmf",a.FEATURE_public_monitor_sharing="multimonitorscreenshare",a.FEATURE_public_app_sharing="appshare",a.FEATURE_public_codec_capability="codec_capability",a.FEATURE_public_e911="e911",a.FEATURE_public_webrtc1dot0="webrtc1.0",a.FEATURE_public_data_channel="datachannel",a.FEATURE_public_vdnobuflimit="vdnobuflimit",a.FEATURE_public_multi_window="multiwindow",a.FEATURE_public_secondary_audio_notifications="secondaryringer",a.FEATURE_public_stream_resolution="streamresolution",a.FEATURE_public_track_clone_with_id="track_clone_with_id",a.FEATURE_public_sender_stats_fix="sender_stats_fix",a.FEATURE_public_audio_notification_loop="loop",a}(),b.Features=c,b.featureNameMap={},b.featureNameMap[c.FEATURE_public_screenshare]=[b.FEATURE_ms_teams_desktop_sharing],b.featureNameMap[c.FEATURE_public_redirection]=[a.FEATURE_ms_teams_redirection],b.featureNameMap[c.FEATURE_public_speaking_indicator]=[b.FEATURE_ms_teams_speaking_indicator],b.featureNameMap[c.FEATURE_public_pstn]=[b.FEATURE_ms_teams_pstn],b.featureNameMap[c.FEATURE_public_osinfo]=[b.FEATURE_ms_teams_osinfo],b.featureNameMap[c.FEATURE_public_endpoint_id]=[b.FEATURE_ms_teams_endpoint_id],b.featureNameMap[c.FEATURE_public_remote_audio_notifications]=[b.FEATURE_ms_teams_remote_audio_notifications,b.FEATURE_ms_teams_secondary_audio_notifications],b.featureNameMap[c.FEATURE_public_device_group_id]=[b.FEATURE_ms_teams_device_group_id],b.featureNameMap[c.FEATURE_public_dtmf]=[b.FEATURE_ms_teams_dtmf],b.featureNameMap[c.FEATURE_public_monitor_sharing]=[b.FEATURE_ms_teams_monitor_sharing],b.featureNameMap[c.FEATURE_public_app_sharing]=[b.FEATURE_ms_teams_app_sharing],b.featureNameMap[c.FEATURE_public_codec_capability]=[b.FEATURE_ms_teams_codec_capability],b.featureNameMap[c.FEATURE_public_e911]=[b.FEATURE_ms_teams_e911],b.featureNameMap[c.FEATURE_public_webrtc1dot0]=[b.FEATURE_ms_teams_webrtc_1dot0],b.featureNameMap[c.FEATURE_public_multi_window]=[b.FEATURE_ms_teams_multi_window],b.featureNameMap[c.FEATURE_public_data_channel]=[b.FEATURE_ms_teams_data_channel],b.featureNameMap[c.FEATURE_public_vdnobuflimit]=[b.FEATURE_ms_teams_no_vd_buffer_limit],b.featureNameMap[c.FEATURE_public_secondary_audio_notifications]=[b.FEATURE_ms_teams_remote_audio_notifications,b.FEATURE_ms_teams_secondary_audio_notifications],b.featureNameMap[c.FEATURE_public_stream_resolution]=[b.FEATURE_ms_teams_stream_resolution],b.featureNameMap[c.FEATURE_public_track_clone_with_id]=[b.FEATURE_ms_teams_track_clone_with_id],b.featureNameMap[c.FEATURE_public_sender_stats_fix]=[b.FEATURE_ms_teams_sender_stats_fix],b.featureNameMap[c.FEATURE_public_audio_notification_loop]=[b.FEATURE_ms_teams_audio_notifications_loop],b.vdaFeatureNameMap={},b.vdaFeatureNameMap[c.FEATURE_public_multi_window]=[b.FEATURE_vda_multi_window],b.vdaFeatureNameMap[c.FEATURE_public_app_sharing]=[b.FEATURE_vda_app_sharing],function(a){a[a.EngineControl=0]="EngineControl",a[a.RTCPeerConnection=1]="RTCPeerConnection",a[a.RTCSessionDescription=2]="RTCSessionDescription",a[a.RTCIceCandidate=3]="RTCIceCandidate",a[a.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",a[a.MediaDevices=5]="MediaDevices",a[a.MediaDeviceInfo=6]="MediaDeviceInfo",a[a.MediaStreamTrack=7]="MediaStreamTrack",a[a.MediaStreamEvent=8]="MediaStreamEvent",a[a.MediaStream=9]="MediaStream",a[a.NavigatorUserMedia=10]="NavigatorUserMedia",a[a.VideoElement=11]="VideoElement",a[a.AudioElement=12]="AudioElement",a[a.RTCRtpReceiver=13]="RTCRtpReceiver",a[a.RTCRtpSender=14]="RTCRtpSender",a[a.RTCDtlsTransport=15]="RTCDtlsTransport",a[a.RTCIceTransport=16]="RTCIceTransport",a[a.RTCDTMFSender=17]="RTCDTMFSender",a[a.RTCDTMFToneChangeEvent=18]="RTCDTMFToneChangeEvent",a[a.RTCIceCandidatePair=19]="RTCIceCandidatePair",a[a.RTCRtpTransceiver=20]="RTCRtpTransceiver",a[a.ScreenSharingRemote=21]="ScreenSharingRemote",a[a.ScreenSource=22]="ScreenSource",a[a.E911Service=23]="E911Service",a[a.reserved2=24]="reserved2",a[a.RTCDataChannel=25]="RTCDataChannel",a[a.RTCSctpTransport=26]="RTCSctpTransport",a[a.StreamResolution=27]="StreamResolution",a[a.VideoEffect=28]="VideoEffect",a[a.reserved6=29]="reserved6",a[a.reserved7=30]="reserved7",a[a.reserved8=31]="reserved8"}(c=b.class_id_t||(b.class_id_t={}));var e;!function(a){a[a.ctor=0]="ctor",a[a.version=1]="version",a[a.feature_flags=2]="feature_flags",a[a.version_info=3]="version_info",a[a.osinfo=4]="osinfo",a[a.endpoint_id=5]="endpoint_id",a[a.set_client_info=6]="set_client_info",a[a.hardware_info=7]="hardware_info"}(e=b.method_id_EngineControl_t||(b.method_id_EngineControl_t={}));var f;!function(a){a[a.ctor=0]="ctor",a[a.localDescription=1]="localDescription",a[a.remoteDescription=2]="remoteDescription",a[a.readyState=3]="readyState",a[a.iceState=4]="iceState",a[a.localStreams=5]="localStreams",a[a.remoteStreams=6]="remoteStreams",a[a.createOffer=7]="createOffer",a[a.createAnswer=8]="createAnswer",a[a.setLocalDescription=9]="setLocalDescription",a[a.setRemoteDescription=10]="setRemoteDescription",a[a.updateIce=11]="updateIce",a[a.addIceCandidate=12]="addIceCandidate",a[a.addStream=13]="addStream",a[a.removeStream=14]="removeStream",a[a.close=15]="close",a[a.iceConnectionState=16]="iceConnectionState",a[a.iceGatheringState=17]="iceGatheringState",a[a.signalingState=18]="signalingState",a[a.onaddstream=19]="onaddstream",a[a.onicecandidate=20]="onicecandidate",a[a.oniceconnectionstatechange=21]="oniceconnectionstatechange",a[a.onicegatheringstatechange=22]="onicegatheringstatechange",a[a.onsignalingstatechange=23]="onsignalingstatechange",a[a.onnegotiationneeded=24]="onnegotiationneeded",a[a.onremovestream=25]="onremovestream",a[a.getStats=26]="getStats",a[a.getReceivers=27]="getReceivers",a[a.getSenders=28]="getSenders",a[a.addTrack=29]="addTrack",a[a.removeTrack=30]="removeTrack",a[a.ontrack=31]="ontrack",a[a.setLocalDescription_v2=32]="setLocalDescription_v2",a[a.setRemoteDescription_v2=33]="setRemoteDescription_v2",a[a.addTransceiverWithTrack=34]="addTransceiverWithTrack",a[a.addTransceiverWithKind=35]="addTransceiverWithKind",a[a.getTransceivers=36]="getTransceivers",a[a.onconnectionstatechange=37]="onconnectionstatechange",a[a.sctp=38]="sctp",a[a.ondatachannel=39]="ondatachannel",a[a.createDataChannel=40]="createDataChannel",a[a.getStats_v2=41]="getStats_v2"}(f=b.method_id_RTCPeerConnection_t||(b.method_id_RTCPeerConnection_t={}));var g;!function(a){a[a.ctor=0]="ctor",a[a.enumerateDevices=1]="enumerateDevices",a[a.getDisplayMedia=2]="getDisplayMedia",a[a.ondevicechange=3]="ondevicechange",a[a.enumerateDevicesV2=4]="enumerateDevicesV2"}(g=b.method_id_MediaDevices_t||(b.method_id_MediaDevices_t={}));var h;!function(a){a[a.ctor=0]="ctor",a[a.deviceId=1]="deviceId",a[a.kind=2]="kind",a[a.label=3]="label",a[a.groupId=4]="groupId"}(h=b.method_id_MediaDeviceInfo_t||(b.method_id_MediaDeviceInfo_t={}));var i;!function(a){a[a.ctor=0]="ctor",a[a.type=1]="type",a[a.sdp=2]="sdp"}(i=b.method_id_RTCSessionDescription_t||(b.method_id_RTCSessionDescription_t={}));var j;!function(a){a[a.ctor=0]="ctor",a[a.kind=1]="kind",a[a.id=2]="id",a[a.label=3]="label",a[a.enabled=4]="enabled",a[a.muted=5]="muted",a[a.readyState=6]="readyState",a[a.onended=7]="onended",a[a.onmute=8]="onmute",a[a.onunmute=9]="onunmute",a[a.clone=10]="clone",a[a.stop=11]="stop",a[a.getCapabilities=12]="getCapabilities",a[a.getSettings=13]="getSettings",a[a.applyConstraints=14]="applyConstraints",a[a.getConstraints=15]="getConstraints"}(j=b.method_id_MediaStreamTrack_t||(b.method_id_MediaStreamTrack_t={}));var k;!function(a){a[a.ctor=0]="ctor",a[a.id=1]="id",a[a.getAudioTracks=2]="getAudioTracks",a[a.getVideoTracks=3]="getVideoTracks",a[a.getTracks=4]="getTracks",a[a.getTrackById=5]="getTrackById",a[a.addTrack=6]="addTrack",a[a.removeTrack=7]="removeTrack",a[a.clone=8]="clone",a[a.active=9]="active"}(k=b.method_id_MediaStream_t||(b.method_id_MediaStream_t={}));var l;!function(a){a[a.ctor=0]="ctor",a[a.getUserMedia=1]="getUserMedia",a[a.setCodecCapabilities=2]="setCodecCapabilities",a[a.getCapabilities=3]="getCapabilities"}(l=b.method_id_NavigatorUserMedia_t||(b.method_id_NavigatorUserMedia_t={}));var m;!function(a){a[a.ctor=0]="ctor",a[a.candidate=1]="candidate",a[a.sdpMid=2]="sdpMid",a[a.sdpMLineIndex=3]="sdpMLineIndex"}(m=b.method_id_RTCIceCandidate_t||(b.method_id_RTCIceCandidate_t={}));var n;!function(a){a[a.ctor=0]="ctor",a[a.candidate=1]="candidate"}(n=b.method_id_RTCIceCandidateEvent_t||(b.method_id_RTCIceCandidateEvent_t={}));var o;!function(a){a[a.ctor=0]="ctor",a[a.stream=1]="stream"}(o=b.method_id_MediaStreamEvent_t||(b.method_id_MediaStreamEvent_t={}));var p;!function(a){a[a.ctor=0]="ctor",a[a.sinkId=1]="sinkId",a[a.connectTo=2]="connectTo",a[a.disconnect=3]="disconnect",a[a.setFrame=4]="setFrame",a[a.addClipRect=5]="addClipRect",a[a.removeClipRect=6]="removeClipRect",a[a.onerror=7]="onerror",a[a.onvideoframechanged=8]="onvideoframechanged",a[a.placement=9]="placement"}(p=b.method_id_VideoElement_t||(b.method_id_VideoElement_t={}));var q;!function(a){a[a.ctor=0]="ctor",a[a.sinkId=1]="sinkId",a[a.srcObject=2]="srcObject",a[a.src=3]="src",a[a.play=4]="play",a[a.pause=5]="pause",a[a.loop=6]="loop"}(q=b.method_id_AudioElement_t||(b.method_id_AudioElement_t={}));var r;!function(a){a[a.ctor=0]="ctor",a[a.track=1]="track",a[a.getContributingSources=2]="getContributingSources",a[a.getSynchronizationSources=3]="getSynchronizationSources",a[a.transport=4]="transport",a[a.rtcpTransport=5]="rtcpTransport",a[a.getCapabilities=6]="getCapabilities",a[a.getParameters=7]="getParameters",a[a.getStats=8]="getStats",a[a.getCapabilities_v2=9]="getCapabilities_v2"}(r=b.method_id_RTCRtpReceiver_t||(b.method_id_RTCRtpReceiver_t={}));var s;!function(a){a[a.ctor=0]="ctor",a[a.track=1]="track",a[a.transport=2]="transport",a[a.rtcpTransport=3]="rtcpTransport",a[a.dtmf=4]="dtmf",a[a.getCapabilities=5]="getCapabilities",a[a.getParameters=6]="getParameters",a[a.setParameters=7]="setParameters",a[a.replaceTrack=8]="replaceTrack",a[a.getStats=9]="getStats",a[a.setStreams=10]="setStreams",a[a.getCapabilities_v2=11]="getCapabilities_v2"}(s=b.method_id_RTCRtpSender_t||(b.method_id_RTCRtpSender_t={}));var t;!function(a){a[a.ctor=0]="ctor",a[a.transport=1]="transport",a[a.state=2]="state",a[a.getRemoteCertificates=3]="getRemoteCertificates",a[a.onstatechange=4]="onstatechange",a[a.onerror=5]="onerror"}(t=b.method_id_RTCDtlsTransport_t||(b.method_id_RTCDtlsTransport_t={}));var u;!function(a){a[a.ctor=0]="ctor",a[a.role=1]="role",a[a.component=2]="component",a[a.state=3]="state",a[a.gatheringState=4]="gatheringState",a[a.localcandidates=5]="localcandidates",a[a.remotecandidates=6]="remotecandidates",a[a.onstatechange=7]="onstatechange",a[a.ongatheringstatechange=8]="ongatheringstatechange",a[a.onselectedcandidatepairchange=9]="onselectedcandidatepairchange"}(u=b.method_id_RTCIceTransport_t||(b.method_id_RTCIceTransport_t={}));var v;!function(a){a[a.ctor=0]="ctor",a[a.insertDTMF=1]="insertDTMF",a[a.ontonechange=2]="ontonechange",a[a.canInsertDTMF=3]="canInsertDTMF",a[a.toneBuffer=4]="toneBuffer"}(v=b.method_id_RTCDTMFSender_t||(b.method_id_RTCDTMFSender_t={}));var w;!function(a){a[a.ctor=0]="ctor",a[a.tone=1]="tone",a[a.tone_buffer=2]="tone_buffer"}(w=b.method_id_RTCDTMFToneChangeEvent_t||(b.method_id_RTCDTMFToneChangeEvent_t={}));var x;!function(a){a[a.ctor=0]="ctor",a[a.local=1]="local",a[a.remote=2]="remote"}(x=b.method_id_RTCIceCandidatePair_t||(b.method_id_RTCIceCandidatePair_t={}));var y;!function(a){a[a.ctor=0]="ctor",a[a.mid=1]="mid",a[a.sender=2]="sender",a[a.receiver=3]="receiver",a[a.direction=4]="direction",a[a.currentDirection=5]="currentDirection",a[a.stop=6]="stop",a[a.setCodecPreferences=7]="setCodecPreferences"}(y=b.method_id_RTCRtpTransceiver_t||(b.method_id_RTCRtpTransceiver_t={}));var z;!function(a){a[a.ctor=0]="ctor",a[a.getScreensAsync=1]="getScreensAsync",a[a.onscreentopologychanged=2]="onscreentopologychanged"}(z=b.method_id_VDISharingRemote_t||(b.method_id_VDISharingRemote_t={}));var A;!function(a){a[a.ctor=0]="ctor",a[a.srcid=1]="srcid",a[a.deviceid=2]="deviceid",a[a.type=3]="type",a[a.name=4]="name",a[a.imagedata=5]="imagedata",a[a.hwnd=6]="hwnd",a[a.origin=7]="origin",a[a.caption=8]="caption",a[a.pid=9]="pid",a[a.bounds=10]="bounds"}(A=b.method_id_ScreenSource_t||(b.method_id_ScreenSource_t={}));var B;!function(a){a[a.ctor=0]="ctor",a[a.getE911Info=1]="getE911Info",a[a.onupdate=2]="onupdate"}(B=b.method_id_E911Service_t||(b.method_id_E911Service_t={}));var C;!function(a){a[a.ctor=0]="ctor",a[a.label=1]="label",a[a.ordered=2]="ordered",a[a.maxPacketLifeTime=3]="maxPacketLifeTime",a[a.maxRetransmits=4]="maxRetransmits",a[a.protocol=5]="protocol",a[a.negotiated=6]="negotiated",a[a.id=7]="id",a[a.readyState=8]="readyState",a[a.bufferedAmount=9]="bufferedAmount",a[a.bufferedAmountLowThreshold=10]="bufferedAmountLowThreshold",a[a.onopen=11]="onopen",a[a.onbufferedamountlow=12]="onbufferedamountlow",a[a.onerror=13]="onerror",a[a.onclosing=14]="onclosing",a[a.onclose=15]="onclose",a[a.onmessage=16]="onmessage",a[a.close=17]="close",a[a.send_text=18]="send_text",a[a.send_binary=19]="send_binary"}(C=b.method_id_RTCDataChannel_t||(b.method_id_RTCDataChannel_t={}));var D;!function(a){a[a.ctor=0]="ctor",a[a.transport=1]="transport",a[a.state=2]="state",a[a.maxMessageSize=3]="maxMessageSize",a[a.maxChannels=4]="maxChannels",a[a.onstatechange=5]="onstatechange"}(D=b.method_id_RTCSctpTransport_t||(b.method_id_RTCSctpTransport_t={}));var E;!function(a){a[a.ctor=0]="ctor",a[a.getCallConstraints=1]="getCallConstraints",a[a.onupdate=2]="onupdate"}(E=b.method_id_StreamResolution_t||(b.method_id_StreamResolution_t={})),
b.class_lib_info=new a.WebrpcClassLibInfo("webrpc_class_library",[new a.WebrpcClassInfo(c.EngineControl,"EngineControl",[new a.WebrpcMethodInfo(c.EngineControl,e.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.EngineControl,e.version,"version",!0),new a.WebrpcMethodInfo(c.EngineControl,e.feature_flags,"feature_flags",!0),new a.WebrpcMethodInfo(c.EngineControl,e.version_info,"version_info",!0,b.FEATURE_ms_teams_desktop_sharing),new a.WebrpcMethodInfo(c.EngineControl,e.osinfo,"osinfo",!0,b.FEATURE_ms_teams_osinfo),new a.WebrpcMethodInfo(c.EngineControl,e.endpoint_id,"endpoint_id",!0,b.FEATURE_ms_teams_endpoint_id),new a.WebrpcMethodInfo(c.EngineControl,e.set_client_info,"set_client_info",!1,b.FEATURE_ms_teams_client_info),new a.WebrpcMethodInfo(c.EngineControl,e.hardware_info,"hardware_info",!0,b.FEATURE_ms_teams_hardware_info)]),new a.WebrpcClassInfo(c.RTCPeerConnection,"RTCPeerConnection",[new a.WebrpcMethodInfo(c.RTCPeerConnection,f.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.localDescription,"localDescription",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.remoteDescription,"remoteDescription",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.readyState,"readyState",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.iceState,"iceState",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.localStreams,"localStreams",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.remoteStreams,"remoteStreams",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.createOffer,"createOffer",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.createAnswer,"createAnswer",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.setLocalDescription,"setLocalDescription",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.setRemoteDescription,"setRemoteDescription",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.updateIce,"updateIce",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.addIceCandidate,"addIceCandidate",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.addStream,"addStream",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.removeStream,"removeStream",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.close,"close",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.iceConnectionState,"iceConnectionState",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.iceGatheringState,"iceGatheringState",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.signalingState,"signalingState",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onaddstream,"onaddstream",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onicecandidate,"onicecandidate",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onicegatheringstatechange,"onicegatheringstatechange",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onsignalingstatechange,"onsignalingstatechange",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onnegotiationneeded,"onnegotiationneeded",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onremovestream,"onremovestream",!0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.getStats,"getStats",!1),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.getReceivers,"getReceivers",!1,b.FEATURE_ms_teams_speaking_indicator),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.getSenders,"getSenders",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.addTrack,"addTrack",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.removeTrack,"removeTrack",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.ontrack,"ontrack",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.setLocalDescription_v2,"setLocalDescription_v2",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.setRemoteDescription_v2,"setRemoteDescription_v2",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.addTransceiverWithTrack,"addTransceiverWithTrack",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.addTransceiverWithKind,"addTransceiverWithKind",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.getTransceivers,"getTransceivers",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.onconnectionstatechange,"onconnectionstatechange",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.sctp,"sctp",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.ondatachannel,"ondatachannel",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.createDataChannel,"createDataChannel",!1,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCPeerConnection,f.getStats_v2,"getStats_v2",!1,b.FEATURE_ms_teams_webrtc_1dot0)]),new a.WebrpcClassInfo(c.RTCSessionDescription,"RTCSessionDescription",[new a.WebrpcMethodInfo(c.RTCSessionDescription,i.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.RTCSessionDescription,i.type,"type",!0),new a.WebrpcMethodInfo(c.RTCSessionDescription,i.sdp,"sdp",!0)]),new a.WebrpcClassInfo(c.RTCIceCandidate,"RTCIceCandidate",[new a.WebrpcMethodInfo(c.RTCIceCandidate,m.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.RTCIceCandidate,m.candidate,"candidate",!0),new a.WebrpcMethodInfo(c.RTCIceCandidate,m.sdpMid,"sdpMid",!0),new a.WebrpcMethodInfo(c.RTCIceCandidate,m.sdpMLineIndex,"sdpMLineIndex",!0)]),new a.WebrpcClassInfo(c.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new a.WebrpcMethodInfo(c.RTCIceCandidateEvent,n.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.RTCIceCandidateEvent,n.candidate,"candidate",!0)]),new a.WebrpcClassInfo(c.MediaDevices,"MediaDevices",[new a.WebrpcMethodInfo(c.MediaDevices,g.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.MediaDevices,g.enumerateDevices,"enumerateDevices",!1),new a.WebrpcMethodInfo(c.MediaDevices,g.getDisplayMedia,"getDisplayMedia",!1,b.FEATURE_ms_teams_desktop_sharing),new a.WebrpcMethodInfo(c.MediaDevices,g.ondevicechange,"ondevicechange",!0,b.FEATURE_ms_teams_speaking_indicator),new a.WebrpcMethodInfo(c.MediaDevices,g.enumerateDevicesV2,"enuerateDevicesV2",!1,b.FEATURE_ms_teams_enumerate_devices_v2)]),new a.WebrpcClassInfo(c.MediaDeviceInfo,"MediaDeviceInfo",[new a.WebrpcMethodInfo(c.MediaDeviceInfo,h.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.MediaDeviceInfo,h.deviceId,"deviceId",!0),new a.WebrpcMethodInfo(c.MediaDeviceInfo,h.kind,"kind",!0),new a.WebrpcMethodInfo(c.MediaDeviceInfo,h.label,"label",!0),new a.WebrpcMethodInfo(c.MediaDeviceInfo,h.groupId,"groupId",!0)]),new a.WebrpcClassInfo(c.MediaStreamTrack,"MediaStreamTrack",[new a.WebrpcMethodInfo(c.MediaStreamTrack,j.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.clone,"clone",!1),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.stop,"stop",!1),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.getCapabilities,"getCapabilities",!1),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.getSettings,"getSettings",!1),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.applyConstraints,"applyConstraints",!1,b.FEATURE_ms_teams_desktop_sharing),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.kind,"kind",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.id,"id",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.label,"label",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.enabled,"enabled",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.muted,"muted",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.readyState,"readyState",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.onended,"onended",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.onmute,"onmute",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.onunmute,"onunmute",!0),new a.WebrpcMethodInfo(c.MediaStreamTrack,j.getConstraints,"getConstraints",!1,b.FEATURE_ms_teams_mstrack_constraints)]),new a.WebrpcClassInfo(c.MediaStream,"MediaStream",[new a.WebrpcMethodInfo(c.MediaStream,k.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.MediaStream,k.id,"id",!0),new a.WebrpcMethodInfo(c.MediaStream,k.getAudioTracks,"getAudioTracks",!1),new a.WebrpcMethodInfo(c.MediaStream,k.getVideoTracks,"getVideoTracks",!1),new a.WebrpcMethodInfo(c.MediaStream,k.getTracks,"getTracks",!1),new a.WebrpcMethodInfo(c.MediaStream,k.getTrackById,"getTrackById",!1),new a.WebrpcMethodInfo(c.MediaStream,k.addTrack,"addTrack",!1),new a.WebrpcMethodInfo(c.MediaStream,k.removeTrack,"removeTrack",!1),new a.WebrpcMethodInfo(c.MediaStream,k.clone,"clone",!0),new a.WebrpcMethodInfo(c.MediaStream,k.active,"active",!0)]),new a.WebrpcClassInfo(c.NavigatorUserMedia,"NavigatorUserMedia",[new a.WebrpcMethodInfo(c.NavigatorUserMedia,l.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.NavigatorUserMedia,l.getUserMedia,"getUserMedia",!1),new a.WebrpcMethodInfo(c.NavigatorUserMedia,l.setCodecCapabilities,"setCodecCapabilities",!1,b.FEATURE_ms_teams_codec_capability),new a.WebrpcMethodInfo(c.NavigatorUserMedia,l.getCapabilities,"getRtpCapabilities",!1,b.FEATURE_ms_teams_webrtc_1dot0)]),new a.WebrpcClassInfo(c.MediaStreamEvent,"MediaStreamEvent",[new a.WebrpcMethodInfo(c.MediaStreamEvent,o.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.MediaStreamEvent,o.stream,"stream",!0)]),new a.WebrpcClassInfo(c.VideoElement,"VideoElement",[new a.WebrpcMethodInfo(c.VideoElement,p.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.VideoElement,p.sinkId,"sinkId",!0),new a.WebrpcMethodInfo(c.VideoElement,p.connectTo,"connectTo",!1),new a.WebrpcMethodInfo(c.VideoElement,p.disconnect,"disconnect",!1),new a.WebrpcMethodInfo(c.VideoElement,p.setFrame,"setFrame",!1),new a.WebrpcMethodInfo(c.VideoElement,p.addClipRect,"addClipRect",!1),new a.WebrpcMethodInfo(c.VideoElement,p.removeClipRect,"removeClipRect",!1),new a.WebrpcMethodInfo(c.VideoElement,p.onerror,"onerror",!0),new a.WebrpcMethodInfo(c.VideoElement,p.onvideoframechanged,"onvideoframechanged",!0),new a.WebrpcMethodInfo(c.VideoElement,p.placement,"placement",!0,b.FEATURE_ms_teams_video_placement)]),new a.WebrpcClassInfo(c.AudioElement,"AudioElement",[new a.WebrpcMethodInfo(c.AudioElement,q.ctor,"ctor",!1),new a.WebrpcMethodInfo(c.AudioElement,q.sinkId,"sinkId",!0),new a.WebrpcMethodInfo(c.AudioElement,q.srcObject,"srcObject",!0),new a.WebrpcMethodInfo(c.AudioElement,q.src,"src",!0),new a.WebrpcMethodInfo(c.AudioElement,q.play,"play",!1),new a.WebrpcMethodInfo(c.AudioElement,q.pause,"pause",!1),new a.WebrpcMethodInfo(c.AudioElement,q.loop,"loop",!0,b.FEATURE_ms_teams_audio_notifications_loop)]),new a.WebrpcClassInfo(c.RTCRtpReceiver,"RTCRtpReceiver",[new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.ctor,"ctor",!1,b.FEATURE_ms_teams_speaking_indicator),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.track,"track",!0,b.FEATURE_ms_teams_speaking_indicator),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getContributingSources,"getContributingSources",!1,b.FEATURE_ms_teams_speaking_indicator),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getSynchronizationSources,"getSynchronizationSources",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.transport,"transport",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.rtcpTransport,"rtcptransport",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getCapabilities,"getCapabilities",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getParameters,"getParameters",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getStats,"getStats",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpReceiver,r.getCapabilities_v2,"getCapabilities_v2",!1,b.FEATURE_ms_teams_webrtc_1dot0)]),new a.WebrpcClassInfo(c.RTCRtpSender,"RTCRtpSender",[new a.WebrpcMethodInfo(c.RTCRtpSender,s.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.track,"track",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.transport,"transport",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.rtcpTransport,"rtcpTransport",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.dtmf,"dtmf",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.getCapabilities,"getCapabilities",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.getParameters,"getParameters",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.setParameters,"setParameters",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.replaceTrack,"replaceTrack",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.getStats,"getStats",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.setStreams,"setStreams",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCRtpSender,s.getCapabilities_v2,"getCapabilities_v2",!1,b.FEATURE_ms_teams_webrtc_1dot0)]),new a.WebrpcClassInfo(c.RTCDtlsTransport,"RTCDtlsTransport",[new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.transport,"transport",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.state,"state",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.getRemoteCertificates,"getRemoteCertificates",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.onstatechange,"onstatechange",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDtlsTransport,t.onerror,"onerror",!0,b.FEATURE_ms_teams_pstn)]),new a.WebrpcClassInfo(c.RTCIceTransport,"RTCIceTransport",[new a.WebrpcMethodInfo(c.RTCIceTransport,u.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.role,"role",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.component,"component",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.state,"state",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.gatheringState,"gatheringState",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.localcandidates,"localcandidates",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.remotecandidates,"remotecandidates",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.onstatechange,"onstatechange",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.ongatheringstatechange,"ongatheringstatechange",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceTransport,u.onselectedcandidatepairchange,"onselectedcandidatepairchange",!0,b.FEATURE_ms_teams_pstn)]),new a.WebrpcClassInfo(c.RTCDTMFSender,"RTCDTMFSender",[new a.WebrpcMethodInfo(c.RTCDTMFSender,v.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFSender,v.insertDTMF,"insertDTMF",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFSender,v.ontonechange,"ontonechange",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFSender,v.canInsertDTMF,"canInsertDTMF",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFSender,v.toneBuffer,"toneBuffer",!0,b.FEATURE_ms_teams_pstn)]),new a.WebrpcClassInfo(c.RTCDTMFToneChangeEvent,"RTCDTMFToneChangeEvent",[new a.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,w.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,w.tone,"tone",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,w.tone_buffer,"tone_buffer",!0,b.FEATURE_ms_teams_pstn)]),new a.WebrpcClassInfo(c.RTCIceCandidatePair,"RTCIceCandidatePair",[new a.WebrpcMethodInfo(c.RTCIceCandidatePair,x.ctor,"ctor",!1,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceCandidatePair,x.local,"local",!0,b.FEATURE_ms_teams_pstn),new a.WebrpcMethodInfo(c.RTCIceCandidatePair,x.remote,"remote",!0,b.FEATURE_ms_teams_pstn)]),new a.WebrpcClassInfo(c.RTCRtpTransceiver,"RTCRtpTransceiver",[new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.ctor,"ctor",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.mid,"mid",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.sender,"sender",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.receiver,"receiver",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.direction,"direction",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.currentDirection,"currentDirection",!0,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.stop,"stop",!1,b.FEATURE_ms_teams_webrtc_1dot0),new a.WebrpcMethodInfo(c.RTCRtpTransceiver,y.setCodecPreferences,"setCodecPreferences",!1,b.FEATURE_ms_teams_webrtc_1dot0)]),new a.WebrpcClassInfo(c.ScreenSharingRemote,"ScreenSharingRemote",[new a.WebrpcMethodInfo(c.ScreenSharingRemote,z.ctor,"ctor",!1,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSharingRemote,z.getScreensAsync,"getScreensAsync",!1,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSharingRemote,z.onscreentopologychanged,"onscreentopologychanged",!0,b.FEATURE_ms_teams_monitor_sharing)]),new a.WebrpcClassInfo(c.ScreenSource,"ScreenSource",[new a.WebrpcMethodInfo(c.ScreenSource,A.ctor,"ctor",!1,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.srcid,"srcid",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.deviceid,"deviceid",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.type,"type",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.name,"name",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.imagedata,"imagedata",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.hwnd,"hwnd",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.origin,"origin",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.caption,"caption",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.pid,"pid",!0,b.FEATURE_ms_teams_monitor_sharing),new a.WebrpcMethodInfo(c.ScreenSource,A.bounds,"bounds",!0,b.FEATURE_ms_teams_gtc)]),new a.WebrpcClassInfo(c.E911Service,"E911Service",[new a.WebrpcMethodInfo(c.E911Service,B.ctor,"ctor",!1,b.FEATURE_ms_teams_e911),new a.WebrpcMethodInfo(c.E911Service,B.getE911Info,"getE911Info",!1,b.FEATURE_ms_teams_e911),new a.WebrpcMethodInfo(c.E911Service,B.onupdate,"onupdate",!0,b.FEATURE_ms_teams_e911)]),new a.WebrpcClassInfo(c.RTCDataChannel,"RTCDataChannel",[new a.WebrpcMethodInfo(c.RTCDataChannel,C.ctor,"ctor",!1,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.label,"label",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.ordered,"ordered",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.maxPacketLifeTime,"maxPacketLifeTime",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.maxRetransmits,"maxRetransmits",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.protocol,"protocol",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.negotiated,"negotiated",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.id,"id",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.readyState,"readyState",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.bufferedAmount,"bufferedAmount",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.bufferedAmountLowThreshold,"bufferedAmountLowThreshold",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onopen,"onopen",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onbufferedamountlow,"onbufferedamountlow",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onerror,"onerror",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onclosing,"onclosing",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onclose,"onclose",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.onmessage,"onmessage",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.close,"close",!1,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.send_text,"send_text",!1,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCDataChannel,C.send_binary,"send_binary",!1,b.FEATURE_ms_teams_data_channel)]),new a.WebrpcClassInfo(c.RTCSctpTransport,"RTCSctpTransport",[new a.WebrpcMethodInfo(c.RTCSctpTransport,D.ctor,"ctor",!1,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCSctpTransport,D.transport,"transport",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCSctpTransport,D.state,"state",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCSctpTransport,D.maxMessageSize,"maxMessageSize",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCSctpTransport,D.maxChannels,"maxChannels",!0,b.FEATURE_ms_teams_data_channel),new a.WebrpcMethodInfo(c.RTCSctpTransport,D.onstatechange,"onstatechange",!0,b.FEATURE_ms_teams_data_channel)]),new a.WebrpcClassInfo(c.StreamResolution,"StreamResolution",[new a.WebrpcMethodInfo(c.StreamResolution,E.ctor,"ctor",!1,b.FEATURE_ms_teams_stream_resolution),new a.WebrpcMethodInfo(c.StreamResolution,E.getCallConstraints,"getCallConstraints",!1,b.FEATURE_ms_teams_stream_resolution),new a.WebrpcMethodInfo(c.StreamResolution,E.onupdate,"onupdate",!0,b.FEATURE_ms_teams_stream_resolution)])])},545:function(a,b,c){var d=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a};Object.defineProperty(b,"__esModule",{value:!0}),b.WsJsonUtil=b.ws_msg_type_t=void 0;var e,f=c(550);!function(a){a[a.req=0]="req",a[a.reply=1]="reply",a[a.event_req=2]="event_req",a[a.event_reply=3]="event_reply"}(e=b.ws_msg_type_t||(b.ws_msg_type_t={})),a=function(){function a(){}return a.createMessageByid=function(a,b,c,e,g,h){for(var i=[],j=6;j<arguments.length;j++)i[j-6]=arguments[j];return(j=f.WebrpcClassLibInfoUtil.getMethodByid(e,g))&&j.isprop||(a=!1),this.createMessage.apply(this,d([c,a,b,e,g,h],i))},a.createMessage=function(a,b,c,e,f,g){for(var h=[],i=6;i<arguments.length;i++)h[i-6]=arguments[i];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(a),modifier:b,destroy:c,proc:{iid:e,methodid:f}},objref:{oid:g},params:d(h)}},a.getMsgType=function(a){var b="";switch(a){default:b="req";break;case e.reply:b="reply";break;case e.event_req:b="event-req";break;case e.event_reply:b="event-reply"}return b},a._version=1,a}(),b.WsJsonUtil=a}},c={};return a(307)}()})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){b.exports={default:a("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":26}],4:[function(a,b,c){b.exports={default:a("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":27}],5:[function(a,b,c){b.exports={default:a("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":28}],6:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":29}],7:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":30}],8:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":31}],9:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":32}],10:[function(a,b,c){b.exports={default:a("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":33}],11:[function(a,b,c){b.exports={default:a("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":34}],12:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":35}],13:[function(a,b,c){b.exports={default:a("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":36}],14:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../core-js/promise"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(a){return function(){var b=a.apply(this,arguments);return new e.default(function(a,c){function d(f,g){try{var h=b[f](g),i=h.value}catch(a){return void c(a)}if(!h.done)return e.default.resolve(i).then(function(a){d("next",a)},function(a){d("throw",a)});a(i)}return d("next")})}}},{"../core-js/promise":11}],15:[function(a,b,c){"use strict";c.__esModule=!0,c.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}},{}],16:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../core-js/object/define-property"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),(0,e.default)(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()},{"../core-js/object/define-property":7}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/object/get-prototype-of"),f=d(e),g=a("../core-js/object/get-own-property-descriptor"),h=d(g);c.default=function a(b,c,d){null===b&&(b=Function.prototype);var e=(0,h.default)(b,c);if(void 0===e){var g=(0,f.default)(b);return null===g?void 0:a(g,c,d)}if("value"in e)return e.value;var i=e.get;if(void 0!==i)return i.call(d)}},{"../core-js/object/get-own-property-descriptor":8,"../core-js/object/get-prototype-of":9}],18:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/object/set-prototype-of"),f=d(e),g=a("../core-js/object/create"),h=d(g),i=a("../helpers/typeof"),j=d(i);c.default=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":(0,j.default)(b)));a.prototype=(0,h.default)(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(f.default?(0,f.default)(a,b):a.__proto__=b)}},{"../core-js/object/create":6,"../core-js/object/set-prototype-of":10,"../helpers/typeof":22}],19:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../helpers/typeof"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":(0,e.default)(b))&&"function"!=typeof b?a:b}},{"../helpers/typeof":22}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/is-iterable"),f=d(e),g=a("../core-js/get-iterator"),h=d(g);c.default=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,i=(0,h.default)(a);!(d=(g=i.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if((0,f.default)(Object(b)))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":4,"../core-js/is-iterable":5}],21:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("../core-js/array/from"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);c.default=function(a){return Array.isArray(a)?a:(0,e.default)(a)}},{"../core-js/array/from":3}],22:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var e=a("../core-js/symbol/iterator"),f=d(e),g=a("../core-js/symbol"),h=d(g),i="function"==typeof h.default&&"symbol"==typeof f.default?function(a){return typeof a}:function(a){return a&&"function"==typeof h.default&&a.constructor===h.default&&a!==h.default.prototype?"symbol":typeof a};c.default="function"==typeof h.default&&"symbol"===i(f.default)?function(a){return void 0===a?"undefined":i(a)}:function(a){return a&&"function"==typeof h.default&&a.constructor===h.default&&a!==h.default.prototype?"symbol":void 0===a?"undefined":i(a)}},{"../core-js/symbol":12,"../core-js/symbol/iterator":13}],23:[function(a,b,c){var d=function(){return this}()||Function("return this")(),e=d.regeneratorRuntime&&Object.getOwnPropertyNames(d).indexOf("regeneratorRuntime")>=0,f=e&&d.regeneratorRuntime;if(d.regeneratorRuntime=void 0,b.exports=a("./runtime"),e)d.regeneratorRuntime=f;else try{delete d.regeneratorRuntime}catch(a){d.regeneratorRuntime=void 0}},{"./runtime":24}],24:[function(a,b,c){!function(a){"use strict";function c(a,b,c,d){var f=b&&b.prototype instanceof e?b:e,g=Object.create(f.prototype),h=new n(d||[]);return g._invoke=j(a,c,h),g}function d(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}function e(){}function f(){}function g(){}function h(a){["next","throw","return"].forEach(function(b){a[b]=function(a){return this._invoke(b,a)}})}function i(a){function b(c,e,f,g){var h=d(a[c],a,e);if("throw"!==h.type){var i=h.arg,j=i.value;return j&&"object"==typeof j&&s.call(j,"__await")?Promise.resolve(j.__await).then(function(a){b("next",a,f,g)},function(a){b("throw",a,f,g)}):Promise.resolve(j).then(function(a){i.value=a,f(i)},g)}g(h.arg)}function c(a,c){function d(){return new Promise(function(d,e){b(a,c,d,e)})}return e=e?e.then(d,d):d()}var e;this._invoke=c}function j(a,b,c){var e=z;return function(f,g){if(e===B)throw new Error("Generator is already running");if(e===C){if("throw"===f)throw g;return p()}for(c.method=f,c.arg=g;;){var h=c.delegate;if(h){var i=k(h,c);if(i){if(i===D)continue;return i}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(e===z)throw e=C,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);e=B;var j=d(a,b,c);if("normal"===j.type){if(e=c.done?C:A,j.arg===D)continue;return{value:j.arg,done:c.done}}"throw"===j.type&&(e=C,c.method="throw",c.arg=j.arg)}}}function k(a,b){var c=a.iterator[b.method];if(c===q){if(b.delegate=null,"throw"===b.method){if(a.iterator.return&&(b.method="return",b.arg=q,k(a,b),"throw"===b.method))return D;b.method="throw",b.arg=new TypeError("The iterator does not provide a 'throw' method")}return D}var e=d(c,a.iterator,b.arg);if("throw"===e.type)return b.method="throw",b.arg=e.arg,b.delegate=null,D;var f=e.arg;return f?f.done?(b[a.resultName]=f.value,b.next=a.nextLoc,"return"!==b.method&&(b.method="next",b.arg=q),b.delegate=null,D):f:(b.method="throw",b.arg=new TypeError("iterator result is not an object"),b.delegate=null,D)}function l(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function m(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function n(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(l,this),this.reset(!0)}function o(a){if(a){var b=a[u];if(b)return b.call(a);if("function"==typeof a.next)return a;if(!isNaN(a.length)){var c=-1,d=function b(){for(;++c<a.length;)if(s.call(a,c))return b.value=a[c],b.done=!1,b;return b.value=q,b.done=!0,b};return d.next=d}}return{next:p}}function p(){return{value:q,done:!0}}var q,r=Object.prototype,s=r.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},u=t.iterator||"@@iterator",v=t.asyncIterator||"@@asyncIterator",w=t.toStringTag||"@@toStringTag",x="object"==typeof b,y=a.regeneratorRuntime;if(y)return void(x&&(b.exports=y));y=a.regeneratorRuntime=x?b.exports:{},y.wrap=c;var z="suspendedStart",A="suspendedYield",B="executing",C="completed",D={},E={};E[u]=function(){return this};var F=Object.getPrototypeOf,G=F&&F(F(o([])));G&&G!==r&&s.call(G,u)&&(E=G)
;var H=g.prototype=e.prototype=Object.create(E);f.prototype=H.constructor=g,g.constructor=f,g[w]=f.displayName="GeneratorFunction",y.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===f||"GeneratorFunction"===(b.displayName||b.name))},y.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,g):(a.__proto__=g,w in a||(a[w]="GeneratorFunction")),a.prototype=Object.create(H),a},y.awrap=function(a){return{__await:a}},h(i.prototype),i.prototype[v]=function(){return this},y.AsyncIterator=i,y.async=function(a,b,d,e){var f=new i(c(a,b,d,e));return y.isGeneratorFunction(b)?f:f.next().then(function(a){return a.done?a.value:f.next()})},h(H),H[w]="Generator",H[u]=function(){return this},H.toString=function(){return"[object Generator]"},y.keys=function(a){var b=[];for(var c in a)b.push(c);return b.reverse(),function c(){for(;b.length;){var d=b.pop();if(d in a)return c.value=d,c.done=!1,c}return c.done=!0,c}},y.values=o,n.prototype={constructor:n,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=q,this.done=!1,this.delegate=null,this.method="next",this.arg=q,this.tryEntries.forEach(m),!a)for(var b in this)"t"===b.charAt(0)&&s.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=q)},stop:function(){this.done=!0;var a=this.tryEntries[0],b=a.completion;if("throw"===b.type)throw b.arg;return this.rval},dispatchException:function(a){function b(b,d){return f.type="throw",f.arg=a,c.next=b,d&&(c.method="next",c.arg=q),!!d}if(this.done)throw a;for(var c=this,d=this.tryEntries.length-1;d>=0;--d){var e=this.tryEntries[d],f=e.completion;if("root"===e.tryLoc)return b("end");if(e.tryLoc<=this.prev){var g=s.call(e,"catchLoc"),h=s.call(e,"finallyLoc");if(g&&h){if(this.prev<e.catchLoc)return b(e.catchLoc,!0);if(this.prev<e.finallyLoc)return b(e.finallyLoc)}else if(g){if(this.prev<e.catchLoc)return b(e.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<e.finallyLoc)return b(e.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&s.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var e=d;break}}e&&("break"===a||"continue"===a)&&e.tryLoc<=b&&b<=e.finallyLoc&&(e=null);var f=e?e.completion:{};return f.type=a,f.arg=b,e?(this.method="next",this.next=e.finallyLoc,D):this.complete(f)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),D},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),m(c),D}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;m(c)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(a,b,c){return this.delegate={iterator:o(a),resultName:b,nextLoc:c},"next"===this.method&&(this.arg=q),D}}}(function(){return this}()||Function("return this")())},{}],25:[function(a,b,c){b.exports=a("regenerator-runtime")},{"regenerator-runtime":23}],26:[function(a,b,c){a("../../modules/es6.string.iterator"),a("../../modules/es6.array.from"),b.exports=a("../../modules/_core").Array.from},{"../../modules/_core":44,"../../modules/es6.array.from":114,"../../modules/es6.string.iterator":123}],27:[function(a,b,c){a("../modules/web.dom.iterable"),a("../modules/es6.string.iterator"),b.exports=a("../modules/core.get-iterator")},{"../modules/core.get-iterator":112,"../modules/es6.string.iterator":123,"../modules/web.dom.iterable":129}],28:[function(a,b,c){a("../modules/web.dom.iterable"),a("../modules/es6.string.iterator"),b.exports=a("../modules/core.is-iterable")},{"../modules/core.is-iterable":113,"../modules/es6.string.iterator":123,"../modules/web.dom.iterable":129}],29:[function(a,b,c){a("../../modules/es6.object.create");var d=a("../../modules/_core").Object;b.exports=function(a,b){return d.create(a,b)}},{"../../modules/_core":44,"../../modules/es6.object.create":116}],30:[function(a,b,c){a("../../modules/es6.object.define-property");var d=a("../../modules/_core").Object;b.exports=function(a,b,c){return d.defineProperty(a,b,c)}},{"../../modules/_core":44,"../../modules/es6.object.define-property":117}],31:[function(a,b,c){a("../../modules/es6.object.get-own-property-descriptor");var d=a("../../modules/_core").Object;b.exports=function(a,b){return d.getOwnPropertyDescriptor(a,b)}},{"../../modules/_core":44,"../../modules/es6.object.get-own-property-descriptor":118}],32:[function(a,b,c){a("../../modules/es6.object.get-prototype-of"),b.exports=a("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":44,"../../modules/es6.object.get-prototype-of":119}],33:[function(a,b,c){a("../../modules/es6.object.set-prototype-of"),b.exports=a("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":44,"../../modules/es6.object.set-prototype-of":120}],34:[function(a,b,c){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.promise"),a("../modules/es7.promise.finally"),a("../modules/es7.promise.try"),b.exports=a("../modules/_core").Promise},{"../modules/_core":44,"../modules/es6.object.to-string":121,"../modules/es6.promise":122,"../modules/es6.string.iterator":123,"../modules/es7.promise.finally":125,"../modules/es7.promise.try":126,"../modules/web.dom.iterable":129}],35:[function(a,b,c){a("../../modules/es6.symbol"),a("../../modules/es6.object.to-string"),a("../../modules/es7.symbol.async-iterator"),a("../../modules/es7.symbol.observable"),b.exports=a("../../modules/_core").Symbol},{"../../modules/_core":44,"../../modules/es6.object.to-string":121,"../../modules/es6.symbol":124,"../../modules/es7.symbol.async-iterator":127,"../../modules/es7.symbol.observable":128}],36:[function(a,b,c){a("../../modules/es6.string.iterator"),a("../../modules/web.dom.iterable"),b.exports=a("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":109,"../../modules/es6.string.iterator":123,"../../modules/web.dom.iterable":129}],37:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],38:[function(a,b,c){b.exports=function(){}},{}],39:[function(a,b,c){b.exports=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a}},{}],40:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":64}],41:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_to-length"),f=a("./_to-absolute-index");b.exports=function(a){return function(b,c,g){var h,i=d(b),j=e(i.length),k=f(g,j);if(a&&c!=c){for(;j>k;)if((h=i[k++])!=h)return!0}else for(;j>k;k++)if((a||k in i)&&i[k]===c)return a||k||0;return!a&&-1}}},{"./_to-absolute-index":100,"./_to-iobject":102,"./_to-length":103}],42:[function(a,b,c){var d=a("./_cof"),e=a("./_wks")("toStringTag"),f="Arguments"==d(function(){return arguments}()),g=function(a,b){try{return a[b]}catch(a){}};b.exports=function(a){var b,c,h;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=g(b=Object(a),e))?c:f?d(b):"Object"==(h=d(b))&&"function"==typeof b.callee?"Arguments":h}},{"./_cof":43,"./_wks":110}],43:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],44:[function(a,b,c){var d=b.exports={version:"2.6.12"};"number"==typeof __e&&(__e=d)},{}],45:[function(a,b,c){"use strict";var d=a("./_object-dp"),e=a("./_property-desc");b.exports=function(a,b,c){b in a?d.f(a,b,e(0,c)):a[b]=c}},{"./_object-dp":76,"./_property-desc":89}],46:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":37}],47:[function(a,b,c){b.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}},{}],48:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":53}],49:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":55,"./_is-object":64}],50:[function(a,b,c){b.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],51:[function(a,b,c){var d=a("./_object-keys"),e=a("./_object-gops"),f=a("./_object-pie");b.exports=function(a){var b=d(a),c=e.f;if(c)for(var g,h=c(a),i=f.f,j=0;h.length>j;)i.call(a,g=h[j++])&&b.push(g);return b}},{"./_object-gops":81,"./_object-keys":84,"./_object-pie":85}],52:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h=a("./_has"),i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s.prototype,u=n?d:o?d[b]:(d[b]||{}).prototype;n&&(c=b);for(j in c)(k=!m&&u&&void 0!==u[j])&&h(s,j)||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b.prototype=a.prototype,b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":44,"./_ctx":46,"./_global":55,"./_has":56,"./_hide":57}],53:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(a){return!0}}},{}],54:[function(a,b,c){var d=a("./_ctx"),e=a("./_iter-call"),f=a("./_is-array-iter"),g=a("./_an-object"),h=a("./_to-length"),i=a("./core.get-iterator-method"),j={},k={},c=b.exports=function(a,b,c,l,m){var n,o,p,q,r=m?function(){return a}:i(a),s=d(c,l,b?2:1),t=0;if("function"!=typeof r)throw TypeError(a+" is not iterable!");if(f(r)){for(n=h(a.length);n>t;t++)if((q=b?s(g(o=a[t])[0],o[1]):s(a[t]))===j||q===k)return q}else for(p=r.call(a);!(o=p.next()).done;)if((q=e(p,s,o.value,b))===j||q===k)return q};c.BREAK=j,c.RETURN=k},{"./_an-object":40,"./_ctx":46,"./_is-array-iter":62,"./_iter-call":65,"./_to-length":103,"./core.get-iterator-method":111}],55:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],56:[function(a,b,c){var d={}.hasOwnProperty;b.exports=function(a,b){return d.call(a,b)}},{}],57:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":48,"./_object-dp":76,"./_property-desc":89}],58:[function(a,b,c){var d=a("./_global").document;b.exports=d&&d.documentElement},{"./_global":55}],59:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":48,"./_dom-create":49,"./_fails":53}],60:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],61:[function(a,b,c){var d=a("./_cof");b.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==d(a)?a.split(""):Object(a)}},{"./_cof":43}],62:[function(a,b,c){var d=a("./_iterators"),e=a("./_wks")("iterator"),f=Array.prototype;b.exports=function(a){return void 0!==a&&(d.Array===a||f[e]===a)}},{"./_iterators":70,"./_wks":110}],63:[function(a,b,c){var d=a("./_cof");b.exports=Array.isArray||function(a){return"Array"==d(a)}},{"./_cof":43}],64:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],65:[function(a,b,c){var d=a("./_an-object");b.exports=function(a,b,c,e){try{return e?b(d(c)[0],c[1]):b(c)}catch(b){var f=a.return;throw void 0!==f&&d(f.call(a)),b}}},{"./_an-object":40}],66:[function(a,b,c){"use strict";var d=a("./_object-create"),e=a("./_property-desc"),f=a("./_set-to-string-tag"),g={};a("./_hide")(g,a("./_wks")("iterator"),function(){return this}),b.exports=function(a,b,c){a.prototype=d(g,{next:e(1,c)}),f(a,b+" Iterator")}},{"./_hide":57,"./_object-create":75,"./_property-desc":89,"./_set-to-string-tag":94,"./_wks":110}],67:[function(a,b,c){"use strict";var d=a("./_library"),e=a("./_export"),f=a("./_redefine"),g=a("./_hide"),h=a("./_iterators"),i=a("./_iter-create"),j=a("./_set-to-string-tag"),k=a("./_object-gpo"),l=a("./_wks")("iterator"),m=!([].keys&&"next"in[].keys()),n=function(){return this};b.exports=function(a,b,c,o,p,q,r){i(c,b,o);var s,t,u,v=function(a){if(!m&&a in z)return z[a];switch(a){case"keys":case"values":return function(){return new c(this,a)}}return function(){return new c(this,a)}},w=b+" Iterator",x="values"==p,y=!1,z=a.prototype,A=z[l]||z["@@iterator"]||p&&z[p],B=A||v(p),C=p?x?v("entries"):B:void 0,D="Array"==b?z.entries||A:A;if(D&&(u=k(D.call(new a)))!==Object.prototype&&u.next&&(j(u,w,!0),d||"function"==typeof u[l]||g(u,l,n)),x&&A&&"values"!==A.name&&(y=!0,B=function(){return A.call(this)}),d&&!r||!m&&!y&&z[l]||g(z,l,B),h[b]=B,h[w]=n,p)if(s={values:x?B:v("values"),keys:q?B:v("keys"),entries:C},r)for(t in s)t in z||f(z,t,s[t]);else e(e.P+e.F*(m||y),b,s);return s}},{"./_export":52,"./_hide":57,"./_iter-create":66,"./_iterators":70,"./_library":71,"./_object-gpo":82,"./_redefine":91,"./_set-to-string-tag":94,"./_wks":110}],68:[function(a,b,c){var d=a("./_wks")("iterator"),e=!1;try{var f=[7][d]();f.return=function(){e=!0},Array.from(f,function(){throw 2})}catch(a){}b.exports=function(a,b){if(!b&&!e)return!1;var c=!1;try{var f=[7],g=f[d]();g.next=function(){return{done:c=!0}},f[d]=function(){return g},a(f)}catch(a){}return c}},{"./_wks":110}],69:[function(a,b,c){b.exports=function(a,b){return{value:b,done:!!a}}},{}],70:[function(a,b,c){b.exports={}},{}],71:[function(a,b,c){b.exports=!0},{}],72:[function(a,b,c){var d=a("./_uid")("meta"),e=a("./_is-object"),f=a("./_has"),g=a("./_object-dp").f,h=0,i=Object.isExtensible||function(){return!0},j=!a("./_fails")(function(){return i(Object.preventExtensions({}))}),k=function(a){g(a,d,{value:{i:"O"+ ++h,w:{}}})},l=function(a,b){if(!e(a))return"symbol"==typeof a?a:("string"==typeof a?"S":"P")+a;if(!f(a,d)){if(!i(a))return"F";if(!b)return"E";k(a)}return a[d].i},m=function(a,b){if(!f(a,d)){if(!i(a))return!0;if(!b)return!1;k(a)}return a[d].w},n=function(a){return j&&o.NEED&&i(a)&&!f(a,d)&&k(a),a},o=b.exports={KEY:d,NEED:!1,fastKey:l,getWeak:m,onFreeze:n}},{"./_fails":53,"./_has":56,"./_is-object":64,"./_object-dp":76,"./_uid":106}],73:[function(a,b,c){var d=a("./_global"),e=a("./_task").set,f=d.MutationObserver||d.WebKitMutationObserver,g=d.process,h=d.Promise,i="process"==a("./_cof")(g);b.exports=function(){var a,b,c,j=function(){var d,e;for(i&&(d=g.domain)&&d.exit();a;){e=a.fn,a=a.next;try{e()}catch(d){throw a?c():b=void 0,d}}b=void 0,d&&d.enter()};if(i)c=function(){g.nextTick(j)};else if(!f||d.navigator&&d.navigator.standalone)if(h&&h.resolve){var k=h.resolve(void 0);c=function(){k.then(j)}}else c=function(){e.call(d,j)};else{var l=!0,m=document.createTextNode("");new f(j).observe(m,{characterData:!0}),c=function(){m.data=l=!l}}return function(d){var e={fn:d,next:void 0};b&&(b.next=e),a||(a=e,c()),b=e}}},{"./_cof":43,"./_global":55,"./_task":99}],74:[function(a,b,c){"use strict";function d(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw TypeError("Bad Promise constructor");b=a,c=d}),this.resolve=e(b),this.reject=e(c)}var e=a("./_a-function");b.exports.f=function(a){return new d(a)}},{"./_a-function":37}],75:[function(a,b,c){var d=a("./_an-object"),e=a("./_object-dps"),f=a("./_enum-bug-keys"),g=a("./_shared-key")("IE_PROTO"),h=function(){},i=function(){var b,c=a("./_dom-create")("iframe"),d=f.length;for(c.style.display="none",a("./_html").appendChild(c),c.src="javascript:",b=c.contentWindow.document,b.open(),b.write("<script>document.F=Object<\/script>"),b.close(),i=b.F;d--;)delete i.prototype[f[d]];return i()};b.exports=Object.create||function(a,b){var c;return null!==a?(h.prototype=d(a),c=new h,h.prototype=null,c[g]=a):c=i(),void 0===b?c:e(c,b)}},{"./_an-object":40,"./_dom-create":49,"./_enum-bug-keys":50,"./_html":58,"./_object-dps":77,"./_shared-key":95}],76:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":40,"./_descriptors":48,"./_ie8-dom-define":59,"./_to-primitive":105}],77:[function(a,b,c){var d=a("./_object-dp"),e=a("./_an-object"),f=a("./_object-keys");b.exports=a("./_descriptors")?Object.defineProperties:function(a,b){e(a);for(var c,g=f(b),h=g.length,i=0;h>i;)d.f(a,c=g[i++],b[c]);return a}},{"./_an-object":40,"./_descriptors":48,"./_object-dp":76,"./_object-keys":84}],78:[function(a,b,c){var d=a("./_object-pie"),e=a("./_property-desc"),f=a("./_to-iobject"),g=a("./_to-primitive"),h=a("./_has"),i=a("./_ie8-dom-define"),j=Object.getOwnPropertyDescriptor;c.f=a("./_descriptors")?j:function(a,b){if(a=f(a),b=g(b,!0),i)try{return j(a,b)}catch(a){}if(h(a,b))return e(!d.f.call(a,b),a[b])}},{"./_descriptors":48,"./_has":56,"./_ie8-dom-define":59,"./_object-pie":85,"./_property-desc":89,"./_to-iobject":102,"./_to-primitive":105}],79:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_object-gopn").f,f={}.toString,g="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],h=function(a){try{return e(a)}catch(a){return g.slice()}};b.exports.f=function(a){return g&&"[object Window]"==f.call(a)?h(a):e(d(a))}},{"./_object-gopn":80,"./_to-iobject":102}],80:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys").concat("length","prototype");c.f=Object.getOwnPropertyNames||function(a){return d(a,e)}},{"./_enum-bug-keys":50,"./_object-keys-internal":83}],81:[function(a,b,c){c.f=Object.getOwnPropertySymbols},{}],82:[function(a,b,c){var d=a("./_has"),e=a("./_to-object"),f=a("./_shared-key")("IE_PROTO"),g=Object.prototype;b.exports=Object.getPrototypeOf||function(a){return a=e(a),d(a,f)?a[f]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?g:null}},{"./_has":56,"./_shared-key":95,"./_to-object":104}],83:[function(a,b,c){var d=a("./_has"),e=a("./_to-iobject"),f=a("./_array-includes")(!1),g=a("./_shared-key")("IE_PROTO");b.exports=function(a,b){var c,h=e(a),i=0,j=[];for(c in h)c!=g&&d(h,c)&&j.push(c);for(;b.length>i;)d(h,c=b[i++])&&(~f(j,c)||j.push(c));return j}},{"./_array-includes":41,"./_has":56,"./_shared-key":95,"./_to-iobject":102}],84:[function(a,b,c){var d=a("./_object-keys-internal"),e=a("./_enum-bug-keys");b.exports=Object.keys||function(a){return d(a,e)}},{"./_enum-bug-keys":50,"./_object-keys-internal":83}],85:[function(a,b,c){c.f={}.propertyIsEnumerable},{}],86:[function(a,b,c){var d=a("./_export"),e=a("./_core"),f=a("./_fails");b.exports=function(a,b){var c=(e.Object||{})[a]||Object[a],g={};g[a]=b(c),d(d.S+d.F*f(function(){c(1)}),"Object",g)}},{"./_core":44,"./_export":52,"./_fails":53}],87:[function(a,b,c){b.exports=function(a){try{return{e:!1,v:a()}}catch(a){return{e:!0,v:a}}}},{}],88:[function(a,b,c){var d=a("./_an-object"),e=a("./_is-object"),f=a("./_new-promise-capability");b.exports=function(a,b){if(d(a),e(b)&&b.constructor===a)return b;var c=f.f(a);return(0,c.resolve)(b),c.promise}},{"./_an-object":40,"./_is-object":64,"./_new-promise-capability":74}],89:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],90:[function(a,b,c){var d=a("./_hide");b.exports=function(a,b,c){for(var e in b)c&&a[e]?a[e]=b[e]:d(a,e,b[e]);return a}},{"./_hide":57}],91:[function(a,b,c){b.exports=a("./_hide")},{"./_hide":57}],92:[function(a,b,c){var d=a("./_is-object"),e=a("./_an-object"),f=function(a,b){if(e(a),!d(b)&&null!==b)throw TypeError(b+": can't set as prototype!")};b.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(b,c,d){try{d=a("./_ctx")(Function.call,a("./_object-gopd").f(Object.prototype,"__proto__").set,2),d(b,[]),c=!(b instanceof Array)}catch(a){c=!0}return function(a,b){return f(a,b),c?a.__proto__=b:d(a,b),a}}({},!1):void 0),check:f}},{"./_an-object":40,"./_ctx":46,"./_is-object":64,"./_object-gopd":78}],93:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_core"),f=a("./_object-dp"),g=a("./_descriptors"),h=a("./_wks")("species");b.exports=function(a){var b="function"==typeof e[a]?e[a]:d[a];g&&b&&!b[h]&&f.f(b,h,{configurable:!0,get:function(){return this}})}},{"./_core":44,"./_descriptors":48,"./_global":55,"./_object-dp":76,"./_wks":110}],94:[function(a,b,c){var d=a("./_object-dp").f,e=a("./_has"),f=a("./_wks")("toStringTag");b.exports=function(a,b,c){a&&!e(a=c?a:a.prototype,f)&&d(a,f,{configurable:!0,value:b})}},{"./_has":56,"./_object-dp":76,"./_wks":110}],95:[function(a,b,c){var d=a("./_shared")("keys"),e=a("./_uid");b.exports=function(a){return d[a]||(d[a]=e(a))}},{"./_shared":96,"./_uid":106}],96:[function(a,b,c){var d=a("./_core"),e=a("./_global"),f=e["__core-js_shared__"]||(e["__core-js_shared__"]={});(b.exports=function(a,b){return f[a]||(f[a]=void 0!==b?b:{})})("versions",[]).push({version:d.version,mode:a("./_library")?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},{"./_core":44,"./_global":55,"./_library":71}],97:[function(a,b,c){var d=a("./_an-object"),e=a("./_a-function"),f=a("./_wks")("species");b.exports=function(a,b){var c,g=d(a).constructor;return void 0===g||void 0==(c=d(g)[f])?b:e(c)}},{"./_a-function":37,"./_an-object":40,"./_wks":110}],98:[function(a,b,c){var d=a("./_to-integer"),e=a("./_defined");b.exports=function(a){return function(b,c){var f,g,h=String(e(b)),i=d(c),j=h.length;return i<0||i>=j?a?"":void 0:(f=h.charCodeAt(i),f<55296||f>56319||i+1===j||(g=h.charCodeAt(i+1))<56320||g>57343?a?h.charAt(i):f:a?h.slice(i,i+2):g-56320+(f-55296<<10)+65536)}}},{"./_defined":47,"./_to-integer":101}],99:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=k.Dispatch,q=0,r={},s=function(){var a=+this;if(r.hasOwnProperty(a)){var b=r[a];delete r[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return r[++q]=function(){h("function"==typeof a?a:Function(a),b)},d(q),q},n=function(a){delete r[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:p&&p.now?d=function(a){p.now(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d="onreadystatechange"in j("script")?function(a){i.appendChild(j("script")).onreadystatechange=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":43,"./_ctx":46,"./_dom-create":49,"./_global":55,"./_html":58,"./_invoke":60}],100:[function(a,b,c){var d=a("./_to-integer"),e=Math.max,f=Math.min;b.exports=function(a,b){return a=d(a),a<0?e(a+b,0):f(a,b)}},{"./_to-integer":101}],101:[function(a,b,c){var d=Math.ceil,e=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?e:d)(a)}},{}],102:[function(a,b,c){var d=a("./_iobject"),e=a("./_defined");b.exports=function(a){return d(e(a))}},{"./_defined":47,"./_iobject":61}],103:[function(a,b,c){var d=a("./_to-integer"),e=Math.min;b.exports=function(a){return a>0?e(d(a),9007199254740991):0}},{"./_to-integer":101}],104:[function(a,b,c){var d=a("./_defined");b.exports=function(a){return Object(d(a))}},{"./_defined":47}],105:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":64}],106:[function(a,b,c){var d=0,e=Math.random();b.exports=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++d+e).toString(36))}},{}],107:[function(a,b,c){var d=a("./_global"),e=d.navigator;b.exports=e&&e.userAgent||""},{"./_global":55}],108:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_library"),g=a("./_wks-ext"),h=a("./_object-dp").f;b.exports=function(a){var b=e.Symbol||(e.Symbol=f?{}:d.Symbol||{});"_"==a.charAt(0)||a in b||h(b,a,{value:g.f(a)})}},{"./_core":44,"./_global":55,"./_library":71,"./_object-dp":76,"./_wks-ext":109}],109:[function(a,b,c){c.f=a("./_wks")},{"./_wks":110}],110:[function(a,b,c){var d=a("./_shared")("wks"),e=a("./_uid"),f=a("./_global").Symbol,g="function"==typeof f;(b.exports=function(a){return d[a]||(d[a]=g&&f[a]||(g?f:e)("Symbol."+a))}).store=d},{"./_global":55,"./_shared":96,"./_uid":106}],111:[function(a,b,c){var d=a("./_classof"),e=a("./_wks")("iterator"),f=a("./_iterators");b.exports=a("./_core").getIteratorMethod=function(a){if(void 0!=a)return a[e]||a["@@iterator"]||f[d(a)]}},{"./_classof":42,"./_core":44,"./_iterators":70,"./_wks":110}],112:[function(a,b,c){var d=a("./_an-object"),e=a("./core.get-iterator-method");b.exports=a("./_core").getIterator=function(a){var b=e(a);if("function"!=typeof b)throw TypeError(a+" is not iterable!");return d(b.call(a))}},{"./_an-object":40,"./_core":44,"./core.get-iterator-method":111}],113:[function(a,b,c){var d=a("./_classof"),e=a("./_wks")("iterator"),f=a("./_iterators");b.exports=a("./_core").isIterable=function(a){var b=Object(a);return void 0!==b[e]||"@@iterator"in b||f.hasOwnProperty(d(b))}},{"./_classof":42,"./_core":44,"./_iterators":70,"./_wks":110}],114:[function(a,b,c){"use strict";var d=a("./_ctx"),e=a("./_export"),f=a("./_to-object"),g=a("./_iter-call"),h=a("./_is-array-iter"),i=a("./_to-length"),j=a("./_create-property"),k=a("./core.get-iterator-method");e(e.S+e.F*!a("./_iter-detect")(function(a){Array.from(a)}),"Array",{from:function(a){var b,c,e,l,m=f(a),n="function"==typeof this?this:Array,o=arguments.length,p=o>1?arguments[1]:void 0,q=void 0!==p,r=0,s=k(m);if(q&&(p=d(p,o>2?arguments[2]:void 0,2)),void 0==s||n==Array&&h(s))for(b=i(m.length),c=new n(b);b>r;r++)j(c,r,q?p(m[r],r):m[r]);else for(l=s.call(m),c=new n;!(e=l.next()).done;r++)j(c,r,q?g(l,p,[e.value,r],!0):e.value);return c.length=r,c}})},{"./_create-property":45,"./_ctx":46,"./_export":52,"./_is-array-iter":62,"./_iter-call":65,"./_iter-detect":68,"./_to-length":103,"./_to-object":104,"./core.get-iterator-method":111}],115:[function(a,b,c){"use strict";var d=a("./_add-to-unscopables"),e=a("./_iter-step"),f=a("./_iterators"),g=a("./_to-iobject");b.exports=a("./_iter-define")(Array,"Array",function(a,b){this._t=g(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,e(1)):"keys"==b?e(0,c):"values"==b?e(0,a[c]):e(0,[c,a[c]])},"values"),f.Arguments=f.Array,d("keys"),d("values"),d("entries")},{"./_add-to-unscopables":38,"./_iter-define":67,"./_iter-step":69,"./_iterators":70,"./_to-iobject":102}],116:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{create:a("./_object-create")})},{"./_export":52,"./_object-create":75}],117:[function(a,b,c){var d=a("./_export");d(d.S+d.F*!a("./_descriptors"),"Object",{defineProperty:a("./_object-dp").f})},{"./_descriptors":48,"./_export":52,"./_object-dp":76}],118:[function(a,b,c){var d=a("./_to-iobject"),e=a("./_object-gopd").f;a("./_object-sap")("getOwnPropertyDescriptor",function(){return function(a,b){return e(d(a),b)}})},{"./_object-gopd":78,"./_object-sap":86,"./_to-iobject":102}],119:[function(a,b,c){var d=a("./_to-object"),e=a("./_object-gpo");a("./_object-sap")("getPrototypeOf",function(){return function(a){return e(d(a))}})},{"./_object-gpo":82,"./_object-sap":86,"./_to-object":104}],120:[function(a,b,c){var d=a("./_export");d(d.S,"Object",{setPrototypeOf:a("./_set-proto").set})},{"./_export":52,"./_set-proto":92}],121:[function(a,b,c){},{}],122:[function(a,b,c){"use strict";var d,e,f,g,h=a("./_library"),i=a("./_global"),j=a("./_ctx"),k=a("./_classof"),l=a("./_export"),m=a("./_is-object"),n=a("./_a-function"),o=a("./_an-instance"),p=a("./_for-of"),q=a("./_species-constructor"),r=a("./_task").set,s=a("./_microtask")(),t=a("./_new-promise-capability"),u=a("./_perform"),v=a("./_user-agent"),w=a("./_promise-resolve"),x=i.TypeError,y=i.process,z=y&&y.versions,A=z&&z.v8||"",B=i.Promise,C="process"==k(y),D=function(){},E=e=t.f,F=!!function(){try{var b=B.resolve(1),c=(b.constructor={})[a("./_wks")("species")]=function(a){a(D,D)};return(C||"function"==typeof PromiseRejectionEvent)&&b.then(D)instanceof c&&0!==A.indexOf("6.6")&&-1===v.indexOf("Chrome/66")}catch(a){}}(),G=function(a){var b;return!(!m(a)||"function"!=typeof(b=a.then))&&b},H=function(a,b){if(!a._n){a._n=!0;var c=a._c;s(function(){for(var d=a._v,e=1==a._s,f=0;c.length>f;)!function(b){var c,f,g,h=e?b.ok:b.fail,i=b.resolve,j=b.reject,k=b.domain;try{h?(e||(2==a._h&&K(a),a._h=1),!0===h?c=d:(k&&k.enter(),c=h(d),k&&(k.exit(),g=!0)),c===b.promise?j(x("Promise-chain cycle")):(f=G(c))?f.call(c,i,j):i(c)):j(d)}catch(a){k&&!g&&k.exit(),j(a)}}(c[f++]);a._c=[],a._n=!1,b&&!a._h&&I(a)})}},I=function(a){r.call(i,function(){var b,c,d,e=a._v,f=J(a);if(f&&(b=u(function(){C?y.emit("unhandledRejection",e,a):(c=i.onunhandledrejection)?c({promise:a,reason:e}):(d=i.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=C||J(a)?2:1),a._a=void 0,f&&b.e)throw b.v})},J=function(a){return 1!==a._h&&0===(a._a||a._c).length},K=function(a){r.call(i,function(){var b;C?y.emit("rejectionHandled",a):(b=i.onrejectionhandled)&&b({promise:a,reason:a._v})})},L=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),H(b,!0))},M=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw x("Promise can't be resolved itself");(b=G(a))?s(function(){var d={_w:c,_d:!1};try{b.call(a,j(M,d,1),j(L,d,1))}catch(a){L.call(d,a)}}):(c._v=a,c._s=1,H(c,!1))}catch(a){L.call({_w:c,_d:!1},a)}}};F||(B=function(a){o(this,B,"Promise","_h"),n(a),d.call(this);try{a(j(M,this,1),j(L,this,1))}catch(a){L.call(this,a)}},d=function(a){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},d.prototype=a("./_redefine-all")(B.prototype,{then:function(a,b){var c=E(q(this,B));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=C?y.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&H(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),f=function(){var a=new d;this.promise=a,this.resolve=j(M,a,1),this.reject=j(L,a,1)},t.f=E=function(a){return a===B||a===g?new f(a):e(a)}),l(l.G+l.W+l.F*!F,{Promise:B}),a("./_set-to-string-tag")(B,"Promise"),a("./_set-species")("Promise"),g=a("./_core").Promise,l(l.S+l.F*!F,"Promise",{reject:function(a){var b=E(this);return(0,b.reject)(a),b.promise}}),l(l.S+l.F*(h||!F),"Promise",{resolve:function(a){return w(h&&this===g?B:this,a)}}),l(l.S+l.F*!(F&&a("./_iter-detect")(function(a){B.all(a).catch(D)})),"Promise",{all:function(a){
var b=this,c=E(b),d=c.resolve,e=c.reject,f=u(function(){var c=[],f=0,g=1;p(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f.e&&e(f.v),c.promise},race:function(a){var b=this,c=E(b),d=c.reject,e=u(function(){p(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e.e&&d(e.v),c.promise}})},{"./_a-function":37,"./_an-instance":39,"./_classof":42,"./_core":44,"./_ctx":46,"./_export":52,"./_for-of":54,"./_global":55,"./_is-object":64,"./_iter-detect":68,"./_library":71,"./_microtask":73,"./_new-promise-capability":74,"./_perform":87,"./_promise-resolve":88,"./_redefine-all":90,"./_set-species":93,"./_set-to-string-tag":94,"./_species-constructor":97,"./_task":99,"./_user-agent":107,"./_wks":110}],123:[function(a,b,c){"use strict";var d=a("./_string-at")(!0);a("./_iter-define")(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=d(b,c),this._i+=a.length,{value:a,done:!1})})},{"./_iter-define":67,"./_string-at":98}],124:[function(a,b,c){"use strict";var d=a("./_global"),e=a("./_has"),f=a("./_descriptors"),g=a("./_export"),h=a("./_redefine"),i=a("./_meta").KEY,j=a("./_fails"),k=a("./_shared"),l=a("./_set-to-string-tag"),m=a("./_uid"),n=a("./_wks"),o=a("./_wks-ext"),p=a("./_wks-define"),q=a("./_enum-keys"),r=a("./_is-array"),s=a("./_an-object"),t=a("./_is-object"),u=a("./_to-object"),v=a("./_to-iobject"),w=a("./_to-primitive"),x=a("./_property-desc"),y=a("./_object-create"),z=a("./_object-gopn-ext"),A=a("./_object-gopd"),B=a("./_object-gops"),C=a("./_object-dp"),D=a("./_object-keys"),E=A.f,F=C.f,G=z.f,H=d.Symbol,I=d.JSON,J=I&&I.stringify,K=n("_hidden"),L=n("toPrimitive"),M={}.propertyIsEnumerable,N=k("symbol-registry"),O=k("symbols"),P=k("op-symbols"),Q=Object.prototype,R="function"==typeof H&&!!B.f,S=d.QObject,T=!S||!S.prototype||!S.prototype.findChild,U=f&&j(function(){return 7!=y(F({},"a",{get:function(){return F(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=E(Q,b);d&&delete Q[b],F(a,b,c),d&&a!==Q&&F(Q,b,d)}:F,V=function(a){var b=O[a]=y(H.prototype);return b._k=a,b},W=R&&"symbol"==typeof H.iterator?function(a){return"symbol"==typeof a}:function(a){return a instanceof H},X=function(a,b,c){return a===Q&&X(P,b,c),s(a),b=w(b,!0),s(c),e(O,b)?(c.enumerable?(e(a,K)&&a[K][b]&&(a[K][b]=!1),c=y(c,{enumerable:x(0,!1)})):(e(a,K)||F(a,K,x(1,{})),a[K][b]=!0),U(a,b,c)):F(a,b,c)},Y=function(a,b){s(a);for(var c,d=q(b=v(b)),e=0,f=d.length;f>e;)X(a,c=d[e++],b[c]);return a},Z=function(a,b){return void 0===b?y(a):Y(y(a),b)},$=function(a){var b=M.call(this,a=w(a,!0));return!(this===Q&&e(O,a)&&!e(P,a))&&(!(b||!e(this,a)||!e(O,a)||e(this,K)&&this[K][a])||b)},_=function(a,b){if(a=v(a),b=w(b,!0),a!==Q||!e(O,b)||e(P,b)){var c=E(a,b);return!c||!e(O,b)||e(a,K)&&a[K][b]||(c.enumerable=!0),c}},aa=function(a){for(var b,c=G(v(a)),d=[],f=0;c.length>f;)e(O,b=c[f++])||b==K||b==i||d.push(b);return d},ba=function(a){for(var b,c=a===Q,d=G(c?P:v(a)),f=[],g=0;d.length>g;)!e(O,b=d[g++])||c&&!e(Q,b)||f.push(O[b]);return f};R||(H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor!");var a=m(arguments.length>0?arguments[0]:void 0),b=function(c){this===Q&&b.call(P,c),e(this,K)&&e(this[K],a)&&(this[K][a]=!1),U(this,a,x(1,c))};return f&&T&&U(Q,a,{configurable:!0,set:b}),V(a)},h(H.prototype,"toString",function(){return this._k}),A.f=_,C.f=X,a("./_object-gopn").f=z.f=aa,a("./_object-pie").f=$,B.f=ba,f&&!a("./_library")&&h(Q,"propertyIsEnumerable",$,!0),o.f=function(a){return V(n(a))}),g(g.G+g.W+g.F*!R,{Symbol:H});for(var ca="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),da=0;ca.length>da;)n(ca[da++]);for(var ea=D(n.store),fa=0;ea.length>fa;)p(ea[fa++]);g(g.S+g.F*!R,"Symbol",{for:function(a){return e(N,a+="")?N[a]:N[a]=H(a)},keyFor:function(a){if(!W(a))throw TypeError(a+" is not a symbol!");for(var b in N)if(N[b]===a)return b},useSetter:function(){T=!0},useSimple:function(){T=!1}}),g(g.S+g.F*!R,"Object",{create:Z,defineProperty:X,defineProperties:Y,getOwnPropertyDescriptor:_,getOwnPropertyNames:aa,getOwnPropertySymbols:ba});var ga=j(function(){B.f(1)});g(g.S+g.F*ga,"Object",{getOwnPropertySymbols:function(a){return B.f(u(a))}}),I&&g(g.S+g.F*(!R||j(function(){var a=H();return"[null]"!=J([a])||"{}"!=J({a:a})||"{}"!=J(Object(a))})),"JSON",{stringify:function(a){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);if(c=b=d[1],(t(b)||void 0!==a)&&!W(a))return r(b)||(b=function(a,b){if("function"==typeof c&&(b=c.call(this,a,b)),!W(b))return b}),d[1]=b,J.apply(I,d)}}),H.prototype[L]||a("./_hide")(H.prototype,L,H.prototype.valueOf),l(H,"Symbol"),l(Math,"Math",!0),l(d.JSON,"JSON",!0)},{"./_an-object":40,"./_descriptors":48,"./_enum-keys":51,"./_export":52,"./_fails":53,"./_global":55,"./_has":56,"./_hide":57,"./_is-array":63,"./_is-object":64,"./_library":71,"./_meta":72,"./_object-create":75,"./_object-dp":76,"./_object-gopd":78,"./_object-gopn":80,"./_object-gopn-ext":79,"./_object-gops":81,"./_object-keys":84,"./_object-pie":85,"./_property-desc":89,"./_redefine":91,"./_set-to-string-tag":94,"./_shared":96,"./_to-iobject":102,"./_to-object":104,"./_to-primitive":105,"./_uid":106,"./_wks":110,"./_wks-define":108,"./_wks-ext":109}],125:[function(a,b,c){"use strict";var d=a("./_export"),e=a("./_core"),f=a("./_global"),g=a("./_species-constructor"),h=a("./_promise-resolve");d(d.P+d.R,"Promise",{finally:function(a){var b=g(this,e.Promise||f.Promise),c="function"==typeof a;return this.then(c?function(c){return h(b,a()).then(function(){return c})}:a,c?function(c){return h(b,a()).then(function(){throw c})}:a)}})},{"./_core":44,"./_export":52,"./_global":55,"./_promise-resolve":88,"./_species-constructor":97}],126:[function(a,b,c){"use strict";var d=a("./_export"),e=a("./_new-promise-capability"),f=a("./_perform");d(d.S,"Promise",{try:function(a){var b=e.f(this),c=f(a);return(c.e?b.reject:b.resolve)(c.v),b.promise}})},{"./_export":52,"./_new-promise-capability":74,"./_perform":87}],127:[function(a,b,c){a("./_wks-define")("asyncIterator")},{"./_wks-define":108}],128:[function(a,b,c){a("./_wks-define")("observable")},{"./_wks-define":108}],129:[function(a,b,c){a("./es6.array.iterator");for(var d=a("./_global"),e=a("./_hide"),f=a("./_iterators"),g=a("./_wks")("toStringTag"),h="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),i=0;i<h.length;i++){var j=h[i],k=d[j],l=k&&k.prototype;l&&!l[g]&&e(l,g,j),f[j]=f.Array}},{"./_global":55,"./_hide":57,"./_iterators":70,"./_wks":110,"./es6.array.iterator":115}],130:[function(a,b,c){"use strict";function d(a){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type}function e(a,b,c,d,e){var f=k.writeRtpDescription(a.kind,b);if(f+=k.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=k.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":e||"active"),f+="a=mid:"+a.mid+"\r\n",a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=g;var h="msid:"+(d?d.id:"-")+" "+g+"\r\n";f+="a="+h,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+h,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+h,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+k.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+k.localCName+"\r\n"),f}function f(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&b>=14393&&-1===a.indexOf("?transport=udp"):(c=!0,!0)}),delete a.url,a.urls=e?d[0]:d,!!d.length}})}function g(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;g=JSON.parse(JSON.stringify(g)),g.numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function h(a,b,c){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}function i(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}function j(a,b){var c=new Error(b);return c.name=a,c.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[a],c}var k=a("sdp");b.exports=function(a,b){function c(b,c){c.addTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:b}))}function l(b,c){c.removeTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:b}))}function m(b,c,d,e){var f=new Event("track");f.track=c,f.receiver=d,f.transceiver={receiver:d},f.streams=e,a.setTimeout(function(){b._dispatchEvent("track",f)})}var n=function(c){var d=this,e=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=e[a].bind(e)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle="max-bundle"===c.bundlePolicy,"negotiate"===c.rtcpMuxPolicy)throw j("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced"}if(c.iceServers=f(c.iceServers||[],b),this._iceGatherers=[],c.iceCandidatePoolSize)for(var g=c.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=k.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(a,b){this._isClosed||(this.dispatchEvent(b),"function"==typeof this["on"+a]&&this["on"+a](b))},n.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(a,b){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();d.iceTransport=e.iceTransport,d.dtlsTransport=e.dtlsTransport}return b||this.transceivers.push(d),d},n.prototype.addTrack=function(b,c){if(this._isClosed)throw j("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(a){return a.track===b}))throw j("InvalidAccessError","Track already exists.");for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==b.kind||(d=this.transceivers[e]);return d||(d=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(c)&&this.localStreams.push(c),d.track=b,d.stream=c,d.rtpSender=new a.RTCRtpSender(b,d.dtlsTransport),d.rtpSender},n.prototype.addStream=function(a){var c=this;if(b>=15025)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)})}},n.prototype.removeTrack=function(b){if(this._isClosed)throw j("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(b instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(a){return a.rtpSender===b});if(!c)throw j("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null,-1===this.transceivers.map(function(a){return a.stream}).indexOf(d)&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},n.prototype._createIceGatherer=function(b,c){var d=this;if(c&&b>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].bufferedCandidateEvents=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering",null!==d.transceivers[b].bufferedCandidateEvents&&d.transceivers[b].bufferedCandidateEvents.push(a)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},n.prototype._gather=function(b,c){var d=this,e=this.transceivers[c].iceGatherer;if(!e.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),e.onlocalcandidate=function(a){if(!(d.usingBundle&&c>0)){var f=new Event("icecandidate");f.candidate={sdpMid:b,sdpMLineIndex:c};var g=a.candidate,h=!g||0===Object.keys(g).length;if(h)"new"!==e.state&&"gathering"!==e.state||(e.state="completed");else{"new"===e.state&&(e.state="gathering"),g.component=1,g.ufrag=e.getLocalParameters().usernameFragment;var i=k.writeCandidate(g);f.candidate=Object.assign(f.candidate,k.parseCandidate(i)),f.candidate.candidate=i,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var j=k.getMediaSections(d._localDescription.sdp);j[f.candidate.sdpMLineIndex]+=h?"a=end-of-candidates\r\n":"a="+f.candidate.candidate+"\r\n",d._localDescription.sdp=k.getDescription(d._localDescription.sdp)+j.join("");var l=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),h||d._dispatchEvent("icecandidate",f),l&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},a.setTimeout(function(){f.forEach(function(a){e.onlocalcandidate(a)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateIceConnectionState(),b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},n.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},n.prototype._transceive=function(a,c,d){var e=g(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:k.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),d&&a.rtpReceiver&&e.codecs.length>0&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length?e.encodings=a.recvEncodingParameters:e.encodings=[{}],e.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(e.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},n.prototype.setLocalDescription=function(a){var b=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(j("TypeError",'Unsupported type "'+a.type+'"'));if(!h("setLocalDescription",a.type,b.signalingState)||b._isClosed)return Promise.reject(j("InvalidStateError","Can not set local "+a.type+" in state "+b.signalingState));var c,d;if("offer"===a.type)c=k.splitSections(a.sdp),d=c.shift(),c.forEach(function(a,c){var d=k.parseRtpParameters(a);b.transceivers[c].localCapabilities=d}),b.transceivers.forEach(function(a,c){b._gather(a.mid,c)});else if("answer"===a.type){c=k.splitSections(b._remoteDescription.sdp),d=c.shift();var e=k.matchPrefix(d,"a=ice-lite").length>0;c.forEach(function(a,c){var f=b.transceivers[c],h=f.iceGatherer,i=f.iceTransport,j=f.dtlsTransport,l=f.localCapabilities,m=f.remoteCapabilities;if(!(k.isRejected(a)&&0===k.matchPrefix(a,"a=bundle-only").length||f.rejected)){var n=k.getIceParameters(a,d),o=k.getDtlsParameters(a,d);e&&(o.role="server"),b.usingBundle&&0!==c||(b._gather(f.mid,c),"new"===i.state&&i.start(h,n,e?"controlling":"controlled"),"new"===j.state&&j.start(o));var p=g(l,m);b._transceive(f,p.codecs.length>0,!1)}})}return b._localDescription={type:a.type,sdp:a.sdp},"offer"===a.type?b._updateSignalingState("have-local-offer"):b._updateSignalingState("stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(d){var e=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(j("TypeError",'Unsupported type "'+d.type+'"'));if(!h("setRemoteDescription",d.type,e.signalingState)||e._isClosed)return Promise.reject(j("InvalidStateError","Can not set remote "+d.type+" in state "+e.signalingState));var f={};e.remoteStreams.forEach(function(a){f[a.id]=a});var n=[],o=k.splitSections(d.sdp),p=o.shift(),q=k.matchPrefix(p,"a=ice-lite").length>0,r=k.matchPrefix(p,"a=group:BUNDLE ").length>0;e.usingBundle=r;var s=k.matchPrefix(p,"a=ice-options:")[0];return e.canTrickleIceCandidates=!!s&&s.substr(14).split(" ").indexOf("trickle")>=0,o.forEach(function(h,j){var m=k.splitLines(h),o=k.getKind(h),s=k.isRejected(h)&&0===k.matchPrefix(h,"a=bundle-only").length,t=m[0].substr(2).split(" ")[2],u=k.getDirection(h,p),v=k.parseMsid(h),w=k.getMid(h)||k.generateIdentifier();if(s||"application"===o&&("DTLS/SCTP"===t||"UDP/DTLS/SCTP"===t))return void(e.transceivers[j]={mid:w,kind:o,protocol:t,rejected:!0});!s&&e.transceivers[j]&&e.transceivers[j].rejected&&(e.transceivers[j]=e._createTransceiver(o,!0));var x,y,z,A,B,C,D,E,F,G,H,I=k.parseRtpParameters(h);s||(G=k.getIceParameters(h,p),H=k.getDtlsParameters(h,p),H.role="client"),D=k.parseRtpEncodingParameters(h);var J=k.parseRtcpParameters(h),K=k.matchPrefix(h,"a=end-of-candidates",p).length>0,L=k.matchPrefix(h,"a=candidate:").map(function(a){return k.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===d.type||"answer"===d.type)&&!s&&r&&j>0&&e.transceivers[j]&&(e._disposeIceAndDtlsTransports(j),e.transceivers[j].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[j].iceTransport=e.transceivers[0].iceTransport,e.transceivers[j].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[j].rtpSender&&e.transceivers[j].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[j].rtpReceiver&&e.transceivers[j].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),"offer"!==d.type||s){if("answer"===d.type&&!s){x=e.transceivers[j],y=x.iceGatherer,z=x.iceTransport,A=x.dtlsTransport,B=x.rtpReceiver,C=x.sendEncodingParameters,E=x.localCapabilities,e.transceivers[j].recvEncodingParameters=D,e.transceivers[j].remoteCapabilities=I,e.transceivers[j].rtcpParameters=J,L.length&&"new"===z.state&&(!q&&!K||r&&0!==j?L.forEach(function(a){i(x.iceTransport,a)}):z.setRemoteCandidates(L)),r&&0!==j||("new"===z.state&&z.start(y,G,"controlling"),"new"===A.state&&A.start(H));var M=g(x.localCapabilities,x.remoteCapabilities),N=M.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length;!N&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,e._transceive(x,"sendrecv"===u||"recvonly"===u,"sendrecv"===u||"sendonly"===u),!B||"sendrecv"!==u&&"sendonly"!==u?delete x.rtpReceiver:(F=B.track,v?(f[v.stream]||(f[v.stream]=new a.MediaStream),c(F,f[v.stream]),n.push([F,B,f[v.stream]])):(f.default||(f.default=new a.MediaStream),c(F,f.default),n.push([F,B,f.default])))}}else{x=e.transceivers[j]||e._createTransceiver(o),x.mid=w,x.iceGatherer||(x.iceGatherer=e._createIceGatherer(j,r)),L.length&&"new"===x.iceTransport.state&&(!K||r&&0!==j?L.forEach(function(a){i(x.iceTransport,a)}):x.iceTransport.setRemoteCandidates(L)),E=a.RTCRtpReceiver.getCapabilities(o),b<15019&&(E.codecs=E.codecs.filter(function(a){return"rtx"!==a.name})),C=x.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var O=!1;if("sendrecv"===u||"sendonly"===u){if(O=!x.rtpReceiver,B=x.rtpReceiver||new a.RTCRtpReceiver(x.dtlsTransport,o),O){var P;F=B.track,v&&"-"===v.stream||(v?(f[v.stream]||(f[v.stream]=new a.MediaStream,Object.defineProperty(f[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(F,"id",{get:function(){return v.track}}),P=f[v.stream]):(f.default||(f.default=new a.MediaStream),P=f.default)),P&&(c(F,P),x.associatedRemoteMediaStreams.push(P)),n.push([F,B,P])}}else x.rtpReceiver&&x.rtpReceiver.track&&(x.associatedRemoteMediaStreams.forEach(function(a){var b=a.getTracks().find(function(a){return a.id===x.rtpReceiver.track.id});b&&l(b,a)}),x.associatedRemoteMediaStreams=[]);x.localCapabilities=E,x.remoteCapabilities=I,x.rtpReceiver=B,x.rtcpParameters=J,x.sendEncodingParameters=C,x.recvEncodingParameters=D,e._transceive(e.transceivers[j],!1,O)}}),void 0===e._dtlsRole&&(e._dtlsRole="offer"===d.type?"active":"passive"),e._remoteDescription={type:d.type,sdp:d.sdp},"offer"===d.type?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(f).forEach(function(b){var c=f[b];if(c.getTracks().length){if(-1===e.remoteStreams.indexOf(c)){e.remoteStreams.push(c);var d=new Event("addstream");d.stream=c,a.setTimeout(function(){e._dispatchEvent("addstream",d)})}n.forEach(function(a){var b=a[0],d=a[1];c.id===a[2].id&&m(e,b,d,[c])})}}),n.forEach(function(a){a[2]||m(e,a[0],a[1],[])}),a.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},n.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))},n.prototype._updateIceConnectionState=function(){var a,b={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&b[a.iceTransport.state]++}),a="new",b.failed>0?a="failed":b.checking>0?a="checking":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0?a="connected":b.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},n.prototype._updateConnectionState=function(){var a,b={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(b[a.iceTransport.state]++,b[a.dtlsTransport.state]++)}),b.connected+=b.completed,a="new",b.failed>0?a="failed":b.connecting>0?a="connecting":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},n.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(j("InvalidStateError","Can not call createOffer after close"));var d=c.transceivers.filter(function(a){return"audio"===a.kind}).length,f=c.transceivers.filter(function(a){return"video"===a.kind}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==g.offerToReceiveAudio&&(d=!0===g.offerToReceiveAudio?1:!1===g.offerToReceiveAudio?0:g.offerToReceiveAudio),void 0!==g.offerToReceiveVideo&&(f=!0===g.offerToReceiveVideo?1:!1===g.offerToReceiveVideo?0:g.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?--d<0&&(a.wantReceive=!1):"video"===a.kind&&--f<0&&(a.wantReceive=!1)});d>0||f>0;)d>0&&(c._createTransceiver("audio"),d--),f>0&&(c._createTransceiver("video"),f--);var h=k.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(d,e){var f=d.track,g=d.kind,h=d.mid||k.generateIdentifier();d.mid=h,d.iceGatherer||(d.iceGatherer=c._createIceGatherer(e,c.usingBundle));var i=a.RTCRtpSender.getCapabilities(g);b<15019&&(i.codecs=i.codecs.filter(function(a){return"rtx"!==a.name})),i.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1"),d.remoteCapabilities&&d.remoteCapabilities.codecs&&d.remoteCapabilities.codecs.forEach(function(b){a.name.toLowerCase()===b.name.toLowerCase()&&a.clockRate===b.clockRate&&(a.preferredPayloadType=b.payloadType)})}),i.headerExtensions.forEach(function(a){(d.remoteCapabilities&&d.remoteCapabilities.headerExtensions||[]).forEach(function(b){a.uri===b.uri&&(a.id=b.id)})});var j=d.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];f&&b>=15019&&"video"===g&&!j[0].rtx&&(j[0].rtx={ssrc:j[0].ssrc+1}),d.wantReceive&&(d.rtpReceiver=new a.RTCRtpReceiver(d.dtlsTransport,g)),d.localCapabilities=i,d.sendEncodingParameters=j}),"max-compat"!==c._config.bundlePolicy&&(h+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),h+="a=ice-options:trickle\r\n",c.transceivers.forEach(function(a,b){h+=e(a,a.localCapabilities,"offer",a.stream,c._dtlsRole),h+="a=rtcp-rsize\r\n",!a.iceGatherer||"new"===c.iceGatheringState||0!==b&&c.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1,h+="a="+k.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(h+="a=end-of-candidates\r\n"))});var i=new a.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(i)},n.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(j("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==c.signalingState&&"have-local-pranswer"!==c.signalingState)return Promise.reject(j("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var d=k.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(d+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n";var f=k.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(a,h){if(!(h+1>f)){if(a.rejected)return"application"===a.kind?"DTLS/SCTP"===a.protocol?d+="m=application 0 DTLS/SCTP 5000\r\n":d+="m=application 0 "+a.protocol+" webrtc-datachannel\r\n":"audio"===a.kind?d+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===a.kind&&(d+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(d+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+a.mid+"\r\n");if(a.stream){var i;"audio"===a.kind?i=a.stream.getAudioTracks()[0]:"video"===a.kind&&(i=a.stream.getVideoTracks()[0]),
i&&b>=15019&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1})}var j=g(a.localCapabilities,a.remoteCapabilities);!j.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,d+=e(a,j,"answer",a.stream,c._dtlsRole),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(d+="a=rtcp-rsize\r\n")}});var h=new a.RTCSessionDescription({type:"answer",sdp:d});return Promise.resolve(h)},n.prototype.addIceCandidate=function(a){var b,c=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,e){if(!c._remoteDescription)return e(j("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var f=a.sdpMLineIndex;if(a.sdpMid)for(var g=0;g<c.transceivers.length;g++)if(c.transceivers[g].mid===a.sdpMid){f=g;break}var h=c.transceivers[f];if(!h)return e(j("OperationError","Can not add ICE candidate"));if(h.rejected)return d();var l=Object.keys(a.candidate).length>0?k.parseCandidate(a.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return d();if(l.component&&1!==l.component)return d();if((0===f||f>0&&h.iceTransport!==c.transceivers[0].iceTransport)&&!i(h.iceTransport,l))return e(j("OperationError","Can not add ICE candidate"));var m=a.candidate.trim();0===m.indexOf("a=")&&(m=m.substr(2)),b=k.getMediaSections(c._remoteDescription.sdp),b[f]+="a="+(l.type?m:"end-of-candidates")+"\r\n",c._remoteDescription.sdp=k.getDescription(c._remoteDescription.sdp)+b.join("")}else for(var n=0;n<c.transceivers.length&&(c.transceivers[n].rejected||(c.transceivers[n].iceTransport.addRemoteCandidate({}),b=k.getMediaSections(c._remoteDescription.sdp),b[n]+="a=end-of-candidates\r\n",c._remoteDescription.sdp=k.getDescription(c._remoteDescription.sdp)+b.join(""),!c.usingBundle));n++);d()})},n.prototype.getStats=function(b){if(b&&b instanceof a.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===b?c=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===b&&(c=a.rtpReceiver)}),!c)throw j("InvalidAccessError","Invalid selector.");return c.getStats()}var d=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&d.push(a[b].getStats())})}),Promise.all(d).then(function(a){var b=new Map;return a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})}),b})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(b){var c=a[b];if(c&&c.prototype&&c.prototype.getStats){var e=c.prototype.getStats;c.prototype.getStats=function(){return e.apply(this).then(function(a){var b=new Map;return Object.keys(a).forEach(function(c){a[c].type=d(a[c]),b.set(c,a[c])}),b})}}});var o=["createOffer","createAnswer"];return o.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[0]||"function"==typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"==typeof a[0]&&a[0].apply(null,[b])},function(b){"function"==typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}}),o=["setLocalDescription","setRemoteDescription","addIceCandidate"],o.forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]||"function"==typeof a[2]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)},function(b){"function"==typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}}),["getStats"].forEach(function(a){var b=n.prototype[a];n.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}}),n}},{sdp:131}],131:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.getDescription=function(a){var b=d.splitSections(a);return b&&b[0]},d.getMediaSections=function(a){var b=d.splitSections(a);return b.shift(),b},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],address:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;case"ufrag":c.ufrag=b[d+1],c.usernameFragment=b[d+1];break;default:c[b[d]]=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},d.parseIceOptions=function(a){return a.substr(14).split(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.channels=3===b.length?parseInt(b[2],10):1,c.numChannels=c.channels,c},d.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);var c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.parseSsrcGroup=function(a){var b=a.substr(13).split(" ");return{semantics:b.shift(),ssrcs:b.map(function(a){return parseInt(a,10)})}},d.getMid=function(a){var b=d.matchPrefix(a,"a=mid:")[0];if(b)return b.substr(6)},d.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},d.getDtlsParameters=function(a,b){return{role:"auto",fingerprints:d.matchPrefix(a+b,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.parseCryptoLine=function(a){var b=a.substr(9).split(" ");return{tag:parseInt(b[0],10),cryptoSuite:b[1],keyParams:b[2],sessionParams:b.slice(3)}},d.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+("object"==typeof a.keyParams?d.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+"\r\n"},d.parseCryptoKeyParams=function(a){if(0!==a.indexOf("inline:"))return null;var b=a.substr(7).split("|");return{keyMethod:"inline",keySalt:b[0],lifeTime:b[1],mkiValue:b[2]?b[2].split(":")[0]:void 0,mkiLength:b[2]?b[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},d.getCryptoParameters=function(a,b){return d.matchPrefix(a+b,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(a,b){var c=d.matchPrefix(a+b,"a=ice-ufrag:")[0],e=d.matchPrefix(a+b,"a=ice-pwd:")[0];return c&&e?{usernameFragment:c.substr(12),password:e.substr(10)}:null},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)});var e=0;return b.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(c+="a=maxptime:"+e+"\r\n"),c+="a=rtcp-mux\r\n",b.headerExtensions&&b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10)};i&&b&&(d.rtx={ssrc:b}),c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:i,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(a){a.maxBitrate=k})),c},d.parseRtcpParameters=function(a){var b={},c=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);var e=d.matchPrefix(a,"a=rtcp-rsize");b.reducedSize=e.length>0,b.compound=0===e.length;var f=d.matchPrefix(a,"a=rtcp-mux");return b.mux=f.length>0,b},d.parseMsid=function(a){var b,c=d.matchPrefix(a,"a=msid:");if(1===c.length)return b=c[0].substr(7).split(" "),{stream:b[0],track:b[1]};var e=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return e.length>0?(b=e[0].value.split(" "),{stream:b[0],track:b[1]}):void 0},d.parseSctpDescription=function(a){var b,c=d.parseMLine(a),e=d.matchPrefix(a,"a=max-message-size:");e.length>0&&(b=parseInt(e[0].substr(19),10)),isNaN(b)&&(b=65536);var f=d.matchPrefix(a,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:c.fmt,maxMessageSize:b};if(d.matchPrefix(a,"a=sctpmap:").length>0){var g=d.matchPrefix(a,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:b}}},d.writeSctpDescription=function(a,b){var c=[];return c="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+b.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+b.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+b.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+b.port+" "+b.protocol+" 65535\r\n"],void 0!==b.maxMessageSize&&c.push("a=max-message-size:"+b.maxMessageSize+"\r\n"),c.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(a,b,c){var e,f=void 0!==b?b:2;return e=a||d.generateSessionId(),"v=0\r\no="+(c||"thisisadapterortc")+" "+e+" "+f+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",a.direction?f+="a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),f},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},d.getKind=function(a){return d.splitLines(a)[0].split(" ")[0].substr(2)},d.isRejected=function(a){return"0"===a.split(" ",2)[1]},d.parseMLine=function(a){var b=d.splitLines(a),c=b[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},d.parseOLine=function(a){var b=d.matchPrefix(a,"o=")[0],c=b.substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},d.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;for(var b=d.splitLines(a),c=0;c<b.length;c++)if(b[c].length<2||"="!==b[c].charAt(1))return!1;return!0},"object"==typeof b&&(b.exports=d)},{}],132:[function(a,b,c){function d(a,b){var c=b||0,d=e;return[d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],"-",d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]],d[a[c++]]].join("")}for(var e=[],f=0;f<256;++f)e[f]=(f+256).toString(16).substr(1);b.exports=d},{}],133:[function(a,b,c){var d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(d){var e=new Uint8Array(16);b.exports=function(){return d(e),e}}else{var f=new Array(16);b.exports=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),f[b]=a>>>((3&b)<<3)&255;return f}}},{}],134:[function(a,b,c){function d(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new Array(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;++h)b[d+h]=g[h];return b||f(g)}var e=a("./lib/rng"),f=a("./lib/bytesToUuid");b.exports=d},{"./lib/bytesToUuid":132,"./lib/rng":133}],135:[function(a,b,c){(function(c){(function(){"use strict";var d=a("./adapter_factory.js");b.exports=d({window:c.window})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":136}],136:[function(a,b,c){"use strict";var d=a("./utils");b.exports=function(b,c){var e=b&&b.window,f={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var g in c)hasOwnProperty.call(c,g)&&(f[g]=c[g]);var h=d.log,i=d.detectBrowser(e),j=a("./chrome/chrome_shim")||null,k=a("./edge/edge_shim")||null,l=a("./firefox/firefox_shim")||null,m=a("./safari/safari_shim")||null,n=a("./common_shim")||null,o={browserDetails:i,commonShim:n,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(i.browser){case"chrome":if(!j||!j.shimPeerConnection||!f.shimChrome)return h("Chrome shim is not included in this adapter release."),o;h("adapter.js shimming chrome."),o.browserShim=j,n.shimCreateObjectURL(e),j.shimGetUserMedia(e),j.shimMediaStream(e),j.shimSourceObject(e),j.shimPeerConnection(e),j.shimOnTrack(e),j.shimAddTrackRemoveTrack(e),j.shimGetSendersWithDtmf(e),j.shimSenderReceiverGetStats(e),j.fixNegotiationNeeded(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"firefox":if(!l||!l.shimPeerConnection||!f.shimFirefox)return h("Firefox shim is not included in this adapter release."),o;h("adapter.js shimming firefox."),o.browserShim=l,n.shimCreateObjectURL(e),l.shimGetUserMedia(e),l.shimSourceObject(e),l.shimPeerConnection(e),l.shimOnTrack(e),l.shimRemoveStream(e),l.shimSenderGetStats(e),l.shimReceiverGetStats(e),l.shimRTCDataChannel(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"edge":if(!k||!k.shimPeerConnection||!f.shimEdge)return h("MS edge shim is not included in this adapter release."),o;h("adapter.js shimming edge."),o.browserShim=k,n.shimCreateObjectURL(e),k.shimGetUserMedia(e),k.shimPeerConnection(e),k.shimReplaceTrack(e),k.shimGetDisplayMedia(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;case"safari":if(!m||!f.shimSafari)return h("Safari shim is not included in this adapter release."),o;h("adapter.js shimming safari."),o.browserShim=m,n.shimCreateObjectURL(e),m.shimRTCIceServerUrls(e),m.shimCreateOfferLegacy(e),m.shimCallbacksAPI(e),m.shimLocalStreamsAPI(e),m.shimRemoteStreamsAPI(e),m.shimTrackEventTransceiver(e),m.shimGetUserMedia(e),n.shimRTCIceCandidate(e),n.shimMaxMessageSize(e),n.shimSendThrowTypeError(e);break;default:h("Unsupported browser!")}return o}},{"./chrome/chrome_shim":137,"./common_shim":139,"./edge/edge_shim":140,"./firefox/firefox_shim":143,"./safari/safari_shim":145,"./utils":146}],137:[function(a,b,c){"use strict";function d(a,b,c){b&&!c.has(b.id)&&(c.set(b.id,b),Object.keys(b).forEach(function(e){e.endsWith("Id")?d(a,a.get(b[e]),c):e.endsWith("Ids")&&b[e].forEach(function(b){d(a,a.get(b),c)})}))}function e(a,b,c){var e=c?"outbound-rtp":"inbound-rtp",f=new Map;if(null===b)return f;var g=[];return a.forEach(function(a){"track"===a.type&&a.trackIdentifier===b.id&&g.push(a)}),g.forEach(function(b){a.forEach(function(c){c.type===e&&c.trackId===b.id&&d(a,c,f)})}),f}var f=a("../utils.js"),g=f.log;b.exports={shimGetUserMedia:a("./getusermedia"),shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)f.wrapPeerConnectionEvent(a,"track",function(a){return a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a});else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var f=new Event("track");f.track=d.track,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)}),b.stream.getTracks().forEach(function(d){var e;e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var f=new Event("track");f.track=d,f.receiver=e,f.transceiver={receiver:e},f.streams=[b.stream],c.dispatchEvent(f)})},c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=this,f=c.apply(e,arguments);return f||(f=b(e,a),e._senders.push(f)),f};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;d.apply(b,arguments);var c=b._senders.indexOf(a);-1!==c&&b._senders.splice(c,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=this;c._senders=c._senders||[],e.apply(c,[a]),a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[],f.apply(b,[a]),a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=g.apply(a,[]);return b.forEach(function(b){b._pc=a}),b},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver){if(!("getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return e(b,a.track,!0)})}}if(!("getStats"in a.RTCRtpReceiver.prototype)){var d=a.RTCPeerConnection.prototype.getReceivers;d&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,b=d.apply(a,[]);return b.forEach(function(b){b._pc=a}),b}),f.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){var a=this;return this._pc.getStats().then(function(b){return e(b,a.track,!1)})}}if("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype){var g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){var b=this;if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){var c,d,e,f=arguments[0];return b.getSenders().forEach(function(a){a.track===f&&(c?e=!0:c=a)}),b.getReceivers().forEach(function(a){return a.track===f&&(d?e=!0:d=a),a.track===f}),e||c&&d?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():d?d.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return g.apply(b,arguments)}}}},shimSourceObject:function(a){var b=a&&a.URL;"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;if(this._srcObject=a,this.src&&b.revokeObjectURL(this.src),!a)return void(this.src="");this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)}),a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src),c.src=b.createObjectURL(a)})}}))},shimAddTrackRemoveTrackWithNative:function(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return a._shimmedLocalStreams[b][0]})};var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(d)&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};var c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(function(a){if(b.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")});var d=b.getSenders();c.apply(this,arguments);var e=b.getSenders().filter(function(a){return-1===d.indexOf(a)});this._shimmedLocalStreams[a.id]=[a].concat(e)};var d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};var e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var d=b._shimmedLocalStreams[c].indexOf(a);-1!==d&&b._shimmedLocalStreams[c].splice(d,1),1===b._shimmedLocalStreams[c].length&&delete b._shimmedLocalStreams[c]}),e.apply(this,arguments)}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}function c(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){var d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(new RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})}if(a.RTCPeerConnection){var d=f.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&d.version>=65)return this.shimAddTrackRemoveTrackWithNative(a);var e=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var a=this,b=e.apply(this);return a._reverseStreams=a._reverseStreams||{},b.map(function(b){return a._reverseStreams[b.id]})};var g=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=this;if(c._streams=c._streams||{},c._reverseStreams=c._reverseStreams||{},b.getTracks().forEach(function(a){if(c.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError")}),!c._reverseStreams[b.id]){var d=new a.MediaStream(b.getTracks());c._streams[b.id]=d,c._reverseStreams[d.id]=b,b=d}g.apply(c,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._streams=b._streams||{},b._reverseStreams=b._reverseStreams||{},h.apply(b,[b._streams[a.id]||a]),delete b._reverseStreams[b._streams[a.id]?b._streams[a.id].id:a.id],delete b._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(d.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");d._streams=d._streams||{},d._reverseStreams=d._reverseStreams||{};var f=d._streams[c.id];if(f)f.addTrack(b),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))});else{var g=new a.MediaStream([b]);d._streams[c.id]=g,d._reverseStreams[g.id]=c,d.addStream(g)}return d.getSenders().find(function(a){return a.track===b})},["createOffer","createAnswer"].forEach(function(c){var d=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments;return arguments.length&&"function"==typeof arguments[0]?d.apply(a,[function(d){var e=b(a,d);c[0].apply(null,[e])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(c){return b(a,c)})}});var i=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a=this;return arguments.length&&arguments[0].type?(arguments[0]=c(a,arguments[0]),i.apply(a,arguments)):i.apply(a,arguments)};var j=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=this,c=j.get.apply(this);return""===c.type?c:b(a,c)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(a._pc!==b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};var c;Object.keys(b._streams).forEach(function(d){b._streams[d].getTracks().find(function(b){return a.track===b})&&(c=b._streams[d])}),c&&(1===c.getTracks().length?b.removeStream(b._reverseStreams[c.id]):c.removeTrack(a.track),b.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(a){var b=f.detectBrowser(a);if(!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=function(b,c){return g("PeerConnection"),b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy),new a.webkitRTCPeerConnection(b,c)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}})),a.RTCPeerConnection){var c=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,d){var e=this,f=arguments
;if(arguments.length>0&&"function"==typeof a)return c.apply(this,arguments);if(0===c.length&&(0===arguments.length||"function"!=typeof arguments[0]))return c.apply(this,[]);var g=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return c.apply(this,[i,arguments[0]])}return new Promise(function(a,b){c.apply(e,[function(b){a(h(g(b)))},b])}).then(b,d)},b.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),b.version<52&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var d=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?d.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(a){f.wrapPeerConnectionEvent(a,"negotiationneeded",function(a){if("stable"===a.target.signalingState)return a})},shimGetDisplayMedia:function(a,b){if(a.navigator&&a.navigator.mediaDevices&&!("getDisplayMedia"in a.navigator.mediaDevices)){if("function"!=typeof b)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");a.navigator.mediaDevices.getDisplayMedia=function(c){return b(c).then(function(b){var d=c.video&&c.video.width,e=c.video&&c.video.height,f=c.video&&c.video.frameRate;return c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxFrameRate:f||3}},d&&(c.video.mandatory.maxWidth=d),e&&(c.video.mandatory.maxHeight=e),a.navigator.mediaDevices.getUserMedia(c)})},a.navigator.getDisplayMedia=function(b){return f.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),a.navigator.mediaDevices.getDisplayMedia(b)}}}}},{"../utils.js":146,"./getusermedia":138}],138:[function(a,b,c){"use strict";var d=a("../utils.js"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},g=function(a,d){if(b.version>=61)return d(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){var g=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a)),g(a.audio,"autoGainControl","googAutoGainControl"),g(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=f(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});var i=b.version<66;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||i)){delete a.video.facingMode;var j;if("environment"===h.exact||"environment"===h.ideal?j=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(j=["front"]),j)return c.mediaDevices.enumerateDevices().then(function(b){b=b.filter(function(a){return"videoinput"===a.kind});var c=b.find(function(a){return j.some(function(b){return-1!==a.label.toLowerCase().indexOf(b)})});return!c&&b.length&&-1!==j.indexOf("back")&&(c=b[b.length-1]),c&&(a.video.deviceId=h.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=f(a.video),e("chrome: "+JSON.stringify(a)),d(a)})}a.video=f(a.video)}return e("chrome: "+JSON.stringify(a)),d(a)},h=function(a){return b.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(a,b,d){g(a,function(a){c.webkitGetUserMedia(a,b,function(a){d&&d(h(a))})})};c.getUserMedia=i;var j=function(a){return new Promise(function(b,d){c.getUserMedia(a,b,d)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:j,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return g(a,function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(h(a))})})}}else c.mediaDevices.getUserMedia=function(a){return j(a)};void 0===c.mediaDevices.addEventListener&&(c.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),void 0===c.mediaDevices.removeEventListener&&(c.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":146}],139:[function(a,b,c){"use strict";var d=a("sdp"),e=a("./utils");b.exports={shimRTCIceCandidate:function(a){if(a.RTCIceCandidate&&!(a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){var c=new b(a),e=d.parseCandidate(a.candidate),f=Object.assign(c,e);return f.toJSON=function(){return{candidate:f.candidate,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex,usernameFragment:f.usernameFragment}},f}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,e.wrapPeerConnectionEvent(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},shimCreateObjectURL:function(a){var b=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&b.createObjectURL&&b.revokeObjectURL){var c=b.createObjectURL.bind(b),d=b.revokeObjectURL.bind(b),f=new Map,g=0;b.createObjectURL=function(a){if("getTracks"in a){var b="polyblob:"+ ++g;return f.set(b,a),e.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),b}return c(a)},b.revokeObjectURL=function(a){d(a),f.delete(a)};var h=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(a){return this.srcObject=f.get(a)||null,h.set.apply(this,[a])}});var i=a.HTMLMediaElement.prototype.setAttribute;a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=f.get(arguments[1])||null),i.apply(this,arguments)}}},shimMaxMessageSize:function(a){if(!a.RTCSctpTransport&&a.RTCPeerConnection){var b=e.detectBrowser(a);"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var c=function(a){var b=d.splitSections(a.sdp);return b.shift(),b.some(function(a){var b=d.parseMLine(a);return b&&"application"===b.kind&&-1!==b.protocol.indexOf("SCTP")})},f=function(a){var b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return-1;var c=parseInt(b[1],10);return c!==c?-1:c},g=function(a){var c=65536;return"firefox"===b.browser&&(c=b.version<57?-1===a?16384:2147483637:b.version<60?57===b.version?65535:65536:2147483637),c},h=function(a,c){var e=65536;"firefox"===b.browser&&57===b.version&&(e=65535);var f=d.matchPrefix(a.sdp,"a=max-message-size:");return f.length>0?e=parseInt(f[0].substr(19),10):"firefox"===b.browser&&-1!==c&&(e=2147483637),e},i=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;if(a._sctp=null,c(arguments[0])){var b,d=f(arguments[0]),e=g(d),j=h(arguments[0],d);b=0===e&&0===j?Number.POSITIVE_INFINITY:0===e||0===j?Math.max(e,j):Math.min(e,j);var k={};Object.defineProperty(k,"maxMessageSize",{get:function(){return b}}),a._sctp=k}return i.apply(a,arguments)}}},shimSendThrowTypeError:function(a){function b(a,b){var c=a.send;a.send=function(){var d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}if(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype){var c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){var a=this,d=c.apply(a,arguments);return b(d,a),d},e.wrapPeerConnectionEvent(a,"datachannel",function(a){return b(a.channel,a.target),a})}}}},{"./utils":146,sdp:131}],140:[function(a,b,c){"use strict";var d=a("../utils"),e=a("./filtericeservers"),f=a("rtcpeerconnection-shim");b.exports={shimGetUserMedia:a("./getusermedia"),shimPeerConnection:function(a){var b=d.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){var c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){c.set.call(this,a);var b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender);var g=f(a,b.version);a.RTCPeerConnection=function(a){return a&&a.iceServers&&(a.iceServers=e(a.iceServers)),new g(a)},a.RTCPeerConnection.prototype=g.prototype},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(a,b){if("getDisplayMedia"in a.navigator&&a.navigator.mediaDevices&&!("getDisplayMedia"in a.navigator.mediaDevices)){var c=a.navigator.getDisplayMedia;a.navigator.mediaDevices.getDisplayMedia=function(b){return c.call(a.navigator,b)},a.navigator.getDisplayMedia=function(b){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),c.call(a.navigator,b)}}}}},{"../utils":146,"./filtericeservers":141,"./getusermedia":142,"rtcpeerconnection-shim":130}],141:[function(a,b,c){"use strict";var d=a("../utils");b.exports=function(a,b){var c=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(a){if(a&&(a.urls||a.url)){var e=a.urls||a.url;a.url&&!a.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var f="string"==typeof e;return f&&(e=[e]),e=e.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport=udp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&b>=14393&&-1===a.indexOf("?transport=udp"):(c=!0,!0)}),delete a.url,a.urls=f?e[0]:e,!!e.length}})}},{"../utils":146}],142:[function(a,b,c){"use strict";b.exports=function(a){var b=a&&a.navigator,c=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},d=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return d(a).catch(function(a){return Promise.reject(c(a))})}}},{}],143:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimGetUserMedia:a("./getusermedia"),shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.transceiver={receiver:c.receiver},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=d.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(b.version<38&&c&&c.iceServers){for(var e=[],f=0;f<c.iceServers.length;f++){var g=c.iceServers[f];if(g.hasOwnProperty("urls"))for(var h=0;h<g.urls.length;h++){var i={url:g.urls[h]};0===g.urls[h].indexOf("turn")&&(i.username=g.username,i.credential=g.credential),e.push(i)}else e.push(c.iceServers[f])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var e=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,d){return g.apply(this,[a||null]).then(function(a){if(b.version<48&&(a=e(a)),b.version<53&&!c)try{a.forEach(function(a){a.type=f[a.type]||a.type})}catch(b){if("TypeError"!==b.name)throw b;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:f[b.type]||b.type}))})}return a}).then(c,d)}}},shimSenderGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)){var b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c});var c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){var a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(a){if("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&!(a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)){var b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){var a=this,c=b.apply(a,[]);return c.forEach(function(b){b._pc=a}),c}),d.wrapPeerConnectionEvent(a,"track",function(a){return a.receiver._pc=a.srcElement,a}),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(a){!a.RTCPeerConnection||"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&-1!==a.getTracks().indexOf(c.track)&&b.removeTrack(c)})})},shimRTCDataChannel:function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)},shimGetDisplayMedia:function(a,b){!a.navigator||!a.navigator.mediaDevices||"getDisplayMedia"in a.navigator.mediaDevices||(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!c||!c.video){var d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)},a.navigator.getDisplayMedia=function(b){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),a.navigator.mediaDevices.getDisplayMedia(b)})}}},{"../utils":146,"./getusermedia":144}],144:[function(a,b,c){"use strict";var d=a("../utils"),e=d.log;b.exports=function(a){var b=d.detectBrowser(a),c=a&&a.navigator,f=a&&a.MediaStreamTrack,g=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,d,f){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),b.version<38&&(e("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e("ff37: "+JSON.stringify(a))),c.mozGetUserMedia(a,d,function(a){f(g(a))})},i=function(a){return new Promise(function(b,c){h(a,b,c)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},b.version<41){var j=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return j().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(b.version<49){var k=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return k(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return b},function(a){return Promise.reject(g(a))})}}if(!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var l=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","mozAutoGainControl"),l(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},f&&f.prototype.getSettings){var n=f.prototype.getSettings;f.prototype.getSettings=function(){var a=n.apply(this,arguments);return l(a,"mozAutoGainControl","autoGainControl"),l(a,"mozNoiseSuppression","noiseSuppression"),a}}if(f&&f.prototype.applyConstraints){var o=f.prototype.applyConstraints;f.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),l(a,"autoGainControl","mozAutoGainControl"),l(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}c.getUserMedia=function(a,e,f){if(b.version<44)return h(a,e,f);d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(e,f)}}},{"../utils":146}],145:[function(a,b,c){"use strict";var d=a("../utils");b.exports={shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})},a.RTCPeerConnection.prototype.addTrack=function(a,c){return c&&(this._localStreams?-1===this._localStreams.indexOf(c)&&this._localStreams.push(c):this._localStreams=[c]),b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){-1!==d.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(function(b){if(a._remoteStreams||(a._remoteStreams=[]),!(a._remoteStreams.indexOf(b)>=0)){a._remoteStreams.push(b);var c=new Event("addstream");c.stream=b,a.dispatchEvent(c)}})}),b.apply(a,arguments)}}},shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){var b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){var d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){var c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};var h=function(a,b,c){var d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){var d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){var d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var e=[],f=0;f<a.iceServers.length;f++){var g=a.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,e.push(g)):e.push(a.iceServers[f])}a.iceServers=e}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"==typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){var c=this;if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);var d=c.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==a.offerToReceiveAudio||d||c.addTransceiver("audio"),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);var e=c.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&e?"sendrecv"===e.direction?e.setDirection("sendonly"):"recvonly"===e.direction&&e.setDirection("inactive"):!0!==a.offerToReceiveVideo||e||c.addTransceiver("video")}return b.apply(c,arguments)}}}},{"../utils":146}],146:[function(a,b,c){"use strict";function d(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}function e(a,b,c){if(a.RTCPeerConnection){var d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);var f=function(a){var b=c(a);b&&d(b)};return this._eventMap=this._eventMap||{},this._eventMap[d]=f,e.apply(this,[a,f])};var f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return f.apply(this,arguments);var d=this._eventMap[c];return delete this._eventMap[c],f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}}var f=!0,g=!0;b.exports={extractVersion:d,wrapPeerConnectionEvent:e,disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(f=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(g=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(f)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(a,b){g&&console.warn(a+" is deprecated, please use "+b+" instead.")},detectBrowser:function(a){var b=a&&a.navigator,c={};if(c.browser=null,c.version=null,void 0===a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=d(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)c.browser="chrome",c.version=d(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser="edge",c.version=d(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!a.RTCPeerConnection||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=d(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c}}},{}],147:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.UNDEFINED="undefined",c.DCV_STRATEGY="DCVStrategy",c.AUDIO="audio",c.ANSWER="answer",c.CHROME="chrome"},{}],148:[function(a,b,c){(function(b){(function(){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}a("webrtc-adapter");var d=a("./rtc_session"),e=c(d),f=a("./rtc_const"),g=a("./rtc_peer_connection_factory"),h=c(g),i=a("uuid/v4"),j=c(i),k=a("./strategies/StandardStrategy"),l=c(k),m=a("./strategies/CitrixVDIStrategy"),n=c(m),o=a("./strategies/DCVWebRTCStrategy"),p=c(o);/**
 * @license
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
/**
 * @license
 * License info for webrtc-adapter module assembled into js bundle:
 *
 * Copyright (c) 2014, The WebRTC project authors. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of Google nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/**
 * @license
 * License info for sdp module assembled into js bundle:
 *
 * See https://www.npmjs.com/package/sdp
 */
b.connect=b.connect||{},/**
 * @license
 * License info for uuid module assembled into js bundle:
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2010-2016 Robert Kieffer and other contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
b.connect.RTCSession=e.default,b.connect.RTCErrors=f.RTC_ERRORS,b.connect.RtcPeerConnectionFactory=h.default,b.connect.uuid=j.default,b.connect.StandardStrategy=l.default,b.connect.CitrixVDIStrategy=n.default,b.connect.DCVWebRTCStrategy=p.default,b.lily=b.lily||{},b.lily.RTCSession=e.default,b.lily.RTCErrors=f.RTC_ERRORS}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./rtc_const":150,"./rtc_peer_connection_factory":151,"./rtc_session":152,"./strategies/CitrixVDIStrategy":157,"./strategies/DCVWebRTCStrategy":158,"./strategies/StandardStrategy":159,"uuid/v4":134,"webrtc-adapter":135}],149:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.UnknownSignalingError=c.UnknownSignalingErrorName=c.CallNotFoundException=c.CallNotFoundExceptionName=c.BusyException=c.BusyExceptionName=c.UnsupportedOperation=c.UnsupportedOperationExceptionName=c.IllegalState=c.IllegalStateExceptionName=c.IllegalParameters=c.IllegalParametersExceptionName=c.GumTimeout=c.GumTimeoutExceptionName=c.Timeout=c.TimeoutExceptionName=void 0;var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/possibleConstructorReturn"),h=d(g),i=a("babel-runtime/helpers/inherits"),j=d(i),k=c.TimeoutExceptionName="Timeout",l=c.Timeout=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=k,c}return(0,j.default)(b,a),b}(Error),m=c.GumTimeoutExceptionName="GumTimeout",n=(c.GumTimeout=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=m,c}return(0,j.default)(b,a),b}(l),c.IllegalParametersExceptionName="IllegalParameters"),o=(c.IllegalParameters=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=n,c}return(0,j.default)(b,a),b}(Error),c.IllegalStateExceptionName="IllegalState"),p=(c.IllegalState=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=o,c}return(0,j.default)(b,a),b}(Error),c.UnsupportedOperationExceptionName="UnsupportedOperation"),q=(c.UnsupportedOperation=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=p,c}return(0,j.default)(b,a),b}(Error),c.BusyExceptionName="BusyException"),r=(c.BusyException=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=q,c}return(0,j.default)(b,a),b}(Error),c.CallNotFoundExceptionName="CallNotFoundException"),s=(c.CallNotFoundException=function(a){function b(a){(0,f.default)(this,b);var c=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name=r,c}return(0,j.default)(b,a),b}(Error),c.UnknownSignalingErrorName="UnknownSignalingError");c.UnknownSignalingError=function(a){function b(){(0,f.default)(this,b);var a=(0,h.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.name=s,a}return(0,j.default)(b,a),b}(Error)},{"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19}],150:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.MAX_ACCEPT_BYE_DELAY_MS=2e3,c.MAX_INVITE_DELAY_MS=5e3,c.DEFAULT_CONNECT_TIMEOUT_MS=1e4,c.DEFAULT_ICE_TIMEOUT_MS=8e3,c.DEFAULT_GUM_TIMEOUT_MS=1e4,c.SOFTPHONE_ROUTE_KEY="aws/softphone",c.INVITE_METHOD_NAME="invite",c.ACCEPT_METHOD_NAME="accept",c.BYE_METHOD_NAME="bye",c.RTC_PEER_CONNECTION_CONFIG={iceTransportPolicy:"relay",rtcpMuxPolicy:"require",bundlePolicy:"balanced",sdpSemantics:"unified-plan",enableDtlsSrtp:!0},c.RTC_PEER_CONNECTION_OPTIONAL_CONFIG={optional:[{googDscp:!0},{DtlsSrtpKeyAgreement:!0}]},c.DEFAULT_ICE_CANDIDATE_POOL_SIZE=1,c.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS=6e4,c.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS=250,c.CHROME_SUPPORTED_VERSION=59,c.RTC_ERRORS={ICE_COLLECTION_TIMEOUT:"Ice Collection Timeout",USER_BUSY:"User Busy",SIGNALLING_CONNECTION_FAILURE:"Signalling Connection Failure",SIGNALLING_HANDSHAKE_FAILURE:"Signalling Handshake Failure",SET_REMOTE_DESCRIPTION_FAILURE:"Set Remote Description Failure",CREATE_OFFER_FAILURE:"Create Offer Failure",SET_LOCAL_DESCRIPTION_FAILURE:"Set Local Description Failure",INVALID_REMOTE_SDP:"Invalid Remote SDP",NO_REMOTE_ICE_CANDIDATE:"No Remote ICE Candidate",GUM_TIMEOUT_FAILURE:"GUM Timeout Failure",GUM_OTHER_FAILURE:"GUM Other Failure",CALL_NOT_FOUND:"Call Not Found"},c.ICE_CONNECTION_STATE={NEW:"new",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},c.PEER_CONNECTION_STATE={NEW:"new",CONNECTING:"connecting",CONNECTED:"connected",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"}},{}],151:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=a("./utils"),j=a("./rtc_const"),k=a("./strategies/CCPInitiationStrategyInterface"),l=d(k),m=a("./strategies/StandardStrategy"),n=d(m),o=function(){function a(b,c,d,e,g){var h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new n.default;if((0,f.default)(this,a),!(h instanceof l.default))throw new Error("Expected a strategy of type CCPInitiationStrategyInterface");(0,i.assertTrue)((0,i.isFunction)(e),"transportHandle must be a function"),(0,i.assertTrue)((0,i.isFunction)(g),"publishError must be a function"),this._strategy=h,this._logger=b,this._clientId=d,this._wssManager=c,this._requestIceAccess=e,this._publishError=g,this._earlyMediaConnectionSupported=this._isEarlyMediaConnectionSupported(),this._initializeWebSocketEventListeners(),this._requestPeerConnection(),this._networkConnectivityChecker(),this._logger.log("RTC.js is using "+h.getStrategyName())}return(0,h.default)(a,[{key:"_isEarlyMediaConnectionSupported",value:function(){return this._strategy._isEarlyMediaConnectionSupported()}},{key:"_webSocketManagerOnMessage",value:function(a){var b=void 0;a.content&&(b=JSON.parse(a.content)),b&&this._clientId===b.clientId&&("idleConnection"===b.jsonRpcMsg.method?this._clearIdleRtcPeerConnection():"quotaBreached"===b.jsonRpcMsg.method&&(this._logger.log("Number of active sessions are more then allowed limit for the client "+this._clientId),this._closeRTCPeerConnection(),this._publishError("multiple_softphone_active_sessions","Number of active sessions are more then allowed limit.")))}},{key:"_initializeWebSocketEventListeners",value:function(){this._wssManager.subscribeTopics([j.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(j.SOFTPHONE_ROUTE_KEY,(0,i.hitch)(this,this._webSocketManagerOnMessage))}},{key:"get",value:function(a){var b=this,c=b._idlePc;return b._idlePc=null,null==c&&(c=b._createRtcPeerConnection(a)),b.clearIdleRtcPeerConnectionTimerId(),b._requestPeerConnection(),c}},{key:"clearIdleRtcPeerConnectionTimerId",value:function(){var a=this;a._idleRtcPeerConnectionTimerId&&(clearTimeout(a._idleRtcPeerConnectionTimerId),a._idleRtcPeerConnectionTimerId=null)}},{key:"_requestPeerConnection",value:function(){var a=this;!a._peerConnectionRequestInFlight&&a._earlyMediaConnectionSupported&&(a._peerConnectionRequestInFlight=!0,a._requestIceAccess().then(function(b){a._idlePc=a._createRtcPeerConnection(b),a._peerConnectionRequestInFlight=!1,a._idleRtcPeerConnectionTimerId=setTimeout((0,i.hitch)(a,a._refreshRtcPeerConnection),j.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS)},function(b){a._peerConnectionRequestInFlight=!1}))}},{key:"_networkConnectivityChecker",value:function(){var a=this;setInterval(function(){!navigator.onLine&&a._idlePc&&(a._logger.log("Network offline. Cleaning up early connection"),a._idlePc.close(),a._idlePc=null)},j.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS)}},{key:"_createRtcPeerConnection",value:function(a){var b=JSON.parse(JSON.stringify(j.RTC_PEER_CONNECTION_CONFIG));return b.iceServers=a,b.iceCandidatePoolSize=j.DEFAULT_ICE_CANDIDATE_POOL_SIZE,this._strategy._createRtcPeerConnection(b,j.RTC_PEER_CONNECTION_OPTIONAL_CONFIG)}},{key:"_clearIdleRtcPeerConnection",value:function(){this._logger.log("session is idle from long time. closing the peer connection for client "+this._clientId),this._closeRTCPeerConnection()}},{key:"_refreshRtcPeerConnection",value:function(){this._idleRtcPeerConnectionTimerId=null,this._clearIdleRtcPeerConnection(),this._logger.log("refreshing peer connection for client "+this._clientId),this._requestPeerConnection()}},{key:"_closeRTCPeerConnection",value:function(){this._idlePc&&(this._idlePc.close(),this._idlePc=null)}},{key:"close",value:function(){this._logger.log("close method invoked. Clear timer and close idle peer connection "+this._clientId),this.clearIdleRtcPeerConnectionTimerId(),this._closeRTCPeerConnection()}}]),a}();c.default=o},{"./rtc_const":150,"./strategies/CCPInitiationStrategyInterface":156,"./strategies/StandardStrategy":159,"./utils":160,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16}],152:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.FailedState=c.DisconnectedState=c.CleanUpState=c.TalkingState=c.AcceptState=c.InviteAnswerState=c.ConnectSignalingAndIceCollectionState=c.SetLocalSessionDescriptionState=c.CreateOfferState=c.GrabLocalMediaState=c.RTCSessionState=void 0;var e=a("babel-runtime/regenerator"),f=d(e),g=a("babel-runtime/helpers/asyncToGenerator"),h=d(g),i=a("babel-runtime/helpers/typeof"),j=d(i),k=a("babel-runtime/helpers/get"),l=d(k),m=a("babel-runtime/helpers/possibleConstructorReturn"),n=d(m),o=a("babel-runtime/helpers/inherits"),p=d(o),q=a("babel-runtime/helpers/classCallCheck"),r=d(q),s=a("babel-runtime/helpers/createClass"),t=d(s),u=a("./utils"),v=a("./session_report"),w=a("./rtc_const"),x=a("./exceptions"),y=a("./signaling"),z=d(y),A=a("uuid/v4"),B=d(A),C=a("./rtp-stats"),D=a("sdp"),E=a("./strategies/CCPInitiationStrategyInterface"),F=d(E),G=a("./strategies/StandardStrategy"),H=d(G),I=c.RTCSessionState=function(){function a(b){(0,r.default)(this,a),this._rtcSession=b}return(0,t.default)(a,[{key:"onEnter",value:function(){}},{key:"onExit",value:function(){}},{key:"_isCurrentState",value:function(){return this._rtcSession._state===this}},{key:"transit",value:function(a){this._isCurrentState()&&this._rtcSession.transit(a)}},{key:"hangup",value:function(){this.transit(new S(this._rtcSession))}},{key:"onIceCandidate",value:function(a){}},{key:"onRemoteHungup",value:function(){throw new x.UnsupportedOperation("onRemoteHungup not implemented by "+this.name)}},{key:"onSignalingConnected",value:function(){throw new x.UnsupportedOperation("onSignalingConnected not implemented by "+this.name)}},{key:"onSignalingHandshaked",value:function(){throw new x.UnsupportedOperation("onSignalingHandshaked not implemented by "+this.name)}},{key:"onSignalingFailed",value:function(a){throw new x.UnsupportedOperation("onSignalingFailed not implemented by "+this.name)}},{key:"onIceStateChange",value:function(a){}},{key:"logger",get:function(){return this._rtcSession._logger}},{key:"name",get:function(){return"RTCSessionState"}}]),a}(),J=c.GrabLocalMediaState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=Date.now();if(a._rtcSession._isUserProvidedStream)a.transit(new K(a._rtcSession));else{var c=new Promise(function(b,c){setTimeout(function(){c(new x.GumTimeout("Local media has not been initialized yet."))},a._rtcSession._gumTimeoutMillis)}),d=a._gUM(a._rtcSession._buildMediaConstraints());Promise.race([d,c]).then(function(c){a._rtcSession._sessionReport.gumTimeMillis=Date.now()-b,a._rtcSession._onGumSuccess(a._rtcSession),a._rtcSession._localStream=c,a._rtcSession._sessionReport.gumOtherFailure=!1,a._rtcSession._sessionReport.gumTimeoutFailure=!1,a.transit(new K(a._rtcSession))}).catch(function(c){a._rtcSession._sessionReport.gumTimeMillis=Date.now()-b;var d;c instanceof x.GumTimeout?(d=w.RTC_ERRORS.GUM_TIMEOUT_FAILURE,a._rtcSession._sessionReport.gumTimeoutFailure=!0,a._rtcSession._sessionReport.gumOtherFailure=!1):(d=w.RTC_ERRORS.GUM_OTHER_FAILURE,a._rtcSession._sessionReport.gumOtherFailure=!0,a._rtcSession._sessionReport.gumTimeoutFailure=!1),a.logger.error("Local media initialization failed",c),a._rtcSession._onGumError(a._rtcSession),a.transit(new S(a._rtcSession,d))})}}},{key:"_gUM",value:function(a){return this._rtcSession._strategy._gUM(a)}},{key:"name",get:function(){return"GrabLocalMediaState"}}]),b}(I),K=c.CreateOfferState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=a._rtcSession._localStream;a._rtcSession._strategy.addStream(a._rtcSession._pc,b),a._rtcSession._onLocalStreamAdded(a._rtcSession,b),a._rtcSession._pc.createOffer().then(function(b){a._rtcSession._localSessionDescription=b,a._rtcSession._sessionReport.createOfferFailure=!1,a.transit(new L(a._rtcSession))}).catch(function(b){a.logger.error("CreateOffer failed",b),a._rtcSession._sessionReport.createOfferFailure=!0,a.transit(new S(a._rtcSession,w.RTC_ERRORS.CREATE_OFFER_FAILURE))})}},{key:"name",get:function(){return"CreateOfferState"}}]),b}(I),L=c.SetLocalSessionDescriptionState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this,b=a._rtcSession._localSessionDescription,c=new u.SdpOptions;a._rtcSession._forceAudioCodec&&(c.forceCodec.audio=a._rtcSession._forceAudioCodec),a._rtcSession._forceVideoCodec&&(c.forceCodec.video=a._rtcSession._forceVideoCodec),c.enableOpusDtx=a._rtcSession._enableOpusDtx;var d=(0,u.transformSdp)(b.sdp,c);b.sdp=d.sdp,b.sdp+="a=ptime:20\r\n",b.sdp+="a=maxptime:20\r\n",b.sdp=b.sdp.replace("minptime=10","minptime=20"),a.logger.info("LocalSD",a._rtcSession._localSessionDescription),a._rtcSession._pc.setLocalDescription(a._rtcSession._localSessionDescription).then(function(){var b=Date.now()-a._rtcSession._connectTimeStamp;a._rtcSession._sessionReport.initializationTimeMillis=b,a._rtcSession._onSessionInitialized(a._rtcSession,b),a._rtcSession._sessionReport.setLocalDescriptionFailure=!1,a.transit(new M(a._rtcSession,d.mLines))}).catch(function(b){a.logger.error("SetLocalDescription failed",b),a._rtcSession._sessionReport.setLocalDescriptionFailure=!0,a.transit(new S(a._rtcSession,w.RTC_ERRORS.SET_LOCAL_DESCRIPTION_FAILURE))})}},{key:"name",get:function(){return"SetLocalSessionDescriptionState"}}]),b}(I),M=c.ConnectSignalingAndIceCollectionState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._iceCandidates=[],d._iceCandidateFoundationsMap={},d._mLines=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this;a._startTime=Date.now(),setTimeout(function(){a._isCurrentState()&&!a._iceCompleted&&(a.logger.warn("ICE collection timed out"),a._reportIceCompleted(!0))},a._rtcSession._iceTimeoutMillis),a._rtcSession._createSignalingChannel().connect()}},{key:"onSignalingConnected",value:function(){this._rtcSession._signallingConnectTimestamp=Date.now(),this._rtcSession._sessionReport.signallingConnectTimeMillis=this._rtcSession._signallingConnectTimestamp-this._startTime,this._signalingConnected=!0,this._rtcSession._onSignalingConnected(this._rtcSession),this._rtcSession._sessionReport.signallingConnectionFailure=!1,this._checkAndTransit()}},{key:"onSignalingFailed",value:function(a){this._rtcSession._sessionReport.signallingConnectTimeMillis=Date.now()-this._startTime,this.logger.error("Failed connecting to signaling server",a),this._rtcSession._sessionReport.signallingConnectionFailure=!0,this.transit(new S(this._rtcSession,w.RTC_ERRORS.SIGNALLING_CONNECTION_FAILURE))}},{key:"_createLocalCandidate",value:function(a){return new RTCIceCandidate(a)}},{key:"onIceCandidate",value:function(a){var b=a.candidate;this.logger.log("onicecandidate "+JSON.stringify(b)),b?b.candidate&&(this._iceCandidates.push(this._createLocalCandidate(b)),this._iceCompleted||this._checkCandidatesSufficient(b)):this._reportIceCompleted(!1)}},{key:"_checkCandidatesSufficient",value:function(a){var b=(0,D.parseCandidate)(a.candidate);if(1==b.component){var c=b.foundation,d=a.sdpMLineIndex;if(c&&d>=0&&d<this._mLines){var e=this._iceCandidateFoundationsMap[c]||[];e.includes(d)||e.push(d),this._iceCandidateFoundationsMap[c]=e,this._mLines==e.length&&this._reportIceCompleted(!1)}}}},{key:"_reportIceCompleted",value:function(a){this._rtcSession._sessionReport.iceCollectionTimeMillis=Date.now()-this._startTime,this._iceCompleted=!0,this._rtcSession._onIceCollectionComplete(this._rtcSession,a,this._iceCandidates.length),this._iceCandidates.length>0?(this._rtcSession._sessionReport.iceCollectionFailure=!1,this._checkAndTransit()):(this.logger.error("No ICE candidate"),this._rtcSession._sessionReport.iceCollectionFailure=!0,this.transit(new S(this._rtcSession,w.RTC_ERRORS.ICE_COLLECTION_TIMEOUT)))}},{key:"_checkAndTransit",value:function(){this._iceCompleted&&this._signalingConnected?this.transit(new N(this._rtcSession,this._iceCandidates)):this._iceCompleted?this.logger.log("Pending signaling connection"):this.logger.log("Pending ICE collection")}},{key:"name",get:function(){return"ConnectSignalingAndIceCollectionState"}}]),b}(I),N=c.InviteAnswerState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._iceCandidates=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){var a=this._rtcSession;a._onSignalingStarted(a),a._signalingChannel.invite(a._localSessionDescription.sdp,this._iceCandidates)}},{key:"onSignalingAnswered",value:function(a,b){this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!1,this.transit(new O(this._rtcSession,a,b))}},{key:"onSignalingFailed",value:function(a){var b;a.name==x.BusyExceptionName?(this.logger.error("User Busy, possibly multiple CCP windows open",a),this._rtcSession._sessionReport.userBusyFailure=!0,this._rtcSession._sessionReport.handshakingFailure=!0,b=w.RTC_ERRORS.USER_BUSY):a.name==x.CallNotFoundExceptionName?(this.logger.error("Call not found. One of the participant probably hungup.",a),b=w.RTC_ERRORS.CALL_NOT_FOUND,this._rtcSession._sessionReport.handshakingFailure=!0):(this.logger.error("Failed handshaking with signaling server",a),this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!0,b=w.RTC_ERRORS.SIGNALLING_HANDSHAKE_FAILURE),this.transit(new S(this._rtcSession,b))}},{key:"name",get:function(){return"InviteAnswerState"}}]),b}(I),O=c.AcceptState=function(a){function b(a,c,d){(0,r.default)(this,b);var e=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return e._sdp=c,e._candidates=d,e}return(0,p.default)(b,a),(0,t.default)(b,[{key:"_createSessionDescription",value:function(a){return new RTCSessionDescription(a)}},{key:"_createRemoteCandidate",value:function(a){return new RTCIceCandidate(a)}},{key:"onEnter",value:function(){var a=this,b=a._rtcSession;return a._sdp?!a._candidates||a._candidates.length<1?(a.logger.error("No remote ICE candidate"),b._stopSession(),b._sessionReport.noRemoteIceCandidateFailure=!0,void a.transit(new S(b,w.RTC_ERRORS.NO_REMOTE_ICE_CANDIDATE))):(b._sessionReport.invalidRemoteSDPFailure=!1,b._sessionReport.noRemoteIceCandidateFailure=!1,void a._rtcSession._strategy.setRemoteDescription(a,b)):(a.logger.error("Invalid remote SDP"),b._stopSession(),b._sessionReport.invalidRemoteSDPFailure=!0,void a.transit(new S(b,w.RTC_ERRORS.INVALID_REMOTE_SDP)))}},{key:"onSignalingHandshaked",value:function(){this._rtcSession._sessionReport.handshakingTimeMillis=Date.now()-this._rtcSession._signallingConnectTimestamp,this._signalingHandshaked=!0,this._checkAndTransit()}},{key:"_checkAndTransit",value:function(){this._signalingHandshaked&&this._remoteDescriptionSet?this.transit(new P(this._rtcSession)):this._signalingHandshaked?this.logger.log("Pending setting remote description"):this.logger.log("Pending handshaking")}},{key:"name",get:function(){return"AcceptState"}}]),b}(I),P=c.TalkingState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._startTime=Date.now(),this._rtcSession._sessionReport.preTalkingTimeMillis=this._startTime-this._rtcSession._connectTimeStamp,this._rtcSession._onSessionConnected(this._rtcSession)}},{key:"onSignalingReconnected",value:function(){}},{key:"onRemoteHungup",value:function(){this._rtcSession._signalingChannel.hangup(),this.transit(new R(this._rtcSession))}},{key:"hangup",value:function(){this._rtcSession._signalingChannel.hangup(),this.transit(new R(this._rtcSession))}},{key:"onIceStateChange",value:function(a){var b=this._rtcSession._strategy.onIceStateChange(a,this._rtcSession._pc);this.logger.info("ICE Connection State: ",b),b==w.ICE_CONNECTION_STATE.DISCONNECTED&&(this.logger.info("Lost ICE connection"),this._rtcSession._sessionReport.iceConnectionsLost+=1),b==w.ICE_CONNECTION_STATE.FAILED&&(this._rtcSession._sessionReport.iceConnectionsFailed=!0)}},{key:"onPeerConnectionStateChange",value:function(){var a=this._rtcSession._strategy.onPeerConnectionStateChange(this._rtcSession._pc);this.logger.info("Peer Connection State: ",a),a==w.PEER_CONNECTION_STATE.FAILED&&(this._rtcSession._sessionReport.peerConnectionFailed=!0)}},{key:"onExit",value:function(){this._rtcSession._sessionReport.talkingTimeMillis=Date.now()-this._startTime,this._rtcSession._detachMedia(),this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionCompleted(this._rtcSession)}},{key:"name",get:function(){return"TalkingState"}}]),b}(I),Q=c.CleanUpState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._startTime=Date.now(),this._rtcSession._stopSession(),this._rtcSession._sessionReport.cleanupTimeMillis=Date.now()-this._startTime,this._rtcSession._onSessionDestroyed(this._rtcSession,this._rtcSession._sessionReport)}},{key:"hangup",value:function(){}},{key:"name",get:function(){return"CleanUpState"}}]),b}(I),R=c.DisconnectedState=function(a){function b(){return(0,r.default)(this,b),(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,p.default)(b,a),(0,t.default)(b,[{key:"name",get:function(){return"DisconnectedState"}}]),b}(Q),S=c.FailedState=function(a){function b(a,c){(0,r.default)(this,b);var d=(0,n.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._failureReason=c,d}return(0,p.default)(b,a),(0,t.default)(b,[{key:"onEnter",value:function(){this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionFailed(this._rtcSession,this._failureReason),(0,l.default)(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onEnter",this).call(this)}},{key:"name",get:function(){return"FailedState"}}]),b}(Q),T=function(){function a(b,c,d,e,f,g,h){var i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new H.default;if((0,r.default)(this,a),!(i instanceof F.default))throw new Error("Expected a strategy of type CCPInitiationStrategyInterface");if("string"!=typeof b||0===b.trim().length)throw new x.IllegalParameters("signalingUri required");if(!c)throw new x.IllegalParameters("iceServers required");if("object"!==(void 0===e?"undefined":(0,j.default)(e)))throw new x.IllegalParameters("logger required");this._callId=f||(0,B.default)(),this._strategy=i,this._connectionId=g,this._wssManager=h,this._sessionReport=new v.SessionReport,this._signalingUri=b,this._iceServers=c,this._contactToken=d,this._originalLogger=e,this._logger=(0,u.wrapLogger)(this._originalLogger,this._callId,"SESSION"),this._iceTimeoutMillis=w.DEFAULT_ICE_TIMEOUT_MS,this._gumTimeoutMillis=w.DEFAULT_GUM_TIMEOUT_MS,this._enableAudio=!0,this._enableVideo=!1,this._facingMode="user",this._legacyStatsReportSupport=!1,this._isUserProvidedStream=!1,this._onGumError=this._onGumSuccess=this._onLocalStreamAdded=this._onSessionFailed=this._onSessionInitialized=this._onSignalingConnected=this._onIceCollectionComplete=this._onSignalingStarted=this._onSessionConnected=this._onRemoteStreamAdded=this._onSessionCompleted=this._onSessionDestroyed=function(){}}return(0,t.default)(a,[{key:"pauseLocalVideo",value:function(){if(this._localStream){var a=this._localStream.getVideoTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeLocalVideo",value:function(){if(this._localStream){var a=this._localStream.getVideoTracks()[0];a&&(a.enabled=!0)}}},{key:"pauseRemoteVideo",value:function(){if(this._remoteVideoStream){var a=this._remoteVideoStream.getTracks()[1];a&&(a.enabled=!1)}}},{key:"resumeRemoteVideo",value:function(){if(this._remoteVideoStream){var a=this._remoteVideoStream.getTracks()[1];a&&(a.enabled=!0)}}},{key:"pauseLocalAudio",value:function(){if(this._localStream){var a=this._localStream.getAudioTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeLocalAudio",value:function(){if(this._localStream){var a=this._localStream.getAudioTracks()[0];a&&(a.enabled=!0)}}},{key:"pauseRemoteAudio",value:function(){if(this._remoteAudioStream){var a=this._remoteAudioStream.getTracks()[0];a&&(a.enabled=!1)}}},{key:"resumeRemoteAudio",value:function(){if(this._remoteAudioStream){var a=this._remoteAudioStream.getTracks()[0];a&&(a.enabled=!0)}}},{key:"transit",value:function(a){try{this._logger.info((this._state?this._state.name:"null")+" => "+a.name),this._state&&this._state.onExit&&this._state.onExit()}finally{if(this._state=a,a.onEnter)try{a.onEnter()}catch(b){throw this._logger.warn(a.name+"#onEnter failed",b),b}}}},{key:"_createSignalingChannel",value:function(){var a=new z.default(this._callId,this._signalingUri,this._contactToken,this._originalLogger,this._signalingConnectTimeout,this._connectionId,this._wssManager);return a.onConnected=(0,u.hitch)(this,this._signalingConnected),a.onAnswered=(0,u.hitch)(this,this._signalingAnswered),a.onHandshaked=(0,u.hitch)(this,this._signalingHandshaked),a.onRemoteHungup=(0,u.hitch)(this,this._signalingRemoteHungup),a.onFailed=(0,u.hitch)(this,this._signalingFailed),a.onDisconnected=(0,u.hitch)(this,this._signalingDisconnected),this._signalingChannel=a,a}},{key:"_signalingConnected",value:function(){this._state.onSignalingConnected()}},{key:"_signalingAnswered",value:function(a,b){this._state.onSignalingAnswered(a,b)}},{key:"_signalingHandshaked",value:function(){this._state.onSignalingHandshaked()}},{key:"_signalingRemoteHungup",value:function(){this._state.onRemoteHungup()}},{key:"_signalingFailed",value:function(a){this._state.onSignalingFailed(a)}},{key:"_signalingDisconnected",value:function(){}},{key:"_createPeerConnection",value:function(a,b){return this._strategy._createPeerConnection(a,b)}},{key:"connect",value:function(a){var b=this,c=new Date;b._sessionReport.sessionStartTime=c,b._connectTimeStamp=c.getTime(),a&&"closed"!=a.signalingState?b._pc=a:(a&&(a.close(),a=null),w.RTC_PEER_CONNECTION_CONFIG.iceServers=b._iceServers,b._pc=b._createPeerConnection(w.RTC_PEER_CONNECTION_CONFIG,w.RTC_PEER_CONNECTION_OPTIONAL_CONFIG)),b._pc.ontrack=(0,u.hitch)(b,b._ontrack),b._pc.onicecandidate=(0,u.hitch)(b,b._onIceCandidate),b._pc.onconnectionstatechange=(0,u.hitch)(b,b._onPeerConnectionStateChange),b._pc.oniceconnectionstatechange=(0,u.hitch)(b,b._onIceStateChange),(0,u.isLegacyStatsReportSupported)(b._pc).then(function(a){b._legacyStatsReportSupport=a,b.transit(new J(b))})}},{key:"accept",value:function(){throw new x.UnsupportedOperation("accept does not go through signaling channel at this moment")}},{key:"hangup",value:function(){this._state.hangup()}},{key:"getStats",value:function(){function a(){return b.apply(this,arguments)}var b=(0,h.default)(f.default.mark(function a(){var b,c,d,e,g,i,j=this;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b=new Date,c=function(){var a=(0,h.default)(f.default.mark(function a(c,d){var e;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=[],c){a.next=3;break}return a.abrupt("return",[]);case 3:a.t0=d,a.next="audio_input"===a.t0?6:"audio_output"===a.t0?6:"video_input"===a.t0?8:"video_output"===a.t0?8:10;break;case 6:return e=c.getAudioTracks(),a.abrupt("break",11);case 8:return e=c.getVideoTracks(),a.abrupt("break",11);case 10:throw new Error("Unsupported stream type while trying to get stats: "+d);case 11:return a.next=13,Promise.all(e.map((0,h.default)(f.default.mark(function a(){return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",j._pc.getStats().then(function(a){var c=(0,C.extractMediaStatsFromStats)(b,a,d);if(!c)throw new Error("Failed to extract MediaRtpStats from RTCStatsReport for stream type "+d);return c}));case 1:case"end":return a.stop()}},a,j)}))));case 13:return a.abrupt("return",a.sent);case 14:case"end":return a.stop()}},a,j)}));return function(b,c){return a.apply(this,arguments)}}(),!this._pc||"stable"!==this._pc.signalingState){a.next=26;break}return a.next=5,c(this._remoteAudioStream,"audio_input");case 5:return a.t0=a.sent,a.next=8,c(this._localStream,"audio_output");case 8:return a.t1=a.sent,a.t2={input:a.t0,output:a.t1},a.next=12,c(this._remoteVideoStream,"video_input");case 12:return a.t3=a.sent,a.next=15,c(this._localStream,"video_output");case 15:return a.t4=a.sent,a.t5={input:a.t3,output:a.t4},d={audio:a.t2,video:a.t5},e=function(a,b){return null!==b.rttMilliseconds&&(null===a||b.rttMilliseconds>a)&&(a=b.rttMilliseconds),b._rttMilliseconds=null,a},g=d.audio.input.reduce(e,null),i=d.video.input.reduce(e,null),null!==g&&d.audio.output.forEach(function(a){a._rttMilliseconds=g}),null!==i&&d.video.output.forEach(function(a){a._rttMilliseconds=i}),a.abrupt("return",d);case 26:return a.abrupt("return",Promise.reject(new x.IllegalState));case 27:case"end":return a.stop()}},a,this)}));return a}()},{key:"getRemoteAudioStats",value:function(){return this.getStats().then(function(a){return a.audio.output.length>0?a.audio.output[0]:Promise.reject(new x.IllegalState)})}},{key:"getUserAudioStats",value:function(){return this.getStats().then(function(a){return a.audio.input.length>0?a.audio.input[0]:Promise.reject(new x.IllegalState)})}},{key:"getRemoteVideoStats",value:function(){return this.getStats().then(function(a){return a.video.output.length>0?a.video.output[0]:Promise.reject(new x.IllegalState)})}},{key:"getUserVideoStats",value:function(){return this.getStats().then(function(a){return a.video.input.length>0?a.video.input[0]:Promise.reject(new x.IllegalState)})}},{key:"_onIceCandidate",value:function(a){this._state.onIceCandidate(a)}},{key:"_onPeerConnectionStateChange",value:function(){this._state.onPeerConnectionStateChange()}},{key:"_onIceStateChange",value:function(a){this._state.onIceStateChange(a)}},{key:"_ontrack",value:function(a){this._strategy._ontrack(this,a),this._onRemoteStreamAdded(this,a.streams[0])}},{key:"_detachMedia",value:function(){
this._remoteVideoElement&&(this._remoteVideoElement.srcObject=null),this._remoteAudioElement&&(this._remoteAudioElement.srcObject=null,this._remoteAudioStream=null)}},{key:"_stopSession",value:function(){try{this._localStream&&!this._isUserProvidedStream&&((0,u.closeStream)(this._localStream),this._localStream=null,this._isUserProvidedStream=!1)}finally{try{this._pc&&this._pc.close()}catch(a){}finally{this._pc=null}}}},{key:"_buildMediaConstraints",value:function(){var a=this,b={};if(a._strategy._buildMediaConstraints(a,b),a._enableVideo){var c={},d={},e={},f={};void 0!==a._idealVideoWidth&&(d.ideal=a._idealVideoWidth),void 0!==a._maxVideoWidth&&(d.max=a._maxVideoWidth),void 0!==a._minVideoWidth&&(d.min=a._minVideoWidth),void 0!==a._idealVideoHeight&&(e.ideal=a._idealVideoHeight),void 0!==a._maxVideoHeight&&(e.max=a._maxVideoHeight),void 0!==a._minVideoHeight&&(e.min=a._minVideoHeight),Object.keys(d).length>0&&Object.keys(e).length>0&&(c.width=d,c.height=e),void 0!==a._videoFrameRate&&(f.ideal=a._videoFrameRate),void 0!==a._minVideoFrameRate&&(f.min=a._minVideoFrameRate),void 0!==a._maxVideoFrameRate&&(f.max=a._maxVideoFrameRate),Object.keys(f).length>0&&(c.frameRate=f),"user"!==a._facingMode&&"environment"!==a._facingMode&&(a._facingMode="user"),c.facingMode=a._facingMode,Object.keys(c).length>0?b.video=c:b.video=!0}return b}},{key:"sessionReport",get:function(){return this._sessionReport}},{key:"callId",get:function(){return this._callId}},{key:"mediaStream",get:function(){return this._localStream},set:function(a){this._localStream=a,this._isUserProvidedStream=!0}},{key:"remoteVideoStream",get:function(){return this._remoteVideoStream}},{key:"onGumSuccess",set:function(a){this._onGumSuccess=a}},{key:"onGumError",set:function(a){this._onGumError=a}},{key:"onSessionFailed",set:function(a){this._onSessionFailed=a}},{key:"onLocalStreamAdded",set:function(a){this._onLocalStreamAdded=a}},{key:"onSessionInitialized",set:function(a){this._onSessionInitialized=a}},{key:"onSignalingConnected",set:function(a){this._onSignalingConnected=a}},{key:"onIceCollectionComplete",set:function(a){this._onIceCollectionComplete=a}},{key:"onSignalingStarted",set:function(a){this._onSignalingStarted=a}},{key:"onSessionConnected",set:function(a){this._onSessionConnected=a}},{key:"onRemoteStreamAdded",set:function(a){this._onRemoteStreamAdded=a}},{key:"onSessionCompleted",set:function(a){this._onSessionCompleted=a}},{key:"onSessionDestroyed",set:function(a){this._onSessionDestroyed=a}},{key:"enableAudio",set:function(a){this._enableAudio=a}},{key:"echoCancellation",set:function(a){this._echoCancellation=a}},{key:"enableVideo",set:function(a){this._enableVideo=a}},{key:"maxVideoFrameRate",set:function(a){this._maxVideoFrameRate=a}},{key:"minVideoFrameRate",set:function(a){this._minVideoFrameRate=a}},{key:"videoFrameRate",set:function(a){this._videoFrameRate=a}},{key:"maxVideoWidth",set:function(a){this._maxVideoWidth=a}},{key:"minVideoWidth",set:function(a){this._minVideoWidth=a}},{key:"idealVideoWidth",set:function(a){this._idealVideoWidth=a}},{key:"maxVideoHeight",set:function(a){this._maxVideoHeight=a}},{key:"minVideoHeight",set:function(a){this._minVideoHeight=a}},{key:"idealVideoHeight",set:function(a){this._idealVideoHeight=a}},{key:"facingMode",set:function(a){this._facingMode=a}},{key:"remoteAudioElement",set:function(a){this._remoteAudioElement=a}},{key:"remoteVideoElement",set:function(a){this._remoteVideoElement=a}},{key:"signalingConnectTimeout",set:function(a){this._signalingConnectTimeout=a}},{key:"iceTimeoutMillis",set:function(a){this._iceTimeoutMillis=a}},{key:"gumTimeoutMillis",set:function(a){this._gumTimeoutMillis=a}},{key:"forceAudioCodec",set:function(a){this._forceAudioCodec=a}},{key:"forceVideoCodec",set:function(a){this._forceVideoCodec=a}},{key:"enableOpusDtx",set:function(a){this._enableOpusDtx=a}}]),a}();c.default=T},{"./exceptions":149,"./rtc_const":150,"./rtp-stats":153,"./session_report":154,"./signaling":155,"./strategies/CCPInitiationStrategyInterface":156,"./strategies/StandardStrategy":159,"./utils":160,"babel-runtime/helpers/asyncToGenerator":14,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/get":17,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19,"babel-runtime/helpers/typeof":22,"babel-runtime/regenerator":25,sdp:131,"uuid/v4":134}],153:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c){var d=null,e=null;return b.forEach(function(b){b&&("inbound-rtp"===b.type&&"audio_input"===c?(e=b.type,d={timestamp:a,packetsLost:b.packetsLost,packetsCount:b.packetsReceived,jbMilliseconds:Math.floor(1e3*(0,j.when_defined)(b.jitter,0)),audioLevel:(0,j.is_defined)(b.audioLevel)?Math.floor(32768*b.audioLevel):null}):"outbound-rtp"===b.type&&"audio_output"===c?(d=d||{},d.packetsCount=b.packetsSent):"media-source"===b.type&&"audio_output"===c?(d=d||{},d.audioLevel=(0,j.is_defined)(b.audioLevel)?Math.floor(32768*b.audioLevel):null):"remote-inbound-rtp"===b.type&&"audio_output"===c&&(e=b.type,d=d||{},d.timestamp=a,d.packetsLost=b.packetsLost,d.rttMilliseconds=(0,j.is_defined)(b.roundTripTime)?Math.floor(1e3*b.roundTripTime):null,d.jbMilliseconds=Math.floor(1e3*(0,j.when_defined)(b.jitter,0))))}),d?new k(d,e,c):null}Object.defineProperty(c,"__esModule",{value:!0});var f=a("babel-runtime/helpers/classCallCheck"),g=d(f),h=a("babel-runtime/helpers/createClass"),i=d(h);c.extractMediaStatsFromStats=e;var j=a("./utils"),k=function(){function a(b,c,d){(0,g.default)(this,a);var e=b||{};this._timestamp=e.timestamp||(new Date).getTime(),this._packetsLost=(0,j.when_defined)(e.packetsLost),this._packetsCount=(0,j.when_defined)(e.packetsCount),this._audioLevel=(0,j.when_defined)(e.audioLevel),this._procMilliseconds=(0,j.when_defined)(e.procMilliseconds),this._rttMilliseconds=(0,j.when_defined)(e.rttMilliseconds),this._jbMilliseconds=(0,j.when_defined)(e.jbMilliseconds),this._bytesSent=(0,j.when_defined)(e.bytesSent),this._bytesReceived=(0,j.when_defined)(e.bytesReceived),this._framesEncoded=(0,j.when_defined)(e.framesEncoded),this._framesDecoded=(0,j.when_defined)(e.framesDecoded),this._frameRateSent=(0,j.when_defined)(e.frameRateSent),this._frameRateReceived=(0,j.when_defined)(e.frameRateReceived),this._statsReportType=c||e._statsReportType||"unknown",this._streamType=d||e.streamType||"unknown"}return(0,i.default)(a,[{key:"packetsCount",get:function(){return this._packetsCount}},{key:"packetsLost",get:function(){return this._packetsLost}},{key:"packetLossPercentage",get:function(){return this._packetsCount>0?this._packetsLost/this._packetsCount:0}},{key:"audioLevel",get:function(){return this._audioLevel}},{key:"timestamp",get:function(){return this._timestamp}},{key:"procMilliseconds",get:function(){return this._procMilliseconds}},{key:"rttMilliseconds",get:function(){return this._rttMilliseconds}},{key:"jbMilliseconds",get:function(){return this._jbMilliseconds}},{key:"bytesSent",get:function(){return this._bytesSent}},{key:"bytesReceived",get:function(){return this._bytesReceived}},{key:"framesEncoded",get:function(){return this._framesEncoded}},{key:"framesDecoded",get:function(){return this._framesDecoded}},{key:"frameRateSent",get:function(){return this._frameRateSent}},{key:"frameRateReceived",get:function(){return this._frameRateReceived}},{key:"statsReportType",get:function(){return this._statsReportType}},{key:"streamType",get:function(){return this._streamType}}]),a}()},{"./utils":160,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16}],154:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.SessionReport=void 0;var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g);c.SessionReport=function(){function a(){(0,f.default)(this,a),this._sessionStartTime=null,this._sessionEndTime=null,this._gumTimeMillis=null,this._initializationTimeMillis=null,this._iceCollectionTimeMillis=null,this._signallingConnectTimeMillis=null,this._handshakingTimeMillis=null,this._preTalkingTimeMillis=null,this._talkingTimeMillis=null,this._iceConnectionsLost=0,this._iceConnectionsFailed=null,this._peerConnectionFailed=null,this._cleanupTimeMillis=null,this._iceCollectionFailure=null,this._signallingConnectionFailure=null,this._handshakingFailure=null,this._gumOtherFailure=null,this._gumTimeoutFailure=null,this._createOfferFailure=null,this._setLocalDescriptionFailure=null,this._userBusyFailure=null,this._invalidRemoteSDPFailure=null,this._noRemoteIceCandidateFailure=null,this._setRemoteDescriptionFailure=null,this._streamStats=[],this._rtcJsVersion="1.1.27"}return(0,h.default)(a,[{key:"sessionStartTime",get:function(){return this._sessionStartTime},set:function(a){this._sessionStartTime=a}},{key:"sessionEndTime",get:function(){return this._sessionEndTime},set:function(a){this._sessionEndTime=a}},{key:"gumTimeMillis",get:function(){return this._gumTimeMillis},set:function(a){this._gumTimeMillis=a}},{key:"initializationTimeMillis",get:function(){return this._initializationTimeMillis},set:function(a){this._initializationTimeMillis=a}},{key:"iceCollectionTimeMillis",get:function(){return this._iceCollectionTimeMillis},set:function(a){this._iceCollectionTimeMillis=a}},{key:"signallingConnectTimeMillis",get:function(){return this._signallingConnectTimeMillis},set:function(a){this._signallingConnectTimeMillis=a}},{key:"preTalkingTimeMillis",get:function(){return this._preTalkingTimeMillis},set:function(a){this._preTalkingTimeMillis=a}},{key:"handshakingTimeMillis",get:function(){return this._handshakingTimeMillis},set:function(a){this._handshakingTimeMillis=a}},{key:"talkingTimeMillis",get:function(){return this._talkingTimeMillis},set:function(a){this._talkingTimeMillis=a}},{key:"iceConnectionsLost",get:function(){return this._iceConnectionsLost},set:function(a){this._iceConnectionsLost=a}},{key:"iceConnectionsFailed",get:function(){return this._iceConnectionsFailed},set:function(a){this._iceConnectionsFailed=a}},{key:"peerConnectionFailed",get:function(){return this._peerConnectionFailed},set:function(a){this._peerConnectionFailed=a}},{key:"cleanupTimeMillis",get:function(){return this._cleanupTimeMillis},set:function(a){this._cleanupTimeMillis=a}},{key:"iceCollectionFailure",get:function(){return this._iceCollectionFailure},set:function(a){this._iceCollectionFailure=a}},{key:"signallingConnectionFailure",get:function(){return this._signallingConnectionFailure},set:function(a){this._signallingConnectionFailure=a}},{key:"handshakingFailure",get:function(){return this._handshakingFailure},set:function(a){this._handshakingFailure=a}},{key:"gumTimeoutFailure",get:function(){return this._gumTimeoutFailure},set:function(a){this._gumTimeoutFailure=a}},{key:"gumOtherFailure",get:function(){return this._gumOtherFailure},set:function(a){this._gumOtherFailure=a}},{key:"createOfferFailure",get:function(){return this._createOfferFailure},set:function(a){this._createOfferFailure=a}},{key:"setLocalDescriptionFailure",get:function(){return this._setLocalDescriptionFailure},set:function(a){this._setLocalDescriptionFailure=a}},{key:"userBusyFailure",get:function(){return this._userBusyFailure},set:function(a){this._userBusyFailure=a}},{key:"invalidRemoteSDPFailure",get:function(){return this._invalidRemoteSDPFailure},set:function(a){this._invalidRemoteSDPFailure=a}},{key:"setRemoteDescriptionFailure",get:function(){return this._setRemoteDescriptionFailure},set:function(a){this._setRemoteDescriptionFailure=a}},{key:"noRemoteIceCandidateFailure",get:function(){return this._noRemoteIceCandidateFailure},set:function(a){this._noRemoteIceCandidateFailure=a}},{key:"streamStats",get:function(){return this._streamStats},set:function(a){this._streamStats=a}},{key:"rtcJsVersion",get:function(){return this._rtcJsVersion},set:function(a){this._rtcJsVersion=a}}]),a}()},{"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16}],155:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.FailedState=c.DisconnectedState=c.PendingLocalHangupState=c.PendingRemoteHangupState=c.PendingReconnectState=c.TalkingState=c.PendingAcceptAckState=c.PendingAcceptState=c.PendingAnswerState=c.PendingInviteState=c.PendingConnectState=c.FailOnTimeoutState=c.SignalingState=void 0;var e=a("babel-runtime/regenerator"),f=d(e),g=a("babel-runtime/helpers/asyncToGenerator"),h=d(g),i=a("babel-runtime/helpers/possibleConstructorReturn"),j=d(i),k=a("babel-runtime/helpers/inherits"),l=d(k),m=a("babel-runtime/helpers/classCallCheck"),n=d(m),o=a("babel-runtime/helpers/createClass"),p=d(o),q=a("./utils"),r=a("./rtc_const"),s=a("./exceptions"),t=a("uuid/v4"),u=d(t),v=a("./virtual_wss_connection_manager"),w=d(v),x=c.SignalingState=function(){function a(b){(0,n.default)(this,a),this._signaling=b,this._createTime=(new Date).getTime()}return(0,p.default)(a,[{key:"setStateTimeout",value:function(a){setTimeout((0,q.hitch)(this,this._onTimeoutChecked),a)}},{key:"onEnter",value:function(){}},{key:"_onTimeoutChecked",value:function(){this.isCurrentState&&this.onTimeout()}},{key:"onTimeout",value:function(){throw new s.UnsupportedOperation}},{key:"transit",value:function(a){this._signaling.transit(a)}},{key:"onExit",value:function(){}},{key:"onOpen",value:function(){throw new s.UnsupportedOperation("onOpen not supported by "+this.name)}},{key:"onError",value:function(){this.channelDown()}},{key:"onClose",value:function(){this.channelDown()}},{key:"channelDown",value:function(){throw new s.UnsupportedOperation("channelDown not supported by "+this.name)}},{key:"onRpcMsg",value:function(a){throw new s.UnsupportedOperation("onRpcMsg not supported by "+this.name)}},{key:"invite",value:function(a,b){throw new s.UnsupportedOperation("invite not supported by "+this.name)}},{key:"accept",value:function(){throw new s.UnsupportedOperation("accept not supported by "+this.name)}},{key:"hangup",value:function(){throw new s.UnsupportedOperation("hangup not supported by "+this.name)}},{key:"isCurrentState",get:function(){return this===this._signaling.state}},{key:"name",get:function(){return"SignalingState"}},{key:"logger",get:function(){return this._signaling._logger}}]),a}(),y=c.FailOnTimeoutState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._timeoutMs=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){this.setStateTimeout(this._timeoutMs)}},{key:"onTimeout",value:function(){this.transit(new I(this._signaling,new s.Timeout))}},{key:"name",get:function(){return"FailOnTimeoutState"}}]),b}(x),z=c.PendingConnectState=function(a){function b(a,c,d,e){(0,n.default)(this,b);var f=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return f._initialStartTime=d||(new Date).getTime(),f._retries=e||0,f}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onOpen",value:function(){this.transit(new A(this._signaling))}},{key:"channelDown",value:function(){var a=(new Date).getTime(),c=this._initialStartTime+this._timeoutMs-a;c>0&&++this._retries<3?(this._signaling._connect(),this.transit(new b(this._signaling,c,this._initialStartTime,this._retries))):this.transit(new I(this._signaling,new Error("channelDown")))}},{key:"name",get:function(){return"PendingConnectState"}}]),b}(y),A=c.PendingInviteState=function(a){function b(){return(0,n.default)(this,b),(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._connectedHandler(),b()})}},{key:"invite",value:function(a,b){var c=this,d=(0,u.default)(),e={sdp:a,candidates:b,callContextToken:c._signaling._contactToken};c.logger.log("Sending SDP",(0,q.getRedactedSdp)(a)),c._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:r.INVITE_METHOD_NAME,params:e,id:d})),c.transit(new B(c._signaling,d))}},{key:"channelDown",value:function(){this.transit(new I(this._signaling))}},{key:"name",get:function(){return"PendingInviteState"}}]),b}(x),B=c.PendingAnswerState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,r.MAX_INVITE_DELAY_MS));return d._inviteId=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onRpcMsg",value:function(a){var b=this;a.id===this._inviteId&&(a.error||!a.result?this.transit(new I(this._signaling,b.translateInviteError(a))):(new Promise(function(c){b.logger.log("Received SDP",(0,q.getRedactedSdp)(a.result.sdp)),b._signaling._answeredHandler(a.result.sdp,a.result.candidates),c()}),this.transit(new C(this._signaling,this._signaling._autoAnswer))))}},{key:"translateInviteError",value:function(a){return a.error&&486==a.error.code?new s.BusyException(a.error.message):a.error&&404==a.error.code?new s.CallNotFoundException(a.error.message):new s.UnknownSignalingError}},{key:"name",get:function(){return"PendingAnswerState"}}]),b}(y),C=c.PendingAcceptState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._autoAnswer=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){this._autoAnswer&&this.accept()}},{key:"accept",value:function(){this.sendAcceptRequest(),this.transit(new D(this._signaling))}},{key:"channelDown",value:function(){this.transit(new I(this._signaling))}},{key:"sendAcceptRequest",value:function(){function a(){return b.apply(this,arguments)}var b=(0,h.default)(f.default.mark(function a(){var b;return f.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:b=(0,u.default)(),this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:r.ACCEPT_METHOD_NAME,params:{},id:b}));case 2:case"end":return a.stop()}},a,this)}));return a}()},{key:"name",get:function(){return"PendingAcceptState"}}]),b}(x),D=(c.PendingAcceptAckState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,r.MAX_ACCEPT_BYE_DELAY_MS));return d._acceptId=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onRpcMsg",value:function(a){a.id===this._acceptId&&(a.error?this.transit(new I(this._signaling)):(this._signaling._clientToken=a.result.clientToken,this.transit(new D(this._signaling))))}},{key:"name",get:function(){return"PendingAcceptAckState"}}]),b}(y),c.TalkingState=function(a){function b(){return(0,n.default)(this,b),(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._handshakedHandler(),b()})}},{key:"hangup",value:function(){var a=(0,u.default)();this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:r.BYE_METHOD_NAME,params:{callContextToken:this._signaling._contactToken},id:a})),this.transit(new F(this._signaling,a))}},{key:"onRpcMsg",value:function(a){a.method===r.BYE_METHOD_NAME?this.transit(new G(this._signaling,a.id)):"renewClientToken"===a.method&&(this._signaling._clientToken=a.params.clientToken)}},{key:"channelDown",value:function(){this._signaling._reconnect(),this._signaling.transit(new E(this._signaling))}},{key:"name",get:function(){return"TalkingState"}}]),b}(x)),E=c.PendingReconnectState=function(a){function b(a){return(0,n.default)(this,b),(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,r.DEFAULT_CONNECT_TIMEOUT_MS))}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onOpen",value:function(){this.transit(new D(this._signaling))}},{key:"channelDown",value:function(){this.transit(new I(this._signaling))}},{key:"name",get:function(){return"PendingReconnectState"}}]),b}(y),F=c.PendingRemoteHangupState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,r.MAX_ACCEPT_BYE_DELAY_MS));return d._byeId=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onRpcMsg",value:function(a){a.id!==this._byeId&&a.method!==r.BYE_METHOD_NAME||this.transit(new H(this._signaling))}},{key:"name",get:function(){return"PendingRemoteHangupState"}}]),b}(y),G=c.PendingLocalHangupState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._byeId=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._remoteHungupHandler(),b()})}},{key:"hangup",value:function(){var a=this;a._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",result:{},id:a._byeId})),a.transit(new H(a._signaling))}},{key:"onRpcMsg",value:function(){}},{key:"channelDown",value:function(){this.transit(new H(this._signaling))}},{key:"name",get:function(){return"PendingLocalHangupState"}}]),b}(x),H=c.DisconnectedState=function(a){function b(){return(0,n.default)(this,b),(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._disconnectedHandler(),b()}),this._signaling._wss.close()}},{key:"channelDown",value:function(){}},{key:"onRpcMsg",value:function(){}},{key:"name",get:function(){return"DisconnectedState"}}]),b}(x),I=c.FailedState=function(a){function b(a,c){(0,n.default)(this,b);var d=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return d._exception=c,d}return(0,l.default)(b,a),(0,p.default)(b,[{key:"onEnter",value:function(){var a=this;new Promise(function(b){a._signaling._failedHandler(a._exception),b()}),this._signaling._wss.close()}},{key:"channelDown",value:function(){}},{key:"name",get:function(){return"FailedState"}},{key:"exception",get:function(){return this._exception}}]),b}(x),J=function(){function a(b,c,d,e,f,g,h){(0,n.default)(this,a),this._callId=b,this._connectTimeoutMs=f||r.DEFAULT_CONNECT_TIMEOUT_MS,this._autoAnswer=!0,this._signalingUri=c,this._contactToken=d,this._logger=(0,q.wrapLogger)(e,b,"SIGNALING"),this._connectionId=g,this._wssManager=h,this._connectedHandler=this._answeredHandler=this._handshakedHandler=this._reconnectedHandler=this._remoteHungupHandler=this._disconnectedHandler=this._failedHandler=function(){}}return(0,p.default)(a,[{key:"connect",value:function(){this._connect(),this.transit(new z(this,this._connectTimeoutMs))}},{key:"_connect",value:function(){this._wss=this._connectWebSocket(this._buildInviteUri())}},{key:"transit",value:function(a){try{this._logger.info((this._state?this._state.name:"null")+" => "+a.name),this.state&&this.state.onExit&&this.state.onExit()}finally{this._state=a,this._state.onEnter&&this._state.onEnter()}}},{key:"_connectWebSocket",value:function(a){var b=void 0;return b=this._wssManager?new w.default(this._logger,this._connectionId,this._wssManager):new WebSocket(a),b.onopen=(0,q.hitch)(this,this._onOpen),b.onmessage=(0,q.hitch)(this,this._onMessage),b.onerror=(0,q.hitch)(this,this._onError),b.onclose=(0,q.hitch)(this,this._onClose),b}},{key:"_buildInviteUri",value:function(){return this._contactToken?this._buildUriBase()+"&contactCtx="+encodeURIComponent(this._contactToken):this._buildUriBase()}},{key:"_buildReconnectUri",value:function(){return this._buildUriBase()+"&clientToken="+encodeURIComponent(this._clientToken)}},{key:"_buildUriBase",value:function(){var a="?";return this._signalingUri.indexOf(a)>-1&&(a="&"),this._signalingUri+a+"callId="+encodeURIComponent(this._callId)}},{key:"_onMessage",value:function(a){this.state.onRpcMsg(JSON.parse(a.data))}},{key:"_onOpen",value:function(a){this.state.onOpen(a)}},{key:"_onError",value:function(a){this.state.onError(a)}},{key:"_onClose",value:function(a){this._logger.log("WebSocket onclose code="+a.code+", reason="+a.reason),this.state.onClose(a)}},{key:"_reconnect",value:function(){this._wss=this._connectWebSocket(this._buildReconnectUri())}},{key:"invite",value:function(a,b){this.state.invite(a,b)}},{key:"accept",value:function(){this.state.accept()}},{key:"hangup",value:function(){this.state.hangup()}},{key:"callId",get:function(){return this._callId}},{key:"onConnected",set:function(a){this._connectedHandler=a}},{key:"onAnswered",set:function(a){this._answeredHandler=a}},{key:"onHandshaked",set:function(a){this._handshakedHandler=a}},{key:"onReconnected",set:function(a){this._reconnectedHandler=a}},{key:"onRemoteHungup",set:function(a){this._remoteHungupHandler=a}},{key:"onDisconnected",set:function(a){this._disconnectedHandler=a}},{key:"onFailed",set:function(a){this._failedHandler=a}},{key:"state",get:function(){return this._state}}]),a}();c.default=J},{"./exceptions":149,"./rtc_const":150,"./utils":160,"./virtual_wss_connection_manager":161,"babel-runtime/helpers/asyncToGenerator":14,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19,"babel-runtime/regenerator":25,"uuid/v4":134}],156:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=function(){function a(){(0,f.default)(this,a),console.log("CCPInitiationStrategyInterface initialized")}return(0,h.default)(a,[{key:"getStrategyName",value:function(){console.error("getStrategyName needs to be overridden")}},{key:"_isEarlyMediaConnectionSupported",value:function(){console.error("_isEarlyMediaConnectionSupported needs to be overridden")}},{key:"_createRtcPeerConnection",value:function(){console.error("_createRtcPeerConnection needs to be overridden")}},{key:"_guM",value:function(){console.error("_guM needs to be overridden")}},{key:"addStream",value:function(){console.error("addStream needs to be overridden")}},{key:"setRemoteDescription",value:function(){console.error("setRemoteDescription needs to be overridden")}},{key:"onIceStateChange",value:function(){console.error("onIceStateChange needs to be overridden")}},{key:"onPeerConnectionStateChange",value:function(){console.error("onPeerConnectionStateChange needs to be overridden")}},{key:"_createPeerConnection",value:function(){console.error("_createPeerConnection needs to be overridden")}},{key:"connect",value:function(){console.error("connect needs to be overridden")}},{key:"_ontrack",value:function(){console.error("_ontrack needs to be overridden")}},{key:"_buildMediaConstraints",value:function(){console.error("_buildMediaConstraints needs to be overridden")}}]),a}();c.default=i},{"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16}],157:[function(a,b,c){(function(b){(function(){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=a("babel-runtime/helpers/possibleConstructorReturn"),j=d(i),k=a("babel-runtime/helpers/inherits"),l=d(k),m=a("./CCPInitiationStrategyInterface"),n=d(m),o=a("../rtc_session"),p=a("../rtc_const"),q=function(c){function d(){var b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,f.default)(this,d);var c=(0,j.default)(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return b&&a("@citrix/ucsdk/CitrixWebRTC"),console.log("CitrixVDIStrategy initializing"),c.initCitrixWebRTC(),c.initGetCitrixWebrtcRedir(),c.initLog(),c}return(0,l.default)(d,c),(0,h.default)(d,[{key:"initCitrixWebRTC",value:function(){window.CitrixWebRTC.setVMEventCallback(function(a){if("vdiClientConnected"===a.event){if(!window.CitrixWebRTC.isFeatureOn("webrtc1.0"))throw new Error("Citrix WebRTC redirection feature is NOT supported!");console.log("CitrixVDIStrategy initialized")}else"vdiClientDisconnected"===a.event&&console.log("vdiClientDisconnected")}),window.CitrixWebRTC.initUCSDK("AmazonConnect")}},{key:"initGetCitrixWebrtcRedir",value:function(){window.getCitrixWebrtcRedir=function(){return Promise.resolve(1)}}},{key:"initLog",value:function(){window.CitrixWebRTC.initLog(b.connect.getLog())}},{key:"_isEarlyMediaConnectionSupported",value:function(){return!1}},{key:"_createRtcPeerConnection",value:function(a,b){return new window.CitrixWebRTC.CitrixPeerConnection(a,b)}},{key:"_gUM",value:function(a){return window.CitrixWebRTC.getUserMedia(a)}},{key:"addStream",value:function(a,b){b.getTracks().forEach(function(b){a.addTransceiver(b,{})})}},{key:"setRemoteDescription",value:function(a,b){var c=a._createSessionDescription({type:"answer",sdp:a._sdp});b._pc.setRemoteDescription(c,function(){Promise.all(a._candidates.map(function(c){var d=a._createRemoteCandidate(c);return a.logger.info("Adding remote candidate",d),b._pc.addIceCandidate(d)})).catch(function(b){a.logger.warn("Error adding remote candidate",b)}),b._sessionReport.setRemoteDescriptionFailure=!1,a._remoteDescriptionSet=!0,a._checkAndTransit()},function(){b._stopSession(),b._sessionReport.setRemoteDescriptionFailure=!0,a.transit(new o.FailedState(b,p.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"onIceStateChange",value:function(a,b){return b.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(a){return a.connectionState_}},{key:"_createPeerConnection",value:function(a,b){return new window.CitrixWebRTC.CitrixPeerConnection(a,b)}},{key:"_ontrack",value:function(a,b){window.CitrixWebRTC.mapAudioElement(a._remoteAudioElement),b.streams.length>1&&a._logger.warn("Found more than 1 streams for "+b.track.kind+" track "+b.track.id+" : "+b.streams.map(function(a){return a.id}).join(",")),"video"===b.track.kind&&a._remoteVideoElement?(a._remoteVideoElement.srcObject=b.streams[0],a._remoteVideoStream=b.streams[0]):"audio"===b.track.kind&&a._remoteAudioElement&&(a._remoteAudioElement.srcObject=b.streams[0],a._remoteAudioStream=b.streams[0]),a._remoteAudioElement.play()}},{key:"_buildMediaConstraints",value:function(a,b){if(a._enableAudio){var c={};void 0!==a._echoCancellation&&(c.echoCancellation=!!a._echoCancellation),window.audio_input&&(c.deviceId=window.audio_input),Object.keys(c).length>0?b.audio=c:b.audio=!0}else b.audio=!1}},{key:"getStrategyName",value:function(){return"CitrixVDIStrategy"}}]),d}(n.default);c.default=q}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../rtc_const":150,"../rtc_session":152,"./CCPInitiationStrategyInterface":156,"@citrix/ucsdk/CitrixWebRTC":2,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19}],158:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/typeof"),f=d(e),g=a("babel-runtime/helpers/classCallCheck"),h=d(g),i=a("babel-runtime/helpers/createClass"),j=d(i),k=a("babel-runtime/helpers/possibleConstructorReturn"),l=d(k),m=a("babel-runtime/helpers/inherits"),n=d(m),o=a("./CCPInitiationStrategyInterface"),p=d(o),q=a("../rtc_session"),r=a("../rtc_const"),s=a("../config/constants"),t=function(a){function b(){(0,h.default)(this,b);var a=(0,l.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(!window.DCVWebRTCPeerConnectionProxy)throw new Error("DCV WebRTC redirection feature is NOT supported!");return window.DCVWebRTCPeerConnectionProxy.setInitCallback(function(b){if(!b.success)throw new Error("DCV WebRTC redirection feature is NOT supported!");a.proxy=window.DCVWebRTCRedirProxy,a.proxy.overrideWebRTC(),console.log("DCVStrategy initialized")},5e3),a}return(0,n.default)(b,a),(0,
j.default)(b,[{key:"isChromeBrowser",value:function(){return this.proxy.clientInfo.browserDetails.browser===s.CHROME}},{key:"getChromeBrowserVersion",value:function(){return this.proxy.clientInfo.browserDetails.version}},{key:"_isEarlyMediaConnectionSupported",value:function(){return this.isChromeBrowser()&&this.getChromeBrowserVersion()>=59}},{key:"_createRtcPeerConnection",value:function(a,b){return this.proxy.createPeerConnection(a,b)}},{key:"_buildMediaConstraints",value:function(a,b){if(a._enableAudio){var c={};(0,f.default)(a._echoCancellation)!==s.UNDEFINED&&(c.echoCancellation=!!a._echoCancellation),Object.keys(c).length>0?b.audio=c:b.audio=!0}else b.audio=!1}},{key:"_gUM",value:function(a){return this.proxy.getUserMedia(a)}},{key:"_createPeerConnection",value:function(a,b){return this.proxy.createPeerConnection(a,b)}},{key:"addStream",value:function(a,b){b.getTracks().forEach(function(c){a.addTransceiver(c.kind,{streams:[b]}).sender.replaceTrack(c)})}},{key:"setRemoteDescription",value:function(a,b){var c=b._pc.setRemoteDescription(a._createSessionDescription({type:s.ANSWER,sdp:a._sdp}));c.catch(function(b){a.logger.error("SetRemoteDescription failed",b)}),c.then(function(){var c=Promise.all(a._candidates.map(function(c){var d=a._createRemoteCandidate(c);return a.logger.info("Adding remote candidate",d),b._pc.addIceCandidate(d)}));return c.catch(function(b){a.logger.warn("Error adding remote candidate",b)}),c}).then(function(){b._sessionReport.setRemoteDescriptionFailure=!1,a._remoteDescriptionSet=!0,a._checkAndTransit()}).catch(function(){b._stopSession(),b._sessionReport.setRemoteDescriptionFailure=!0,a.transit(new q.FailedState(b,r.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"onIceStateChange",value:function(a,b){return b.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(a){return a.connectionState}},{key:"_ontrack",value:function(a,b){b.streams.length>1&&console.warn("Found more than 1 streams for "+b.track.kind+" track "+b.track.id+" : "+b.streams.map(function(a){return a.id}).join(","));var c=b.streams[0];a._remoteAudioElement=this.createMediaElement(c),a._remoteAudioStream=c,a._remoteAudioElement.srcObject=c}},{key:"createMediaElement",value:function(a){var b={kind:s.AUDIO,autoplay:!0},c=a.createMediaElement(b);return console.log("Creating proxied media element."),c}},{key:"getStrategyName",value:function(){return s.DCV_STRATEGY}}]),b}(p.default);c.default=t},{"../config/constants":147,"../rtc_const":150,"../rtc_session":152,"./CCPInitiationStrategyInterface":156,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19,"babel-runtime/helpers/typeof":22}],159:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=a("babel-runtime/helpers/possibleConstructorReturn"),j=d(i),k=a("babel-runtime/helpers/inherits"),l=d(k),m=a("./CCPInitiationStrategyInterface"),n=d(m),o=a("../rtc_const"),p=a("../utils"),q=a("../rtc_session"),r=function(a){function b(){(0,f.default)(this,b);var a=(0,j.default)(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return console.log("StandardStrategy initialized"),a}return(0,l.default)(b,a),(0,h.default)(b,[{key:"_isEarlyMediaConnectionSupported",value:function(){return(0,p.isChromeBrowser)()&&(0,p.getChromeBrowserVersion)()>=o.CHROME_SUPPORTED_VERSION}},{key:"_createRtcPeerConnection",value:function(a,b){return new RTCPeerConnection(a,b)}},{key:"_gUM",value:function(a){return navigator.mediaDevices.getUserMedia(a)}},{key:"addStream",value:function(a,b){a.addStream(b)}},{key:"setRemoteDescription",value:function(a,b){var c=b._pc.setRemoteDescription(a._createSessionDescription({type:"answer",sdp:a._sdp}));c.catch(function(b){a.logger.error("SetRemoteDescription failed",b)}),c.then(function(){var c=Promise.all(a._candidates.map(function(c){var d=a._createRemoteCandidate(c);return a.logger.info("Adding remote candidate",d),b._pc.addIceCandidate(d)}));return c.catch(function(b){a.logger.warn("Error adding remote candidate",b)}),c}).then(function(){b._sessionReport.setRemoteDescriptionFailure=!1,a._remoteDescriptionSet=!0,a._checkAndTransit()}).catch(function(){b._stopSession(),b._sessionReport.setRemoteDescriptionFailure=!0,a.transit(new q.FailedState(b,o.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"onIceStateChange",value:function(a,b){return a.currentTarget.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(a){return a.connectionState}},{key:"_createPeerConnection",value:function(a,b){return new RTCPeerConnection(a,b)}},{key:"_ontrack",value:function(a,b){b.streams.length>1&&a._logger.warn("Found more than 1 streams for "+b.track.kind+" track "+b.track.id+" : "+b.streams.map(function(a){return a.id}).join(",")),"video"===b.track.kind&&a._remoteVideoElement?(a._remoteVideoElement.srcObject=b.streams[0],a._remoteVideoStream=b.streams[0]):"audio"===b.track.kind&&a._remoteAudioElement&&(a._remoteAudioElement.srcObject=b.streams[0],a._remoteAudioStream=b.streams[0])}},{key:"_buildMediaConstraints",value:function(a,b){if(a._enableAudio){var c={};void 0!==a._echoCancellation&&(c.echoCancellation=!!a._echoCancellation),Object.keys(c).length>0?b.audio=c:b.audio=!0}else b.audio=!1}},{key:"getStrategyName",value:function(){return"StandardStrategy"}}]),b}(n.default);c.default=r},{"../rtc_const":150,"../rtc_session":152,"../utils":160,"./CCPInitiationStrategyInterface":156,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,"babel-runtime/helpers/inherits":18,"babel-runtime/helpers/possibleConstructorReturn":19}],160:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.shift();if(!b)throw new u.IllegalParameters("utils.hitch(): scope is required!");if(!c)throw new u.IllegalParameters("utils.hitch(): method is required!");if("function"!=typeof c)throw new u.IllegalParameters("utils.hitch(): method is not a function!");return function(){var d=Array.prototype.slice.call(arguments);return c.apply(b,a.concat(d))}}function f(a,b,c){var d={};return w.forEach(function(f){if(!a[f])throw new Error("Logging method "+f+" required");d[f]=e(a,a[f],b,c)}),d}function g(a){if(a)for(var b=a.getTracks(),c=0;c<b.length;c++){var d=b[c];try{d.stop()}catch(a){}}}function h(a,b){for(var c=(0,v.splitSections)(a),d=1;d<c.length;d++){var e=(0,v.getKind)(c[d]),f=(0,v.parseRtpParameters)(c[d]),g=f.codecs.reduce(function(a,b){return a[""+b.payloadType]=b,a},{});c[d]=(0,v.splitLines)(c[d]).map(function(a){if(a.startsWith("m=")){if(b.forceCodec[e]){var c=Object.keys(g).filter(function(a){return!b._shouldDeleteCodec(e,g[a].name)});return/.*RTP\/S?AVPF? /.exec(a)+c.join(" ")}return a}if(a.startsWith("a=rtpmap:")){var d=(0,v.parseRtpMap)(a),f=g[d.payloadType];return i(f)&&b._shouldDeleteCodec(e,f.name)?null:i(f)&&"OPUS"===f.name.toUpperCase()?(f.parameters.usedtx=b.enableOpusDtx?"1":"0",(a+"\r\n"+(0,v.writeFmtp)(f)).trim()):a}if(a.startsWith("a=fmtp:")){var h=a.substring("a=fmtp:".length,a.indexOf(" ")),f=g[h];return i(f)&&b._shouldDeleteCodec(e,f.name)?null:i(f)&&"OPUS"===f.name.toUpperCase()?null:a}if(a.startsWith("a=rtcp-fb:")){var h=a.substring(a.indexOf(":")+1,a.indexOf(" "));if("*"===h)return a;var f=g[h];return i(f)&&b._shouldDeleteCodec(e,f.name)?null:a}return a}).filter(function(a){return null!==a}).join("\r\n")}return{sdp:c.map(function(a){return a.trim()}).join("\r\n")+"\r\n",mLines:c.length-1}}function i(a){return void 0!==a}function j(a,b){var c=i(b)?b:null;return i(a)?a:c}function k(a){return new Promise(function(b){a.getStats(function(){b(!0)}).catch(function(){b(!1)})})}function l(a){return!!(a&&a.constructor&&a.call&&a.apply)}function m(a,b){if(!a)throw new Error(b)}function n(){return-1!==navigator.userAgent.indexOf("Chrome")}function o(){var a=navigator.userAgent,b=a.substring(a.indexOf("Chrome")+7);return b?parseFloat(b):-1}function p(a){var b=/a=ice-pwd:[^\r\n]*/;return a.replace(b,"a=ice-pwd:[redacted]")}Object.defineProperty(c,"__esModule",{value:!0}),c.SdpOptions=void 0;var q=a("babel-runtime/helpers/classCallCheck"),r=d(q),s=a("babel-runtime/helpers/createClass"),t=d(s);c.hitch=e,c.wrapLogger=f,c.closeStream=g,c.transformSdp=h,c.is_defined=i,c.when_defined=j,c.isLegacyStatsReportSupported=k,c.isFunction=l,c.assertTrue=m,c.isChromeBrowser=n,c.getChromeBrowserVersion=o,c.getRedactedSdp=p;var u=a("./exceptions"),v=a("sdp"),w=["log","info","warn","error"];c.SdpOptions=function(){function a(){(0,r.default)(this,a),this._forceCodec={}}return(0,t.default)(a,[{key:"_shouldDeleteCodec",value:function(a,b){var c=b.toUpperCase();return this._forceCodec[a]&&c!==this._forceCodec[a].toUpperCase()&&"TELEPHONE-EVENT"!==c}},{key:"enableOpusDtx",get:function(){return this._enableOpusDtx},set:function(a){this._enableOpusDtx=a}},{key:"forceCodec",get:function(){return this._forceCodec}}]),a}()},{"./exceptions":149,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16,sdp:131}],161:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("babel-runtime/helpers/classCallCheck"),f=d(e),g=a("babel-runtime/helpers/createClass"),h=d(g),i=a("./utils"),j=a("./rtc_const"),k=function(){function a(b,c,d){(0,f.default)(this,a),this._logger=b,this._connectionId=c,this._wssManager=d,this._initializeWebSocketEventListeners()}return(0,h.default)(a,[{key:"_initializeWebSocketEventListeners",value:function(){var a=this;this._wssManager.subscribeTopics([j.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(j.SOFTPHONE_ROUTE_KEY,(0,i.hitch)(this,this._webSocketManagerOnMessage)),setTimeout(function(){a._onOpen()},0)}},{key:"_webSocketManagerOnMessage",value:function(a){var b=void 0;a.content&&(b=JSON.parse(a.content)),this._onMessage&&b&&this._connectionId===b.connectionId&&this._onMessage({data:JSON.stringify(b.jsonRpcMsg)})}},{key:"send",value:function(a){var b={};try{b.topic=j.SOFTPHONE_ROUTE_KEY,b.connectionId=this._connectionId,b.jsonRpcMsg=JSON.parse(a),this._wssManager.sendMessage(b)}catch(a){this._logger.error("Error in sendMessage ",a)}}},{key:"close",value:function(){this._logger.info("closing virtual connection"),this._unSubscribe()}},{key:"onmessage",set:function(a){this._onMessage=a}},{key:"onopen",set:function(a){this._onOpen=a}}]),a}();c.default=k},{"./rtc_const":150,"./utils":160,"babel-runtime/helpers/classCallCheck":15,"babel-runtime/helpers/createClass":16}]},{},[1,148]);