!function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){(function(r){(function(){"use strict";var i,o,a=h(e("babel-runtime/helpers/toArray")),s=h(e("babel-runtime/helpers/slicedToArray")),c=h(e("babel-runtime/regenerator")),d=h(e("babel-runtime/helpers/asyncToGenerator")),l=h(e("babel-runtime/helpers/classCallCheck")),u=h(e("babel-runtime/helpers/createClass")),f=h(e("babel-runtime/helpers/typeof"));function h(e){return e&&e.__esModule?e:{default:e}}i=void 0,o=function(e){var t={major:0,minor:3,patch:3,buildNumber:0,gitHash:"2a04538bd16eaa144c6a87ab71a77e2e314f348f",versionStr:"0.3.3+build.0"},n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o={exports:{}};!function(e){var t,r;t=n,r=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":(0,f.default)(window))!==t&&(0,f.default)(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,("undefined"==typeof console?"undefined":(0,f.default)(console))===t&&n<this.levels.SILENT)return"No console available for logging"}function d(r,i,o){return function(r){return"debug"===r&&(r="log"),("undefined"==typeof console?"undefined":(0,f.default)(console))!==t&&("trace"===r&&n?s:void 0!==console[r]?a(console,r):void 0!==console.log?a(console,"log"):e)}(r)||function(e){return function(){("undefined"==typeof console?"undefined":(0,f.default)(console))!==t&&(c.call(this),this[e].apply(this,arguments))}}.apply(this,arguments)}function l(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(("undefined"==typeof window?"undefined":(0,f.default)(window))!==t&&h){try{e=window.localStorage[h]}catch(e){}if((void 0===e?"undefined":(0,f.default)(e))===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function _(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==(void 0===e?"undefined":(0,f.default)(e))&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:a},u.setLevel=function(e,n){return l=_(e),!1!==n&&function(e){var n=(r[l]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":(0,f.default)(window))!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(),c.call(u)},u.setDefaultLevel=function(e){s=_(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(("undefined"==typeof window?"undefined":(0,f.default)(window))!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=_(o.getLevel())),c.call(u),o===u)for(var e in i)i[e].rebuild()},a=_(o?o.getLevel():"WARN");var g=p();null!=g&&(l=_(g)),c.call(u)}(o=new l).getLogger=function(e){if("symbol"!=(void 0===e?"undefined":(0,f.default)(e))&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new l(e,o.methodFactory)),t};var u=("undefined"==typeof window?"undefined":(0,f.default)(window))!==t?window.log:void 0;return o.noConflict=function(){return("undefined"==typeof window?"undefined":(0,f.default)(window))!==t&&window.log===o&&(window.log=u),o},o.getLoggers=function(){return i},o.default=o,o},e.exports?e.exports=r():t.log=r()}(o);for(var h=i(o.exports),p=Object.freeze({HELLO_API_NAME:"hello",GETUSERMEDIA_API_NAME:"navigator.mediaDevices.getUserMedia",ENUMERATEDEVICES_API_NAME:"navigator.mediaDevices.enumerateDevices",GENERATE_CERTIFICATE_API_NAME:"RTCPeerConnection.generateCertificate",NEWRTCPEERCONNECTION_API_NAME:"new.RTCPeerConnection",PC_GET_CONFIGURATION:"pcs.getConfiguration",NEW_AUDIO_CONTEXT:"new.AudioContext",CREATE_WORKER:"new.Worker",WORKER_POST_MESSAGE:"workers.postMessage",WORKER_TERMINATE:"workers.terminate",AUDIO_CTX_CREATE_AUDIO_NODE:"audioContexts.createAudioNode",AUDIO_CTX_CLOSE:"audioContexts.close",AUDIO_NODE_CONNECT:"audioNodes.connect",AUDIO_NODE_DISCONNECT:"audioNodes.disconnect",AUDIO_PARAM_SET_VALUE_AT_TIME:"audioParams.setValueAtTime",AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME:"audioParams.linearRampToValueAtTime",AUDIO_NODE_SET_TYPE:"audioNodes.setType",AUDIO_NODE_START:"audioNodes.start",AUDIO_NODE_STOP:"audioNodes.stop",PC_CLOSE_API_NAME:"pcs.close",ADDSTREAM_API_NAME:"pcs.addStream",STREAM_REMOVE_TRACK:"streams.removeTrack",STREAM_ADD_TRACK:"streams.addTrack",GET_STATS_API_NAME:"pcs.getStats",CREATE_OFFER_API_NAME:"pcs.createOffer",SET_LOCAL_DESCRIPTION_API_NAME:"pcs.setLocalDescription",ADD_PC_EVENT_LISTENER:"pcs.addEventListener",ADD_TRACK_EVENT_LISTENER:"tracks.addEventListener",ADD_DTMF_EVENT_LISTENER:"dtmfs.addEventListener",ADD_WORKER_EVENT_LISTENER:"workers.addEventListener",SET_REMOTE_DESCRIPTION_API_NAME:"pcs.setRemoteDescription",ADD_ICE_CANDIDATE_API_NAME:"pcs.addIceCandidate",CREATE_MEDIA_ELEMENT_API_NAME:"document.createElement",MEDIA_ELEMENT_SET_SINK_ID_API_NAME:"mediaElements.setSinkId",MEDIA_ELEMENT_REMOVE:"mediaElements.remove",CREATE_ANSWER_API_NAME:"pcs.createAnswer",UNLOAD_EVENT_NAME:"unload",TOGGLE_TRACK_ENABLED_API_NAME:"tracks.enabled",TRACK_STOP_API_NAME:"tracks.stop",TRACK_GET_SETTINGS:"tracks.getSettings",GET_RECEIVERS_API_NAME:"pcs.getReceivers",ADD_TRACK_API_NAME:"pcs.addTrack",GET_SENDERS_API_NAME:"pcs.getSenders",GET_SENDER_STATS_API_NAME:"senders.getStats",GET_RECEIVER_STATS_API_NAME:"receivers.getStats",SET_MEDIA_SRC_OBJ_API_NAME:"mediaElements.srcObject",SET_MEDIA_HIDDEN_API_NAME:"mediaElements.hidden",SET_MEDIA_VOLUME_API_NAME:"mediaElements.volume",MEDIA_ELEMENT_PLAY_API_NAME:"mediaElements.play",MEDIA_ELEMENT_PAUSE_API_NAME:"mediaElements.pause",MEDIA_ELEMENT_MUTED:"mediaElements.muted",ADD_TRANSCEIVER_API_NAME:"pcs.addTransceiver",GET_TRANSCEIVERS_API_NAME:"pcs.getTransceivers",TRANSCEIVER_SET_CODEC_PREFS:"transceivers.setCodecPreferences",REPLACE_SENDER_TRACK_API_NAME:"senders.replaceTrack",PC_REMOVE_TRACK_API_NAME:"pcs.removeTrack",INSERT_DTMF_API_NAME:"dtmfSenders.insertDTMF",SENDER_CREATE_ENCODED_STREAMS:"senders.createEncodedStreams",RECEIVER_CREATE_ENCODED_STREAMS:"receivers.createEncodedStreams"}),_=Object.freeze({SIG_STATE_CHANGE:"signalingstatechange",TRACK:"track",CONN_STATE_CHANGE:"connectionstatechange",ICE_CONN_STATE_CHANGE:"iceconnectionstatechange",ICE_GATHER_STATE_CHANGE:"icegatheringstatechange",ICE_CANDIDATE:"icecandidate",NEGOTIATION_NEEDED:"negotiationneeded"}),g=Object.freeze({ENDED:"ended",MUTE:"mute",UNMUTE:"unmute"}),m=Object.freeze({TONECHANGE:"tonechange"}),v=Object.freeze({ERROR:"error",MESSAGE:"message",MESSAGE_ERROR:"messageerror"}),y=Object.freeze({NEW:"new",AVAILABLE:"available",UNAVAILABLE:"unavailable"}),b=Object.freeze({CHROME:"diilpfplcnhehakckkpmcmibmhbingnd",EDGE:"kjbbkjjiecchbcdoollhgffghfjnbhef"}),C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S="undefined"==typeof Uint8Array?[]:new Uint8Array(256),E=0;E<64;E++)S[C.charCodeAt(E)]=E;var R=function(e){var t,n=new Uint8Array(e),r=n.length,i="";for(t=0;t<r;t+=3)i+=C[n[t]>>2],i+=C[(3&n[t])<<4|n[t+1]>>4],i+=C[(15&n[t+1])<<2|n[t+2]>>6],i+=C[63&n[t+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i},T=function(e){var t,n,r,i,o,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),l=new Uint8Array(d);for(t=0;t<s;t+=4)n=S[e.charCodeAt(t)],r=S[e.charCodeAt(t+1)],i=S[e.charCodeAt(t+2)],o=S[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return d},w={};!function(e){function t(e){for(var t=e.length;--t>=0;)e[t]=0}var n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=new Array(576);t(a);var s=new Array(60);t(s);var c=new Array(512);t(c);var d=new Array(256);t(d);var l=new Array(29);t(l);var u=new Array(30);function h(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}var p=void 0,_=void 0,g=void 0;function m(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(u);var v=function(e){return e<256?c[e]:c[256+(e>>>7)]},y=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},b=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,y(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},C=function(e,t,n){b(e,n[2*t],n[2*t+1])},S=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},E=function(e,t,n){var r=new Array(16),i=void 0,o=void 0,a=0;for(i=1;i<=15;i++)a=a+n[i-1]<<1,r[i]=a;for(o=0;o<=t;o++){var s=e[2*o+1];0!==s&&(e[2*o]=S(r[s]++,s))}},R=function(e){var t=void 0;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},T=function(e){e.bi_valid>8?y(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},w=function(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},k=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&w(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!w(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},I=function(e,t,i){var o=void 0,a=void 0,s=void 0,c=void 0,f=0;if(0!==e.sym_next)do{o=255&e.pending_buf[e.sym_buf+f++],o+=(255&e.pending_buf[e.sym_buf+f++])<<8,a=e.pending_buf[e.sym_buf+f++],0===o?C(e,a,t):(s=d[a],C(e,s+256+1,t),0!==(c=n[s])&&(a-=l[s],b(e,a,c)),s=v(--o),C(e,s,i),0!==(c=r[s])&&(o-=u[s],b(e,o,c)))}while(f<e.sym_next);C(e,256,t)},P=function(e,t){var n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems,a=void 0,s=void 0,c=void 0,d=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)0!==n[2*a]?(e.heap[++e.heap_len]=d=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)n[2*(c=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=d,a=e.heap_len>>1;a>=1;a--)k(e,n,a);c=o;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],k(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,n[2*c]=n[2*a]+n[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,n[2*a+1]=n[2*s+1]=c,e.heap[1]=c++,k(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length,d=void 0,l=void 0,u=void 0,f=void 0,h=void 0,p=void 0,_=0;for(f=0;f<=15;f++)e.bl_count[f]=0;for(n[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)(f=n[2*n[2*(l=e.heap[d])+1]+1]+1)>c&&(f=c,_++),n[2*l+1]=f,l>r||(e.bl_count[f]++,h=0,l>=s&&(h=a[l-s]),p=n[2*l],e.opt_len+=p*(f+h),o&&(e.static_len+=p*(i[2*l+1]+h)));if(0!==_){do{for(f=c-1;0===e.bl_count[f];)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,_-=2}while(_>0);for(f=c;0!==f;f--)for(l=e.bl_count[f];0!==l;)(u=e.heap[--d])>r||(n[2*u+1]!==f&&(e.opt_len+=(f-n[2*u+1])*n[2*u],n[2*u+1]=f),l--)}}(e,t),E(n,d,e.bl_count)},A=function(e,t,n){var r=void 0,i=void 0,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<c&&i===a||(s<d?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(c=138,d=3):i===a?(c=6,d=3):(c=7,d=4))},M=function(e,t,n){var r=void 0,i=void 0,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<c&&i===a)){if(s<d)do{C(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(C(e,i,e.bl_tree),s--),C(e,16,e.bl_tree),b(e,s-3,2)):s<=10?(C(e,17,e.bl_tree),b(e,s-3,3)):(C(e,18,e.bl_tree),b(e,s-11,7));s=0,o=i,0===a?(c=138,d=3):i===a?(c=6,d=3):(c=7,d=4)}},D=!1,O=function(e,t,n,r){b(e,0+(r?1:0),3),T(e),y(e,n),y(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},x=function(e){D||(function(){var e=void 0,t=void 0,o=void 0,f=void 0,m=void 0,v=new Array(16);for(o=0,f=0;f<28;f++)for(l[f]=o,e=0;e<1<<n[f];e++)d[o++]=f;for(d[o-1]=f,m=0,f=0;f<16;f++)for(u[f]=m,e=0;e<1<<r[f];e++)c[m++]=f;for(m>>=7;f<30;f++)for(u[f]=m<<7,e=0;e<1<<r[f]-7;e++)c[256+m++]=f;for(t=0;t<=15;t++)v[t]=0;for(e=0;e<=143;)a[2*e+1]=8,e++,v[8]++;for(;e<=255;)a[2*e+1]=9,e++,v[9]++;for(;e<=279;)a[2*e+1]=7,e++,v[7]++;for(;e<=287;)a[2*e+1]=8,e++,v[8]++;for(E(a,287,v),e=0;e<30;e++)s[2*e+1]=5,s[2*e]=S(e,5);p=new h(a,n,257,286,15),_=new h(s,r,0,30,15),g=new h(new Array(0),i,0,19,7)}(),D=!0),e.l_desc=new m(e.dyn_ltree,p),e.d_desc=new m(e.dyn_dtree,_),e.bl_desc=new m(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,R(e)},N=O,U=function(e,t,n,r){var i=void 0,c=void 0,d=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t=void 0,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),P(e,e.l_desc),P(e,e.d_desc),d=function(e){var t=void 0;for(A(e,e.dyn_ltree,e.l_desc.max_code),A(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=i&&(i=c)):i=c=n+5,n+4<=i&&-1!==t?O(e,t,n,r):4===e.strategy||c===i?(b(e,2+(r?1:0),3),I(e,a,s)):(b(e,4+(r?1:0),3),function(e,t,n,r){var i=void 0;for(b(e,t-257,5),b(e,n-1,5),b(e,r-4,4),i=0;i<r;i++)b(e,e.bl_tree[2*o[i]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),I(e,e.dyn_ltree,e.dyn_dtree)),R(e),r&&T(e)},j=function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(d[n]+256+1)]++,e.dyn_dtree[2*v(t)]++),e.sym_next===e.sym_end},F=function(e){b(e,2,3),C(e,256,a),function(e){16===e.bi_valid?(y(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},L=function(e,t,n,r){for(var i=65535&e,o=e>>>16&65535,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16},V=new Uint32Array(function(){for(var e=void 0,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),W=function(e,t,n,r){var i=V,o=r+n;e^=-1;for(var a=r;a<o;a++)e=e>>>8^i[255&(e^t[a])];return~e},B={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},z=x,G=N,q=U,J=j,K=F,Z=H.Z_NO_FLUSH,Y=H.Z_PARTIAL_FLUSH,X=H.Z_FULL_FLUSH,$=H.Z_FINISH,Q=H.Z_BLOCK,ee=H.Z_OK,te=H.Z_STREAM_END,ne=H.Z_STREAM_ERROR,re=H.Z_DATA_ERROR,ie=H.Z_BUF_ERROR,oe=H.Z_DEFAULT_COMPRESSION,ae=H.Z_FILTERED,se=H.Z_HUFFMAN_ONLY,ce=H.Z_RLE,de=H.Z_FIXED,le=H.Z_DEFAULT_STRATEGY,ue=H.Z_UNKNOWN,fe=H.Z_DEFLATED,he=262,pe=function(e,t){return e.msg=B[t],t},_e=function(e){return 2*e-(e>4?9:0)},ge=function(e){for(var t=e.length;--t>=0;)e[t]=0},me=function(e){var t=void 0,n=void 0,r=void 0,i=e.w_size;r=t=e.hash_size;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);r=t=i;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},ve=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},ye=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},be=function(e,t){q(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ye(e.strm)},Ce=function(e,t){e.pending_buf[e.pending++]=t},Se=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ee=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=L(e.adler,t,i,n):2===e.state.wrap&&(e.adler=W(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Re=function(e,t){var n=void 0,r=void 0,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-he?e.strstart-(e.w_size-he):0,d=e.window,l=e.w_mask,u=e.prev,f=e.strstart+258,h=d[o+a-1],p=d[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(n=t)+a]===p&&d[n+a-1]===h&&d[n]===d[o]&&d[++n]===d[o+1]){o+=2,n++;do{}while(d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&o<f);if(r=258-(f-o),o=f-258,r>a){if(e.match_start=t,a=r,r>=s)break;h=d[o+a-1],p=d[o+a]}}}while((t=u[t&l])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead},Te=function(e){var t=e.w_size,n=void 0,r=void 0,i=void 0;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-he)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),me(e),r+=t),0===e.strm.avail_in)break;if(n=Ee(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=ve(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=ve(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<he&&0!==e.strm.avail_in)},we=function(e,t){var n=void 0,r=void 0,i=void 0,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n>(r=e.strstart-e.block_start)+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==$||t===Z||n!==r+e.strm.avail_in))break;a=t===$&&n===r+e.strm.avail_in?1:0,G(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ye(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ee(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return(s-=e.strm.avail_in)&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==Z&&t!==$&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Ee(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,o=(i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=o||(r||t===$)&&t!==Z&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===$&&0===e.strm.avail_in&&n===r?1:0,G(e,e.block_start,n,a),e.block_start+=n,ye(e.strm)),a?3:1)},ke=function(e,t){for(var n=void 0,r=void 0;;){if(e.lookahead<he){if(Te(e),e.lookahead<he&&t===Z)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-he&&(e.match_length=Re(e,n)),e.match_length>=3)if(r=J(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ve(e,e.ins_h,e.window[e.strstart+1]);else r=J(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2},Ie=function(e,t){for(var n=void 0,r=void 0,i=void 0;;){if(e.lookahead<he){if(Te(e),e.lookahead<he&&t===Z)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-he&&(e.match_length=Re(e,n),e.match_length<=5&&(e.strategy===ae||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=J(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(be(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=J(e,0,e.window[e.strstart-1]))&&be(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=J(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2};function Pe(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var Ae=[new Pe(0,0,0,0,we),new Pe(4,4,8,4,ke),new Pe(4,5,16,8,ke),new Pe(4,6,32,32,ke),new Pe(4,4,16,16,Ie),new Pe(8,16,32,32,Ie),new Pe(8,16,128,128,Ie),new Pe(8,32,128,256,Ie),new Pe(32,128,258,1024,Ie),new Pe(32,258,258,4096,Ie)],Me=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||42!==t.status&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&113!==t.status&&666!==t.status?1:0},De=function(e){if(Me(e))return pe(e,ne);e.total_in=e.total_out=0,e.data_type=ue;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=-2,z(t),ee},Oe=function(e){var t,n=De(e);return n===ee&&((t=e.state).window_size=2*t.w_size,ge(t.head),t.max_lazy_match=Ae[t.level].max_lazy,t.good_match=Ae[t.level].good_length,t.nice_match=Ae[t.level].nice_length,t.max_chain_length=Ae[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},xe=function(e,t,n,r,i,o){if(!e)return ne;var a=1;if(t===oe&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==fe||r<8||r>15||t<0||t>9||o<0||o>de||8===r&&1!==a)return pe(e,ne);8===r&&(r=9);var s=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ge(this.dyn_ltree),ge(this.dyn_dtree),ge(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ge(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ge(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=s,s.strm=e,s.status=42,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=n,Oe(e)},Ne={deflateInit:function(e,t){return xe(e,t,fe,15,8,le)},deflateInit2:xe,deflateReset:Oe,deflateResetKeep:De,deflateSetHeader:function(e,t){return Me(e)||2!==e.state.wrap?ne:(e.state.gzhead=t,ee)},deflate:function(e,t){if(Me(e)||t>Q||t<0)return e?pe(e,ne):ne;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||666===n.status&&t!==$)return pe(e,0===e.avail_out?ie:ne);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ye(e),0===e.avail_out)return n.last_flush=-1,ee}else if(0===e.avail_in&&_e(t)<=_e(r)&&t!==$)return pe(e,ie);if(666===n.status&&0!==e.avail_in)return pe(e,ie);if(42===n.status&&0===n.wrap&&(n.status=113),42===n.status){var i=fe+(n.w_bits-8<<4)<<8;if(i|=(n.strategy>=se||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(i|=32),Se(n,i+=31-i%31),0!==n.strstart&&(Se(n,e.adler>>>16),Se(n,65535&e.adler)),e.adler=1,n.status=113,ye(e),0!==n.pending)return n.last_flush=-1,ee}if(57===n.status)if(e.adler=0,Ce(n,31),Ce(n,139),Ce(n,8),n.gzhead)Ce(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ce(n,255&n.gzhead.time),Ce(n,n.gzhead.time>>8&255),Ce(n,n.gzhead.time>>16&255),Ce(n,n.gzhead.time>>24&255),Ce(n,9===n.level?2:n.strategy>=se||n.level<2?4:0),Ce(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ce(n,255&n.gzhead.extra.length),Ce(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=W(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,9===n.level?2:n.strategy>=se||n.level<2?4:0),Ce(n,3),n.status=113,ye(e),0!==n.pending)return n.last_flush=-1,ee;if(69===n.status){if(n.gzhead.extra){for(var o=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+a>n.pending_buf_size;){var s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=W(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=s,ye(e),0!==n.pending)return n.last_flush=-1,ee;o=0,a-=s}var c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>o&&(e.adler=W(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var d=void 0,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=W(e.adler,n.pending_buf,n.pending-l,l)),ye(e),0!==n.pending)return n.last_flush=-1,ee;l=0}d=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ce(n,d)}while(0!==d);n.gzhead.hcrc&&n.pending>l&&(e.adler=W(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var u=void 0,f=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>f&&(e.adler=W(e.adler,n.pending_buf,n.pending-f,f)),ye(e),0!==n.pending)return n.last_flush=-1,ee;f=0}u=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ce(n,u)}while(0!==u);n.gzhead.hcrc&&n.pending>f&&(e.adler=W(e.adler,n.pending_buf,n.pending-f,f))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ye(e),0!==n.pending))return n.last_flush=-1,ee;Ce(n,255&e.adler),Ce(n,e.adler>>8&255),e.adler=0}if(n.status=113,ye(e),0!==n.pending)return n.last_flush=-1,ee}if(0!==e.avail_in||0!==n.lookahead||t!==Z&&666!==n.status){var h=0===n.level?we(n,t):n.strategy===se?function(e,t){for(var n=void 0;;){if(0===e.lookahead&&(Te(e),0===e.lookahead)){if(t===Z)return 1;break}if(e.match_length=0,n=J(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===ce?function(e,t){for(var n=void 0,r=void 0,i=void 0,o=void 0,a=e.window;;){if(e.lookahead<=258){if(Te(e),e.lookahead<=258&&t===Z)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){o=e.strstart+258;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=J(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=J(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2}(n,t):Ae[n.level].func(n,t);if(3!==h&&4!==h||(n.status=666),1===h||3===h)return 0===e.avail_out&&(n.last_flush=-1),ee;if(2===h&&(t===Y?K(n):t!==Q&&(G(n,0,0,!1),t===X&&(ge(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ye(e),0===e.avail_out))return n.last_flush=-1,ee}return t!==$?ee:n.wrap<=0?te:(2===n.wrap?(Ce(n,255&e.adler),Ce(n,e.adler>>8&255),Ce(n,e.adler>>16&255),Ce(n,e.adler>>24&255),Ce(n,255&e.total_in),Ce(n,e.total_in>>8&255),Ce(n,e.total_in>>16&255),Ce(n,e.total_in>>24&255)):(Se(n,e.adler>>>16),Se(n,65535&e.adler)),ye(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?ee:te)},deflateEnd:function(e){if(Me(e))return ne;var t=e.state.status;return e.state=null,113===t?pe(e,re):ee},deflateSetDictionary:function(e,t){var n=t.length;if(Me(e))return ne;var r=e.state,i=r.wrap;if(2===i||1===i&&42!==r.status||r.lookahead)return ne;if(1===i&&(e.adler=L(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(ge(r.head),r.strstart=0,r.block_start=0,r.insert=0);var o=new Uint8Array(r.w_size);o.set(t.subarray(n-r.w_size,n),0),t=o,n=r.w_size}var a=e.avail_in,s=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Te(r);r.lookahead>=3;){var d=r.strstart,l=r.lookahead-2;do{r.ins_h=ve(r,r.ins_h,r.window[d+3-1]),r.prev[d&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=d,d++}while(--l);r.strstart=d,r.lookahead=2,Te(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,r.wrap=i,ee},deflateInfo:"pako deflate (from Nodeca project)"},Ue=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},je=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=(void 0===n?"undefined":(0,f.default)(n)))throw new TypeError(n+"must be non-object");for(var r in n)Ue(n,r)&&(e[r]=n[r])}}return e},Fe=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),o=0,a=0,s=e.length;o<s;o++){var c=e[o];i.set(c,a),a+=c.length}return i},Le=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Le=!1}for(var Ve=new Uint8Array(256),We=0;We<256;We++)Ve[We]=We>=252?6:We>=248?5:We>=240?4:We>=224?3:We>=192?2:1;Ve[254]=Ve[254]=1;var Be=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t=void 0,n=void 0,r=void 0,i=void 0,o=void 0,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},He=function(e,t){var n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var r=void 0,i=void 0,o=new Array(2*n);for(i=0,r=0;r<n;){var a=e[r++];if(a<128)o[i++]=a;else{var s=Ve[a];if(s>4)o[i++]=65533,r+=s-1;else{for(a&=2===s?31:3===s?15:7;s>1&&r<n;)a=a<<6|63&e[r++],s--;s>1?o[i++]=65533:a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|1023&a)}}}return function(e,t){if(t<65534&&e.subarray&&Le)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(o,i)},ze=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ve[e[n]]>t?n:t},Ge=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},qe=Object.prototype.toString,Je=H.Z_NO_FLUSH,Ke=H.Z_SYNC_FLUSH,Ze=H.Z_FULL_FLUSH,Ye=H.Z_FINISH,Xe=H.Z_OK,$e=H.Z_STREAM_END,Qe=H.Z_DEFAULT_COMPRESSION,et=H.Z_DEFAULT_STRATEGY,tt=H.Z_DEFLATED;function nt(e){this.options=je({level:Qe,method:tt,chunkSize:16384,windowBits:15,memLevel:8,strategy:et},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ge,this.strm.avail_out=0;var n=Ne.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Xe)throw new Error(B[n]);if(t.header&&Ne.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?Be(t.dictionary):"[object ArrayBuffer]"===qe.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Ne.deflateSetDictionary(this.strm,r))!==Xe)throw new Error(B[n]);this._dict_set=!0}}function rt(e,t){var n=new nt(t);if(n.push(e,!0),n.err)throw n.msg||B[n.err];return n.result}nt.prototype.push=function(e,t){var n,r=this.strm,i=this.options.chunkSize,o=void 0;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Ye:Je,"string"==typeof e?r.input=Be(e):"[object ArrayBuffer]"===qe.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(n===Ke||n===Ze)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((o=Ne.deflate(r,n))===$e)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),o=Ne.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Xe;if(0!==r.avail_out){if(n>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},nt.prototype.onData=function(e){this.chunks.push(e)},nt.prototype.onEnd=function(e){e===Xe&&(this.result=Fe(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var it=nt,ot=rt,at=function(e,t){return(t=t||{}).raw=!0,rt(e,t)},st=function(e,t){return(t=t||{}).gzip=!0,rt(e,t)},ct=16209,dt=function(e,t){var n,r,i,o,a,s,c,d,l,u,f,h,p,_=void 0,g=void 0,m=void 0,v=void 0,y=void 0,b=void 0,C=void 0,S=void 0,E=void 0,R=void 0,T=void 0,w=e.state;_=e.next_in,p=e.input,n=_+(e.avail_in-5),g=e.next_out,T=e.output,r=g-(t-e.avail_out),i=g+(e.avail_out-257),o=w.dmax,a=w.wsize,s=w.whave,c=w.wnext,d=w.window,m=w.hold,v=w.bits,l=w.lencode,u=w.distcode,f=(1<<w.lenbits)-1,h=(1<<w.distbits)-1;e:do{v<15&&(m+=p[_++]<<v,v+=8,m+=p[_++]<<v,v+=8),y=l[m&f];t:for(;;){if(m>>>=b=y>>>24,v-=b,0==(b=y>>>16&255))T[g++]=65535&y;else{if(!(16&b)){if(!(64&b)){y=l[(65535&y)+(m&(1<<b)-1)];continue t}if(32&b){w.mode=16191;break e}e.msg="invalid literal/length code",w.mode=ct;break e}C=65535&y,(b&=15)&&(v<b&&(m+=p[_++]<<v,v+=8),C+=m&(1<<b)-1,m>>>=b,v-=b),v<15&&(m+=p[_++]<<v,v+=8,m+=p[_++]<<v,v+=8),y=u[m&h];n:for(;;){if(m>>>=b=y>>>24,v-=b,!(16&(b=y>>>16&255))){if(!(64&b)){y=u[(65535&y)+(m&(1<<b)-1)];continue n}e.msg="invalid distance code",w.mode=ct;break e}if(S=65535&y,v<(b&=15)&&(m+=p[_++]<<v,(v+=8)<b&&(m+=p[_++]<<v,v+=8)),(S+=m&(1<<b)-1)>o){e.msg="invalid distance too far back",w.mode=ct;break e}if(m>>>=b,v-=b,S>(b=g-r)){if((b=S-b)>s&&w.sane){e.msg="invalid distance too far back",w.mode=ct;break e}if(E=0,R=d,0===c){if(E+=a-b,b<C){C-=b;do{T[g++]=d[E++]}while(--b);E=g-S,R=T}}else if(c<b){if(E+=a+c-b,(b-=c)<C){C-=b;do{T[g++]=d[E++]}while(--b);if(E=0,c<C){C-=b=c;do{T[g++]=d[E++]}while(--b);E=g-S,R=T}}}else if(E+=c-b,b<C){C-=b;do{T[g++]=d[E++]}while(--b);E=g-S,R=T}for(;C>2;)T[g++]=R[E++],T[g++]=R[E++],T[g++]=R[E++],C-=3;C&&(T[g++]=R[E++],C>1&&(T[g++]=R[E++]))}else{E=g-S;do{T[g++]=T[E++],T[g++]=T[E++],T[g++]=T[E++],C-=3}while(C>2);C&&(T[g++]=T[E++],C>1&&(T[g++]=T[E++]))}break}}break}}while(_<n&&g<i);_-=C=v>>3,m&=(1<<(v-=C<<3))-1,e.next_in=_,e.next_out=g,e.avail_in=_<n?n-_+5:5-(_-n),e.avail_out=g<i?i-g+257:257-(g-i),w.hold=m,w.bits=v},lt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ut=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ft=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ht=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),pt=function(e,t,n,r,i,o,a,s){var c,d=s.bits,l=void 0,u=void 0,f=void 0,h=void 0,p=void 0,_=0,g=0,m=0,v=0,y=0,b=0,C=0,S=0,E=0,R=0,T=null,w=new Uint16Array(16),k=new Uint16Array(16),I=void 0,P=void 0,A=void 0,M=null;for(_=0;_<=15;_++)w[_]=0;for(g=0;g<r;g++)w[t[n+g]]++;for(y=d,v=15;v>=1&&0===w[v];v--);if(y>v&&(y=v),0===v)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(m=1;m<v&&0===w[m];m++);for(y<m&&(y=m),S=1,_=1;_<=15;_++)if(S<<=1,(S-=w[_])<0)return-1;if(S>0&&(0===e||1!==v))return-1;for(k[1]=0,_=1;_<15;_++)k[_+1]=k[_]+w[_];for(g=0;g<r;g++)0!==t[n+g]&&(a[k[t[n+g]]++]=g);if(0===e?(T=M=a,p=20):1===e?(T=lt,M=ut,p=257):(T=ft,M=ht,p=0),R=0,g=0,_=m,h=o,b=y,C=0,f=-1,c=(E=1<<y)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){I=_-C,a[g]+1<p?(P=0,A=a[g]):a[g]>=p?(P=M[a[g]-p],A=T[a[g]-p]):(P=96,A=0),l=1<<_-C,m=u=1<<b;do{i[h+(R>>C)+(u-=l)]=I<<24|P<<16|A}while(0!==u);for(l=1<<_-1;R&l;)l>>=1;if(0!==l?(R&=l-1,R+=l):R=0,g++,0==--w[_]){if(_===v)break;_=t[n+a[g]]}if(_>y&&(R&c)!==f){for(0===C&&(C=y),h+=m,S=1<<(b=_-C);b+C<v&&!((S-=w[b+C])<=0);)b++,S<<=1;if(E+=1<<b,1===e&&E>852||2===e&&E>592)return 1;i[f=R&c]=y<<24|b<<16|h-o}}return 0!==R&&(i[h+R]=_-C<<24|64<<16),s.bits=y,0},_t=H.Z_FINISH,gt=H.Z_BLOCK,mt=H.Z_TREES,vt=H.Z_OK,yt=H.Z_STREAM_END,bt=H.Z_NEED_DICT,Ct=H.Z_STREAM_ERROR,St=H.Z_DATA_ERROR,Et=H.Z_MEM_ERROR,Rt=H.Z_BUF_ERROR,Tt=H.Z_DEFLATED,wt=16180,kt=16190,It=16191,Pt=16199,At=16200,Mt=16209,Dt=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)},Ot=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<wt||t.mode>16211?1:0},xt=function(e){if(Ot(e))return Ct;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=wt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,vt},Nt=function(e){if(Ot(e))return Ct;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,xt(e)},Ut=function(e,t){var n=void 0;if(Ot(e))return Ct;var r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ct:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Nt(e))},jt=function(e,t){if(!e)return Ct;var n=new function(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0};e.state=n,n.strm=e,n.window=null,n.mode=wt;var r=Ut(e,t);return r!==vt&&(e.state=null),r},Ft=void 0,Lt=void 0,Vt=!0,Wt=function(e){if(Vt){Ft=new Int32Array(512),Lt=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pt(1,e.lens,0,288,Ft,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pt(2,e.lens,0,32,Lt,0,e.work,{bits:5}),Vt=!1}e.lencode=Ft,e.lenbits=9,e.distcode=Lt,e.distbits=5},Bt=function(e,t,n,r){var i=void 0,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},Ht={inflateReset:Nt,inflateReset2:Ut,inflateResetKeep:xt,inflateInit:function(e){return jt(e,15)},inflateInit2:jt,inflate:function(e,t){var n=void 0,r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,c=void 0,d=void 0,l=void 0,u=void 0,f=void 0,h=void 0,p=void 0,_=void 0,g=void 0,m=void 0,v=void 0,y=void 0,b=void 0,C=void 0,S=void 0,E=void 0,R=0,T=new Uint8Array(4),w=void 0,k=void 0,I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ot(e)||!e.output||!e.input&&0!==e.avail_in)return Ct;(n=e.state).mode===It&&(n.mode=16192),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,d=n.hold,l=n.bits,u=s,f=c,E=vt;e:for(;;)switch(n.mode){case wt:if(0===n.wrap){n.mode=16192;break}for(;l<16;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(2&n.wrap&&35615===d){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&d,T[1]=d>>>8&255,n.check=W(n.check,T,2,0),d=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=Mt;break}if((15&d)!==Tt){e.msg="unknown compression method",n.mode=Mt;break}if(l-=4,S=8+(15&(d>>>=4)),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=Mt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&d?16189:It,d=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(n.flags=d,(255&n.flags)!==Tt){e.msg="unknown compression method",n.mode=Mt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Mt;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&4&n.wrap&&(T[0]=255&d,T[1]=d>>>8&255,n.check=W(n.check,T,2,0)),d=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.head&&(n.head.time=d),512&n.flags&&4&n.wrap&&(T[0]=255&d,T[1]=d>>>8&255,T[2]=d>>>16&255,T[3]=d>>>24&255,n.check=W(n.check,T,4,0)),d=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&4&n.wrap&&(T[0]=255&d,T[1]=d>>>8&255,n.check=W(n.check,T,2,0)),d=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&4&n.wrap&&(T[0]=255&d,T[1]=d>>>8&255,n.check=W(n.check,T,2,0)),d=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&((h=n.length)>s&&(h=s),h&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+h),S)),512&n.flags&&4&n.wrap&&(n.check=W(n.check,r,h,o)),s-=h,o+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===s)break e;h=0;do{S=r[o+h++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&h<s);if(512&n.flags&&4&n.wrap&&(n.check=W(n.check,r,h,o)),s-=h,o+=h,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===s)break e;h=0;do{S=r[o+h++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&h<s);if(512&n.flags&&4&n.wrap&&(n.check=W(n.check,r,h,o)),s-=h,o+=h,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(4&n.wrap&&d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Mt;break}d=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=It;break;case 16189:for(;l<32;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}e.adler=n.check=Dt(d),d=0,l=0,n.mode=kt;case kt:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=l,bt;e.adler=n.check=1,n.mode=It;case It:if(t===gt||t===mt)break e;case 16192:if(n.last){d>>>=7&l,l-=7&l,n.mode=16206;break}for(;l<3;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}switch(n.last=1&d,l-=1,3&(d>>>=1)){case 0:n.mode=16193;break;case 1:if(Wt(n),n.mode=Pt,t===mt){d>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Mt}d>>>=2,l-=2;break;case 16193:for(d>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Mt;break}if(n.length=65535&d,d=0,l=0,n.mode=16194,t===mt)break e;case 16194:n.mode=16195;case 16195:if(h=n.length){if(h>s&&(h=s),h>c&&(h=c),0===h)break e;i.set(r.subarray(o,o+h),a),s-=h,o+=h,c-=h,a+=h,n.length-=h;break}n.mode=It;break;case 16196:for(;l<14;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(n.nlen=257+(31&d),d>>>=5,l-=5,n.ndist=1+(31&d),d>>>=5,l-=5,n.ncode=4+(15&d),d>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Mt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.lens[I[n.have++]]=7&d,d>>>=3,l-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,w={bits:n.lenbits},E=pt(0,n.lens,0,19,n.lencode,0,n.work,w),n.lenbits=w.bits,E){e.msg="invalid code lengths set",n.mode=Mt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;m=(R=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,v=65535&R,!((g=R>>>24)<=l);){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(v<16)d>>>=g,l-=g,n.lens[n.have++]=v;else{if(16===v){for(k=g+2;l<k;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(d>>>=g,l-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=Mt;break}S=n.lens[n.have-1],h=3+(3&d),d>>>=2,l-=2}else if(17===v){for(k=g+3;l<k;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}l-=g,S=0,h=3+(7&(d>>>=g)),d>>>=3,l-=3}else{for(k=g+7;l<k;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}l-=g,S=0,h=11+(127&(d>>>=g)),d>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Mt;break}for(;h--;)n.lens[n.have++]=S}}if(n.mode===Mt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Mt;break}if(n.lenbits=9,w={bits:n.lenbits},E=pt(1,n.lens,0,n.nlen,n.lencode,0,n.work,w),n.lenbits=w.bits,E){e.msg="invalid literal/lengths set",n.mode=Mt;break}if(n.distbits=6,n.distcode=n.distdyn,w={bits:n.distbits},E=pt(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,w),n.distbits=w.bits,E){e.msg="invalid distances set",n.mode=Mt;break}if(n.mode=Pt,t===mt)break e;case Pt:n.mode=At;case At:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=l,dt(e,f),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,d=n.hold,l=n.bits,n.mode===It&&(n.back=-1);break}for(n.back=0;m=(R=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,v=65535&R,!((g=R>>>24)<=l);){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(m&&!(240&m)){for(y=g,b=m,C=v;m=(R=n.lencode[C+((d&(1<<y+b)-1)>>y)])>>>16&255,v=65535&R,!(y+(g=R>>>24)<=l);){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}d>>>=y,l-=y,n.back+=y}if(d>>>=g,l-=g,n.back+=g,n.length=v,0===m){n.mode=16205;break}if(32&m){n.back=-1,n.mode=It;break}if(64&m){e.msg="invalid literal/length code",n.mode=Mt;break}n.extra=15&m,n.mode=16201;case 16201:if(n.extra){for(k=n.extra;l<k;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;m=(R=n.distcode[d&(1<<n.distbits)-1])>>>16&255,v=65535&R,!((g=R>>>24)<=l);){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(!(240&m)){for(y=g,b=m,C=v;m=(R=n.distcode[C+((d&(1<<y+b)-1)>>y)])>>>16&255,v=65535&R,!(y+(g=R>>>24)<=l);){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}d>>>=y,l-=y,n.back+=y}if(d>>>=g,l-=g,n.back+=g,64&m){e.msg="invalid distance code",n.mode=Mt;break}n.offset=v,n.extra=15&m,n.mode=16203;case 16203:if(n.extra){for(k=n.extra;l<k;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Mt;break}n.mode=16204;case 16204:if(0===c)break e;if(h=f-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Mt;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),_=n.window}else _=i,p=a-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{i[a++]=_[p++]}while(--h);0===n.length&&(n.mode=At);break;case 16205:if(0===c)break e;i[a++]=n.length,c--,n.mode=At;break;case 16206:if(n.wrap){for(;l<32;){if(0===s)break e;s--,d|=r[o++]<<l,l+=8}if(f-=c,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?W(n.check,i,f,a-f):L(n.check,i,f,a-f)),f=c,4&n.wrap&&(n.flags?d:Dt(d))!==n.check){e.msg="incorrect data check",n.mode=Mt;break}d=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,d+=r[o++]<<l,l+=8}if(4&n.wrap&&d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Mt;break}d=0,l=0}n.mode=16208;case 16208:E=yt;break e;case Mt:E=St;break e;case 16210:return Et;default:return Ct}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=d,n.bits=l,(n.wsize||f!==e.avail_out&&n.mode<Mt&&(n.mode<16206||t!==_t))&&Bt(e,e.output,e.next_out,f-e.avail_out),u-=e.avail_in,f-=e.avail_out,e.total_in+=u,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?W(n.check,i,f,e.next_out-f):L(n.check,i,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===It?128:0)+(n.mode===Pt||16194===n.mode?256:0),(0===u&&0===f||t===_t)&&E===vt&&(E=Rt),E},inflateEnd:function(e){if(Ot(e))return Ct;var t=e.state;return t.window&&(t.window=null),e.state=null,vt},inflateGetHeader:function(e,t){if(Ot(e))return Ct;var n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,vt):Ct},inflateSetDictionary:function(e,t){var n=t.length,r=void 0;return Ot(e)?Ct:0!==(r=e.state).wrap&&r.mode!==kt?Ct:r.mode===kt&&L(1,t,n,0)!==r.check?St:Bt(e,t,n,n)?(r.mode=16210,Et):(r.havedict=1,vt)},inflateInfo:"pako inflate (from Nodeca project)"},zt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Gt=Object.prototype.toString,qt=H.Z_NO_FLUSH,Jt=H.Z_FINISH,Kt=H.Z_OK,Zt=H.Z_STREAM_END,Yt=H.Z_NEED_DICT,Xt=H.Z_STREAM_ERROR,$t=H.Z_DATA_ERROR,Qt=H.Z_MEM_ERROR;function en(e){this.options=je({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ge,this.strm.avail_out=0;var n=Ht.inflateInit2(this.strm,t.windowBits);if(n!==Kt)throw new Error(B[n]);if(this.header=new zt,Ht.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Be(t.dictionary):"[object ArrayBuffer]"===Gt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ht.inflateSetDictionary(this.strm,t.dictionary))!==Kt))throw new Error(B[n])}function tn(e,t){var n=new en(t);if(n.push(e),n.err)throw n.msg||B[n.err];return n.result}en.prototype.push=function(e,t){var n,r=this.strm,i=this.options.chunkSize,o=this.options.dictionary,a=void 0,s=void 0;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Jt:qt,"[object ArrayBuffer]"===Gt.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(a=Ht.inflate(r,n))===Yt&&o&&((a=Ht.inflateSetDictionary(r,o))===Kt?a=Ht.inflate(r,n):a===$t&&(a=Yt));r.avail_in>0&&a===Zt&&r.state.wrap>0&&0!==e[r.next_in];)Ht.inflateReset(r),a=Ht.inflate(r,n);switch(a){case Xt:case $t:case Yt:case Qt:return this.onEnd(a),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(0===r.avail_out||a===Zt))if("string"===this.options.to){var c=ze(r.output,r.next_out),d=r.next_out-c,l=He(r.output,c);r.next_out=d,r.avail_out=i-d,d&&r.output.set(r.output.subarray(c,c+d),0),this.onData(l)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(a!==Kt||0!==s){if(a===Zt)return a=Ht.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},en.prototype.onData=function(e){this.chunks.push(e)},en.prototype.onEnd=function(e){e===Kt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fe(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nn=it,rn=ot,on=at,an=st,sn=en,cn=tn,dn=function(e,t){return(t=t||{}).raw=!0,tn(e,t)},ln=tn,un=H,fn={Deflate:nn,deflate:rn,deflateRaw:on,gzip:an,Inflate:sn,inflate:cn,inflateRaw:dn,ungzip:ln,constants:un};e.Deflate=nn,e.Inflate=sn,e.constants=un,e.default=fn,e.deflate=rn,e.deflateRaw=on,e.gzip=an,e.inflate=cn,e.inflateRaw=dn,e.ungzip=ln,Object.defineProperty(e,"__esModule",{value:!0})}(w);var k=i(w);var I=function(){function e(n){if((0,l.default)(this,e),this.version=t,this.config=n,this.logger=n.logger,this.clientInfo=null,this.certParams={name:"ECDSA",namedCurve:"P-256"},this.extensionId=function(){return(e=window.navigator.userAgent.toLowerCase()).indexOf("edg/")>-1||e.indexOf("edge")>-1?b.EDGE:b.CHROME;var e}(),this.pcProxies=new Map,this.audioContextProxies=new Map,this.audioNodeProxies=new Map,this.workerProxies=new Map,this.streamProxies=new Map,this.eventListeners=new Map,this.mediaElementProxies=new Map,this.transceiverProxies=new Map,this.senderProxies=new Map,this.dtmfProxies=new Map,this.receiverProxies=new Map,this.trackProxies=new Map,this.overridenApis=new Map,this.decoder=new TextDecoder("utf-8"),this.logger.debug("Checking for chrome extension.  Chrome runtime: "+chrome.runtime),void 0===chrome.runtime)throw new Error("Chrome runtime not available.  DCV WebRTC chrome extension may not be active.");this.overridenApis.set("navigator.mediaDevices.getUserMedia",navigator.mediaDevices.getUserMedia),this.overridenApis.set("navigator.mediaDevices.enumerateDevices",navigator.mediaDevices.enumerateDevices),this.overridenApis.set("window.RTCPeerConnection",window.RTCPeerConnection),this.overridenApis.set("window.RTCPeerConnection.generateCertificate",window.RTCPeerConnection.generateCertificate),this.overridenApis.set("window.AudioContext",window.AudioContext),this.overridenApis.set("window.Worker",window.Worker),this.status=y.NEW,this.statusChangeEventListeners=[],this.lastHeartbeat=Date.now(),this.heartbeatTimeout=null,this.heartbeatTimeoutMs=1e4,this.heartbeatIntervalPeriodMs=1e3,this.heartbeatInterval=null}return(0,u.default)(e,[{key:"clearHeartbeatInterval",value:function(){this.heartbeatTimeout&&(clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=null),this.hearbeatInterval&&(clearInterval(this.hearbeatInterval),this.hearbeatInterval=null)}},{key:"resetHeartbeat",value:function(e){var t=this;this.clearHeartbeatInterval(),this.heartbeatTimeoutMs=e&&e.heartbeatTimeoutMs?e.heartbeatTimeoutMs:this.heartbeatTimeoutMs,this.heartbeatIntervalPeriodMs=e&&e.heartbeatIntervalPeriodMs?e.heartbeatIntervalPeriodMs:this.heartbeatIntervalPeriodMs,this.hearbeatInterval=setInterval((0,d.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.heartbeatTimeout||(t.heartbeatTimeout=setTimeout(function(){t.logger.debug("heartbeatTimeout reached, current status: "+t.status+", last hb: "+(Date.now()-t.lastHeartbeat)+"ms ago."),t.status!==y.UNAVAILABLE&&(t.status=y.UNAVAILABLE,t.statusChangeEventListeners.forEach(function(e){e({status:t.status,data:t.clientInfo,lastHeartbeat:t.lastHeartbeat})}))},t.heartbeatTimeoutMs)),e.prev=1,e.next=4,t.sendApiRequest(p.HELLO_API_NAME,[]);case 4:if(t.clientInfo=e.sent,t.clientInfo){e.next=7;break}throw new Error("Failed to get clientInfo.");case 7:t.heartbeatTimeout&&(clearTimeout(t.heartbeatTimeout),t.heartbeatTimeout=null),t.status!==y.AVAILABLE&&(t.status=y.AVAILABLE,t.statusChangeEventListeners.forEach(function(e){e({status:t.status,data:t.clientInfo})})),t.lastHeartbeat=Date.now(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t.logger.debug("Heartbeat ping failed.  Last heartbeat received "+(Date.now()-t.lastHeartbeat)+"ms ago.");case 13:case"end":return e.stop()}},e,this,[[1,10]])})),this.heartbeatIntervalPeriodMs)}},{key:"makeMediaDeviceInfoProxies",value:function(e){return e.forEach(function(e){e.toJSON=function(){return e}}),e}},{key:"makeTrackProxy",value:function(e){var t=this;if(this.trackProxies.has(e.id)){var n=this.trackProxies.get(e.id);return Object.assign(n,e),n}return this.trackProxies.set(e.id,e),e.pendingEvents=new Map,e.stop=function(){t.sendApiRequest(p.TRACK_STOP_API_NAME,[e.id])},e.getSettings=function(){return t.sendApiRequest(p.TRACK_GET_SETTINGS,[e.id]).then(function(t){t&&(e.settings=t)}),e.settings},e.addEventListener=function(n,r,i){t.logger.debug("Setting ended event listener via addEventListener."),t.addTrackEventListener(e.id,n,r,i)},e.removeEventListener=function(n,r){t.removeEventListener(e.id,n,r)},Object.defineProperty(e,"onended",{set:function(n){t.addTrackEventListener(e.id,g.ENDED,n)},get:function(){return null}}),Object.defineProperty(e,"onmute",{set:function(n){t.addTrackEventListener(e.id,g.MUTE,n)},get:function(){return null}}),Object.defineProperty(e,"onunmute",{set:function(n){t.addTrackEventListener(e.id,g.UNMUTE,n)},get:function(){return null}}),e.trackEnabled=e.enabled,Object.defineProperty(e,"enabled",{set:function(n){e.trackEnabled=n,t.sendApiRequest(p.TOGGLE_TRACK_ENABLED_API_NAME,[e.id,n]).then(function(n){n&&(t.trackProxies.get(e.id).trackEnabled=n.enabled)})},get:function(){return e.trackEnabled}}),this.preRegisterEvents(g,e,this.addTrackEventListener),e}},{key:"makeStreamProxy",value:function(e){var t=this;this.streamProxies.set(e.id,e);var n=new MediaStream;n.type="proxy",n.proxy=e;var r=e.tracks?e.tracks.map(function(e){return t.makeTrackProxy(e)}):[];return e.tracks=r,n.getTracks=function(){return r},n.getAudioTracks=function(){return r.filter(function(e){return"audio"===e.kind})},n.getVideoTracks=function(){return r.filter(function(e){return"video"===e.kind})},n.getTrackById=function(e){return r.find(function(t){return t.id===e})},n.createMediaElement=function(e){return t.createMediaElement(e)},n.addTrack=function(n){t.sendApiRequest(p.STREAM_ADD_TRACK,[e.id,n.id])},n.removeTrack=function(n){t.sendApiRequest(p.STREAM_REMOVE_TRACK,[e.id,n.id])},n}},{key:"updateTransceiverProxy",value:function(e){var t=this.transceiverProxies.get(e.id);return t||(t={}),Object.assign(t,e),e.receiver&&"proxy"===e.receiver.type&&(t.receiver=this.updateReceiverProxy(e.receiver)),e.sender&&"proxy"===e.sender.type&&(t.sender=this.updateSenderProxy(e.sender)),this.transceiverProxies.set(e.id,t),t}},{key:"updatePCSenders",value:function(e,t){var n=this,r=t.map(function(e){return n.updateSenderProxy(e)});this.pcProxies.get(e).senders=r}},{key:"updatePCReceivers",value:function(e,t){var n=this,r=t.map(function(e){return n.updateReceiverProxy(e)});this.pcProxies.get(e).receivers=r}},{key:"updatePCTransceivers",value:function(e,t){var n=this,r=t;r.forEach(function(e){n.updateTransceiverProxy(e)}),this.pcProxies.get(e).transceivers=r}},{key:"isValidApi",value:function(e){var t=!1;for(var n in p)if(p[n]===e){t=!0;break}return t}},{key:"sendApiRequest",value:function(){var e=(0,d.default)(c.default.mark(function e(t,n){var r,i,o,a,s,d,l,u,f,h,p,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:crypto.randomUUID();return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug(t,n,_),e.prev=1,r={api:t,args:n},i=k.deflateRaw(JSON.stringify(r)),o={requestId:_,message:i,type:"request"},this.logger.debug("Sending request:",JSON.stringify(o)),e.next=8,chrome.runtime.sendMessage(this.extensionId,o);case 8:if(a=e.sent,i=a.message,s=k.inflateRaw(i),d=this.decoder.decode(s),a.message=JSON.parse(d),this.logger.debug("Received response: ",JSON.stringify(a)),a&&a.message&&a.type){e.next=14;break}return l="Received empty message or type, extensionResponse: "+JSON.stringify(a)+", request: "+JSON.stringify(o)+", message: "+JSON.stringify(r),e.abrupt("return",(this.logger.warn(l),null));case 14:if("error"!==a.type){e.next=19;break}if(u="Received error: "+JSON.stringify(a)+", for request: "+JSON.stringify(o)+", message: "+JSON.stringify(r),f=null,this.logger.debug(u),!(a.message.error&&a.message.error.message&&a.message.error&&a.message.error.name)){e.next=18;break}throw u=a.message.error.message,f=a.message.error.name,new DOMException(u,f);case 18:return e.abrupt("return",null);case 19:if("response"===a.type||"event"===a.type||"error"===a.type){e.next=22;break}return h="Received invalid message type, type: "+JSON.stringify(a.type)+", event: "+JSON.stringify(a)+", request: "+JSON.stringify(o)+", message: "+JSON.stringify(r),e.abrupt("return",(this.logger.warn(h),null));case 22:if(!a.message.api||this.isValidApi(a.message.api)){e.next=25;break}return p="Received invalid message api, event: "+JSON.stringify(a)+", request: "+JSON.stringify(o)+", message: "+JSON.stringify(r),e.abrupt("return",(this.logger.warn(p),null));case 25:return e.abrupt("return","event"===a.type?a.message.event:a.message.response);case 28:return e.prev=28,e.t0=e.catch(1),e.abrupt("return",(this.logger.warn("Failed to send api request: api: "+t+", args: "+n+", requestId: "+_,e.t0),null));case 31:case"end":return e.stop()}},e,this,[[1,28]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserMediaInternal",value:function(){var e=(0,d.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendApiRequest(p.GETUSERMEDIA_API_NAME,[t]);case 2:return n=e.sent,e.abrupt("return",n?this.makeStreamProxy(n):null);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOverridenApi",value:function(e){return this.overridenApis.get(e)}},{key:"getUserMedia",value:function(){var e=(0,d.default)(c.default.mark(function e(t){var n,r,i,o,a,s;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=Object.freeze(t)).audio||!n.video){e.next=14;break}return e.next=4,navigator.permissions.query({name:"microphone"});case 4:return r=e.sent,e.next=7,navigator.permissions.query({name:"camera"});case 7:if(i=e.sent,!r||"granted"!==r.state||!i||"granted"!==i.state){e.next=12;break}return e.next=11,this.getUserMediaInternal(n);case 11:return e.abrupt("return",e.sent);case 12:e.next=32;break;case 14:if(!n.audio){e.next=24;break}return e.next=17,navigator.permissions.query({name:"microphone"});case 17:if(!(o=e.sent)||"granted"!==o.state){e.next=22;break}return e.next=21,this.getUserMediaInternal(n);case 21:return e.abrupt("return",e.sent);case 22:e.next=32;break;case 24:if(!n.video){e.next=32;break}return e.next=27,navigator.permissions.query({name:"camera"});case 27:if(!(a=e.sent)||"granted"!==a.state){e.next=32;break}return e.next=31,this.getUserMediaInternal(n);case 31:return e.abrupt("return",e.sent);case 32:if(s=[],e.t0=n.video,!e.t0){e.next=39;break}return e.next=37,this.getOverridenApi("navigator.mediaDevices.enumerateDevices").apply(navigator.mediaDevices);case 37:s=(s=e.sent).filter(function(e){return e.kind&&e.kind.indexOf("video")>-1});case 39:if(!(n.audio&&!n.video||n.video&&s.length>0)){e.next=44;break}return e.next=42,this.getOverridenApi("navigator.mediaDevices.getUserMedia").apply(navigator.mediaDevices,[n]);case 42:e.t1=function(e){e.stop()},e.sent.getTracks().forEach(e.t1);case 44:return e.next=46,this.getUserMediaInternal(n);case 46:return e.abrupt("return",e.sent);case 47:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"enumerateDevices",value:function(){var e=(0,d.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendApiRequest(p.ENUMERATEDEVICES_API_NAME,[]);case 2:return t=e.sent,e.abrupt("return",t?this.makeMediaDeviceInfoProxies(t):null);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVersion",value:function(){return t}},{key:"makeReceiverProxy",value:function(e){var t=this;return e.track&&(e.track=this.makeTrackProxy(e.track)),e.getSynchronizationSources=function(){return e.synchronizationSources},e.getStats=(0,d.default)(c.default.mark(function n(){var r,i;return c.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.sendApiRequest(p.GET_RECEIVER_STATS_API_NAME,[e.id]);case 2:return r=n.sent,i=new Map,n.abrupt("return",(r&&r.forEach(function(e){i.set(e.id,e)}),i));case 5:case"end":return n.stop()}},n,this)})),e.createEncodedStreams=function(){var n={id:crypto.randomUUID(),type:"proxy",readable:{id:crypto.randomUUID(),type:"proxy"},writable:{id:crypto.randomUUID(),type:"proxy"}};return t.streamProxies.set(n.id,n),t.sendApiRequest(p.RECEIVER_CREATE_ENCODED_STREAMS,[e.id,n]),n},this.receiverProxies.set(e.id,e),e}},{key:"makeDTMFProxy",value:function(e){var t=this,n=e;return this.dtmfProxies.has(n.id)?(n=this.dtmfProxies.get(n.id),Object.assign(n,e)):(this.dtmfProxies.set(n.id,n),n.pendingEvents=new Map,n.insertDTMF=function(e,r,i){t.sendApiRequest(p.INSERT_DTMF_API_NAME,[n.id,e,r,i])},n.addEventListener=function(e,r,i){t.addDtmfEventListener(n.id,e,r,i)},n.removeEventListener=function(e,r){t.removeEventListener(n.id,e,r)},Object.defineProperty(n,"ontonechange",{set:function(e){t.addDtmfEventListener(n.id,m.TONECHANGE,e)},get:function(){return null}}),this.preRegisterEvents(m,n,this.addDtmfEventListener)),n}},{key:"makeSenderProxy",value:function(e){var t=this;return e.track&&(e.track=this.makeTrackProxy(e.track)),e.dtmf&&(e.dtmf=this.makeDTMFProxy(e.dtmf)),e.getStats=(0,d.default)(c.default.mark(function n(){var r;return c.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.sendApiRequest(p.GET_SENDER_STATS_API_NAME,[e.id]);case 2:return r=n.sent,n.abrupt("return",(r&&(r.has=function(e){return void 0!==r.find(function(t){return t.id===e})},r.get=function(e){return r.find(function(t){return t.id===e})}),r));case 4:case"end":return n.stop()}},n,this)})),e.replaceTrack=function(n){return e.track=n,t.sendApiRequest(p.REPLACE_SENDER_TRACK_API_NAME,[e.id,n])},e.createEncodedStreams=function(){var n={id:crypto.randomUUID(),type:"proxy",readable:{type:"proxy",id:crypto.randomUUID()},writable:{type:"proxy",id:crypto.randomUUID()}};return t.streamProxies.set(n.id,n),t.sendApiRequest(p.SENDER_CREATE_ENCODED_STREAMS,[e.id,n]),n},e}},{key:"updateSenderProxy",value:function(e){var t=this.senderProxies.get(e.id);return t?Object.assign(t,e):(t=e,this.senderProxies.set(e.id,t)),this.makeSenderProxy(t)}},{key:"updateReceiverProxy",value:function(e){var t=this.receiverProxies.get(e.id);return t?Object.assign(t,e):(t=e,this.receiverProxies.set(e.id,t)),this.makeReceiverProxy(t)}},{key:"addTrack",value:function(e,t){var n=this,r=crypto.randomUUID();this.sendApiRequest(p.ADD_TRACK_API_NAME,[r].concat(Array.prototype.slice.call(arguments))).then(function(e){e&&(n.updateSenderProxy(e),n.updatePCSenders(e.pcId,e.senders),n.updatePCReceivers(e.pcId,e.receivers),n.updatePCTransceivers(e.pcId,e.transceivers))});var i=this.updateSenderProxy({id:r});return this.pcProxies.get(e).senders.push(i),i}},{key:"updatePeerConnectionProxy",value:function(e){var t=this.pcProxies.get(e.pcId);Object.assign(t,e),this.updatePCSenders(e.pcId,e.senders),this.updatePCReceivers(e.pcId,e.receivers),this.updatePCTransceivers(e.pcId,e.transceivers)}},{key:"createPeerConnection",value:function(e,t){var n=this,r=crypto.randomUUID(),i=this;this.logger.debug("Creating RTCPeerConnection with id: "+r);var o={type:"proxy",id:r,signalingState:"new",connectionState:"new",iceConnectionState:"new",iceGatheringState:"new",receivers:[],senders:[],transceivers:[],pendingEvents:new Map,configuration:e,close:function(){n.close(r)},addStream:function(e){n.addStream(r,e)},getConfiguration:function(){return n.sendApiRequest(p.PC_GET_CONFIGURATION,[r]).then(function(e){e&&(o.configuration=e)}),o.configuration},getStats:function(e){return n.getStats(r,e)},createOffer:function(e){return n.createOffer(r,e)},createAnswer:function(e){return n.createAnswer(r,e)},setLocalDescription:function(e){return n.setLocalDescription(r,e)},addEventListener:function(e,t){n.addPeerConnectionEventListener(r,e,t)},removeEventListener:function(e,t){n.removeEventListener(r,e,t)},getEventListener:function(e){return n.eventListeners.get(r).get(e)},set onicecandidate(e){this.addEventListener(_.ICE_CANDIDATE,e)},get onicecandidate(){return this.getEventListener(_.ICE_CANDIDATE)},set ontrack(e){this.addEventListener(_.TRACK,e)},get ontrack(){return this.getEventListener(_.TRACK)},get onsignalingstatechange(){return this.getEventListener(_.SIG_STATE_CHANGE)},set onsignalingstatechange(e){this.addEventListener(_.SIG_STATE_CHANGE,e)},get onconnectionstatechange(){return this.getEventListener(_.CONN_STATE_CHANGE)},set onconnectionstatechange(e){this.addEventListener(_.CONN_STATE_CHANGE,e)},get oniceconnectionstatechange(){return this.getEventListener(_.ICE_CONN_STATE_CHANGE)},set oniceconnectionstatechange(e){this.addEventListener(_.ICE_CONN_STATE_CHANGE,e)},get onicegatheringstatechange(){return this.getEventListener(_.ICE_GATHER_STATE_CHANGE)},set onicegatheringstatechange(e){this.addEventListener(_.ICE_GATHER_STATE_CHANGE,e)},get onnegotiationneeded(){return this.getEventListener(_.NEGOTIATION_NEEDED)},set onnegotiationneeded(e){this.addEventListener(_.NEGOTIATION_NEEDED,e)},setRemoteDescription:function(e){return n.setRemoteDescription(r,e)},addIceCandidate:function(e){return n.addIceCandidate(r,e)},getRemoteStreams:function(){return n.logger.warn("getRemoteStreams not implemented on proxy."),[]},getReceivers:function(){return n.getReceivers(r)},getSenders:function(){return n.getSenders(r)},addTrack:function(e){var t=[r].concat(Array.prototype.slice.call(arguments));return i.addTrack.apply(i,t)},addTransceiver:function(e,t){return n.addTransceiver(r,e,t)},getTransceivers:function(){return n.getTransceivers(r)},removeTrack:function(e){n.removeTrack(r,e)}};return this.pcProxies.set(r,o),this.sendApiRequest(p.NEWRTCPEERCONNECTION_API_NAME,[r,e,t],r).then(function(e){e&&n.updatePeerConnectionProxy(e)},function(e){n.logger.error("Error creating proxied RTCPeerConnection: "+e)}),this.preRegisterEvents(_,this.pcProxies.get(r),this.addPeerConnectionEventListener),this.pcProxies.get(r)}},{key:"preRegisterEvents",value:function(e,t,n){for(var r in e)"string"==typeof e[r]&&n.apply(this,[t.id,e[r],function(e){t.pendingEvents.has(e.eventName)||t.pendingEvents.set(e.eventName,[]),t.pendingEvents.get(e.eventName).push(e)}])}},{key:"updateAudioContextProxy",value:function(e){var t=this.audioContextProxies.get(e.id);Object.assign(t,e)}},{key:"updateAudioNodeProxy",value:function(e){var t=this.audioNodeProxies.get(e.id);Object.assign(t,e),e.stream&&this.makeStreamProxy(e.stream)}},{key:"makeAudioNodeProxy",value:function(e,t){var n=this;return{type:"proxy",id:t,context:this.audioContextProxies.get(e),connect:function(e,r,i){return n.sendApiRequest(p.AUDIO_NODE_CONNECT,[t,e,r,i]),e},disconnect:function(e,r,i){n.sendApiRequest(p.AUDIO_NODE_DISCONNECT,[t,e,r,i])}}}},{key:"createAudioNode",value:function(e,t,n){var r=this,i=crypto.randomUUID();return this.audioNodeProxies.set(i,this.makeAudioNodeProxy(e,i)),this.sendApiRequest(p.AUDIO_CTX_CREATE_AUDIO_NODE,[e,i,t,n],i).then(function(e){e&&r.updateAudioNodeProxy(e)},function(e){r.logger.error("Error creating proxied "+t+": "+e)}),this.audioNodeProxies.get(i)}},{key:"makeWorkerProxy",value:function(e){var t=this,n={id:e,pendingEvents:new Map,type:"proxy",postMessage:function(n,r){t.sendApiRequest(p.WORKER_POST_MESSAGE,[e,n,r])},terminate:function(){t.sendApiRequest(p.WORKER_TERMINATE,[e])},addEventListener:function(e,r,i){t.addWorkerEventListener(n.id,e,r,i)},removeEventListener:function(e,r){t.removeEventListener(n.id,e,r)}};return Object.defineProperty(n,"onerror",{set:function(e){t.addWorkerEventListener(n.id,v.ERROR,e)},get:function(){return null}}),Object.defineProperty(n,"onmessage",{set:function(e){t.addWorkerEventListener(n.id,v.MESSAGE,e)},get:function(){return null}}),Object.defineProperty(n,"onmessageerror",{set:function(e){t.addWorkerEventListener(n.id,v.MESSAGE_ERROR,e)},get:function(){return null}}),n}},{key:"createWorker",value:function(e,t){var n=this,r=crypto.randomUUID(),i=this.makeWorkerProxy(r);return this.workerProxies.set(r,i),fetch(e).then(function(e){e.blob().then(function(e){e.arrayBuffer().then(function(i){var o=R(i);n.sendApiRequest(p.CREATE_WORKER,[r,e.type,o,t]).then(function(e){n.logger.debug("Created worker: "+JSON.stringify(e))})})})}),this.logger.debug("Preregistering events for worker: "+JSON.stringify(i)),this.preRegisterEvents(v,i,this.addWorkerEventListener),i}},{key:"createAudioContext",value:function(){var e=this,t=crypto.randomUUID(),n=crypto.randomUUID();return this.audioContextProxies.set(t,{type:"proxy",id:t,destination:this.makeAudioNodeProxy(t,n),createGain:function(){var n=e.createAudioNode(t,"Gain",[]),r={setValueAtTime:function(t,i){return r.currentValue=t,e.sendApiRequest(p.AUDIO_PARAM_SET_VALUE_AT_TIME,[n.id,t,i]),r},linearRampToValueAtTime:function(t,i){return e.sendApiRequest(p.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME,[n.id,t,i]),r}};return Object.defineProperty(r,"value",{set:function(e){return r.setValueAtTime(e,0)},get:function(){return r.currentValue}}),n.gain=r,n},createOscillator:function(){var n=e.createAudioNode(t,"Oscillator",[]);n.start=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e.sendApiRequest(p.AUDIO_NODE_START,[n.id,t])},n.stop=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e.sendApiRequest(p.AUDIO_NODE_STOP,[n.id,t])},Object.defineProperty(n,"type",{set:function(t){n.currentType=t,e.sendApiRequest(p.AUDIO_NODE_SET_TYPE,[n.id,t])},get:function(){return n.currentType}});var r={setValueAtTime:function(t,i){return e.sendApiRequest(p.AUDIO_PARAM_SET_VALUE_AT_TIME,[n.id,t,i]),r}};return Object.defineProperty(r,"value",{set:function(e){return r.setValueAtTime(e,0)},get:function(){return r.currentValue}}),n.frequency=r,n},createMediaStreamSource:function(n){return e.createAudioNode(t,"MediaStreamSource",[n.proxy])},createAnalyser:function(){return e.createAudioNode(t,"Analyser",[])},createMediaStreamDestination:function(){var n=e.createAudioNode(t,"MediaStreamDestination",[]);return n.stream=e.makeStreamProxy({id:n.id,tracks:[{id:n.id,kind:"audio"}]}),n},close:function(){return e.sendApiRequest(p.AUDIO_CTX_CLOSE,[t])}}),this.sendApiRequest(p.NEW_AUDIO_CONTEXT,[t,n],t).then(function(t){t&&e.updateAudioContextProxy(t)},function(t){e.logger.error("Error creating proxied AudioContext: "+t)}),this.audioContextProxies.get(t)}},{key:"close",value:function(e){this.eventListeners.get(e).clear(),this.sendApiRequest(p.PC_CLOSE_API_NAME,[e])}},{key:"addStream",value:function(e,t){this.sendApiRequest(p.ADDSTREAM_API_NAME,[e,t.proxy])}},{key:"getStats",value:function(e,t){return"function"==typeof t?Promise.reject(new Error("callback based getStats is obsolete.")):this.sendApiRequest(p.GET_STATS_API_NAME,[e,t])}},{key:"createOffer",value:function(e,t){return this.sendApiRequest(p.CREATE_OFFER_API_NAME,[e,t])}},{key:"createAnswer",value:function(e,t){return this.sendApiRequest(p.CREATE_ANSWER_API_NAME,[e,t])}},{key:"setLocalDescription",value:function(e,t){return this.pcProxies.get(e).localDescription=t,this.sendApiRequest(p.SET_LOCAL_DESCRIPTION_API_NAME,[e,t])}},{key:"setRemoteDescription",value:function(e,t){return this.sendApiRequest(p.SET_REMOTE_DESCRIPTION_API_NAME,[e,t])}},{key:"handleAddEventListenerResponse",value:function(e){var t=this;e.eventName===_.SIG_STATE_CHANGE?this.updatePeerConnectionProxy(e):e.eventName===_.TRACK?(e.streams=e.streams.map(function(e){return t.makeStreamProxy(e)}),e.track=this.makeTrackProxy(e.track),this.updatePeerConnectionProxy(e)):(e.eventName===_.CONN_STATE_CHANGE||e.eventName===_.ICE_CONN_STATE_CHANGE||e.eventName===_.ICE_GATHER_STATE_CHANGE||e.eventName===_.ICE_CANDIDATE||e.eventName===_.NEGOTIATION_NEEDED)&&this.updatePeerConnectionProxy(e),this.fireUpEventHandlers(this.pcProxies.get(e.pcId),e),this.sendApiRequest(p.ADD_PC_EVENT_LISTENER,[e.pcId,e.eventName]).then(function(e){e&&t.handleAddEventListenerResponse(e)})}},{key:"fireUpEventHandlers",value:function(e,t){if(e&&this.eventListeners.get(e.id).has(t.eventName)){var n=e.pendingEvents;this.eventListeners.get(e.id).get(t.eventName).forEach(function(e,r){0===r?e(t):n.get(t.eventName).forEach(function(t){e(t)})}),n.set(t.eventName,[])}}},{key:"handleAddTrackEventListenerResponse",value:function(e){var t=this;"mute"!==e.eventName&&"unmute"!==e.eventName||(this.trackProxies.get(e.trackId).muted=e.muted),this.fireUpEventHandlers(this.trackProxies.get(e.trackId),e),this.sendApiRequest(p.ADD_TRACK_EVENT_LISTENER,[e.trackId,e.eventName]).then(function(e){e&&t.handleAddTrackEventListenerResponse(e)})}},{key:"handleAddDtmfEventListenerResponse",value:function(e){var t=this;this.fireUpEventHandlers(this.dtmfProxies.get(e.dtmfId),e),this.sendApiRequest(p.ADD_DTMF_EVENT_LISTENER,[e.dtmfId,e.eventName]).then(function(e){e&&t.handleAddDtmfEventListenerResponse(e)})}},{key:"handleAddWorkerEventListenerResponse",value:function(e){var t=this;this.fireUpEventHandlers(this.workerProxies.get(e.wId),e),this.sendApiRequest(p.ADD_WORKER_EVENT_LISTENER,[e.wId,e.eventName]).then(function(e){e&&t.handleAddWorkerEventListenerResponse(e)})}},{key:"addEventListener",value:function(e,t,n){this.eventListeners.has(e)||this.eventListeners.set(e,new Map),this.eventListeners.get(e).has(t)||this.eventListeners.get(e).set(t,[]),this.eventListeners.get(e).get(t).push(n)}},{key:"addPeerConnectionEventListener",value:function(e,t,n){var r=this;this.addEventListener(e,t,n),this.sendApiRequest(p.ADD_PC_EVENT_LISTENER,[e,t]).then(function(e){e&&r.handleAddEventListenerResponse(e)})}},{key:"addTrackEventListener",value:function(e,t,n,r){var i=this;this.addEventListener(e,t,n),this.sendApiRequest(p.ADD_TRACK_EVENT_LISTENER,[e,t,r]).then(function(e){e&&i.handleAddTrackEventListenerResponse(e)})}},{key:"addDtmfEventListener",value:function(e,t,n,r){var i=this;this.addEventListener(e,t,n),this.sendApiRequest(p.ADD_DTMF_EVENT_LISTENER,[e,t,r]).then(function(e){e&&i.handleAddDtmfEventListenerResponse(e)})}},{key:"addWorkerEventListener",value:function(e,t,n){var r=this;this.addEventListener(e,t,n),this.sendApiRequest(p.ADD_WORKER_EVENT_LISTENER,[e,t]).then(function(e){e&&r.handleAddWorkerEventListenerResponse(e)})}},{key:"removeEventListener",value:function(e,t,n){var r=this.eventListeners.get(e).get(t),i=r.indexOf(n);i>-1&&r.splice(i,1)}},{key:"addIceCandidate",value:function(e,t){var n=t?{sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}:null;return this.sendApiRequest(p.ADD_ICE_CANDIDATE_API_NAME,[e,n])}},{key:"createMediaElement",value:function(e){var t=this,n=crypto.randomUUID();this.sendApiRequest(p.CREATE_MEDIA_ELEMENT_API_NAME,[n,e],n).then(function(e){e&&(t.mediaElementProxies.get(e.id).sinkId=e.sinkId)});var r={id:n,type:"proxy",classList:new Set,isMuted:!1,play:function(){t.sendApiRequest(p.MEDIA_ELEMENT_PLAY_API_NAME,[n])},pause:function(){t.sendApiRequest(p.MEDIA_ELEMENT_PAUSE_API_NAME,[n])},setSinkId:function(e){return t.sendApiRequest(p.MEDIA_ELEMENT_SET_SINK_ID_API_NAME,[n,e])},remove:function(){return t.sendApiRequest(p.MEDIA_ELEMENT_REMOVE,[n])}};return this.mediaElementProxies.set(n,r),r.classList.remove=function(e){r.classList.delete(e)},Object.assign(r,e),Object.defineProperty(r,"srcObject",{set:function(e){r.stream=e,t.sendApiRequest(p.SET_MEDIA_SRC_OBJ_API_NAME,[r.id,e&&e.proxy?e.proxy:e])},get:function(){return r.stream}}),Object.defineProperty(r,"hidden",{set:function(e){t.sendApiRequest(p.SET_MEDIA_HIDDEN_API_NAME,[r.id,e])},get:function(){return r.hidden}}),Object.defineProperty(r,"volume",{set:function(e){t.sendApiRequest(p.SET_MEDIA_VOLUME_API_NAME,[r.id,e])},get:function(){return r.volume}}),Object.defineProperty(r,"muted",{set:function(e){r.isMuted=e,t.sendApiRequest(p.MEDIA_ELEMENT_MUTED,[r.id,e]).then(function(e){e&&(r.isMuted=e.muted)})},get:function(){return r.isMuted}}),r}},{key:"generateCertificate",value:function(e){return this.sendApiRequest(p.GENERATE_CERTIFICATE_API_NAME,[e])}},{key:"getReceivers",value:function(e){var t=this;return this.sendApiRequest(p.GET_RECEIVERS_API_NAME,[e]).then(function(e){e&&t.updatePCReceivers(e.pcId,e.receivers)}),this.pcProxies.get(e).receivers}},{key:"getSenders",value:function(e){var t=this;return this.sendApiRequest(p.GET_SENDERS_API_NAME,[e]).then(function(e){e&&t.updatePCSenders(e.pcId,e.senders)}),this.pcProxies.get(e).senders}},{key:"removeTrack",value:function(e,t){this.sendApiRequest(p.PC_REMOVE_TRACK_API_NAME,[e,t])}},{key:"getTransceivers",value:function(e){var t=this;return this.sendApiRequest(p.GET_TRANSCEIVERS_API_NAME,[e]).then(function(e){e&&t.updatePCTransceivers(e.pcId,e.transceivers)}),this.pcProxies.get(e).transceivers}},{key:"addTransceiver",value:function(e,t,n){var r=this,i=crypto.randomUUID(),o={type:"proxy",id:i,sender:this.makeSenderProxy({id:crypto.randomUUID()}),receiver:this.makeReceiverProxy({id:crypto.randomUUID()}),setCodecPreferences:function(e){r.sendApiRequest(p.TRANSCEIVER_SET_CODEC_PREFS,[i,e])}};return this.transceiverProxies.set(o.id,o),this.pcProxies.get(e).transceivers.push(o),this.pcProxies.get(e).receivers.push(o.receiver),this.pcProxies.get(e).senders.push(o.sender),this.sendApiRequest(p.ADD_TRANSCEIVER_API_NAME,[e,o,"string"==typeof t?t:this.makeTrackProxy(t),n]).then(function(e){e&&(r.updateTransceiverProxy(e),r.updatePCSenders(e.pcId,e.senders),r.updatePCReceivers(e.pcId,e.receivers),r.updatePCTransceivers(e.pcId,e.transceivers))}),o}},{key:"setLogger",value:function(e){this.logger=e}},{key:"overrideWebRTC",value:function(){var e=this;this.logger.info("Overriding WebRTC interfaces for the current webapp.");var t=this;navigator.mediaDevices.getUserMedia=function(t){return e.getUserMedia(t)},navigator.mediaDevices.enumerateDevices=function(){return e.enumerateDevices()},window.RTCPeerConnection=function(e,n){return t.createPeerConnection(e,n)},window.RTCPeerConnection.generateCertificate=function(e){return t.generateCertificate(e)},window.AudioContext=function(){return t.createAudioContext()},window.Worker=function(e,n){return t.createWorker(e,n)}}},{key:"removeStatusChangeEventListener",value:function(e){this.statusChangeEventListeners=this.statusChangeEventListeners.filter(function(t){return t!==e})}},{key:"addStatusChangeEventListener",value:function(e){this.statusChangeEventListeners.push(e)}},{key:"sendHelloRequest",value:function(){var e=(0,d.default)(c.default.mark(function e(){var n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.next=3,this.sendApiRequest(p.HELLO_API_NAME,[]);case 3:return r=e.sent,e.abrupt("return",(r&&!globalThis.DCVWebRTCRedirProxy&&(this.status=y.AVAILABLE,this.logger.info("Running in a DCV WebRTC redirection env, proxy version: "+t.versionStr+" - "+t.gitHash),this.logger.info("Client info: "+JSON.stringify(r)),window.addEventListener("beforeunload",function(e){var t={pcIds:[],streamIds:[],mediaElementIds:[],transceiverIds:[],senderIds:[],receiverIds:[],trackIds:[],workerIds:[]};n.pcProxies.forEach(function(e,n){t.pcIds.push(n)}),n.streamProxies.forEach(function(e,n){t.streamIds.push(n)}),n.trackProxies.forEach(function(e,n){t.trackIds.push(n)}),n.workerProxies.forEach(function(e,n){t.workerIds.push(n)}),n.mediaElementProxies.forEach(function(e,n){t.mediaElementIds.push(n)}),n.transceiverProxies.forEach(function(e,n){t.transceiverIds.push(n)}),n.senderProxies.forEach(function(e,n){t.senderIds.push(n)}),n.receiverProxies.forEach(function(e,n){t.receiverIds.push(n)}),n.sendApiRequest(p.UNLOAD_EVENT_NAME,[t])})),r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}],[{key:"setInitCallback",value:function(t,n){var r=globalThis.DCVWebRTCRedirProxy;if(r)t({success:!0,proxy:r});else{e.initCallbacks||(e.initCallbacks=new Map);var i=setTimeout(function(t){t({success:!1,error:"Failed to initialize DCVWebRTCPeerConnectionProxy in "+n+"ms"}),e.initCallbacks.delete(t)},n,t);e.initCallbacks.set(t,i)}}}]),e}();function P(e,t,n){globalThis.DCVWebRTCRedirProxy=t,I.initCallbacks?(I.initCallbacks.forEach(function(r,i){clearTimeout(r),i({success:e,proxy:t,error:n})}),I.initCallbacks.clear()):h.debug("No DCVWebRTCPeerConnectionProxy.initCallback was specified.")}try{window.DCVWebRTCPeerConnectionProxy=I;var A=new I({logger:h});A.sendHelloRequest().then(function(e){h.debug("Successfully received hello response from client: "+JSON.stringify(e)),A.clientInfo=e,A.resetHeartbeat(null),P(!0,A)}).catch(function(e){var t="Running in an invalid dcv webrtc env, skipping setting up proxy: "+JSON.stringify(e);h.debug(t),P(!1,null,t)})}catch(e){var M=e.message;P(!1,null,M),h.debug("Skipping setting up proxy in client env: "+M)}e.DCVWebRTCRedirClient=function(){function e(n){(0,l.default)(this,e),this.version=t,this.config=n,this.logger=n.logger?n.logger:h,this.channel=n.channel,this.decoder=new TextDecoder("utf-8"),this.messageBuffer=null,this.pcs=new Map,this.pcPromises=new Map,this.audioContexts=new Map,this.audioNodes=new Map,this.workers=new Map,this.workerPromises=new Map,this.certs=new Map,this.streams=new Map,this.tracks=new Map,this.offers=new Map,this.answers=new Map,this.remoteDescriptions=new Map,this.mediaElements=new Map,this.senders=new Map,this.dtmfSenders=new Map,this.receivers=new Map,this.transceivers=new Map,this.logger.info("Created WebRTC Redirection Client version: "+t.versionStr+" - "+t.gitHash)}return(0,u.default)(e,[{key:"encodeBase64",value:function(e){return R(e)}},{key:"decodeBase64",value:function(e){return T(e)}},{key:"getVersion",value:function(){return this.version}},{key:"concatUint8Arrays",value:function(e){var t=e.reduce(function(e,t){return e+t.byteLength},0),n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(e,r),r+=e.byteLength}),n}},{key:"parseHeader",value:function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}},{key:"onMessageReceived",value:function(e){this.logger.debug("onMessageReceived, binaryPayload.byteLength: "+e.byteLength);try{var t=0;for(null===this.messageBuffer?this.messageBuffer=new Uint8Array(e):this.messageBuffer=this.concatUint8Arrays([this.messageBuffer,new Uint8Array(e)]),this.messageBuffer.byteLength>=4&&(t=this.parseHeader(this.messageBuffer));t>0&&this.messageBuffer.byteLength>=t+4;){var n=4+t,r=this.messageBuffer.slice(4,n);this.logger.debug("Decoding payload: ",r);var i=this.decoder.decode(r);this.logger.debug("Received message: "+i);var o=JSON.parse(i);this.logger.debug("Received json: ",o),this.handleMessage(o),this.messageBuffer=this.messageBuffer.slice(n),t=this.messageBuffer.byteLength>=4?this.parseHeader(this.messageBuffer):0}}catch(e){this.logger.error("Failed to parse JSON from binaryPayload: "+e),this.messageBuffer=null}}},{key:"getPeerConnection",value:function(e){var t=this;return this.pcs.has(e)?this.pcs.get(e):(this.pcPromises.has(e)||this.pcPromises.set(e,[]),new Promise(function(n,r){t.pcPromises.get(e).push({resolve:n,reject:r})}))}},{key:"closePeerConnection",value:function(e){var t=this;if(this.pcs.has(e)){var n=this.pcs.get(e);n.getTransceivers().forEach(function(e){e.sender&&(e.sender.dtmf&&t.dtmfSenders.forEach(function(n,r){n===e.sender.dtmf&&t.dtmfSenders.delete(r)}),t.senders.forEach(function(n,r){n===e.sender&&t.senders.delete(r)})),e.receiver&&t.receivers.forEach(function(n,r){n===e.receiver&&t.receivers.delete(r)}),t.transceivers.forEach(function(n,r){n===e&&t.transceivers.delete(r)})}),n.getSenders().forEach(function(e){t.senders.forEach(function(n,r){n===e&&t.senders.delete(r)})}),n.getReceivers(function(e){t.receivers.forEach(function(n,r){n===e&&t.receivers.delete(r)})}),n.localDescription&&(this.offers.forEach(function(e,r){n.localDescription.type===e.type&&n.localDescription.sdp===e.sdp&&t.offers.delete(r)}),this.answers.forEach(function(e,r){n.localDescription.type===e.type&&n.localDescription.sdp===e.sdp&&t.offers.delete(r)})),n.remoteDescription&&this.remoteDescriptions.forEach(function(e,r){n.remoteDescription.type===e.type&&n.remoteDescription.sdp===e.sdp&&t.remoteDescriptions.delete(r)}),this.pcPromises.has(e)&&(this.pcPromises.get(e).forEach(function(e){e.reject(null)}),this.pcPromises.delete(e)),n.close(),this.pcs.delete(e)}}},{key:"getPendingEvent",value:function(e,t){return e.pendingEvents.has(t)&&e.pendingEvents.get(t).length>0?e.pendingEvents.get(t).shift():(e.eventPromises.has(t)||e.eventPromises.set(t,[]),new Promise(function(n,r){e.eventPromises.get(t).push({resolve:n,reject:r})}))}},{key:"getStream",value:function(e){return this.streams.get(e)}},{key:"makeTrackTO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.id?e.id:crypto.randomUUID();return this.tracks.set(t,e),{type:"proxy",contentHint:e.contentHint,enabled:e.enabled,id:t,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,settings:e.getSettings()}}},{key:"makeStreamTO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.id?e.id:crypto.randomUUID(),n=this;this.streams.set(t,e);var r=e.getTracks().map(function(e){return n.makeTrackTO(e)});return{type:"proxy",id:t,active:e.active,tracks:r}}},{key:"makeSyncronizationSourceTO",value:function(e){return{audioLevel:e.audioLevel,rtpTimestamp:e.rtpTimestamp,source:e.source,timestamp:e.timestamp}}},{key:"makeReceiverTO",value:function(e){var t=this,n=e.getSynchronizationSources();n=n.map(function(e){return t.makeSyncronizationSourceTO(e)});var r={id:e.id?e.id:crypto.randomUUID(),type:"proxy",track:e.track?this.makeTrackTO(e.track):null,synchronizationSources:n,stats:[]};return e.id=r.id,this.receivers.set(r.id,e),r}},{key:"makeDTMFSenderTO",value:function(e){var t={id:e.id?e.id:crypto.randomUUID(),type:"proxy",toneBuffer:e.toneBuffer};return e.id=t.id,this.dtmfSenders.set(t.id,e),t}},{key:"makeSenderTO",value:function(e){var t={id:e.id?e.id:crypto.randomUUID(),type:"proxy",track:e.track?this.makeTrackTO(e.track):null,dtmf:e.dtmf?this.makeDTMFSenderTO(e.dtmf):null};return e.id=t.id,this.senders.set(t.id,e),t}},{key:"makeTransceiverTO",value:function(e){return{id:e.id,type:"proxy",currentDirection:e.currentDirection,direction:e.direction,mid:e.mid,receiver:e.receiver?this.makeReceiverTO(e.receiver):null,sender:e.sender?this.makeSenderTO(e.sender):null,stopped:e.stopped}}},{key:"findProxySubject",value:function(e){return this.pcs.has(e)?this.pcs.get(e):this.audioContexts.has(e)?this.audioContexts.get(e):this.audioNodes.has(e)?this.audioNodes.get(e):this.workers.has(e)?this.workers.get(e):this.certs.has(e)?this.certs.get(e):this.streams.has(e)?this.streams.get(e):this.offers.has(e)?this.offers.get(e):this.answers.has(e)?this.answers.get(e):this.remoteDescriptions.has(e)?this.remoteDescriptions.get(e):this.mediaElements.has(e)?this.mediaElements.get(e):this.senders.has(e)?this.senders.get(e):this.dtmfSenders.has(e)?this.dtmfSenders.get(e):this.receivers.has(e)?this.receivers.get(e):this.transceivers.has(e)?this.transceivers.get(e):this.tracks.has(e)?this.tracks.get(e):null}},{key:"traverse",value:function(e,t){if("object"==(void 0===e?"undefined":(0,f.default)(e)))for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t.apply(this,[e,n,e[n]]),null!==e[n]&&"object"==(0,f.default)(e[n])&&this.traverse(e[n],t))}},{key:"getWorker",value:function(e){var t=this;return this.workers.has(e)?this.workers.get(e):(this.workerPromises.has(e)||this.workerPromises.set(e,[]),new Promise(function(n,r){t.workerPromises.get(e).push({resolve:n,reject:r})}))}},{key:"gatherPeerConnectionState",value:function(e,t){var n=this;e.canTrickleIceCandidates=t.canTrickleIceCandidates,e.connectionState=t.connectionState,e.currentLocalDescription=t.currentLocalDescription,e.currentRemoteDescription=t.currentRemoteDescription,e.iceConnectionState=t.iceConnectionState,e.iceGatheringState=t.iceGatheringState,e.iceGatheringState=t.iceGatheringState,e.localDescription=t.localDescription,e.peerIdentity=t.peerIdentity,e.pendingLocalDescription=t.pendingLocalDescription,e.pendingRemoteDescription=t.pendingRemoteDescription,e.remoteDescription=t.remoteDescription,e.sctp=t.sctp,e.signalingState=t.signalingState,e.configuration=t.getConfiguration(),e.transceivers=t.getTransceivers().map(function(e){return n.makeTransceiverTO(e)}),e.senders=t.getSenders().map(function(e){return n.makeSenderTO(e)}),e.receivers=t.getReceivers().map(function(e){return n.makeReceiverTO(e)})}},{key:"callWebRTCApi",value:function(){var e=(0,d.default)(c.default.mark(function e(t,n,r){var i,o,d,l,u,f,h,y,b,C,S,E,R,w,k,I,P,A,M,D,O,x,N,U,j,F,L,V,W,B,H,z,G,q,J,K,Z,Y,X,$,Q,ee,te,ne,re,ie,oe,ae,se,ce,de,le,ue,fe,he,pe,_e,ge,me,ve,ye,be,Ce,Se,Ee,Re,Te,we,ke,Ie,Pe,Ae,Me,De,Oe,xe,Ne,Ue,je,Fe,Le,Ve,We,Be,He,ze,Ge,qe,Je,Ke,Ze,Ye,Xe,$e,Qe,et,tt,nt,rt,it,ot,at,st,ct,dt,lt,ut,ft,ht,pt,_t,gt,mt,vt,yt,bt,Ct,St,Et,Rt,Tt,wt,kt,It,Pt,At,Mt,Dt,Ot,xt,Nt,Ut,jt,Ft,Lt,Vt,Wt,Bt,Ht,zt,Gt,qt,Jt,Kt,Zt,Yt,Xt,$t,Qt,en,tn,nn,rn,on,an,sn,cn,dn,ln,un,fn,hn,pn,_n,gn,mn,vn,yn,bn,Cn,Sn,En,Rn,Tn,wn,kn,In,Pn,An,Mn,Dn,On,xn,Nn,Un,jn,Fn,Ln,Vn,Wn,Bn,Hn,zn,Gn,qn,Jn,Kn,Zn,Yn,Xn,$n,Qn,er,tr,nr,rr,ir,or,ar,sr,cr,dr,lr,ur,fr,hr,pr,_r,gr,mr,vr,yr,br,Cr,Sr,Er,Rr,Tr,wr,kr,Ir,Pr,Ar,Mr,Dr,Or,xr,Nr,Ur,jr,Fr,Lr,Vr,Wr,Br,Hr,zr,Gr,qr,Jr,Kr,Zr;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=this,e.t0=t,e.next=e.t0===p.HELLO_API_NAME?4:e.t0===p.GETUSERMEDIA_API_NAME?5:e.t0===p.ENUMERATEDEVICES_API_NAME?11:e.t0===p.STREAM_ADD_TRACK?15:e.t0===p.STREAM_REMOVE_TRACK?17:e.t0===p.GENERATE_CERTIFICATE_API_NAME?19:e.t0===p.NEWRTCPEERCONNECTION_API_NAME?25:e.t0===p.PC_GET_CONFIGURATION?31:e.t0===p.CREATE_WORKER?35:e.t0===p.WORKER_TERMINATE?37:e.t0===p.WORKER_POST_MESSAGE?39:e.t0===p.NEW_AUDIO_CONTEXT?47:e.t0===p.AUDIO_CTX_CREATE_AUDIO_NODE?49:e.t0===p.AUDIO_CTX_CLOSE?59:e.t0===p.AUDIO_NODE_CONNECT?62:e.t0===p.AUDIO_NODE_DISCONNECT?64:e.t0===p.AUDIO_NODE_SET_TYPE?66:e.t0===p.AUDIO_NODE_START?69:e.t0===p.AUDIO_NODE_STOP?72:e.t0===p.AUDIO_PARAM_SET_VALUE_AT_TIME?75:e.t0===p.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME?78:e.t0===p.GET_RECEIVERS_API_NAME?81:e.t0===p.GET_SENDERS_API_NAME?88:e.t0===p.INSERT_DTMF_API_NAME?95:e.t0===p.GET_TRANSCEIVERS_API_NAME?97:e.t0===p.TRANSCEIVER_SET_CODEC_PREFS?103:e.t0===p.ADD_TRACK_API_NAME?104:e.t0===p.ADD_TRANSCEIVER_API_NAME?121:e.t0===p.PC_CLOSE_API_NAME?134:e.t0===p.ADDSTREAM_API_NAME?136:e.t0===p.GET_STATS_API_NAME?142:e.t0===p.GET_SENDER_STATS_API_NAME?153:e.t0===p.GET_RECEIVER_STATS_API_NAME?161:e.t0===p.REPLACE_SENDER_TRACK_API_NAME?169:e.t0===p.PC_REMOVE_TRACK_API_NAME?175:e.t0===p.CREATE_OFFER_API_NAME?183:e.t0===p.CREATE_ANSWER_API_NAME?193:e.t0===p.SET_LOCAL_DESCRIPTION_API_NAME?203:e.t0===p.SET_REMOTE_DESCRIPTION_API_NAME?213:e.t0===p.ADD_ICE_CANDIDATE_API_NAME?222:e.t0===p.ADD_PC_EVENT_LISTENER?228:e.t0===p.ADD_TRACK_EVENT_LISTENER?243:e.t0===p.ADD_WORKER_EVENT_LISTENER?255:e.t0===p.ADD_DTMF_EVENT_LISTENER?270:e.t0===p.CREATE_MEDIA_ELEMENT_API_NAME?280:e.t0===p.MEDIA_ELEMENT_SET_SINK_ID_API_NAME?285:e.t0===p.SET_MEDIA_SRC_OBJ_API_NAME?291:e.t0===p.MEDIA_ELEMENT_MUTED?293:e.t0===p.SET_MEDIA_HIDDEN_API_NAME?295:e.t0===p.SET_MEDIA_VOLUME_API_NAME?297:e.t0===p.MEDIA_ELEMENT_PLAY_API_NAME?299:e.t0===p.MEDIA_ELEMENT_PAUSE_API_NAME?301:e.t0===p.MEDIA_ELEMENT_REMOVE?303:e.t0===p.TOGGLE_TRACK_ENABLED_API_NAME?305:e.t0===p.TRACK_STOP_API_NAME?307:e.t0===p.TRACK_GET_SETTINGS?309:e.t0===p.SENDER_CREATE_ENCODED_STREAMS?311:e.t0===p.RECEIVER_CREATE_ENCODED_STREAMS?316:e.t0===p.UNLOAD_EVENT_NAME?321:323;break;case 4:return e.abrupt("return",{version:this.version,platform:"web",userAgent:navigator.userAgent});case 5:return o=(0,s.default)(r,1),d=o[0],e.next=9,navigator.mediaDevices.getUserMedia(d);case 9:return l=e.sent,e.abrupt("return",this.makeStreamTO(l));case 11:return e.next=13,navigator.mediaDevices.enumerateDevices();case 13:return e.t1=function(e){return e.toJSON()},e.abrupt("return",e.sent.map(e.t1));case 15:return u=(0,s.default)(r,2),f=u[0],h=u[1],y=this.streams.get(f),b=this.tracks.get(h),e.abrupt("return",(y&&b&&y.addTrack(b),{}));case 17:return C=(0,s.default)(r,2),S=C[0],E=C[1],R=this.streams.get(S),w=this.tracks.get(E),e.abrupt("return",(R&&w&&R.removeTrack(w),{}));case 19:return k=(0,s.default)(r,1),I=k[0],e.next=23,RTCPeerConnection.generateCertificate(I);case 23:return P=e.sent,e.abrupt("return",(this.certs.set(n,P),{type:"proxy",id:n,expires:P.expires,fingerprints:P.getFingerprints()}));case 25:return A=(0,s.default)(r,3),M=A[0],D=A[1],O=A[2],D&&D.certificates&&(x=D.certificates.map(function(e){return i.certs.get(e.id)}),D.certificates=x),N=new RTCPeerConnection(D,O),this.pcs.set(M,N),this.pcPromises.has(M)&&(this.pcPromises.get(M).forEach(function(e){e.resolve(e)}),this.pcPromises.set(M,[])),U={type:"proxy",pcId:M},e.abrupt("return",(this.gatherPeerConnectionState(U,N),U));case 31:return j=(0,s.default)(r,1),F=j[0],e.next=34,this.getPeerConnection(F);case 34:return e.abrupt("return",e.sent.getConfiguration());case 35:return L=(0,s.default)(r,4),V=L[0],W=L[1],B=L[2],H=L[3],z=T(B),G=new Blob([z],{type:W}),q=URL.createObjectURL(G),J=new Worker(q,H),e.abrupt("return",(this.workers.set(V,J),this.workerPromises.has(V)&&(this.workerPromises.get(V).forEach(function(e){e.resolve(J)}),this.workerPromises.set(V,[])),{type:"proxy",id:V}));case 37:return K=(0,s.default)(r,1),Z=K[0],e.abrupt("return",(this.workers.has(Z)&&(this.workers.get(Z).terminate(),this.workerPromises.has(Z)&&this.workerPromises.get(Z).forEach(function(e){e.reject(null)}),this.workerPromises.delete(Z),this.workers.delete(Z)),{}));case 39:return Y=(0,s.default)(r,3),X=Y[0],$=Y[1],Q=Y[2],e.next=45,this.getWorker(X);case 45:return ee=e.sent,e.abrupt("return",(this.logger.debug("Message before traversing: ",JSON.stringify($)),this.traverse($,function(e,t,n){"proxy"===n.type&&n.id&&(e[t]=i.findProxySubject(n.id))}),this.logger.debug("Message after traversing: ",$),this.logger.debug("Options before traversing: ",JSON.stringify(Q)),this.traverse(Q,function(e,t,n){"proxy"===n.type&&n.id&&(e[t]=i.findProxySubject(n.id))}),this.logger.debug("Options after traversing: ",Q),ee.postMessage($,Q),{type:"proxy",id:X}));case 47:return te=(0,s.default)(r,2),ne=te[0],re=te[1],ie=new AudioContext,e.abrupt("return",(this.audioContexts.set(ne,ie),this.audioNodes.set(re,ie.destination),{type:"proxy",id:ne,baseLatency:ie.baseLatency,currentTime:ie.currentTime,outputLatency:ie.outputLatency,sampleRate:ie.sampleRate,sinkId:ie.sinkId,state:ie.state}));case 49:if(oe=(0,s.default)(r,4),ae=oe[0],se=oe[1],ce=oe[2],de=oe[3],!this.audioContexts.has(ae)){e.next=58;break}return le=this.audioContexts.get(ae),ue=le["create"+ce],de=de.map(function(e){return"proxy"===e.type?i.findProxySubject(e.id):e}),fe=ue.apply(le,de),this.audioNodes.set(se,fe),he=null,fe.stream&&(pe=fe.stream.getTracks().map(function(e){return i.makeTrackTO(e,se)}),(he=this.makeStreamTO(fe.stream,se)).tracks=pe),e.abrupt("return",{id:se,channelCount:fe.channelCount,channelCountMode:fe.channelCountMode,channelInterpretation:fe.channelInterpretation,numberOfInputs:fe.numberOfInputs,numberOfOutputs:fe.numberOfOutputs,fftSize:fe.fftSize,frequencyBinCount:fe.frequencyBinCount,maxDecibels:fe.maxDecibels,minDecibels:fe.minDecibels,smoothingTimeConstant:fe.smoothingTimeConstant,stream:he});case 58:return e.abrupt("return",{});case 59:return _e=(0,s.default)(r,1),ge=_e[0],this.audioContexts.has(ge)&&(this.audioContexts.get(ge).close(),this.audioContexts.delete(ge)),e.abrupt("return",{});case 62:return me=(0,s.default)(r,4),ve=me[0],ye=me[1],be=me[2],Ce=me[3],Se=this.audioNodes.get(ve),Ee=this.findProxySubject(ye.id),e.abrupt("return",(Se&&Ee&&Se.connect(Ee,be||0,Ce||0),{}));case 64:return Re=(0,s.default)(r,4),Te=Re[0],we=Re[1],ke=Re[2],Ie=Re[3],Pe=this.audioNodes.get(Te),Ae=this.findProxySubject(we.id),e.abrupt("return",(Pe&&Ae&&Pe.disconnect(Ae,ke||0,Ie||0),{}));case 66:return Me=(0,s.default)(r,2),De=Me[0],Oe=Me[1],this.audioNodes.has(De)&&(this.audioNodes.get(De).type=Oe),e.abrupt("return",{});case 69:return xe=(0,s.default)(r,2),Ne=xe[0],Ue=xe[1],this.audioNodes.has(Ne)&&this.audioNodes.get(Ne).start(Ue),e.abrupt("return",{});case 72:return je=(0,s.default)(r,2),Fe=je[0],Le=je[1],this.audioNodes.has(Fe)&&this.audioNodes.get(Fe).stop(Le),e.abrupt("return",{});case 75:return Ve=(0,s.default)(r,3),We=Ve[0],Be=Ve[1],He=Ve[2],this.audioNodes.has(We)&&((ze=this.audioNodes.get(We)).gain?ze.gain.setValueAtTime(Be,He||ze.context.currentTime):ze.frequency&&ze.frequency.setValueAtTime(Be,He||ze.context.currentTime)),e.abrupt("return",{});case 78:return Ge=(0,s.default)(r,3),qe=Ge[0],Je=Ge[1],Ke=Ge[2],this.audioNodes.has(qe)&&(Ze=this.audioNodes.get(qe)).frequency&&Ze.frequency.linearRampToValueAtTime(Je,Ke||Ze.context.currentTime),e.abrupt("return",{});case 81:return Ye=(0,s.default)(r,1),Xe=Ye[0],e.t2=Xe,e.next=85,this.getPeerConnection(Xe);case 85:return e.t3=function(e){return i.makeReceiverTO(e)},e.t4=e.sent.getReceivers().map(e.t3),e.abrupt("return",{pcId:e.t2,receivers:e.t4});case 88:return $e=(0,s.default)(r,1),Qe=$e[0],e.t5=Qe,e.next=92,this.getPeerConnection(Qe);case 92:return e.t6=function(e){return i.makeSenderTO(e)},e.t7=e.sent.getSenders().map(e.t6),e.abrupt("return",{pcId:e.t5,senders:e.t7});case 95:return et=(0,s.default)(r,4),tt=et[0],nt=et[1],rt=et[2],it=et[3],ot=this.dtmfSenders.get(tt),e.abrupt("return",(ot&&ot.insertDTMF(nt,rt,it),{}));case 97:return at=(0,s.default)(r,1),st=at[0],e.next=101,this.getPeerConnection(st);case 101:return ct=e.sent.getTransceivers(),e.abrupt("return",(ct=ct.map(function(e){return e.id=e.id?e.id:crypto.randomUUID(),i.makeTransceiverTO(e)}),{pcId:st,transceivers:ct}));case 103:return e.abrupt("return",{});case 104:return dt=(0,a.default)(r),lt=dt[0],ut=dt[1],ft=dt[2],ht=dt.slice(3),e.next=111,this.getPeerConnection(ut);case 111:if(pt=e.sent,_t=[],ht.forEach(function(e){var t=i.streams.get(e.proxy.id);t&&_t.push(t)}),!(gt=this.tracks.get(ft.id))){e.next=120;break}return mt=[gt].concat(_t),(vt=pt.addTrack.apply(pt,mt)).id=lt,yt=this.makeSenderTO(vt),e.abrupt("return",(yt.pcId=ut,yt.senders=pt.getSenders().map(function(e){return i.makeSenderTO(e)}),yt.receivers=pt.getReceivers().map(function(e){return i.makeReceiverTO(e)}),yt.transceivers=pt.getTransceivers().map(function(e){return i.makeTransceiverTO(e)}),yt));case 120:return e.abrupt("return",{});case 121:return bt=(0,s.default)(r,4),Ct=bt[0],St=bt[1],Et=bt[2],Rt=bt[3],e.next=128,this.getPeerConnection(Ct);case 128:return Tt=e.sent,"string"!=typeof Et&&(Et=this.tracks.get(Et.id)),Rt&&Rt.streams&&(wt=[],Rt.streams.forEach(function(e){if(e.proxy){var t=i.streams.get(e.proxy.id);wt.push(t)}}),Rt.streams=wt),(kt=Tt.addTransceiver(Et,Rt)).id=St.id,this.transceivers.set(St.id,kt),kt.sender&&(kt.sender.id=St.sender.id,this.senders.set(St.sender.id,kt.sender)),kt.receiver&&(kt.receiver.id=St.receiver.id,this.receivers.set(St.receiver.id,kt.receiver)),It=this.makeTransceiverTO(kt),e.abrupt("return",(It.pcId=Ct,It.senders=Tt.getSenders().map(function(e){return i.makeSenderTO(e)}),It.receivers=Tt.getReceivers().map(function(e){return i.makeReceiverTO(e)}),It.transceivers=Tt.getTransceivers().map(function(e){return i.makeTransceiverTO(e)}),It));case 134:return Pt=(0,s.default)(r,1),At=Pt[0],e.abrupt("return",(this.closePeerConnection(At),{}));case 136:return Mt=(0,s.default)(r,2),Dt=Mt[0],Ot=Mt[1],xt=this.streams.get(Ot.id),e.next=139,this.getPeerConnection(Dt);case 139:return e.t8=xt,e.sent.addStream(e.t8),e.abrupt("return",Ot);case 142:return Nt=(0,s.default)(r,2),Ut=Nt[0],jt=Nt[1],e.next=147,this.getPeerConnection(Ut);case 147:return Ft=e.sent,e.next=150,Ft.getStats(jt);case 150:return Lt=e.sent,Vt=[],e.abrupt("return",(Lt.forEach(function(e){var t=Object.assign({},e);Vt.push(t)}),Vt));case 153:if(Wt=(0,s.default)(r,1),Bt=Wt[0],!this.senders.has(Bt)){e.next=160;break}return e.next=157,this.senders.get(Bt).getStats();case 157:return Ht=e.sent,zt=[],e.abrupt("return",(Ht.forEach(function(e){var t=Object.assign({},e);zt.push(t)}),zt));case 160:return e.abrupt("return",[]);case 161:if(Gt=(0,s.default)(r,1),qt=Gt[0],!this.receivers.has(qt)){e.next=168;break}return e.next=165,this.receivers.get(qt).getStats();case 165:return Jt=e.sent,Kt=[],e.abrupt("return",(Jt.forEach(function(e){var t={id:e.id?e.id:crypto.randomUUID(),type:e.type,concealedSamples:e.concealedSamples};Kt.push(t)}),Kt));case 168:return e.abrupt("return",{});case 169:if(Zt=(0,s.default)(r,2),Yt=Zt[0],Xt=Zt[1],$t=this.senders.get(Yt),Qt=Xt?this.tracks.get(Xt.id):null,e.t9=Qt&&$t,!e.t9){e.next=174;break}return e.next=174,$t.replaceTrack(Qt);case 174:return e.abrupt("return",{});case 175:return en=(0,s.default)(r,2),tn=en[0],nn=en[1],e.next=180,this.getPeerConnection(tn);case 180:return rn=e.sent,on=this.senders.get(nn.id),e.abrupt("return",(on&&rn.removeTrack(on),{}));case 183:return an=(0,s.default)(r,2),sn=an[0],cn=an[1],e.next=188,this.getPeerConnection(sn);case 188:return dn=e.sent,e.next=191,dn.createOffer(cn);case 191:return ln=e.sent,e.abrupt("return",(this.offers.set(n,ln),{id:n,type:ln.type,sdp:ln.sdp}));case 193:return un=(0,s.default)(r,2),fn=un[0],hn=un[1],e.next=198,this.getPeerConnection(fn);case 198:return pn=e.sent,e.next=201,pn.createAnswer(hn);case 201:return _n=e.sent,e.abrupt("return",(this.answers.set(n,_n),{id:n,type:_n.type,sdp:_n.sdp}));case 203:if(gn=(0,s.default)(r,2),mn=gn[0],vn=gn[1],yn="offer"===vn.type?this.offers:this.answers,!(bn=vn.id?yn.get(vn.id):vn)){e.next=212;break}return bn.sdp=vn.sdp,e.next=208,this.getPeerConnection(mn);case 208:return Cn=e.sent,e.next=211,Cn.setLocalDescription(bn);case 211:return e.abrupt("return",vn);case 212:return e.abrupt("return",{});case 213:return Sn=(0,s.default)(r,2),En=Sn[0],Rn=Sn[1],e.next=218,this.getPeerConnection(En);case 218:return Tn=e.sent,e.next=221,Tn.setRemoteDescription(Rn);case 221:return e.abrupt("return",Rn);case 222:return wn=(0,s.default)(r,2),kn=wn[0],In=wn[1],Pn=In?new RTCIceCandidate({sdpMLineIndex:In.sdpMLineIndex,candidate:In.candidate}):null,e.next=225,this.getPeerConnection(kn);case 225:return e.t10=Pn,e.sent.addIceCandidate(e.t10),e.abrupt("return",In);case 228:return An=(0,s.default)(r,2),Mn=An[0],Dn=An[1],e.next=233,this.getPeerConnection(Mn);case 233:if((On=e.sent).pendingEvents||(On.pendingEvents=new Map),On.eventPromises||(On.eventPromises=new Map),!On.pendingEvents.has(Dn)){e.next=241;break}return e.next=237,this.getPendingEvent(On,Dn);case 237:xn=e.sent,this.sendEvent(p.ADD_PC_EVENT_LISTENER,n,xn),e.next=242;break;case 241:On[Dn]||(Nn=function(e){var t=null;if(e.type===_.ICE_CANDIDATE){i.logger.debug("event: ",e);var r=e.candidate,o=null;r&&(o={sdpMLineIndex:r.sdpMLineIndex,sdpMid:r.sdpMid,candidate:r.candidate,type:r.type,foundation:r.foundation,protocol:r.protocol,address:r.address,port:r.port,priority:r.priority,url:r.url,relayProtocol:r.relayProtocol,component:r.compoonent,relatedAddress:r.relatedAddress,relatedPort:r.relatedPort,tcpType:r.tcpType,usernameFragment:r.usernameFragment}),t={pcId:Mn,eventName:e.type,type:"proxy",candidate:o},i.gatherPeerConnectionState(t,On)}else e.type===_.SIG_STATE_CHANGE?(t={pcId:Mn,eventName:e.type,type:"proxy"},i.gatherPeerConnectionState(t,On)):e.type===_.TRACK?((t={pcId:Mn,eventName:e.type,type:"proxy",streams:[],senders:[],receivers:[],track:i.makeTrackTO(e.track)}).streams=e.streams.map(function(e){return i.makeStreamTO(e)}),i.gatherPeerConnectionState(t,On)):e.type===_.CONN_STATE_CHANGE||e.type===_.ICE_CONN_STATE_CHANGE||e.type===_.ICE_GATHER_STATE_CHANGE||e.type===_.NEGOTIATION_NEEDED?(t={pcId:Mn,eventName:e.type,type:"proxy"},i.gatherPeerConnectionState(t,On)):i.logger.warn("Ignored event, type: "+e.type+", event: "+JSON.stringify(e));t&&i.processPendingEvents(On,e,t,p.ADD_PC_EVENT_LISTENER,n)},On[Dn]=Nn,On.addEventListener(Dn,Nn));case 242:return e.abrupt("return",null);case 243:if(Un=(0,s.default)(r,3),jn=Un[0],Fn=Un[1],Ln=Un[2],!(Vn=this.tracks.get(jn))){e.next=254;break}if(Vn.pendingEvents||(Vn.pendingEvents=new Map),Vn.eventPromises||(Vn.eventPromises=new Map),!Vn.pendingEvents.has(Fn)){e.next=252;break}return e.next=248,this.getPendingEvent(Vn,Fn);case 248:Wn=e.sent,this.sendEvent(p.ADD_TRACK_EVENT_LISTENER,n,Wn),e.next=253;break;case 252:Vn[Fn]||(Bn=function(e){if(Object.values(g).includes(Fn)){var t={trackId:jn,eventName:e.type,type:"proxy"};t&&i.processPendingEvents(Vn,e,t,p.ADD_TRACK_EVENT_LISTENER,n)}else i.logger.warn("Ignored event: "+JSON.stringify(e))},Vn[Fn]=Bn,Vn.addEventListener(Fn,Bn,Ln));case 253:return e.abrupt("return",null);case 254:return e.abrupt("return",{});case 255:return Hn=(0,s.default)(r,2),zn=Hn[0],Gn=Hn[1],e.next=260,this.getWorker(zn);case 260:if((qn=e.sent).pendingEvents||(qn.pendingEvents=new Map),qn.eventPromises||(qn.eventPromises=new Map),!qn.pendingEvents.has(Gn)){e.next=268;break}return e.next=264,this.getPendingEvent(qn,Gn);case 264:Jn=e.sent,this.sendEvent(p.ADD_WORKER_EVENT_LISTENER,n,Jn),e.next=269;break;case 268:qn[Gn]||(Kn=function(e){if(i.logger.debug("Received event: ",e),Object.values(v).includes(Gn)){var t={wId:zn,eventName:e.type,type:"proxy",data:e.data};t&&i.processPendingEvents(qn,e,t,p.ADD_WORKER_EVENT_LISTENER,n)}else i.logger.warn("Ignored event: "+JSON.stringify(e),e)},qn[Gn]=Kn,qn.addEventListener(Gn,Kn));case 269:return e.abrupt("return",null);case 270:if(Zn=(0,s.default)(r,3),Yn=Zn[0],Xn=Zn[1],$n=Zn[2],(Qn=this.dtmfSenders.get(Yn)).pendingEvents||(Qn.pendingEvents=new Map),Qn.eventPromises||(Qn.eventPromises=new Map),!Qn.pendingEvents.has(Xn)){e.next=278;break}return e.next=274,this.getPendingEvent(Qn,Xn);case 274:er=e.sent,this.sendEvent(p.ADD_DTMF_EVENT_LISTENER,n,er),e.next=279;break;case 278:Qn[Xn]||(tr=function(e){if(Object.values(m).includes(Xn)){var t={dtmfId:Yn,eventName:e.type,type:e.type,tone:e.tone};i.processPendingEvents(Qn,e,t,p.ADD_DTMF_EVENT_LISTENER,n)}else i.logger.warn("Ignored event: "+JSON.stringify(e))},Qn[Xn]=tr,Qn.addEventListener(Xn,tr,$n));case 279:return e.abrupt("return",null);case 280:if(nr=(0,s.default)(r,2),rr=nr[0],"audio"===(ir=nr[1]).kind||"video"===ir.kind){e.next=283;break}return e.abrupt("return",(this.logger.warn("Invalid media type: "+JSON.stringify(ir)),null));case 283:return or=document.createElement(ir.kind),e.abrupt("return",(Object.assign(or,ir),document.body.appendChild(or),this.mediaElements.set(rr,or),{id:rr,sinkId:or.sinkId}));case 285:if(ar=(0,s.default)(r,2),sr=ar[0],cr=ar[1],!(dr=this.mediaElements.get(sr))){e.next=290;break}return e.next=289,dr.setSinkId(cr);case 289:return e.abrupt("return",{id:sr,sinkId:dr.sinkId});case 290:return e.abrupt("return",{});case 291:return lr=(0,s.default)(r,2),ur=lr[0],fr=lr[1],hr=fr?this.getStream(fr.id):null,e.abrupt("return",(this.mediaElements.has(ur)&&(this.mediaElements.get(ur).srcObject=hr),{}));case 293:return pr=(0,s.default)(r,2),_r=pr[0],gr=pr[1],e.abrupt("return",(this.mediaElements.has(_r)&&(this.mediaElements.get(_r).muted=gr),{id:_r,muted:gr}));case 295:return mr=(0,s.default)(r,2),vr=mr[0],yr=mr[1],br=this.mediaElements.get(vr),e.abrupt("return",(br&&(br.hidden=yr),{}));case 297:return Cr=(0,s.default)(r,2),Sr=Cr[0],Er=Cr[1],e.abrupt("return",(this.mediaElements.has(Sr)&&(this.mediaElements.get(Sr).volume=Er),{}));case 299:return Rr=(0,s.default)(r,1),Tr=Rr[0],e.abrupt("return",(this.mediaElements.has(Tr)&&this.mediaElements.get(Tr).play(),{}));case 301:return wr=(0,s.default)(r,1),kr=wr[0],e.abrupt("return",(this.mediaElements.has(kr)&&this.mediaElements.get(kr).pause(),{}));case 303:return Ir=(0,s.default)(r,1),Pr=Ir[0],e.abrupt("return",(this.mediaElements.has(Pr)&&(this.mediaElements.get(Pr).remove(),this.mediaElements.delete(Pr)),{}));case 305:return Ar=(0,s.default)(r,2),Mr=Ar[0],Dr=Ar[1],Or=this.tracks.get(Mr),e.abrupt("return",Or?(Or.enabled=Dr,this.makeTrackTO(Or)):{});case 307:return xr=(0,s.default)(r,1),Nr=xr[0],Ur=this.tracks.get(Nr),e.abrupt("return",(Ur&&(Ur.stop(),this.tracks.delete(Nr)),{}));case 309:return jr=(0,s.default)(r,1),Fr=jr[0],Lr=this.tracks.get(Fr),e.abrupt("return",Lr?Lr.getSettings():{});case 311:if(Vr=(0,s.default)(r,2),Wr=Vr[0],Br=Vr[1],!this.senders.has(Wr)){e.next=315;break}return Hr=this.senders.get(Wr).createEncodedStreams(),e.abrupt("return",(this.streams.set(Br.id,Hr),this.streams.set(Br.readable.id,Hr.readable),this.streams.set(Br.writable.id,Hr.writable),Br));case 315:return e.abrupt("return",{});case 316:if(zr=(0,s.default)(r,2),Gr=zr[0],qr=zr[1],!this.receivers.has(Gr)){e.next=320;break}return Jr=this.receivers.get(Gr).createEncodedStreams(),e.abrupt("return",(this.streams.set(qr.id,Jr),this.streams.set(qr.readable.id,Jr.readable),this.streams.set(qr.writable.id,Jr.writable),qr));case 320:return e.abrupt("return",{});case 321:return Kr=(0,s.default)(r,1),Zr=Kr[0],e.abrupt("return",(Zr.pcIds.forEach(function(e){i.closePeerConnection(e)}),Zr.streamIds.forEach(function(e){var t=i.streams.get(e);t&&("function"==typeof t.getTracks&&t.getTracks().forEach(function(e){e.stop()}),i.streams.delete(e))}),Zr.trackIds.forEach(function(e){i.tracks.delete(e)}),Zr.workerIds.forEach(function(e){var t=i.workers.get(e);t&&t.terminate(),i.workers.delete(e)}),Zr.mediaElementIds.forEach(function(e){var t=i.mediaElements.get(e);t&&(t.remove(),i.mediaElements.delete(e))}),Zr.transceiverIds.forEach(function(e){i.transceivers.delete(e)}),Zr.senderIds.forEach(function(e){i.senders.delete(e)}),Zr.receiverIds.forEach(function(e){i.receivers.delete(e)}),{}));case 323:return e.abrupt("return",null);case 324:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e){this.logger.debug("Sending message: "+JSON.stringify(e));var t=e.message,n=k.deflateRaw(JSON.stringify(t));e.message=n;var r=(new TextEncoder).encode(JSON.stringify(e)),i=r.byteLength,o=new Uint8Array([i,i>>8,i>>16,i>>24]);this.channel.sendMessage(o),this.channel.sendMessage(r)}},{key:"sendEvent",value:function(e,t,n){var r={requestId:t,type:"event",message:{api:e,event:n}};this.sendMessage(r)}},{key:"sendResponse",value:function(e,t,n){var r={requestId:t,type:"response",message:{api:e,response:n}};this.sendMessage(r)}},{key:"sendError",value:function(e,t,n){var r={requestId:t,type:"error",message:{api:e,error:n}};this.sendMessage(r)}},{key:"handleWebRTCApi",value:function(){var e=(0,d.default)(c.default.mark(function e(t){var n;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.callWebRTCApi(t.message.api,t.requestId,t.message.args);case 3:(n=e.sent)&&this.sendResponse(t.message.api,t.requestId,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.logger.error("Error handling WebRTC API: "+JSON.stringify(t)+", message: "+(e.t0.message?e.t0.message:"(no message)")+", error: "+JSON.stringify(e.t0)),this.logger.trace(e.t0),this.sendError(t.message.api,t.requestId,{name:e.t0.name,message:e.t0.message});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"processPendingEvents",value:function(e,t,n,r,i){if(e.pendingEvents.has(t.type)){e.pendingEvents.get(t.type).push(n);var o=e.eventPromises.get(t.type);o&&o.forEach(function(e){e.resolve(n)})}else this.sendEvent(r,i,n),e.pendingEvents.set(t.type,[])}},{key:"handleMessage",value:function(e){var t=e.message,n=k.inflateRaw(t),r=this.decoder.decode(n);e.message=JSON.parse(r),e.message.api&&e.requestId&&e.message.args?this.handleWebRTCApi(e):(this.logger.error("Invalid message format: "+JSON.stringify(e)),this.logger.trace(e))}},{key:"onClose",value:function(e){this.logger.info("WebRTC redir custom channel closed: "+JSON.stringify(e)+'"'),this.release()}},{key:"release",value:function(){var e=this;this.streams.forEach(function(e){e.getTracks().forEach(function(e){e.stop()})}),this.mediaElements.forEach(function(e){e.remove()}),this.pcs.forEach(function(t,n){e.closePeerConnection(n)}),this.certs.clear()}}]),e}()},"object"==(void 0===n?"undefined":(0,f.default)(n))&&void 0!==t?o(n):"function"==typeof define&&define.amd?define(["exports"],o):o((i="undefined"!=typeof globalThis?git:i||self).dcvwebrtc={})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/slicedToArray":22,"babel-runtime/helpers/toArray":23,"babel-runtime/helpers/typeof":24,"babel-runtime/regenerator":27}],2:[function(e,t,n){(function(e){(function(){var r,i,o={scope:{},getGlobal:function(t){return"undefined"!=typeof window&&window===t?t:void 0!==e?e:t}};o.global=o.getGlobal(this),o.initSymbol=function(){o.global.Symbol||(o.global.Symbol=o.Symbol),o.initSymbol=function(){}},o.symbolCounter_=0,o.Symbol=function(e){return"jscomp_symbol_"+e+o.symbolCounter_++},o.initSymbolIterator=function(){o.initSymbol(),o.global.Symbol.iterator||(o.global.Symbol.iterator=o.global.Symbol("iterator")),o.initSymbolIterator=function(){}},o.makeIterator=function(e){if(o.initSymbolIterator(),e[o.global.Symbol.iterator])return e[o.global.Symbol.iterator]();var t=0;return{next:function(){return t==e.length?{done:!0}:{done:!1,value:e[t++]}}}},o.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},o.arrayFromIterable=function(e){return e instanceof Array?e:o.arrayFromIterator(o.makeIterator(e))},o.inherits=function(e,t){function n(){}for(var r in n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,t)if(o.global.Object.defineProperties){var i=o.global.Object.getOwnPropertyDescriptor(t,r);i&&o.global.Object.defineProperty(e,r,i)}else e[r]=t[r]},o.array=o.array||{},o.array.done_=function(){return{done:!0,value:void 0}},o.array.arrayIterator_=function(e,t){e instanceof String&&(e=String(e));var n=0;o.initSymbol(),o.initSymbolIterator();var r={},i=(r.next=function(){if(n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i.next=o.array.done_,o.array.done_()},r[Symbol.iterator]=function(){return i},r);return i},o.array.findInternal_=function(e,t,n){e instanceof String&&(e=String(e));for(var r=e.length,i=0;i<r;i++){var o=e[i];if(t.call(n,o,i,e))return{i:i,v:o}}return{i:-1,v:void 0}},o.array.from=function(e,t,n){t=void 0===t?function(e){return e}:t;var r=[];if(o.initSymbol(),o.initSymbolIterator(),e[Symbol.iterator]){o.initSymbol(),o.initSymbolIterator(),e=e[Symbol.iterator]();for(var i;!(i=e.next()).done;)r.push(t.call(n,i.value))}else{i=e.length;for(var a=0;a<i;a++)r.push(t.call(n,e[a]))}return r},o.array.of=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];return o.array.from(t)},o.array.entries=function(){return o.array.arrayIterator_(this,function(e,t){return[e,t]})},o.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=o.array.entries)},o.array.keys=function(){return o.array.arrayIterator_(this,function(e){return e})},o.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=o.array.keys)},o.array.values=function(){return o.array.arrayIterator_(this,function(e,t){return t})},o.array.values$install=function(){Array.prototype.values||(Array.prototype.values=o.array.values)},o.array.copyWithin=function(e,t,n){var r=this.length;if(e=Number(e),t=Number(t),n=Number(null!=n?n:r),e<t)for(n=Math.min(n,r);t<n;)t in this?this[e++]=this[t++]:(delete this[e++],t++);else for(e+=(n=Math.min(n,r+t-e))-t;n>t;)--n in this?this[--e]=this[n]:delete this[e];return this},o.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=o.array.copyWithin)},o.array.fill=function(e,t,n){for(null!=n&&e.length||(n=this.length||0),n=Number(n),t=Number((void 0===t?0:t)||0);t<n;t++)this[t]=e;return this},o.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=o.array.fill)},o.array.find=function(e,t){return o.array.findInternal_(this,e,t).v},o.array.find$install=function(){Array.prototype.find||(Array.prototype.find=o.array.find)},o.array.findIndex=function(e,t){return o.array.findInternal_(this,e,t).i},o.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=o.array.findIndex)},o.Map=function(e){if(e=void 0===e?[]:e,this.data_={},this.head_=o.Map.createHead_(),this.size=0,e)for(var t=(e=o.makeIterator(e)).next();!t.done;t=e.next())t=t.value,this.set(t[0],t[1])},o.Map.checkBrowserConformance_=function(){var e=o.global.Map;if(!e||!e.prototype.entries||!Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(o.makeIterator([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=r.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!r.next().done)}catch(e){return!1}},o.Map.createHead_=function(){var e={};return e.previous=e.next=e.head=e},o.Map.getId_=function(e){return e instanceof Object?(o.Map.key_ in e||e instanceof Object&&Object.isExtensible&&Object.isExtensible(e)&&o.Map.defineProperty_(e,o.Map.key_,++o.Map.index_),o.Map.key_ in e?e[o.Map.key_]:" "+e):String(e)},o.Map.prototype.set=function(e,t){var n=(i=this.maybeGetEntry_(e)).id,r=i.list,i=i.entry;return r||(r=this.data_[n]=[]),i?i.value=t:(i={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},r.push(i),this.head_.previous.next=i,this.head_.previous=i,this.size++),this},o.Map.prototype.delete=function(e){var t=this.maybeGetEntry_(e);e=t.id;var n=t.list,r=t.index;return!(!(t=t.entry)||!n)&&(n.splice(r,1),n.length||delete this.data_[e],t.previous.next=t.next,t.next.previous=t.previous,t.head=null,this.size--,!0)},o.Map.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=o.Map.createHead_(),this.size=0},o.Map.prototype.has=function(e){return!!this.maybeGetEntry_(e).entry},o.Map.prototype.get=function(e){return(e=this.maybeGetEntry_(e).entry)&&e.value},o.Map.prototype.maybeGetEntry_=function(e){var t=o.Map.getId_(e),n=this.data_[t];if(n)for(var r=0;r<n.length;r++){var i=n[r];if(e!=e&&i.key!=i.key||e===i.key)return{id:t,list:n,index:r,entry:i}}return{id:t,list:n,index:-1,entry:void 0}},o.Map.prototype.entries=function(){return this.iter_(function(e){return[e.key,e.value]})},o.Map.prototype.keys=function(){return this.iter_(function(e){return e.key})},o.Map.prototype.values=function(){return this.iter_(function(e){return e.value})},o.Map.prototype.forEach=function(e,t){for(var n=o.makeIterator(this.entries()),r=n.next();!r.done;r=n.next())r=r.value,e.call(t,r[1],r[0],this)},o.Map.prototype.iter_=function(e){var t=this,n=this.head_;o.initSymbol(),o.initSymbolIterator();var r={next:function(){if(n){for(;n.head!=t.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return this},r},o.Map.index_=0,o.Map.defineProperty_=Object.defineProperty?function(e,t,n){Object.defineProperty(e,t,{value:String(n)})}:function(e,t,n){e[t]=String(n)},o.Map.Entry_=function(){},o.Map.ASSUME_NO_NATIVE=!1,o.Map$install=function(){o.initSymbol(),o.initSymbolIterator(),!o.Map.ASSUME_NO_NATIVE&&o.Map.checkBrowserConformance_()?o.Map=o.global.Map:(o.initSymbol(),o.initSymbolIterator(),o.Map.prototype[Symbol.iterator]=o.Map.prototype.entries,o.initSymbol(),o.Map.key_=Symbol("map-id-key")),o.Map$install=function(){}},o.math=o.math||{},o.math.clz32=function(e){if(0===(e=Number(e)>>>0))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&t++,t},o.math.imul=function(e,t){var n=65535&(e=Number(e)),r=65535&(t=Number(t));return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},o.math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1},o.math.log10=function(e){return Math.log(e)/Math.LN10},o.math.log2=function(e){return Math.log(e)/Math.LN2},o.math.log1p=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,r=e,i=0,o=1;i!=r;)r=(i=r)+(o*=-1)*(t*=e)/++n;return r}return Math.log(1+e)},o.math.expm1=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,r=e,i=0;i!=r;)r=(i=r)+(t*=e/++n);return r}return Math.exp(e)-1},o.math.cosh=function(e){return e=Number(e),(Math.exp(e)+Math.exp(-e))/2},o.math.sinh=function(e){return 0===(e=Number(e))?e:(Math.exp(e)-Math.exp(-e))/2},o.math.tanh=function(e){if(0===(e=Number(e)))return e;var t=(1-(t=Math.exp(2*-Math.abs(e))))/(1+t);return 0>e?-t:t},o.math.acosh=function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))},o.math.asinh=function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t},o.math.atanh=function(e){return e=Number(e),(o.math.log1p(e)-o.math.log1p(-e))/2},o.math.hypot=function(e,t,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];e=Number(e),t=Number(t);var a=Math.max(Math.abs(e),Math.abs(t)),s=o.makeIterator(r);for(i=s.next();!i.done;i=s.next())a=Math.max(a,Math.abs(i.value));if(1e100<a||1e-100>a){for(s=(e/=a)*e+(t/=a)*t,i=(r=o.makeIterator(r)).next();!i.done;i=r.next())i=i.value,s+=(i=Number(i)/a)*i;return Math.sqrt(s)*a}for(a=e*e+t*t,i=(r=o.makeIterator(r)).next();!i.done;i=r.next())i=i.value,a+=(i=Number(i))*i;return Math.sqrt(a)},o.math.trunc=function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t},o.math.cbrt=function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t},o.number=o.number||{},o.number.isFinite=function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)},o.number.isInteger=function(e){return!!o.number.isFinite(e)&&e===Math.floor(e)},o.number.isNaN=function(e){return"number"==typeof e&&isNaN(e)},o.number.isSafeInteger=function(e){return o.number.isInteger(e)&&Math.abs(e)<=o.number.MAX_SAFE_INTEGER},o.number.EPSILON=Math.pow(2,-52),o.number.MAX_SAFE_INTEGER=9007199254740991,o.number.MIN_SAFE_INTEGER=-9007199254740991,o.object=o.object||{},o.object.assign=function(e,t){for(var n=[],r=1;r<arguments.length;++r)n[r-1]=arguments[r];for(r=(n=o.makeIterator(n)).next();!r.done;r=n.next())if(r=r.value)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},o.object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},o.Set=function(e){if(e=void 0===e?[]:e,this.map_=new o.Map,e)for(var t=(e=o.makeIterator(e)).next();!t.done;t=e.next())this.add(t.value);this.size=this.map_.size},o.Set.checkBrowserConformance_=function(){if(!(t=o.global.Set)||!t.prototype.entries||!Object.seal)return!1;var e=Object.seal({x:4});if((t=new t(o.makeIterator([e]))).has(e)||1!=t.size||t.add(e)!=t||1!=t.size||t.add({x:4})!=t||2!=t.size)return!1;var t,n=(t=t.entries()).next();return!n.done&&n.value[0]==e&&n.value[1]==e&&(!(n=t.next()).done&&n.value[0]!=e&&4==n.value[0].x&&n.value[1]==n.value[0]&&t.next().done)},o.Set.prototype.add=function(e){return this.map_.set(e,e),this.size=this.map_.size,this},o.Set.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},o.Set.prototype.clear=function(){this.map_.clear(),this.size=0},o.Set.prototype.has=function(e){return this.map_.has(e)},o.Set.prototype.entries=function(){return this.map_.entries()},o.Set.prototype.values=function(){return this.map_.values()},o.Set.prototype.forEach=function(e,t){var n=this;this.map_.forEach(function(r){return e.call(t,r,r,n)})},o.Set.ASSUME_NO_NATIVE=!1,o.Set$install=function(){!o.Set.ASSUME_NO_NATIVE&&o.Set.checkBrowserConformance_()?o.Set=o.global.Set:(o.Map$install(),o.initSymbol(),o.initSymbolIterator(),o.Set.prototype[Symbol.iterator]=o.Set.prototype.values),o.Set$install=function(){}},o.string=o.string||{},o.string.noRegExp_=function(e,t){if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+t+" must not be a regular expression")},o.string.fromCodePoint=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];n="";for(var r=(t=o.makeIterator(t)).next();!r.done;r=t.next()){if(0>(r=+(r=r.value))||1114111<r||r!==Math.floor(r))throw new RangeError("invalid_code_point "+r);65535>=r?n+=String.fromCharCode(r):(r-=65536,n+=String.fromCharCode(r>>>10&1023|55296),n+=String.fromCharCode(1023&r|56320))}return n},o.string.repeat=function(e){var t=this.toString();if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n},o.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=o.string.repeat)},o.string.codePointAt=function(e){var t=this.toString(),n=t.length;if(0<=(e=Number(e)||0)&&e<n){e|=0;var r=t.charCodeAt(e);return 55296>r||56319<r||e+1===n?r:56320>(e=t.charCodeAt(e+1))||57343<e?r:1024*(r-55296)+e+9216}},o.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=o.string.codePointAt)},o.string.includes=function(e,t){return t=void 0===t?0:t,o.string.noRegExp_(e,"includes"),-1!==this.toString().indexOf(e,t)},o.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=o.string.includes)},o.string.startsWith=function(e,t){t=void 0===t?0:t,o.string.noRegExp_(e,"startsWith");var n=this.toString();e+="";for(var r=n.length,i=e.length,a=Math.max(0,Math.min(0|t,n.length)),s=0;s<i&&a<r;)if(n[a++]!=e[s++])return!1;return s>=i},o.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=o.string.startsWith)},o.string.endsWith=function(e,t){o.string.noRegExp_(e,"endsWith");var n=this.toString();e+="",void 0===t&&(t=n.length);for(var r=Math.max(0,Math.min(0|t,n.length)),i=e.length;0<i&&0<r;)if(n[--r]!=e[--i])return!1;return 0>=i},o.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=o.string.endsWith)},r=self,i=function(){return function(){var e={945:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.AudioElement=void 0;var i,o=n(658),a=n(550),s=n(851),c=n(946);!function(e){e.Init="Init",e.PlayStarted="PlayStarted",e.PauseCalled="PauseCalled"}(i||(i={})),e=function(e){function t(){var t=e.call(this,null,a.class_id_t.AudioElement,0,o.ProxyMode.Local)||this;return t.sinkId_="",t.srcObject_=null,t.loop_=!1,t.notiState=i.Init,t}return r(t,e),t.prototype.setSinkId=function(e){var t=this;return s.logger.log(this.user_friendly_id()+".setSinkId: set sinkId to "+e),new Promise(function(n,r){t.waitUntilConnected("AudioElement.sinkId").then(function(){var r=t.remoteInvoke(!0,a.method_id_AudioElement_t.sinkId,e);return c.getRedirector().getFeatureValue(a.FEATURE_ms_teams_pstn)||(t.sinkId_=e,n()),r}).then(function(){s.logger.log(t.user_friendly_id()+".setSinkId: success! resolving..."),t.sinkId_=e,n()}).catch(function(e){e=t.logRemoteInvokeError(e,".sinkId setter: failed to connect!"),r(e)})})},Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){this.setSinkId(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){var t=this;s.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(e)),e!==this.srcObject_&&(this.srcObject_=e,this.waitUntilConnected("AudioElement.srcObject").then(function(){return e.syncBarrier()}).then(function(e){return s.logger.log(t.user_friendly_id()+".srcObject: set srcObject to s "+JSON.stringify(e)),t.remoteInvoke(!0,a.method_id_AudioElement_t.srcObject,null!==e&&void 0!==e?e.id:"null")}).then(function(){s.logger.log(t.user_friendly_id()+".srcObject setter: remote success!")}).catch(function(e){t.logRemoteInvokeError(e,".srcObject setter: failed to connect!")}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.src_},set:function(e){var t=this;s.logger.log(this.user_friendly_id()+".src: set src to "+e),this.src_=e,this.waitUntilConnected("AudioElement.src").then(function(){t.remoteInvoke(!0,a.method_id_AudioElement_t.src,e)}).catch(function(e){t.logRemoteInvokeError(e,".src setter: failed to connect!")})},enumerable:!1,configurable:!0}),t.prototype.play=function(){var e=this;return s.logger.log(this.user_friendly_id()+".play() called."),this.toggleAudio(!0),new Promise(function(t,n){e.waitUntilConnected("AudioElement.play").then(function(){return e.remoteInvoke(!1,a.method_id_AudioElement_t.play)}).then(function(){t()}).catch(function(t){e.logRemoteInvokeError(t,".play: failed to connect!"),n(t)})})},t.prototype.playEx=function(e,t,n){var r=this;s.logger.log(this.user_friendly_id()+".playEx() src:"+e+" sinkId:"+t+" loop:"+n),this.notiState=i.PlayStarted,this.waitUntilConnected("AudioElement.playEx").then(function(){var e=[];return t&&e.push(r.setSinkId(t)),void 0!==n&&null!==n&&(r.loop_=n,e.push(r.remoteInvoke(!0,a.method_id_AudioElement_t.loop,n))),Promise.all(e)}).then(function(){return r.src_=e,r.remoteInvoke(!0,a.method_id_AudioElement_t.src,e)}).then(function(){return r.play()}).then(function(){if(r.notiState==i.PauseCalled)return s.logger.log(r.user_friendly_id()+".playEx() run deferred pause"),r.doPauseAndDispose()}).then(function(){r.notiState=i.Init,s.logger.log(r.user_friendly_id()+".playEx() done")}).catch(function(e){r.notiState=i.Init,r.logRemoteInvokeError(e,".playEx() failed!")})},t.prototype.pause=function(){var e=this;return s.logger.log(this.user_friendly_id()+".pause() called."),this.toggleAudio(!1),new Promise(function(t,n){e.waitUntilConnected("AudioElement.pause").then(function(){return e.remoteInvoke(!1,a.method_id_AudioElement_t.pause)}).then(function(){t()}).catch(function(t){e.logRemoteInvokeError(t,".pause: failed!"),n()})})},t.prototype.doPauseAndDispose=function(){var e=this;return s.logger.log(this.user_friendly_id()+".doPauseAndDispose() called."),this.toggleAudio(!1),new Promise(function(t,n){e.waitUntilConnected("AudioElement.doPauseAndDispose").then(function(){return e.remoteInvoke(!1,a.method_id_AudioElement_t.pause,[])}).then(function(){s.logger.log(e.user_friendly_id()+".doPauseAndDispose() resolving..."),t(),e.dispose()}).catch(function(t){e.logRemoteInvokeError(t,".doPauseAndDispose: failed to connect!")})})},t.prototype.pauseAndDispose=function(){this.notiState==i.PlayStarted?(s.logger.log(this.user_friendly_id()+".pauseAndDispose() deferred"),this.notiState=i.PauseCalled):this.doPauseAndDispose()},t.prototype.toggleAudio=function(e){this.srcObject_&&(s.logger.log(this.user_friendly_id()+".toggleAudio() toggle audio tracks:"+e),this.srcObject_.toggleAudio(e))},Object.defineProperty(t.prototype,"loop",{get:function(){return this.loop_},set:function(e){var t=this;s.logger.log(this.user_friendly_id()+".loop: set loop to "+e),this.loop_=e,this.waitUntilConnected("AudioElement.loop").then(function(){t.remoteInvoke(!0,a.method_id_AudioElement_t.loop,e)}).catch(function(e){t.logRemoteInvokeError(e,".loop setter: failed to connect!")})},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){s.logger.log(this.user_friendly_id()+".dispose()"),this.src_=this.sinkId_="",this.srcObject_=null,this.loop_=!1,this.release()},t}(o.ProxyObject),t.AudioElement=e},239:function(e,t,n){t.E=void 0;var r=n(945),i=n(851),o=function(){function e(){this.sinkId=void 0,this.src="",this.loop=void 0,this.element=null}return e.prototype.getSrc=function(){return this.src},e.prototype.setSinkId=function(e){this.sinkId=e},e.prototype.getLoop=function(){return!0===this.loop},e.prototype.setLoop=function(e){this.loop=e},e.prototype.play=function(e){this.element=new r.AudioElement,this.src=e,this.element.playEx(this.src,this.sinkId,this.loop)},e.prototype.pause=function(){this.element&&(this.element.pauseAndDispose(),this.element=null)},e.prototype.release=function(){this.element&&(this.element.dispose(),this.element=null)},e}();e=function(){function e(){this.audioIdMap=null,this.audioIdMap=new Map}return e.prototype.getNotificationInfo=function(e){if(this.audioIdMap.has(e))return this.audioIdMap.get(e);var t=new o;return this.audioIdMap.set(e,t),t},e.prototype.playNotifyAudio=function(e,t){t&&(i.logger.log("AudioNotification.playNotifyAudio, Remote to Thin Client audioId:"+e+" src:"+t),this.getNotificationInfo(e).play(t))},e.prototype.pauseNotifyAudio=function(e,t){if(this.audioIdMap.has(e)){var n=this.audioIdMap.get(e);t&&t!=n.getSrc()&&i.logger.log("AudioNotification.pauseNotifyAudio warning: for audioId:"+e+", different param src:"+t+" from org src:"+n.getSrc()),n.pause()}else i.logger.log("AudioNotification.pauseNotifyAudio no audioId:"+e+" src:"+t)},e.prototype.setSinkId=function(e,t){if(null!=t&&t.startsWith("speaker:")){i.logger.log("AudioNotification.setSinkId before parsing audioId:"+e+" sinkId:"+t);var n=t.slice(8);i.logger.log("AudioNotification.setSinkId after parsing audioId:"+e+" speakersinkId:"+n),t=n}this.getNotificationInfo(e).setSinkId(t)},e.prototype.getLoop=function(e){return this.getNotificationInfo(e).getLoop()},e.prototype.setLoop=function(e,t){this.getNotificationInfo(e).setLoop(t)},e.prototype.release=function(){this.audioIdMap.forEach(function(e,t,n){e.release()}),this.audioIdMap.clear()},e}(),t.E=e},613:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.E911Service=void 0;var i=n(550),o=n(658),a=n(851);e=function(e){function t(){var t=e.call(this,null,i.class_id_t.E911Service,0,o.ProxyMode.Local)||this;return t.preE911Info_=null,t}return r(t,e),t.prototype.isSameInfo=function(e){if(null==this.preE911Info_&&null!=e||null!=this.preE911Info_&&null==e||this.preE911Info_.e911.length!=e.e911.length||this.preE911Info_.bssid!=e.bssid||this.preE911Info_.ipv4!=e.ipv4||this.preE911Info_.subnetLengthIpv4!=e.subnetLengthIpv4||this.preE911Info_.ipv6!=e.ipv6||this.preE911Info_.subnetLengthIpv6!=e.subnetLengthIpv6||this.preE911Info_.mac!=e.mac||1e-4<=Math.abs(this.preE911Info_.latitude-e.latitude)||1e-4<=Math.abs(this.preE911Info_.longitude-e.longitude))return!1;for(var t=0;t<e.e911.length;t++)if(this.preE911Info_.e911[t].chassisId!=e.e911[t].chassisId||this.preE911Info_.e911[t].portId!=e.e911[t].portId)return!1;return!0},Object.defineProperty(t.prototype,"onupdate",{get:function(){return this.onupdate_},set:function(e){var t=this;this.onupdate_=e,this.waitUntilConnected(this.user_friendly_id()+".onupdate").then(function(){var e=t.registerCallbacks(!1,t.isNullCallback(t.onupdate_),i.method_id_E911Service_t.onupdate);return e.then(function(e){var n=(e=e.params)[0];e.slice(1),null!==t.preE911Info_&&t.isSameInfo(n)||(a.logger.log(t.user_friendly_id()+".onupdate",JSON.stringify(n)),t.onupdate_&&t.onupdate_(n),t.preE911Info_=n)}),t.remoteInvoke(!0,i.method_id_E911Service_t.onupdate,e.success)}).catch(function(){return a.logger.log(t.user_friendly_id()+".onupdate, could not set listener")})},enumerable:!1,configurable:!0}),t.prototype.getE911Info=function(){var e=this;return new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getE911Info").then(function(){return e.remoteInvoke(!1,i.method_id_E911Service_t.getE911Info)}).then(function(n){a.logger.log(e.user_friendly_id()+".getE911Info",JSON.stringify(e.param0(n))),t(e.param0(n))}).catch(function(){a.logger.log(e.user_friendly_id()+".getE911Info promise rejected"),n()})})},t.prototype.updateE911Info=function(){var e=this;this.getE911Info().then(function(t){return e.onupdate&&e.onupdate(t)}).catch(function(){return a.logger.log("Fail to get e911 information!")})},t}(o.ProxyObject),t.E911Service=e},9:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.EngineControl=t.VersionType=void 0;var i=n(550),o=n(946),a=n(658),s=n(851);!function(e){e[e.Webrpc=0]="Webrpc",e[e.WebrtcCodecs=1]="WebrtcCodecs",e[e.Receiver=2]="Receiver",e[e.Vda=3]="Vda",e[e.Endpoint=4]="Endpoint",e[e.TypeScript=5]="TypeScript",e[e.HdxRtcEngine=6]="HdxRtcEngine",e[e.Max=7]="Max"}(t.VersionType||(t.VersionType={})),e=function(e){function t(t){var n=e.call(this,null,i.class_id_t.EngineControl,0,a.ProxyMode.Local)||this;return n.clientInfo_="",n.clientInfo_=t,n}return r(t,e),t.prototype.bind=function(){s.logger.log(this.user_friendly_id()+".bind() called."),this.reconstructor(null,i.class_id_t.EngineControl,0)},t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,i.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),e.remoteInvoke(!1,i.method_id_EngineControl_t.feature_flags,[])])}).then(function(t){s.logger.log(e.user_friendly_id()+"received webrpc version and supported feature list."),t=t.map(function(t){return e.param0(t)}),e.version_=t[0],e.features_=t[1],o.getRedirector().setFeatures(e.features_),e.remoteInvoke(!1,i.method_id_EngineControl_t.set_client_info,(e.clientInfo_||"Unknown")+"; vdiShim/"+i.HDXMS_VERSION,o.getRedirector().sessionClientId).catch(function(){return s.logger.log(e.user_friendly_id()+" could not set client info")}),t=[];for(var n=0,r=e.features_;n<r.length;n++){var a=r[n];"ms_teams_desktop_sharing"===a.name&&a.value?t.push(e.remoteInvoke(!1,i.method_id_EngineControl_t.version_info,[])):"ms_teams_osinfo"===a.name&&a.value?t.push(e.remoteInvoke(!1,i.method_id_EngineControl_t.osinfo,{family:"",version:"",architecture:"",distro:"",edition:""})):"ms_teams_endpoint_id"===a.name&&a.value?t.push(e.remoteInvoke(!1,i.method_id_EngineControl_t.endpoint_id,{machine_id:"",user_id:""})):"ms_teams_hardware_info"===a.name&&a.value&&t.push(e.remoteInvoke(!1,i.method_id_EngineControl_t.hardware_info))}if(0<t.length)return Promise.all(t)}).then(function(t){if(void 0===t)s.logger.log(e.user_friendly_id()+"release-1905 client.");else{s.logger.log(e.user_friendly_id()+"release-1906 or later client: received detailed client version list.");for(var n=0;n<t.length;n++){var r=t[n];r.hdr.proc.iid==i.class_id_t.EngineControl&&r.hdr.proc.methodid==i.method_id_EngineControl_t.version_info?e.versions_=e.param0(r):r.hdr.proc.iid==i.class_id_t.EngineControl&&r.hdr.proc.methodid==i.method_id_EngineControl_t.osinfo?e.osinfo_=e.param0(r):r.hdr.proc.iid==i.class_id_t.EngineControl&&r.hdr.proc.methodid==i.method_id_EngineControl_t.endpoint_id?e.endpointid_=e.param0(r):r.hdr.proc.iid==i.class_id_t.EngineControl&&r.hdr.proc.methodid==i.method_id_EngineControl_t.hardware_info&&(e.hardwareinfo_=e.param0(r))}}e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,"failure to retrieve version/feature related client info."),e.syncBarrierReject(t)})})},t}(a.ProxyObject),t.EngineControl=e},368:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Frames=t.FrameTracker=void 0;var r=n(851),i=n(946),o=n(679),a=function(e,t){this.resolve=e,this.reject=t},s=function(){function e(){this.name="overlay",this.reqs_=[],i.getRedirector().addProtocolHandler(this)}return e.prototype.init=function(e){},e.prototype.reset=function(){this.reqs_.forEach(function(e,t){e.reject()}),this.reqs_=[]},e.prototype.on_message=function(e){var t=this;if(r.logger.log("HDXMS: Overlay <<< "+JSON.stringify(e)),"capabilities"==e.command)new Promise(function(e,n){t.reqs_.push(new a(e,n)),i.getRedirector().WSSendObject({v:"overlay",command:"configure",caps:[]})});else{var n=this.reqs_.shift();void 0!=n?1==e.status&&("track_window"==e.command?n.resolve(e.windowId):"untrack_window"==e.command?n.resolve(e.windowHandle):"configure"==e.command?n.resolve({}):n.reject({})):r.logger.log("spurious response for message: "+e.command)}},e.prototype.registerWindowWithService=function(e){var t=this;return new Promise(function(n,o){var s=i.getRedirector();if(void 0==e){r.logger.log("FrameTrackerProtocol.registerWindowWithService: legacy case");var c=window.getWindowHandleAsHex.bind(window);void 0!==c&&null!==c||(r.logger.log("FrameTrackerProtocol.registerWindowWithService: getWindowHandle method is undefined or null"),o({})),Promise.all([c(),s.startRedirection(!1,"registerWindowWithService")]).then(function(e){r.logger.log("FrameTracker.registerWindowWithService: set window handle: "+e[0]),s.WSSendObject({v:"overlay",command:"window",windowHandle:e[0]}),n(void 0)})}else r.logger.log("FrameTrackerProtocol.registerWindowWithService: new MW case"),s.startRedirection(!1,"registerWindowWithService").then(function(){t.reqs_.push(new a(n,o)),s.WSSendObject({v:"overlay",command:"track_window",windowHandle:e})})})},e.prototype.unregisterWindowWithService=function(e){var t=this;return r.logger.log("FrameTrackerProtocol.unregisterWindowWithService(handle: "+e+")"),new Promise(function(n,r){void 0==e?r({}):(t.reqs_.push(new a(n,r)),i.getRedirector().WSSendObject({v:"overlay",command:"untrack_window",windowHandle:e}))})},e}(),c=function(){function e(e){var t=this;this.running_=!1,this.elements_=[],this.clipRects=new Set,this.videos_=[],this.connected_=!1,this.yClientAreaOffset_=this.xClientAreaOffset_=0,this.wheelEventHandler=function(e){setTimeout(function(){t.updateAll()},10)},this.scrollEventHandler=function(e){t.updateAll()},this.keyupEventHandler=function(e){"Tab"!=e.code&&"ArrowUp"!=e.code&&"ArrowDown"!=e.code&&"ArrowLeft"!=e.code&&"ArrowRight"!=e.code&&"PageUp"!=e.code&&"PageDown"!=e.code&&"Home"!=e.code&&"End"!=e.code||t.updateAll()},this.resizeEventHandler=function(e){r.logger.log("onWindowResize... update video elements position"),t.updateAll()},r.logger.log("FrameTracker.constructor: (handle: "+e+")"),this.handle_=e,this.connectToService(),this.observer_=new MutationObserver(function(e){t.updateAll()})}return e.prototype.connectToService=function(){var t=this;e.Protocol.registerWindowWithService(this.handle_).then(function(e){r.logger.log("FrameTracker: connected to service. (windowId="+e+")"),t.connected_=!0,t.windowId_=e,t.videos_.forEach(function(e){e.sinkId=JSON.stringify(t.windowId_)}),t.videos_=[]})},Object.defineProperty(e.prototype,"handle",{get:function(){return this.handle_},enumerable:!1,configurable:!0}),e.prototype.getWindowFromElement=function(e){return e.ownerDocument.defaultView},e.prototype.rectanglesIntersect=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y},e.prototype.intersectingRect=function(e,t){var n=Math.max(e.left,t.left),r=Math.max(e.top,t.top);return new DOMRect(n,r,Math.min(e.right,t.right)-n,Math.min(e.bottom,t.bottom)-r)},e.prototype.pedigreeCount=function(e,t){for(var n=0,r=e.parentElement;null!=r&&r!=t;)n++,r=r.parentElement;return{isAncestor:null!=r,pedigree:n}},e.prototype.selectTopmost=function(e,t){var n=this.getBoundingClientRect(e),r=this.getBoundingClientRect(t);n=this.intersectingRect(n,r);if((r=e.ownerDocument.elementFromPoint(n.left+n.width/2,n.top+n.height/2))==e)return e;if(r==t)return t;if(n=this.pedigreeCount(e,r),r=this.pedigreeCount(t,r),n.isAncestor&&r.isAncestor){if(n.pedigree<r.pedigree)return e;if(r.pedigree<n.pedigree)return t}else{if(n.isAncestor)return e;if(r.isAncestor)return t}},e.prototype.checkOverlappingVideos=function(e){var t=this,n=this.getBoundingClientRect(e.target);e.overlaps.forEach(function(t){e.target.remoteVideoElement.removeClipRect(t.rect)}),e.overlaps=[],this.elements_.forEach(function(r){if(r!=e){var i=r.overlaps.map(function(e){return e.element}).indexOf(e.target);if(-1!=i&&(i=r.overlaps.splice(i,1)[0],r.target.remoteVideoElement.removeClipRect(i.rect)),i=t.getBoundingClientRect(r.target),t.rectanglesIntersect(n,i)){var o=t.selectTopmost(e.target,r.target);o==e.target?(r.overlaps.push({element:e.target,rect:n}),r.target.remoteVideoElement.addClipRect(n)):o==r.target&&(e.overlaps.push({element:r.target,rect:i}),e.target.remoteVideoElement.addClipRect(i))}}})},e.prototype.updateAll=function(){var e=this;this.elements_.forEach(function(t){var n=e.getBoundingClientRect(t.target);if(void 0!==n){var r=t.clientRect;void 0!==r&&r.x===n.x&&r.y===n.y&&r.width===n.width&&r.height===n.height||(t.clientRect=n,t.callback(n),e.checkOverlappingVideos(t))}})},e.prototype.track=function(e,t){var n=this,i=this.getBoundingClientRect(e);r.logger.log("Track (handle: "+this.handle_+") element frame",e,JSON.stringify(i)),console.log(e),this.elements_.push({target:e,clientRect:void 0,callback:t,overlaps:[]});try{r.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach(function(t){n.applyOcclusion(e,JSON.parse(t))})}catch(e){r.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+e)}this.running_||(r.logger.log("Start FrameTracker observer..."),this.observer_.observe(e.ownerDocument.body,{attributes:!0,childList:!0,subtree:!0}),(i=this.getWindowFromElement(e)).addEventListener("wheel",this.wheelEventHandler),i.addEventListener("scroll",this.scrollEventHandler),i.addEventListener("keyup",this.keyupEventHandler),i.addEventListener("resize",this.resizeEventHandler),this.running_=!0),this.updateAll()},e.prototype.untrack=function(e){r.logger.log("Untrack (handle: "+this.handle_+") element frame",e);var t=-1;if(this.elements_.forEach(function(n,r){n.target===e&&(t=r)}),0<=t&&(this.elements_.splice(t,1),0===this.elements_.length)){r.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect();var n=this.getWindowFromElement(e);n.removeEventListener("wheel",this.wheelEventHandler),n.removeEventListener("scroll",this.scrollEventHandler),n.removeEventListener("keyup",this.keyupEventHandler),n.removeEventListener("resize",this.resizeEventHandler),this.running_=!1}},e.prototype.applyOcclusion=function(e,t){var n=this.getBoundingClientRect(e);this.rectanglesIntersect(t,n)&&void 0!==e.remoteVideoElement&&e.remoteVideoElement.addClipRect(t)},e.prototype.addOcclusion=function(e){var t=this;r.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(e)),r.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.add(JSON.stringify(e)),this.elements_.forEach(function(n){t.applyOcclusion(n.target,e)})},e.prototype.removeOcclusion=function(e){r.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(e)),r.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.delete(JSON.stringify(e)),this.elements_.forEach(function(t){void 0!==t.target.remoteVideoElement&&t.target.remoteVideoElement.removeClipRect(e)})},e.prototype.setClientAreaOffset=function(e,t){this.xClientAreaOffset_=e,this.yClientAreaOffset_=t},e.prototype.getBoundingClientRect=function(e){return(e=e.getBoundingClientRect()).x+=this.xClientAreaOffset_,e.y+=this.yClientAreaOffset_,e},e.prototype.newVideoElement=function(t){var n=this;if(r.logger.log("FrameTracker.newVideoElement: (id: "+t.id+")"),void 0!==t.remoteVideoElement)r.logger.log("Video element is already configured!!!");else{t.id||(t.id="ctx-vid-"+e.videoElementIDs++);var i=new o.VideoElement(t.id,this.getWindowFromElement(t));this.connected_?(r.logger.log("FrameTracker.newVideoElement: initializing video element with sink id "+this.windowId_),i.sinkId=JSON.stringify(this.windowId_)):(r.logger.log("FrameTracker.newVideoElement: video element awaiting stable window state"),this.videos_.push(i)),i.onloadedmetadata=function(){t.dispatchEvent(new Event("loadedmetadata"))},i.ontimeupdate=function(){t.dispatchEvent(new Event("timeupdate"))},i.onconnectionstatechange=function(){"connected"==i.connectionState?n.track(t,function(e){i.setFrame(e)}):n.untrack(t)},delete t.remoteVideoElement,Object.defineProperty(t,"remoteVideoElement",{writable:!0,configurable:!0,value:null}),t.remoteVideoElement=i,delete t.srcObject,Object.defineProperty(t,"srcObject",{configurable:!0,get:function(){return i.srcObject},set:function(e){r.logger.log("VDI Shim set video element srcObject "+e),i.srcObject=e}}),delete t.videoWidth,Object.defineProperty(t,"videoWidth",{configurable:!0,get:function(){return i.videoWidth}}),delete t.videoHeight,Object.defineProperty(t,"videoHeight",{configurable:!0,get:function(){return i.videoHeight}})}},e.prototype.disposeVideoElement=function(e){r.logger.log("FrameTracker.disposeVideoElement: (id: "+e.id+")");var t=e.remoteVideoElement;if(void 0!=t){var n=this.videos_.findIndex(function(e){return e.Id==t.Id});-1<n&&this.videos_.splice(n,1),t.dispose(),e.remoteVideoElement=void 0}},e.videoElementIDs=0,e.Protocol=new s,e}();t.FrameTracker=c,e=function(){function e(e){this.frames_=[],e&&this.frames_.push(new c(void 0))}return e.prototype.newFrame=function(e){r.logger.log("Frames.newFrame: (handle: "+e+")");var t=this.findFrame(e);return void 0==t&&(t=new c(e),this.frames_.push(t)),t},e.prototype.disposeFrame=function(e){r.logger.log("Frames.disposeFrame: (handle: "+e+")");var t=this.frames_.findIndex(function(t){return t.handle==e});-1<t&&(c.Protocol.unregisterWindowWithService(e).then(function(e){r.logger.log("Untrack window (handle: "+e+") successful")}),this.frames_.splice(t,1))},e.prototype.findFrame=function(e){return r.logger.log("Frames.findFrame: (handle: "+e+")"),void 0!=e?this.frames_.find(function(t){return t.handle==e}):this.frames_[0]},e.prototype.reconnect=function(){r.logger.log("Frames.reconnect()"),this.frames_.forEach(function(e){e.connectToService()})},e}(),t.Frames=e},247:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getGC=t.GC=void 0;var n=function(){function e(e){this.parent_=this.object_=null,this.children_=[],this.object_=e}return e.prototype.addChild=function(e){e.parent_!=this&&(e.parent_=this,this.children_.push(e))},e.prototype.removeChild=function(e){var t=this.children_.indexOf(e);this.children_.splice(t,1),e.parent_=null},e}(),r=function(){function e(){this.root_=new n(null)}return e.prototype.trackObject=function(e,t){if(void 0===t&&(t=null),null===this.findNode(e,this.root_)){var r=this.findNode(t,this.root_),i=new n(e);r?r.addChild(i):this.root_.addChild(i)}},e.prototype.releaseObject=function(e){return null!==(e=this.findNode(e,this.root_))&&e!==this.root_&&(this.destroyNodeObjectRecurse(e),e.parent_.removeChild(e),!0)},e.prototype.destroyNodeObjectRecurse=function(e){for(var t=0,n=e.children_;t<n.length;t++)this.destroyNodeObjectRecurse(n[t]);e.object_.destroy()},e.prototype.setParent=function(e,t){var n=this.findNode(e,this.root_);if(null===n)return!1;var r=this.findNode(t,this.root_);return null!==r&&(n.parent_===r||(n.parent_.removeChild(n),r.addChild(n),!0))},e.prototype.reset=function(){this.root_.children_=[]},e.prototype.findNode=function(e,t){if(t.object_===e)return t;for(var n=null,r=0,i=t.children_;r<i.length&&null===(n=this.findNode(e,i[r]));r++);return n},e}();t.GC=r;var i=new r;t.getGC=function(){return i}},946:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.getRedirector=t.HdxMediaStream=t.RedirectionStatus=t.WebrpcStatusCode=void 0;var r,i,o=n(658),a=n(851),s=n(550),c=n(545),d=n(394),l=n(691),u=function(e,t,n,r,i,o,a,s){void 0===s&&(s=void 0),this.resolve=e,this.reject=t,this.iid=n,this.oid=r,this.cbid=i,this.oneShot=o,this.mid=a,this.completion_cb=s};!function(e){e[e.rpc_status_success=0]="rpc_status_success",e[e.rpc_status_unspecified_error=1]="rpc_status_unspecified_error",e[e.rpc_status_unexpected=2]="rpc_status_unexpected",e[e.rpc_status_index_out_of_bounds=3]="rpc_status_index_out_of_bounds",e[e.rpc_status_missing_parameter=4]="rpc_status_missing_parameter",e[e.rpc_status_missing_return_value=5]="rpc_status_missing_return_value",e[e.rpc_status_invalid_object=6]="rpc_status_invalid_object",e[e.rpc_status_user_exception=7]="rpc_status_user_exception",e[e.rpc_status_system_error=8]="rpc_status_system_error"}(r=t.WebrpcStatusCode||(t.WebrpcStatusCode={})),function(e){e[e.NotRedirected=0]="NotRedirected",e[e.Connecting=1]="Connecting",e[e.Binding=2]="Binding",e[e.Redirected=3]="Redirected"}(i=t.RedirectionStatus||(t.RedirectionStatus={})),e=function(){function e(){this.sessionId_="",this.handlers_=[],this.pingactive=!1,this.status=i.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=[],this.telemetry_=new d.Telemetry,this.screenshare_=new l.ScreenShareUtil,this.stateChangeNotifcations=[],this.vdafeatures_=[]}return Object.defineProperty(e.prototype,"telemetry",{get:function(){return this.telemetry_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenshare",{get:function(){return this.screenshare_},enumerable:!1,configurable:!0}),e.prototype.setRemoteSessionInfoCb=function(e){this.remoteSessionInfoCb=e},e.prototype.setFeatures=function(e){this.features=e,this.screenshare.onInitComplete(),this.handlers_.forEach(function(t,n){t.init(e)})},e.prototype.getFeatureValue=function(e){if(this.features){var t=this.features.find(function(t){return t.name===e});return void 0!==t&&t.value}return!1},e.prototype.getVDAFeatureValue=function(e){return void 0!==this.vdafeatures_.find(function(t){return t===e})},e.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==i.Redirected)},e.prototype.connectToService=function(){return a.logger.log("Redirection status: Connecting..."),this.status=i.Connecting,new Promise(function(e,t){var n=new WebSocket("wss://127.0.0.1:9002");n.onopen=function(){e(n)},n.onerror=function(e){a.logger.log("websocket connection error: "+e.type),t(e)}})},e.prototype.waitUntilRedirected=function(e){var t=this;return new Promise(function(n,r){t.status==i.Redirected?n():0>=e?r():setTimeout(function(){a.logger.log("waitUntilRedirected() timeout. count="+e),t.status!=i.Redirected?t.waitUntilRedirected(--e).then(function(){n()}).catch(function(){r()}):n()},2e3)})},e.prototype.handleRemoteSessionInfo=function(){var e=this;a.logger.log("handleRemoteSessionInfo called.");var t=this;t.remoteSessionInfoCb?t.remoteSessionInfoCb().then(function(n){a.logger.log("remoteSessionInfo success! info:"+JSON.stringify(n)),a.logger.log("Redirection status: Redirected"),t.status=i.Redirected,t.pingConnectionEnd(),(n=window.onVdiClientConnected)&&n(),e.telemetry.SendTelemetryInit(),t.onRedirectionComplete()}).catch(function(){a.logger.log("remoteSessionInfo failure!"),t.suspendRedirection(!0),t.onRedirectionComplete()}):(a.logger.log("remoteSessionInfoCb is invalid!"),t.suspendRedirection(!0),t.onRedirectionComplete())},e.prototype.startRedirection=function(e,t){var n=this,r=window.onVdiClientDisconnected;return new Promise(function(s,c){n.status!=i.Redirected?(a.logger.log("Attempting to start redirection: "+t),!1===e?n.deferredActions.push(new o.deferred_action(s,c,t)):n.connectToService().then(function(e){a.logger.log("Redirection status: Binding..."),n.status=i.Binding,n.websocket=e,n.websocket.onmessage=function(e){n.onWSMessage(e)},n.websocket.onclose=function(e){n.onWSClose(e)},s(),n.handleRemoteSessionInfo()}).catch(function(e){a.logger.log("Unable to connect to websocket service! "+e),c(),n.suspendRedirection(!0),n.onRedirectionComplete(),r&&r(!0)})):(a.logger.log("Redirection already started."),s())})},e.prototype.terminateOptimization=function(){this.websocket.close(1e3,"normal disconnecting!")},e.prototype.suspendRedirection=function(e){var t=this;a.logger.log("Suspending redirection."),this.handlers_.forEach(function(e,t){e.reset()});var n=window.onVdiClientDisconnected;try{n&&n(!1)}catch(e){a.logger.log("suspendRedirection(): exception during vdiClientDisconnect: "+e.message)}a.logger.log("Redirection status: NotRedirected");var r=this.status;this.status=i.NotRedirected;var o,s=!1,c=(n=window.getCitrixMSTeamsRedir,window.getCitrixWebrtcRedir);n?o=n:c&&(o=c),o&&o().then(function(n){a.logger.log("sucesss on disconnect"+n),"1"==n&&(s=!0,a.logger.log("Reg key exists while disconnecting")),e&&r===i.Redirected&&1==s&&(a.logger.log("Calling ping not normal disconnect"),t.pingConnectionBegin(!1))}).catch(function(){a.logger.log("Failure to Read MS Teams redir Reg Key, not retrying...")}),this.dispatchStateChangeNotifications()},e.prototype.onWSOpen=function(){},e.prototype.onWSClose=function(e){a.logger.log("disconnected from websocket service. "+JSON.stringify(e));try{e&&1e3==e.code?this.suspendRedirection(!1):this.suspendRedirection(!0)}catch(e){a.logger.log("suspendRedirection(): exception closing WebSocket: "+e.message)}},e.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(e){a.logger.log("suspendRedirection(): exception on WebSocket error: "+e.message)}},e.prototype.WSSendObjectWrapper=function(e,t,n,r){var i=!0;t!=s.class_id_t.EngineControl||n!=s.method_id_EngineControl_t.ctor&&n!=s.method_id_EngineControl_t.version&&n!=s.method_id_EngineControl_t.feature_flags||(i=!1);var o=!0;if(i&&(o=!1,void 0!=this.features)){i=0;for(var a=this.features;i<a.length;i++){var c=a[i];if(!0===c.value&&c.name==e){o=!0;break}}}return 1==o?this.WSSendObject(r):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+t+") mid("+n+")")},e.prototype.WSSendObject=function(e){var t=this;return new Promise(function(n,r){if("webrtc"==e.v){var i=e.hdr.proc.iid,o=e.hdr.proc.methodid,c=e.objref.oid;e.hdr.destroy||(i=new u(n,r,i,c,0,!0,o),t.reqs.push(i)),i=JSON.stringify(e),a.logger.trace("WSSendObject: >>> "+s.WebrpcClassLibInfoUtil.composeClassInfoData(e)+" "+i);try{t.websocket.readyState==WebSocket.OPEN?t.websocket.send(i):(a.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),n({}))}catch(e){a.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else if("overlay"==e.v){i=JSON.stringify(e),a.logger.log("HDXMS: SendOverlayData: >>> "+i+"'");try{t.websocket.readyState==WebSocket.OPEN?t.websocket.send(i):(a.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),n({}))}catch(e){a.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else if("telemetry"==e.v){i=JSON.stringify(e),a.logger.log("HDXMS: SendTelemetryData: >>> "+i+"'");try{t.websocket.readyState==WebSocket.OPEN?t.websocket.send(i):(a.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),n({}))}catch(e){a.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else if("appsharing"==e.v){i=JSON.stringify(e),a.logger.log("HDXMS: SendScreenSharingData: >>> "+i+"'");try{t.websocket.readyState==WebSocket.OPEN?t.websocket.send(i):(a.logger.log("WSSendObject(): warinig: web socket is not open, dropping the message!"),n({}))}catch(e){a.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else a.logger.log("HDXMS: WSSendObject: Unknown protocol: '"+JSON.stringify(e)+"'")})},e.prototype.webrpcStatusCodeToName=function(e){switch(e){case r.rpc_status_success:e="rpc_status_success";break;case r.rpc_status_unspecified_error:e="rpc_status_unspecified_error";break;case r.rpc_status_unexpected:e="rpc_status_unexpected";break;case r.rpc_status_index_out_of_bounds:e="rpc_status_index_out_of_bounds";break;case r.rpc_status_missing_parameter:e="rpc_status_missing_parameter";break;case r.rpc_status_missing_return_value:e="rpc_status_missing_return_value";break;case r.rpc_status_invalid_object:e="rpc_status_invalid_object";break;case r.rpc_status_user_exception:e="rpc_status_user_exception";break;case r.rpc_status_system_error:e="rpc_status_system_error";break;default:e="unknown"}return e},e.prototype.parceWebrpcError=function(e,t){var n;switch(void 0===e&&(e=t&&0<t.length?t[0].category||t[0].code||t[0].message?r.rpc_status_system_error:r.rpc_status_user_exception:r.rpc_status_unspecified_error),e){case r.rpc_status_unspecified_error:case r.rpc_status_unexpected:case r.rpc_status_index_out_of_bounds:case r.rpc_status_missing_parameter:case r.rpc_status_missing_return_value:case r.rpc_status_invalid_object:n=new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e));break;case r.rpc_status_user_exception:n=t&&0<t.length?new DOMException(t[0],this.webrpcStatusCodeToName(e)):new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e));break;case r.rpc_status_system_error:if(t&&0<t.length){n=Object.create(DOMException);var i={value:null,writable:!0,enumerable:!1,Configurable:!0};i.value=t[0].category,Object.defineProperty(n,"name",i),i.value=t[0].code,Object.defineProperty(n,"code",i),i.value=t[0].message,Object.defineProperty(n,"message",i)}else n=new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e))}return n},e.prototype.onWSMessage=function(e){var t;e=e.data;try{t=JSON.parse(e)}catch(t){return a.logger.log("invalid JSON!!!"),a.logger.log(t),void a.logger.log(e)}if("webrtc"==t.v){a.logger.trace("onWSMessage: <<< "+s.WebrpcClassLibInfoUtil.composeClassInfoData(t)+" "+e);var n=t.hdr.proc.iid,r=t.hdr.proc.methodid,i=t.objref.oid,o=t.status;if(t.hdr.msg_type==c.WsJsonUtil.getMsgType(c.ws_msg_type_t.reply))0<=(e=this.reqs.findIndex(function(e){return e.iid==n&&e.oid==i&&e.mid==r}))?0==o?this.reqs.splice(e,1).shift().resolve(t):(o=this.parceWebrpcError(o,t.params),this.reqs.splice(e,1).shift().reject(o)):(a.logger.log("HDXMS didnt find this one. (reqs)"),a.logger.log(this.reqs));else if(t.hdr.msg_type==c.WsJsonUtil.getMsgType(c.ws_msg_type_t.event_req)){var d=t.func.id;0<=(e=this.cbs.findIndex(function(e){return e.iid==n&&e.oid==i&&e.cbid==d>>16}))?(0==(65535&d)?this.cbs[e].resolve(t):(o=this.parceWebrpcError(o,t.params),this.cbs[e].reject(o)),1==this.cbs[e].oneShot&&(this.cbs[e].completion_cb?this.cbs[e].completion_cb(this.cbs[e].cbid,this.cbs[e].mid):a.logger.log("HDXMS didnt find completion_cb for oneShot callback, something went wrong!!!! cbid="+this.cbs[e].cbid+" (iid, mid)=("+this.cbs[e].iid,","+this.cbs[e].mid+")"))):(a.logger.log("HDXMS didnt find this one. (cbs)"),a.logger.log(JSON.stringify(this.cbs)))}else a.logger.log("HDXMS Received bogus message: "+e+"'")}else if("telemetry"==t.v)0==t.status&&(2==(2147483647&(o=t.hdr.command))&&(e=t.hdr.id,this.telemetry.onInitialized(e),a.logger.log("Telemetry init response received")));else if("features"==t.v){if(e=t.features,"feature-support"==t.command)for(a.logger.log("features capabilities received, features:"+e),this.vdafeatures_=e,o=0;o<e.length;o++)e[o]===s.FEATURE_vda_app_sharing&&this.screenshare.onInitialized(!0);this.clientViewportMode_=t.client_viewport_mode,a.logger.log("features client_viewport_mode value: "+this.clientViewportMode_),this.sessionId_=t.client_session_id}else"appsharing"==t.v?0==(e=t.status)?(o=t.hdr.command,e=t.hdr.id,(2147483647&o)==l.sshare_cmd.GetSources?(a.logger.log("appsharing GetSources response received"),o=t.data,this.screenshare.onGetSources(e,o)):(2147483647&o)==l.sshare_cmd.SetActive?(a.logger.log("appsharing SetActive response received"),o=t.data,this.screenshare.onSetActive(e,o)):(2147483647&o)==l.sshare_cmd.TopologyChanged?(a.logger.log("appsharing Window topology changed cmd received"),this.screenshare.onToplogyChanged()):(a.logger.log("invalid command reply:"+o),this.screenshare.onError(e))):(a.logger.log("invalid status reply:"+e),e=t.hdr.id,this.screenshare.onError(e)):void 0!=(o=this.handlers_.find(function(e){return e.name==t.v}))?o.on_message(t):a.logger.log("HDXMS: onWSMessage: Unknown protocol: "+e+"'")},e.prototype.clearReqs=function(){a.logger.log("clearReqs()"),this.reqs.forEach(function(e,t){e.reject()}),this.reqs=[]},e.prototype.registerHandler=function(e,t,n,r){e=new u(r.resolve.bind(r),r.reject.bind(r),e,t,r.id,r.oneShot,n,r.completion_cb),this.cbs.push(e)},e.prototype.unregisterHandler=function(e,t,n){var r=this.cbs.findIndex(function(r){return r.iid==e&&r.oid==t&&r.cbid==n});0<=r?this.cbs.splice(r,1):(a.logger.log("HDXMS Didnt find this callback in the list!"),a.logger.log(JSON.stringify(this.cbs)))},e.prototype.isRedirected=function(){return this.status===i.Redirected||this.status===i.Binding||this.status===i.Connecting},e.prototype.isConnected=function(){return this.status==i.Redirected},e.prototype.isPingActive=function(){return this.pingactive},e.prototype.pingConnectionBegin=function(e){a.logger.log("Started timer"),this.pingactive=!0;var t=window.onVdiClientDisconnectedTimer;1==e?(a.logger.log("checking if we are connected..."),t()):this.conntimer=setTimeout(function(){a.logger.log("checking if we are connected..."),t&&t()},15e3)},e.prototype.pingConnectionEnd=function(){this.pingactive=!1,clearTimeout(this.conntimer)},e.prototype.SendTelemetryData_Speaker=function(e){this.telemetry.SendTelemetryData(d.tel_cmd.Data,d.tel_key_SpeakerDeviceUsed,e,0)},e.prototype.registerStateChangeNotification=function(e){this.stateChangeNotifcations.push(e)},e.prototype.unregisterStateChangeNotification=function(e){this.stateChangeNotifcations=this.stateChangeNotifcations.filter(function(t){return t!=e})},e.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach(function(e){e()})},e.prototype.vdabufferNoLimit=function(){for(var e=!1,t=0,n=this.vdafeatures_;t<n.length;t++)if(n[t]===s.FEATURE_vda_service_no_buffer_limit){e=!0;break}return e},Object.defineProperty(e.prototype,"clientViewportMode",{get:function(){return this.clientViewportMode_||"unknown"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionClientId",{get:function(){return this.sessionId_||""},enumerable:!1,configurable:!0}),e.prototype.addProtocolHandler=function(e){void 0==this.handlers_.find(function(t){return t.name==e.name})&&this.handlers_.push(e)},e}(),t.HdxMediaStream=e;var f=new e;t.getRedirector=function(){return f}},985:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;e=Array(e);var r=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,r++)e[r]=i[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.IceCandidatePair=t.IceCandidate=void 0;var o=n(658),a=n(550),s=n(851);e=function(e){function t(t,n,r){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return e.apply(this,i([t,a.class_id_t.RTCIceCandidate,n,r,null,[]],o))||this}return r(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!1,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.candidate,""),e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.sdpMid,""),e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(t){t=t.map(function(t){return e.param0(t)}),e.candidate_=t[0],e.sdpMid_=t[1],e.sdpMLineIndex_=t[2],e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),e.syncBarrierReject(t)})})},t}(o.ProxyObject),t.IceCandidate=e,e=function(e){function t(t,n){return e.call(this,t,a.class_id_t.RTCIceCandidatePair,n,o.ProxyMode.Remote)||this}return r(t,e),Object.defineProperty(t.prototype,"local",{get:function(){return this.local_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remote",{get:function(){return this.remote_},enumerable:!1,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("IceCandidatePair.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,a.method_id_RTCIceCandidatePair_t.local,{}),e.remoteInvoke(!1,a.method_id_RTCIceCandidatePair_t.remote,{})])}).then(function(t){t=t.map(function(t){return e.param0(t)}),e.local_=t[0],e.remote_=t[1],e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),e.syncBarrierReject(t)})})},t}(o.ProxyObject),t.IceCandidatePair=e},851:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.Logger=void 0;var r=n(550);e=function(){function e(e){this.tracing=!1,this.mslogger_=void 0,this.enable_timestamp_=!1,this.tag=e,this.enabled=!0,r.BUILD_TYPE_SDK&&(this.enable_timestamp_=!0)}return e.prototype.setMSLogger=function(e,t){this.mslogger_=e,void 0!=t&&(this.enable_timestamp_=t)},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(e=this.tag+" "+e,this.enable_timestamp_&&(e="["+(t=new Date).getTime()+"] "+t.toISOString()+" "+e),void 0!=this.mslogger_?this.mslogger_.info(e):console.log(e))},e.prototype.logx=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e||this.log(t)},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracing&&this.log.apply(this,e)},e}(),t.Logger=e,t.logger=new e("[HdxWebRTC.js]"),t.logger.enabled=!0},360:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;d;)try{if(i=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,a=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if(!(s=0<(s=d.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))d.label=n[1];else if(6===n[0]&&d.label<s[1])d.label=s[1],s=n;else{if(!(s&&d.label<s[2])){s[2]&&d.ops.pop(),d.trys.pop();continue}d.label=s[2],d.ops.push(n)}}n=t.call(e,d)}catch(e){n=[6,e],a=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,s,c,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o.initSymbol(),o.initSymbol(),o.initSymbolIterator(),c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;e=Array(e);var r=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,r++)e[r]=i[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.PeerConnection=t.SessionDescription=t.SessionDescriptionInit=t.RtcConfiguration=t.RtcIceServer=t.IceCandidateEvent=void 0;var c=n(946),d=n(144),l=n(589),u=n(658),f=n(985),h=n(377),p=n(650),_=n(24),g=n(550),m=n(851),v=n(517),y=n(394),b=function(e){function t(t,n,r){return(t=e.call(this,t,g.class_id_t.RTCIceCandidateEvent,n,u.ProxyMode.Remote)||this).target=r,t.type="icecandidate",t}return r(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!1,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return m.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){return e.remoteInvoke(!1,g.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(t){return!1===(t=e.param0(t)).is_null?new f.IceCandidate(e,t.oid,u.ProxyMode.Remote).syncBarrier():Promise.resolve(null)}).then(function(t){m.logger.log(e.user_friendly_id()+".onicecandidate: icecandidate available!"),e.candidate_=t,e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".onicecandidate() failed!"),e.syncBarrierReject(t)})})},t}(u.ProxyObject);t.IceCandidateEvent=b;var C=function(){function e(e,t){this.state_="new",this.candidates_=[],this.gatheringstateupdatecb_=void 0,this.pc_=e,this.gatheringstateupdatecb_=t}return e.prototype.pushState=function(e){m.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+e),this.state_=e,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},e.prototype.addIceCandidate=function(e){var t=this;this.candidates_.push(e);var n=[];n.push(e.syncBarrier()),n.push(this.pc_.updateSdpDescription(!0)),Promise.all(n).then(function(e){m.logger.log(t.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),t.postIceCandidate(e[0])})},e.prototype.postIceCandidate=function(e){m.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(e):m.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},e.prototype.postUpdate=function(){m.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var e=new w("onicegatheringstatechange",this.pc_);this.gatheringstateupdatecb_&&this.gatheringstateupdatecb_(this.state_),this.pc_.onicegatheringstatechange(e)},e.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):m.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(e){return e.object_id()})+"], state="+this.state_)},e}(),S=function(){function e(){}return e.toRtcIceServer=function(e,t){var n={urls:[],credential:"",username:""};if(e&&(e.urls?Array.isArray(e.urls)?n.urls=e.urls:n.urls.push(e.urls):m.logger.log("RtcIceServer.toRtcIceServer().urls property is missing! this is required property!"),e.credential&&(e.credential.hasOwnProperty("accessToken")?n.credential=e.credential.accessToken:n.credential=e.credential),e.username&&(n.username=e.username)),1==t)for(var r in e)"urls"!=r&&"credential"!=r&&"username"!=r&&m.logger.log("RtcIceServer.toRtcIceServer() warning: unsupported property:"+r);return n},e}();t.RtcIceServer=S;var E=function(){function e(){}return e.toRtcConfiguration=function(e,t){1==t&&m.logger.log("RtcConfiguration.toRtcConfiguration() in RTCConfiguration config:"+JSON.stringify(e));var n={};if(e){if(e.iceServers){n.iceServers=[];for(var r=0,i=e.iceServers;r<i.length;r++)n.iceServers.push(S.toRtcIceServer(i[r],t))}e.iceTransportPolicy&&(n.iceTransportPolicy=e.iceTransportPolicy),e.bundlePolicy&&(n.bundlePolicy=e.bundlePolicy),e.rtcpMuxPolicy&&(n.rtcpMuxPolicy=e.rtcpMuxPolicy),e.iceTransports&&(n.iceTransports=e.iceTransports),e.sdpSemantics&&(n.sdpSemantics=e.sdpSemantics),e.enableDtlsSrtp&&(n.enableDtlsSrtp=e.enableDtlsSrtp),e.enableDscp&&(n.enableDscp=e.enableDscp)}if(1==t){for(var o in e)"iceServers"!=o&&"iceTransportPolicy"!=o&&"bundlePolicy"!=o&&"rtcpMuxPolicy"!=o&&"iceTransports"!=o&&"sdpSemantics"!=o&&"enableDtlsSrtp"!=o&&"enableDscp"!=o&&m.logger.log("RtcConfiguration.toRtcConfiguration() warning: unsupported property:"+o);m.logger.log("RtcConfiguration.toRtcConfiguration() converted RtcConfiguration config:"+JSON.stringify(n))}return n},e}();t.RtcConfiguration=E;var R=function(e,t){this.sdp=t,this.type=e};t.SessionDescriptionInit=R;var T=function(e){function t(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return e.apply(this,s([t,g.class_id_t.RTCSessionDescription,n,r,null,[]],i))||this}return r(t,e),t.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(t.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!1,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return m.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,g.method_id_RTCSessionDescription_t.type,0),e.remoteInvoke(!1,g.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(t){e.type_=e.convertType(e.param0(t[0])),e.sdp_=e.param0(t[1]),e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},t.prototype.convertType=function(e){return 0==e?"offer":1==e?"pranswer":2==e?"answer":"rollback"},t.convertC2H=function(e){return"offer"==e?0:"pranswer"==e?1:"answer"==e?2:3},t}(u.ProxyObject);t.SessionDescription=T;var w=function(e,t){this.type=e,this.target=t},k=function(){},I=function(){function e(e,t){this.local=e,this.remote=t}return Object.defineProperty(e.prototype,"active",{get:function(){var e=!1;return 1!=this.local&&1!=this.remote||(e=!0),e},enumerable:!1,configurable:!0}),e}();e=function(e){function t(n){var r=e.call(this,null,g.class_id_t.RTCPeerConnection,0,u.ProxyMode.Local,null,[],t.ensure_config_defined(n,!1),{})||this;if(r.timeerstarted_=!1,r.firsttimeremoteoffer_=!1,r.firststable_=!1,r.firsttimelocaloffer_=!1,r.audiocall_=new I(!1,!1),r.videocall_=new I(!1,!1),r.screensharingcall_=new I(!1,!1),r.conferencecall_=!1,r.incomingcall_=!1,r.outgoingcall_=!1,r.usingasynconly_=!1,r.rtcconfig_=t.ensure_config_defined(n,!0),m.logger.log(r.user_friendly_id()+".constructor sdpSemantics="+r.rtcconfig_.sdpSemantics),!g.BUILD_TYPE_SDK&&r.isUnified()&&!c.getRedirector().getFeatureValue(g.FEATURE_ms_teams_webrtc_1dot0))throw new DOMException("CWA client does not support unified sdpSemantic","createPeerConnection");return r.pendingtransceiver_=0,r.pendingtrack_=0,r.deferredOfferAnswers=[],r.localStreams=[],r.remoteStreams=[],r.onaddstream_=null,r.signalingState_="stable",r.iceConnectionState_="new",r.iceGatheringState_="new",r.iceQ_=new C(r,function(e){r.onicegatheringstateupdate(e)}),r.receivers_=[],r.senders_=[],r.transceivers_=[],r.registerStateChangeNotification(r.onStateChange),r.localdatachannel_=null,r.remotedatachannel_=null,r}return r(t,e),t.ensure_config_defined=function(e,t){return E.toRtcConfiguration(e,t)},t.prototype.dumpSdp=function(e){m.logger.log(this.user_friendly_id()+".dumpSdp"),e&&(m.logger.log(this.user_friendly_id()+"  -- type: "+e.type),m.logger.log(this.user_friendly_id()+"  -- sdp: "+e.sdp))},Object.defineProperty(t.prototype,"localDescription",{get:function(){return m.logger.log(this.user_friendly_id()+".get_localDescription() called."),this.localDescription_},set:function(e){m.logger.log(this.user_friendly_id()+".set_localDescription() called."),this.localDescription_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteDescription",{get:function(){return m.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_},set:function(e){m.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_=e},enumerable:!1,configurable:!0}),t.prototype.isUnified=function(){return"unified"==this.rtcconfig_.sdpSemantics||"unified-plan"==this.rtcconfig_.sdpSemantics},t.prototype.onStateChange=function(){var e=new w("iceconnectionstatechange",this);this.oniceconnectionstatechange_&&this.oniceconnectionstatechange_(e)},t.prototype.addIceCandidate=function(e){var t=this;m.logger.log(this.user_friendly_id()+".addIceCandidate() called."),this.waitUntilConnected(this.user_friendly_id()+".addIceCandidate").then(function(){var n={candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex};return void 0!=n.candidate&&null!=n.candidate||(n.candidate=""),void 0==n.sdpMid&&(n.sdpMid=null),void 0==n.sdpMLineIndex&&(n.sdpMLineIndex=null),new f.IceCandidate(t,0,u.ProxyMode.Local,n).syncBarrier()}).then(function(e){return t.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.addIceCandidate,[e],{})}).then(function(){return m.logger.log(t.user_friendly_id()+".addIceCandidate() success."),t.updateSdpDescription(!1)}).then(function(){m.logger.log(t.user_friendly_id()+".addIceCandidate() - sync remote sdp success.")}).catch(function(e){t.logRemoteInvokeError(e,".addIceCandidate() failed!")})},Object.defineProperty(t.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=e,this.waitUntilConnected(this.user_friendly_id()+".onicecandidate").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onicecandidate);return n.then(function(e){m.logger.log(t.user_friendly_id()+".onicecandidate callback received!!!"),e=new b(t,t.param0(e).oid,t),null!=t.iceQ_&&t.iceQ_.addIceCandidate(e)}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onicecandidate,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onicecandidate() failed!")})},enumerable:!1,configurable:!0}),t.prototype.convertIceConnectionState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},t.prototype.convertConnectionState=function(e){if(0!=e){if(1==e)return"connecting";if(2==e)return"connected";if(3==e)return"disconnected";if(4==e)return"failed";if(5==e)return"closed"}return"new"},Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onconnectionstatechange);return n.then(function(e){m.logger.log(t.user_friendly_id()+".onconnectionstatechange(): success callback received!!!"),t.connectionState_=t.convertConnectionState(t.param0(e)),m.logger.log(t.user_friendly_id()+" connectionState=:"+t.connectionState_),e=new w("connectionstatechange",t),t.onconnectionstatechange_&&t.onconnectionstatechange_(e)}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onconnectionstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onconnectionstatechange() failed!")})},enumerable:!1,configurable:!0}),t.prototype.get_connectionState=function(){return m.logger.log(this.user_friendly_id()+".get_connectionState() called, value = "+this.connectionState_),this.isRedirected()?this.connectionState_:"failed"},Object.defineProperty(t.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".oniceconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return n.then(function(e){m.logger.log(t.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),t.iceConnectionState_=t.convertIceConnectionState(t.param0(e)),e=new w("iceconnectionstatechange",t),t.oniceconnectionstatechange_&&t.oniceconnectionstatechange_(e)}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.oniceconnectionstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_oniceconnectionstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return m.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!1,configurable:!0}),t.prototype.convertIceGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},t.prototype.onicegatheringstateupdate=function(e){m.logger.log(this.user_friendly_id()+".onicegatheringstateupdate() current:"+this.iceGatheringState_+" updating to:"+e),this.iceGatheringState_=e,m.logger.log(this.user_friendly_id()+".onicegatheringstateupdate() after update: iceGatheringState_:"+this.iceGatheringState_)},Object.defineProperty(t.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onicegatheringstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onicegatheringstatechange);return n.then(function(e){m.logger.log(t.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),e=t.convertIceGatheringState(t.param0(e)),null!=t.iceQ_&&t.iceQ_.pushState(e)}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onicegatheringstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onicegatheringstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return m.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!1,configurable:!0}),t.prototype.convertSignalState=function(e){return 0==e?"stable":1==e?"have-local-offer":2==e?"have-local-pranswer":3==e?"have-remote-offer":4==e?"have-remote-pranswer":"closed"},t.prototype.TelemtryReadings_=function(){var e=this;if("have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),0==this.outgoingcall_&&(this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.active,1),this.SendTelemetryData(y.tel_key_PerfCallDirection,y.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0),"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.active,1),this.SendTelemetryData(y.tel_key_PerfCallDirection,y.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0),"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.firststable_=this.timeerstarted_=!0),"stable"==this.signalingState_){for(var t=0,n=this.localStreams;t<n.length;t++){var r=n[t];if(1<=r.getAudioTracks().length&&0==this.audiocall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.audio,1),this.audiocall_.local=!0),1<=(r=r.getVideoTracks()).length)for(var i=0,o=r;i<o.length;i++)1==(r=o[i]).getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.video,1),this.videocall_.local=!0)}for(t=0,n=this.remoteStreams;t<n.length;t++)if(1<=(r=n[t]).getAudioTracks().length&&0==this.audiocall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.audio,1),this.audiocall_.remote=!0),1<=(i=r.getVideoTracks()).length)for(r=0;r<i.length;r++)1==i[r].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.video,1),this.videocall_.remote=!0);this.getReceiversAsync().then(function(t){2<t.length&&0==e.conferencecall_&&(e.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.multi,1),e.conferencecall_=!0)})}},Object.defineProperty(t.prototype,"onsignalingstatechange",{set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onsignalingstatechanged").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onsignalingstatechange);return n.then(function(e){m.logger.log(t.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),t.signalingState_=t.convertSignalState(t.param0(e)),e=new w("onsignalingstatechange",t),t.onsignalingstatechange_&&t.onsignalingstatechange_(e),t.TelemtryReadings_()}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onsignalingstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onsignalingstatechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ontrack",{get:function(){return this.ontrack_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_ontrack() called."),this.ontrack_=e,this.waitUntilConnected(this.user_friendly_id()+".ontrack").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.ontrack);return n.then(function(e){return i(t,void 0,void 0,function(){var t,n,r,i,o,s,c,f,_,g,v,y=this;return a(this,function(a){if(m.logger.log(this.user_friendly_id()+".ontrack(): callback received!!!"),t=new k,n=[],void 0!=(r=this.param0(e)).track&&!1===r.track.is_null&&(m.logger.log(this.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+r.track.oid),i=new d.RemoteMediaTrack(this,r.track.oid),n.push(i.syncBarrier())),t.track=i,void 0!=r.receiver&&!1===r.receiver.is_null&&(void 0===(o=this.receivers_.find(function(e){return e.object_id()===r.receiver.oid}))&&(m.logger.log(this.user_friendly_id()+" adding a RtpReceiver with oid:"+r.receiver.oid),o=new l.RtpReceiver(this,r.receiver.oid,u.ProxyMode.Remote,this.isUnified(),i)),n.push(o.syncBarrier())),t.receiver=o,p.RemoteSession.isFeatureWebrtc1dot0Supported()&&void 0!=r.transceiver&&!1===r.transceiver.is_null&&(void 0===(s=this.transceivers_.find(function(e){return e.object_id()===r.transceiver.oid}))&&(m.logger.log(this.user_friendly_id()+" adding a RtpTransceiver with oid:"+r.transceiver.oid),s=new h.RtpTransceiver(this,r.transceiver.oid,u.ProxyMode.Remote,this.isUnified(),h.RtcRtpTransceiverDirection.inactive,o),this.transceivers_.push(s)),n.push(s.syncBarrier())),t.transceiver=s,t.streams=[],void 0!=r.streams)for(c=function(e){var r=f.remoteStreams.find(function(t){return!1===e.is_null&&t.object_id()===e.oid});void 0===r&&(m.logger.log(f.user_friendly_id()+" adding a RemoteStream with oid:"+e.oid),r=new d.RemoteStream(f,e.oid,u.ProxyMode.Remote),f.remoteStreams.push(r)),n.push(r.syncBarrier()),t.streams.push(r)},f=this,_=0,g=r.streams;_<g.length;_++)v=g[_],c(v);return m.logger.log(this.user_friendly_id()+".ontrack(): .prop.syncBarrier start"),Promise.all(n).then(function(){m.logger.log(y.user_friendly_id()+".ontrack(): notified!!! with evt: "+t);for(var e=0,n=t.streams;e<n.length;e++)n[e].toggleAudio(!1);y.ontrack_&&y.ontrack_(t)}).catch(function(e){y.logRemoteInvokeError(e,".ontrack(): .prop.syncBarrier failed.")}),[2]})})}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.ontrack,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_ontrack(): failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return m.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=e,this.waitUntilConnected(this.user_friendly_id()+".onnegotiationneeded").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onnegotiationneeded);return n.then(function(){m.logger.log(t.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var e=new w("negotiationneeded",t);t.onnegotiationneeded_&&t.onnegotiationneeded_(e)}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onnegotiationneeded,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onnegotiationneeded(): failed.")})},enumerable:!1,configurable:!0}),t.prototype.dumpConstraints=function(e){m.logger.log(this.user_friendly_id()+"constraints: "+e),void 0!==e&&0!==Object.keys(e).length||m.logger.log(this.user_friendly_id()+"constraints either undefined or empty!"),e&&(m.logger.log(this.user_friendly_id()+"  -- video: "+e.offerToReceiveVideo),m.logger.log(this.user_friendly_id()+"  -- audio: "+e.offerToReceiveAudio),m.logger.log(this.user_friendly_id()+"  -- iceRestart: "+e.iceRestart),m.logger.log(this.user_friendly_id()+"  -- voiceActivityDetection: "+e.voiceActivityDetection))},t.prototype.fix_constraints=function(e){this.dumpConstraints(e);var t={};return this.isUnified()||(t={audio:!0,video:!0}),e&&(void 0===e.video&&void 0===e.offerToReceiveVideo||(t.video=e.offerToReceiveVideo),void 0===e.audio&&void 0===e.offerToReceiveAudio||(t.audio=e.offerToReceiveAudio),void 0!==e.iceRestart&&(t.iceRestart=e.iceRestart),void 0!==e.voiceActivityDetection&&(t.voiceActivityDetection=e.voiceActivityDetection)),t},t.prototype.createOffer=function(e,t,n){return m.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(e)),this.isUnified()?void 0==e?this.createOffer_v2():e?this.createOffer_v2(e):this.createOffer_v1(e,t,n):this.createOffer_v1(e,t,n)},t.prototype.createOffer_v2=function(e){var t=this;return m.logger.log(this.user_friendly_id()+".createOffer_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.createOffer_v1(function(e){m.logger.log(t.user_friendly_id()+".createOffer_v2(): got sdp!!!",JSON.stringify(e)),e=new R(e.type,e.sdp),n(e)},function(e){void 0!=e&&(e=t.logRemoteInvokeError(e,".createOffer_v2() failed."),r(e))},e)})},t.prototype.createOffer_v1=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".createOffer_v1().",JSON.stringify(n));var i=[this.waitUntilConnected(this.user_friendly_id()+".createOffer_v1"),this.waitTransceiverAndTrackReady(this.user_friendly_id()+".createOffer_v1")];Promise.all(i).then(function(){var e=r.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.createOffer);return r.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.createOffer,e.success,e.fail,r.fix_constraints(n)),e.prom()}).then(function(e){return m.logger.log(r.user_friendly_id()+".createOffer_v1(): success callback received!!!"),new T(r,r.param0(e).oid,u.ProxyMode.Remote).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(e){void 0!=e&&(e=r.logRemoteInvokeError(e,".createOffer_v1() failed."),t&&t(e))})},t.prototype.createAnswer=function(e,t,n){return m.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(e)),this.isUnified()?void 0==e?this.createAnswer_v2():e?this.createAnswer_v2(e):this.createAnswer_v1(e,t,n):this.createAnswer_v1(e,t,n)},t.prototype.createAnswer_v2=function(e){var t=this;return m.logger.log(this.user_friendly_id()+".createAnswer_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.createAnswer_v1(function(e){m.logger.log(t.user_friendly_id()+".createAnswer_v2(): got sdp!!!",JSON.stringify(e)),e=new R(e.type,e.sdp),n(e)},function(e){void 0!=e&&(e=t.logRemoteInvokeError(e,".createAnswer_v2() failed."),r(e))},e)})},t.prototype.createAnswer_v1=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".createAnswer_v1() called.",JSON.stringify(n));var i=[this.waitUntilConnected(this.user_friendly_id()+".createAnswer_v1"),this.waitTransceiverAndTrackReady(this.user_friendly_id()+".createAnswer_v1")];Promise.all(i).then(function(){var e=r.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.createAnswer);return r.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.createAnswer,e.success,e.fail,r.fix_constraints(n),{}),e.prom()}).then(function(e){return m.logger.log(r.user_friendly_id()+".createAnswer_v1(): success callback received!!!"),new T(r,r.param0(e).oid,u.ProxyMode.Remote).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(e){e=r.logRemoteInvokeError(e,".createAnswer_v1() failed."),t&&t(e.message)})},t.prototype.updateSdpDescription=function(e){m.logger.log(this.user_friendly_id()+".updateSdpDescription() called.");var t=this;return new Promise(function(n,r){var i=[];1==e?i.push(t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.localDescription,{oid:0})):i.push(t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.remoteDescription,{oid:0})),Promise.all(i).then(function(e){return m.logger.log(t.user_friendly_id()+".updateSdpDescription() resolved."),new T(t,t.param0(e[0]).oid,u.ProxyMode.Remote).syncBarrier()}).then(function(r){1==e?t.localDescription_=r:t.remoteDescription_=r,m.logger.log(t.user_friendly_id()+".updateSdpDescription() updated sdp"),n()}).catch(function(e){t.logRemoteInvokeError(e,"sdp.syncBarrier() failed!"),r()})})},t.prototype.sdpToString=function(e){var t="",n=0;for(e=e?e.split(/\r?\n/):[];n<e.length;n++){var r=e[n];-1!=r.indexOf("m=",0)?t+=r+"\\r\\n":-1!=r.indexOf("o=-",0)?t+=r+"\\r\\n":-1!=r.indexOf("a=ssrc",0)&&(t+=r+"\\r\\n")}return t},t.prototype.setLocalDescription=function(e,t,n){return m.logger.log(this.user_friendly_id()+".setLocalDescription() called.",this.sdpToString(e.sdp)),e instanceof R?this.setLocalDescription_v2(e):e instanceof RTCSessionDescription&&t?this.setLocalDescription_v1(e,t,n):(t=void 0,e?t=new R(e.type,e.sdp):(m.logger.log(this.user_friendly_id()+".setLocalDescription() empty param1, setting sdp type to rollback"),e=void 0,e="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",t=new R(e,"")),this.setLocalDescription_v2(t))},t.prototype.setLocalDescription_v2=function(e){var t=this;return m.logger.log(this.user_friendly_id()+".setLocalDescription_v2() called."),new Promise(function(n,r){t.waitUntilConnected(t.user_friendly_id()+".setLocalDescription_v2").then(function(){return new T(t,0,u.ProxyMode.Local,{type:T.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(i){var o=t.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setLocalDescription_v2),a={type:T.convertC2H(e.type),sdp:e.sdp};t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.setLocalDescription_v2,a,o.success,o.fail),o.prom().then(function(){m.logger.log(t.user_friendly_id()+".setLocalDescription_v2(): success callback received!!!"),t.localDescription_=i,m.logger.log(t.user_friendly_id()+".setLocalDescription_v2(): updated localDescription_"),Promise.all([]).then(function(){m.logger.log(t.user_friendly_id()+".setLocalDescription_v2() success."),n()}).catch(function(e){e=t.logRemoteInvokeError(e,".prop.setLocalDescription_v2() failed!"),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,"setLocalDescription_v2() error callback received!"),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".setLocalDescription_v2() failed."),r(e)})})},t.prototype.setLocalDescription_v1=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".setLocalDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setLocalDescription_v1").then(function(){return new T(r,0,u.ProxyMode.Local,{type:T.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var i=r.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setLocalDescription);r.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.setLocalDescription,[e],i.success,i.fail),i.prom().then(function(){m.logger.log(r.user_friendly_id()+".setLocalDescription_v1(): success callback received!!!"),r.localDescription_=e,m.logger.log(r.user_friendly_id()+".setLocalDescription_v1(): updated localDescription_"),Promise.all([]).then(function(){m.logger.log(r.user_friendly_id()+".setLocalDescription_v1() success."),t&&t()}).catch(function(e){e=r.logRemoteInvokeError(e,".prop.setLocalDescription_v1() failed."),n&&n(e.message)})}).catch(function(e){e=r.logRemoteInvokeError(e,".setLocalDescription_v1() error callback received."),n&&n(e.message)})}).catch(function(e){e=r.logRemoteInvokeError(e,".setLocalDescription_v1() failed."),n&&n(e.message)})},t.prototype.setRemoteDescription=function(e,t,n){return m.logger.log(this.user_friendly_id()+".setRemoteDescription() called.",this.sdpToString(e.sdp)),e instanceof R?this.setRemoteDescription_v2(e):e instanceof RTCSessionDescription&&t?this.setRemoteDescription_v1(e,t,n):(t=void 0,e?t=new R(e.type,e.sdp):(m.logger.log(this.user_friendly_id()+".setRemoteDescription() empty param1, setting sdp type to rollback"),e=void 0,e="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",t=new R(e,"")),this.setRemoteDescription_v2(t))},t.prototype.setRemoteDescription_v2=function(e){var t=this;return m.logger.log(this.user_friendly_id()+".setRemoteDescription_v2() called."),new Promise(function(n,r){t.waitUntilConnected(t.user_friendly_id()+".setRemoteDescription_v2").then(function(){var i=new T(t,0,u.ProxyMode.Local,{type:T.convertC2H(e.type),sdp:e.sdp}),o=[];o.push(i.syncBarrier());i=t.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setRemoteDescription_v2);var a={type:T.convertC2H(e.type),sdp:e.sdp};t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.setRemoteDescription_v2,a,i.success,i.fail),o.push(i.prom()),Promise.all(o).then(function(e){m.logger.log(t.user_friendly_id()+".setRemoteDescription_v2(): remote success."),t.remoteDescription_=e[0],o=[],t.usingasynconly_||(t.isUnified()?o.push(t.getTransceiversAsync()):o.push(t.getSendersAsync())),Promise.all(o).then(function(e){m.logger.log(t.user_friendly_id()+".setRemoteDescription_v2(): final success."),n()}).catch(function(e){e=t.logRemoteInvokeError(e,".prop.setRemoteDescription_v2() final failed."),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".prop.setRemoteDescription_v2() remote failed."),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".setRemoteDescription_v2() failed."),r(e)})})},t.prototype.setRemoteDescription_v1=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".setRemoteDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setRemoteDescription_v1").then(function(){return new T(r,0,u.ProxyMode.Local,{type:T.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var i=r.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setRemoteDescription);r.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.setRemoteDescription,[e],i.success,i.fail),i.prom().then(function(){m.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): success callback received!!!"),r.remoteDescription_=e,m.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): updated remoteDescription_");var i=[];r.usingasynconly_||(r.isUnified()?i.push(r.getTransceiversAsync()):i.push(r.getSendersAsync())),Promise.all(i).then(function(){m.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): success."),t&&t()}).catch(function(e){e=r.logRemoteInvokeError(e,".prop.setRemoteDescription_v1() failed."),n&&n(e.message)})})}).catch(function(e){e=r.logRemoteInvokeError(e,".setRemoteDescription_v1() failed."),n&&n(e.message)})},t.prototype.getLocalStreams=function(){m.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]");for(var e=0,t=this.localStreams;e<t.length;e++)m.logger.log(JSON.stringify(t[e]));return this.localStreams},t.prototype.getRemoteStreams=function(){m.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var e=0,t=this.remoteStreams;e<t.length;e++)m.logger.log(JSON.stringify(t[e]));return this.remoteStreams},t.prototype.addTrack=function(e,t){return this.addTrackInternal(e,t,!1)},t.prototype.addTrackAsync=function(e,t){return this.addTrackInternal(e,t,!0)},t.prototype.addTrackInternal=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".addTrackInternal() called. track.id = "+e.id+", streams = "+JSON.stringify(t)+", isAsync = "+n),this.incrementPendingTrackCount();var i=[];if(t)if(t instanceof d.RemoteStream)i.push(t.id),this.localStreams.push(t);else for(var o=0;o<t.length;o++)i.push(t[o].id),this.localStreams.push(t[o]);else m.logger.log(this.user_friendly_id()+".addTrackInternal() empty streams passed in, continue with empty array");var a=new l.RtpSender(this,0,u.ProxyMode.Pseudo,this.isUnified());return this.senders_.push(a),t=new Promise(function(t,n){r.waitUntilConnected(r.user_friendly_id()+".addTrackInternal").then(function(){return r.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.addTrack,[e],i)}).then(function(e){m.logger.log(r.user_friendly_id()+".addTrackInternal() success with oid: "+r.param0(e).oid),a.bind(r,r.param0(e).oid),a.syncBarrier().then(function(){m.logger.log(r.user_friendly_id()+"sender.syncBarrier(): success"),!r.usingasynconly_&&r.isUnified()?r.getTransceiversAsync().then(function(){r.decrementPendingTrackCount(),t(a)}).catch(function(e){r.logRemoteInvokeError(e,".addTrackInternal() getTransceiversAsync() failed!"),r.decrementPendingTrackCount(),n()}):(r.decrementPendingTrackCount(),t(a))}).catch(function(e){r.logRemoteInvokeError(e,"sender.syncBarrier() failed!"),r.decrementPendingTrackCount(),n()})}).catch(function(e){r.logRemoteInvokeError(e,"addTrack() failed!"),r.decrementPendingTrackCount(),n()})}),n?t:(m.logger.log(this.user_friendly_id()+".addTrack() returning: "+a),a)},t.prototype.removeTrack=function(e){m.logger.log(this.user_friendly_id()+".removeTrack() called."),this.removeTrackAsync(e)},t.prototype.removeTrackAsync=function(e){var t=this;m.logger.log(this.user_friendly_id()+".removeTrackAsync() called."),this.incrementPendingTrackCount();for(var n=0;n<this.senders_.length;n++)this.senders_[n]==e&&this.senders_.splice(n,1);return new Promise(function(n,r){t.waitUntilConnected(t.user_friendly_id()+".removeTrackAsync").then(function(){return t.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.removeTrack,[e])}).then(function(){m.logger.log(t.user_friendly_id()+".removeTrackAsync() success."),!t.usingasynconly_&&t.isUnified()?t.getTransceiversAsync().then(function(){t.decrementPendingTrackCount(),n()}).catch(function(e){t.logRemoteInvokeError(e,"removeTrackAsync() getTransceiversAsync() failed!"),t.decrementPendingTrackCount(),r(e)}):(t.decrementPendingTrackCount(),n())}).catch(function(e){t.logRemoteInvokeError(e,"removeTrackAsync() failed!"),t.decrementPendingTrackCount(),r(e)})})},t.prototype.addStream=function(e){var t=this;m.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(e)),this.localStreams.push(e),this.waitUntilConnected(this.user_friendly_id()+".addStream").then(function(){return t.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.addStream,[e],{})}).then(function(){m.logger.log(t.user_friendly_id()+".addStream() success.")}).catch(function(e){t.logRemoteInvokeError(e,"addStream() failed.")})},t.prototype.removeStream=function(e){var t=this;m.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(e));for(var n=0;n<this.localStreams.length;n++)this.localStreams[n]==e&&this.localStreams.splice(n,1);this.waitUntilConnected(this.user_friendly_id()+".removeStream").then(function(){return t.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.removeStream,[e])}).then(function(){m.logger.log(t.user_friendly_id()+".removeStream() success.")}).catch(function(e){t.logRemoteInvokeError(e,"removeStream() failed.")})},Object.defineProperty(t.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=e,this.waitUntilConnected(this.user_friendly_id()+".onaddstream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onaddstream);return n.then(function(e){new d.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){m.logger.log(t.user_friendly_id()+".onaddstream callback received!"),void 0===t.remoteStreams.find(function(t){return void 0!=e.stream&&t.object_id()===e.stream.object_id()})&&t.remoteStreams.push(e.stream),t.onaddstream_&&(m.logger.log(t.user_friendly_id()+".onaddstream notified!!! "+e.stream.id),t.onaddstream_(e))})}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onaddstream,n.success)}).catch(function(e){t.logRemoteInvokeError(e,"set_onaddstream() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=e,this.waitUntilConnected(this.user_friendly_id()+".onremovestream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onremovestream);return n.then(function(e){new d.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){m.logger.log(t.user_friendly_id()+".onremovestream callback received! "+e.stream.id);var n=t.remoteStreams.findIndex(function(t){return t.id==e.stream.id});0<=n&&t.remoteStreams.splice(n,1),t.onremovestream_&&t.onremovestream_(e)})}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onremovestream,n.success)}).catch(function(e){t.logRemoteInvokeError(e,"set_onremovestream() failed!")})},enumerable:!1,configurable:!0}),t.prototype.getStats=function(e){var t=this;return new Promise(function(n,r){t.isRedirected()?t.waitUntilConnected(t.user_friendly_id()+".getStats").then(function(){var r=t.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.getStats);return r.then(function(t){void 0===t.params||0===t.params.length||0===t.params[0].length?n():e?(e(v.StatsReport.fromJSON(JSON.parse(t.params[0]))),n()):n(v.StatsReport.toRTCStatsReport(JSON.parse(t.params[0])))}),e?t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getStats,r.success):t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getStats_v2,r.success)}).catch(function(e){t&&(e=t.logRemoteInvokeError(e,".getStats() failed!"),r(e))}):(e({}),n())})},t.prototype.SendTelemetryData=function(e,t,n){c.getRedirector().telemetry.SendTelemetryData(y.tel_cmd.Data,e,t,n)},t.prototype.MillisecondstoDisplayformat_=function(e){var t,n;n=Math.floor(e/1e3),t=Math.floor(n/60),e=Math.floor(t/60),m.logger.log(Math.floor(e/24)+":"+e%24+":"+t%60+":"+n%60)},t.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.timeerstarted_=!1,this.callendTime_=(new Date).getTime();var e,t=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(t),t=Math.round(t/1e3),m.logger.log("Call Duration "+t),1==this.conferencecall_?this.SendTelemetryData(y.tel_key_ConferenceCallDuration,t,1):(1==this.audiocall_.active&&this.SendTelemetryData(y.tel_key_AudioCallDuration,t,1),1==this.videocall_.active&&this.SendTelemetryData(y.tel_key_VideoCallDuration,t,1),1==this.screensharingcall_.active&&this.SendTelemetryData(y.tel_key_ScreensharingCallDuration,t,1)),1==this.firsttimelocaloffer_&&(e=this.callstartTime_-this.outgoingcallstart_),1==this.firsttimeremoteoffer_&&(e=this.callstartTime_-this.incomingcallstart_),this.MillisecondstoDisplayformat_(e),e=Math.round(e/1e3),m.logger.log("Call Establish Time "+e),1==this.incomingcall_?this.SendTelemetryData(y.tel_key_CallEstIncoming,e,1):1==this.outgoingcall_&&this.SendTelemetryData(y.tel_key_CallEstOutgoing,e,1),this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.idle,1)}},t.prototype.close=function(){var e=this;m.logger.log(this.user_friendly_id()+".close() called."),this.CalculateCallDurationandType_(),this.unregisterStateChangeNotification(this.onStateChange),this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=null,this.waitUntilConnected(this.user_friendly_id()+".close").then(function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.close)}).then(function(){e.iceQ_=null,e.release(),m.logger.log(e.user_friendly_id()+".close() success.")}).catch(function(t){e.logRemoteInvokeError(t,".close() failed."),e.iceQ_=null,e.release()})},t.prototype.createDTMFSender=function(e){m.logger.log(this.user_friendly_id()+".createDTMFSender() called.");var t,n=this.senders_;return void 0!==n&&0!==n.length||(n=this.getSenders()),void 0!=n&&(void 0!=(n=n.find(function(t){return t.track.id===e.id}))&&(m.logger.log(this.user_friendly_id()+" returning RtpSender with oid:"+n.object_id()),t=n.dtmf)),t},Object.defineProperty(t.prototype,"usingAsyncOnly",{get:function(){return this.usingasynconly_},set:function(e){m.logger.log(this.user_friendly_id()+".usingAsyncOnly() called with async:"+e),void 0!=e&&null!=e&&(this.usingasynconly_=e)},enumerable:!1,configurable:!0}),t.prototype.getSendersAsync=function(){return m.logger.log(this.user_friendly_id()+".getSendersAsync() called."),this.getSendersAsyncInternal()},t.prototype.getSenders=function(){if(m.logger.log(this.user_friendly_id()+".getSenders() called. "),this.usingasynconly_)throw m.logger.log(this.user_friendly_id()+".getSenders(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getSenders() not allowed when usingAsyncOnly is true!!!");return this.getSendersAsyncInternal(),m.logger.log(this.user_friendly_id()+".getSenders() returning:"+this.senders_.length+" items"),this.senders_},t.prototype.getSendersAsyncInternal=function(){var e=this;return m.logger.log(this.user_friendly_id()+".getSendersAsyncInternal() called. "+this.senders_),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getSendersAsyncInternal").then(function(){return m.logger.log(e.user_friendly_id()+".getSendersAsyncInternal invoking remote"),e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getSenders)}).then(function(n){m.logger.log(e.user_friendly_id()+".getSendersAsyncInternal remote success");var r=[],i=[];n.params[0].forEach(function(t){var n=e.senders_.find(function(e){return e.object_id()===t.oid});void 0===n&&(m.logger.log(e.user_friendly_id()+" adding a RtpSender with oid:"+t.oid),n=new l.RtpSender(e,t.oid,u.ProxyMode.Remote,e.isUnified())),i.push(n.syncBarrier()),r.push(n)}),Promise.all(i).then(function(){e.senders_=r,m.logger.log(e.user_friendly_id()+".getSendersAsyncInternal: returning senders with ids ["+e.senders_.map(function(e){return e.object_id()})+"]"),t(e.senders_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getSendersAsyncInternal() failed."),e.senders_=[],t(e.senders_)})}).catch(function(n){e.logRemoteInvokeError(n,".getSendersAsyncInternal() failed."),e.senders_=[],t(e.senders_)})})},t.prototype.getReceiversAsync=function(){return m.logger.log(this.user_friendly_id()+".getReceiversAsync() called."),this.getReceiversAsyncInternal()},t.prototype.getReceivers=function(){if(m.logger.log(this.user_friendly_id()+".getReceivers() called. "),this.usingasynconly_)throw m.logger.log(this.user_friendly_id()+".getReceivers(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getReceivers() not allowed when usingAsyncOnly is true!!!");return this.getReceiversAsyncInternal(),m.logger.log(this.user_friendly_id()+".getReceivers() returning:"+this.receivers_.length+" items"),this.receivers_},t.prototype.getReceiversAsyncInternal=function(){var e=this;return m.logger.log(this.user_friendly_id()+".getReceiversAsyncInternal() called. "+this.receivers_),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getReceiversAsyncInternal").then(function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getReceivers)}).then(function(n){m.logger.log(e.user_friendly_id()+".getReceiversAsyncInternal: remote success.");var r=[],i=[];n.params[0].forEach(function(t){var n=e.receivers_.find(function(e){return e.object_id()===t.oid});void 0===n&&(m.logger.log(e.user_friendly_id()+" adding a RtpReceiver with oid:"+t.oid),n=new l.RtpReceiver(e,t.oid,u.ProxyMode.Remote,e.isUnified())),i.push(n.syncBarrier()),r.push(n)}),Promise.all(i).then(function(){e.receivers_=r,m.logger.log(e.user_friendly_id()+".getReceiversAsyncInternal: returning receiver with ids ["+e.receivers_.map(function(e){return e.object_id()})+"]"),t(e.receivers_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getReceiversAsyncInternal() failed!"),e.receivers_=[],t(e.receivers_)})}).catch(function(n){e.logRemoteInvokeError(n,".getReceiversAsyncInternal() failed!"),e.receivers_=[],t(e.receivers_)})})},t.prototype.addTransceiver=function(e,t){return m.logger.log(this.user_friendly_id()+".addTransceiver() called: "+JSON.stringify(e)+" init="+JSON.stringify(t)),this.addTransceiverInternal(e,t,!1)},t.prototype.addTransceiverAsync=function(e,t){return m.logger.log(this.user_friendly_id()+".addTransceiverAsync() called: "+JSON.stringify(e)+" init="+JSON.stringify(t)),this.addTransceiverInternal(e,t,!0)},t.prototype.addTransceiverInternal=function(e,t,n){var r=this;m.logger.log(this.user_friendly_id()+".addTransceiverInternal() called: "+JSON.stringify(e)+" init="+JSON.stringify(t)),this.incrementPendingTransceiverCount();var i=h.RtcRtpTransceiverDirection.sendrecv,o=void 0;t&&((o=h.RtcRtpTransceiverInit.toRtcRtpTransceiverInit(t)).direction&&(i=o.direction));var a=t;p.RemoteSession.isFeatureCallConstraintsSupported()&&(a=o);var s=new h.RtpTransceiver(this,0,u.ProxyMode.Pseudo,this.isUnified(),i);return this.transceivers_.push(s),t=new Promise(function(t,n){r.waitUntilConnected(r.user_friendly_id()+".addTransceiverInternal").then(function(){return"string"==typeof e?r.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.addTransceiverWithKind,e,a):r.remoteInvokeEx(!1,g.method_id_RTCPeerConnection_t.addTransceiverWithTrack,[e],a)}).then(function(e){m.logger.log(r.user_friendly_id()+".addTransceiverInternal() success with oid: "+r.param0(e).oid),s.bind(r,r.param0(e).oid),s.syncBarrier().then(function(){m.logger.log(r.user_friendly_id()+".addTransceiverInternal(): success"),r.decrementPendingTransceiverCount(),t(s)}).catch(function(e){r.logRemoteInvokeError(e,".prop.addTransceiverInternal() failed!"),r.decrementPendingTransceiverCount(),n()})}).catch(function(e){r.logRemoteInvokeError(e,"addTransceiverInternal() failed!"),r.decrementPendingTransceiverCount(),n()})}),m.logger.log(this.user_friendly_id()+".addTransceiverInternal() returning:"),n?t:s},t.prototype.incrementPendingTransceiverCount=function(){++this.pendingtransceiver_},t.prototype.decrementPendingTransceiverCount=function(){0<this.pendingtransceiver_&&--this.pendingtransceiver_},t.prototype.incrementPendingTrackCount=function(){++this.pendingtrack_},t.prototype.decrementPendingTrackCount=function(){0<this.pendingtrack_&&--this.pendingtrack_},t.prototype.waitTransceiverAndTrackReady=function(e){var t=this;return new Promise(function(n,r){if(m.logger.trace(t.user_friendly_id()+".waitTransceiverAndTrackReady(): pendingtransceiver_="+t.pendingtransceiver_+", pendingtrack_="+t.pendingtrack_),0==t.pendingtransceiver_&&0==t.pendingtrack_){for(;t.deferredOfferAnswers&&0<t.deferredOfferAnswers.length;)t.deferredOfferAnswers.shift().post(!0);n()}else t.deferredOfferAnswers.push(new u.deferred_action(n,r,e)),t.checkTransceiverAndTrack(600,25)})},t.prototype.checkTransceiverAndTrack=function(e,t){var n=this;if(0>=e)for(m.logger.log(".checkTransceiverAndTrack() timeout waiting for transceiver ready!");this.deferredOfferAnswers&&0<this.deferredOfferAnswers.length;)this.deferredOfferAnswers.shift().post(!1);else setTimeout(function(e){if(0==n.pendingtransceiver_&&0==n.pendingtrack_)for(;n.deferredOfferAnswers&&0<n.deferredOfferAnswers.length;)n.deferredOfferAnswers.shift().post(!0);else m.logger.log('.checkTransceiverAndTrack(): count= "'+e),n.checkTransceiverAndTrack(--e,t)},t,e)},t.prototype.getTransceivers=function(){if(m.logger.log(this.user_friendly_id()+".getTransceivers() called. "),this.usingasynconly_)throw m.logger.log(this.user_friendly_id()+".getTransceivers(): throwing exception: not allowed when usingAsyncOnly is true!!!"),new DOMException(".getTransceivers() not allowed when usingAsyncOnly is true!!!");return this.getTransceiversAsync(),m.logger.log(this.user_friendly_id()+".getTransceivers() returning:"+this.transceivers_.length+" items"),this.transceivers_},t.prototype.getTransceiversAsync=function(){var e=this;return m.logger.log(this.user_friendly_id()+".getTransceiversAsync() called. "),new Promise(function(t,n){if(!e.isUnified())return m.logger.log(e.user_friendly_id()+".getTransceiversAsync() called in non-Unified. "),Promise.resolve(e.transceivers_);e.waitUntilConnected(e.user_friendly_id()+".getTransceiversAsync").then(function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getTransceivers)}).then(function(n){m.logger.log(e.user_friendly_id()+".getTransceiversAsync() remote success.");var r=[],i=[];n.params[0].forEach(function(t){var n=e.transceivers_.find(function(e){return e.object_id()===t.oid});void 0===n&&(m.logger.log(e.user_friendly_id()+" adding a RtpTransceiver with oid:"+t.oid),n=new h.RtpTransceiver(e,t.oid,u.ProxyMode.Remote,e.isUnified())),i.push(n.syncBarrier()),r.push(n)}),Promise.all(i).then(function(){e.transceivers_=r,m.logger.log(e.user_friendly_id()+".prop.getTransceiversAsync: returning transceiver with ids ["+e.transceivers_.map(function(e){return e.object_id()})+"]"),t(e.transceivers_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getTransceiversAsync() failed!"),e.transceivers_=[],t(e.transceivers_)})}).catch(function(n){e.logRemoteInvokeError(n,".getTransceiversAsync() failed!"),e.transceivers_=[],t(e.transceivers_)})})},Object.defineProperty(t.prototype,"sctp",{get:function(){return this.sctp_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ondatachannel",{get:function(){return this.ondatachannel_},set:function(e){var t=this;m.logger.log(this.user_friendly_id()+".set_ondatachannel() called."),this.ondatachannel_=e,this.waitUntilConnected(this.user_friendly_id()+".ondatachannel").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.ondatachannel);return n.then(function(e){m.logger.log(t.user_friendly_id()+".ondatachannel callback received!!!"),null!==t.remotedatachannel_&&t.remotedatachannel_.object_id()==t.param0(e).oid||(t.remotedatachannel_=new _.RtcDataChannel(t,t.param0(e).oid,u.ProxyMode.Remote),t.remotedatachannel_.syncBarrier().then(function(){m.logger.log(t.user_friendly_id()+"remotedatachannel_.syncBarrier(): success");var e=new Event("ondatachannel");e.channel=t.remotedatachannel_,t.localdatachannel_&&!t.localdatachannel_.isdestroyed()?t.localdatachannel_.syncBarrier().then(function(){m.logger.log(t.user_friendly_id()+"ondatachannel(): notifying..."),t.ondatachannel_&&t.ondatachannel_(e)}).catch(function(){m.logger.log(t.user_friendly_id()+"localdatachannel_.syncBarrier(): failed!")}):(m.logger.log(t.user_friendly_id()+"ondatachannel(): notifying..."),t.ondatachannel_&&t.ondatachannel_(e))}).catch(function(){m.logger.log(t.user_friendly_id()+"remotedatachannel_.syncBarrier(): failed!")}))}),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.ondatachannel,n.success)}).catch(function(){m.logger.log(t.user_friendly_id()+".ondatachannel() failed.")})},enumerable:!1,configurable:!0}),t.prototype.fixDataChannelConfig=function(e){return m.logger.log(this.user_friendly_id()+".fixDataChannelConfig() called: "+e),void 0==e&&(e={}),void 0==e.negotiated&&void 0==e.id&&(e.negotiated=!1,e.id=-1),e},t.prototype.createDataChannel=function(e,t){var n=this;return m.logger.log(this.user_friendly_id()+".createDataChannel() called. label:"+e),this.localdatachannel_=new _.RtcDataChannel(this,0,u.ProxyMode.Pseudo),this.waitUntilConnected(this.user_friendly_id()+".createDataChannel").then(function(){return n.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.createDataChannel,e,n.fixDataChannelConfig(t))}).then(function(e){m.logger.log(n.user_friendly_id()+".createDataChannel() success with oid: "+n.param0(e).oid),n.localdatachannel_.bind(n,n.param0(e).oid),n.localdatachannel_.syncBarrier().then(function(){m.logger.log(n.user_friendly_id()+"channel.syncBarrier(): success")}).catch(function(){m.logger.log(n.user_friendly_id()+"channel.syncBarrier(): failed!")})}).catch(function(e){e=n.param0(e),m.logger.log(n.user_friendly_id()+".createDataChannel() failed with error: "+e)}),m.logger.log(this.user_friendly_id()+".createDataChannel() returning: "+this.localdatachannel_),this.localdatachannel_},t}(u.ProxyObject),t.PeerConnection=e},658:function(e,t,n){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;e=Array(e);var r=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,r++)e[r]=i[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyObject=t.ProxyMode=t.ProxyReadyState=t.number_allocator=t.callback=t.rpc_callback=t.deferred_action=void 0;var i=n(946),o=n(851),a=n(545),s=n(247),c=n(550),d=function(){function e(e,t,n){this.resolve=e,this.reject=t,this.name_=n}return Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),e.prototype.post=function(e){1==e?(o.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve()):(o.logger.log('deferred_action.post(): rejecting "'+this.name_+'"'),this.reject())},e.prototype.postWithResult=function(e,t){1==e?(o.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve(t)):(o.logger.log('deferred_action.post(): rejecting "'+this.name_+'"'),this.reject())},e.prototype.postResolve=function(e){this.resolve(e)},e.prototype.postReject=function(e){void 0==e?this.reject():this.reject(e)},e}();t.deferred_action=d;var l=function(e,t){this.id=e,this.is_null=t};t.rpc_callback=l;var u=function(){function e(e,t,n){this.success=new l(e<<16,t),this.fail=new l(e<<16|1,t),this.id=e,this.oneShot=n}return e.prototype.resolve=function(e){o.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(e)},e.prototype.reject=function(e){null!=this.err_handler&&this.err_handler(e)},e.prototype.then=function(e){this.handler=e},e.prototype.prom=function(){var e=this;return new Promise(function(t,n){e.handler=t,e.err_handler=n})},e}();t.callback=u;var f,h,p=function(){function e(t,n,r){this.min_=t<e.BOUND_LOW||t>e.BOUND_HIGH?e.DEF_MIN:t,this.max_=n<e.BOUND_LOW||n>e.BOUND_HIGH?e.DEF_MAX:n,this.interval_=r<e.BOUND_LOW||r>e.BOUND_HIGH?e.DEF_INTERVAL:r,this.numbers_=new Map,this.numbers_.set(this.min_,this.max_)}return Object.defineProperty(e.prototype,"max",{get:function(){return this.max_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this.min_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interval",{get:function(){return this.interval_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numbers",{get:function(){return this.numbers_},enumerable:!1,configurable:!0}),e.prototype.allocate=function(){var e=-1;if(0<this.numbers_.size){var t=Array.from(this.numbers_.keys()).sort(function(e,t){return e-t})[0],n=this.numbers_.get(t);e=this.min_+(t-this.min_)*this.interval_;this.numbers_.delete(t),(t+=1)<n&&this.numbers_.set(t,n)}return e},e.prototype.deallocate=function(e){var t=Array.from(this.numbers_.keys()).sort(function(e,t){return e-t});e=(e-this.min_)/this.interval_;for(var n=!1,r=0;r<t.length&&(t[r]==e+1?(this.numbers_.set(e,this.numbers_.get(t[r])),this.numbers_.delete(t[r]),n=!0):this.numbers_.get(t[r])==e&&(this.numbers_.set(t[r],e+1),r+1<t.length&&t[r+1]==e+1&&(this.numbers_.set(t[r],this.numbers_.get(t[r+1])),this.numbers_.delete(t[r+1])),n=!0),!n);r++);n||this.numbers_.set(e,e+1)},e.BOUND_LOW=0,e.BOUND_HIGH=4294967295,e.DEF_MIN=0,e.DEF_MAX=1024,e.DEF_INTERVAL=1,e}();t.number_allocator=p,function(e){e[e.NotConfigured=0]="NotConfigured",e[e.Configured=1]="Configured",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(f=t.ProxyReadyState||(t.ProxyReadyState={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.Pseudo=2]="Pseudo"}(h=t.ProxyMode||(t.ProxyMode={})),e=function(){function e(t,n,d,l,u,p){var _=this;void 0===u&&(u=null),void 0===p&&(p=[]);for(var g=[],m=6;m<arguments.length;m++)g[m-6]=arguments[m];if(this.hdxms=i.getRedirector(),this.iid=n,this.oid=d,this.mode=l,this.proxystate=f.NotConfigured,this.deferredActions=[],this.pendingSyncBarriers=[],this.cbs=new Map,l===h.Local){m=!1,this.iid===c.class_id_t.EngineControl&&(m=!0);var v=this;this.hdxms.startRedirection(m,this.user_friendly_id()).then(function(){return _.oid=e.nextId++,o.logger.log(_.user_friendly_id()+" assigned local oid:"+_.oid),new Promise(function(e,t){v.waitUntilConnectedEx(v.user_friendly_id()+".ctor()",p).then(function(){o.logger.log(v.user_friendly_id()+".ctor() all parameter rpc objects are ready.");var e=v.oidsFromProxyOjbects(p).concat(g),t=c.WebrpcClassLibInfoUtil.getMethodFeatureByid(n,0);return v.hdxms.WSSendObjectWrapper(t,n,0,a.WsJsonUtil.createMessageByid.apply(a.WsJsonUtil,r([!1,!1,a.ws_msg_type_t.req,n,0,v.oid],e)))}).then(function(t){o.logger.log(v.user_friendly_id()+".ctor() success."),e(t)}).catch(function(){o.logger.log(v.user_friendly_id()+".ctor() failed."),t()})})}).then(function(e){o.logger.trace("ProxyObject: setting state to configured. (iid: "+_.iid+" oid: "+_.oid+")");var n=_.oid;v.proxystate=f.Configured,v.oid=_.param0(e),o.logger.log(_.user_friendly_id()+" assigned remote oid for local oid:"+n),v.onConnected(),u&&u(),s.getGC().trackObject(_,t)}).catch(function(){v.proxystate=f.Error,v.onConnected()})}else l===h.Remote&&(this.proxystate=f.Configured,s.getGC().trackObject(this,t))}return e.prototype.syncBarrierDeep=function(e,t){var n=!0;return 0<this.pendingSyncBarriers.length&&(n=!1),this.pendingSyncBarriers.push(new d(e,t,this.user_friendly_id()+".syncBarrier")),o.logger.log(this.user_friendly_id()+".syncBarrierDeep() queing request for:"+this.oid+", rv:"+n+", items:"+this.pendingSyncBarriers.length),n},e.prototype.syncBarrierResolve=function(e){for(o.logger.log(this.user_friendly_id()+".syncBarrierResolve() items:"+this.pendingSyncBarriers.length);this.pendingSyncBarriers&&0<this.pendingSyncBarriers.length;)o.logger.log(this.user_friendly_id()+".syncBarrierResolve() items:"+this.pendingSyncBarriers.length+" resolving request for:"+this.oid),this.pendingSyncBarriers.shift().postResolve(e)},e.prototype.syncBarrierReject=function(e){for(o.logger.log(this.user_friendly_id()+".syncBarrierReject() items:"+this.pendingSyncBarriers.length);this.pendingSyncBarriers&&0<this.pendingSyncBarriers.length;)o.logger.log(this.user_friendly_id()+".syncBarrierReject() rejecting request for:"+this.oid),this.pendingSyncBarriers.shift().postReject(e)},Object.defineProperty(e.prototype,"proxyreadystate",{get:function(){return this.proxystate},set:function(e){this.proxystate=e},enumerable:!1,configurable:!0}),e.prototype.bind=function(e,t){if(o.logger.trace("ProxyObject: binding object. (iid: "+this.iid+" oid: "+t+" mode: "+this.mode+")"),this.mode===h.Pseudo){this.proxystate=f.Configured;var n=this.oid;this.oid=t,o.logger.log(this.user_friendly_id()+" assigned remote oid for local oid:"+n),this.onConnected(),s.getGC().trackObject(this,e),this.mode=h.Remote}else this.mode===h.Remote?o.logger.log("ProxyObject: binding already complete."):o.logger.log("ProxyObject: binding failure. incorrect mode!")},e.prototype.reconstructor=function(e,t,n){for(var i=this,d=[],l=3;l<arguments.length;l++)d[l-3]=arguments[l];this.proxystate=f.NotConfigured,this.deferredActions=[],l=c.WebrpcClassLibInfoUtil.getMethodFeatureByid(t,0),this.hdxms.WSSendObjectWrapper(l,t,0,a.WsJsonUtil.createMessageByid.apply(a.WsJsonUtil,r([!1,!1,a.ws_msg_type_t.req,t,0,this.oid],d))).then(function(t){o.logger.trace("ProxyObject: setting state to configured. (iid: "+i.iid+" oid: "+i.oid+")");var n=i.oid;i.proxystate=f.Configured,i.oid=i.param0(t),o.logger.log(i.user_friendly_id()+" assigned remote oid for local oid:"+n),i.onConnected(),s.getGC().trackObject(i,e)}).catch(function(){i.proxystate=f.Error,i.onConnected()})},e.prototype.setParent=function(e){s.getGC().setParent(this,e)},e.prototype.release=function(){o.logger.log(this.user_friendly_id()+".release() called."),s.getGC().releaseObject(this)},e.prototype.destroy=function(){o.logger.log(this.user_friendly_id()+".destroy() called."),this.proxystate=f.Destroyed;var e=c.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(e,this.iid,0,a.WsJsonUtil.createMessageByid(!1,!0,a.ws_msg_type_t.req,this.iid,0,this.oid)),this.clearCallbacks()},e.prototype.isdestroyed=function(){return this.proxystate==f.Destroyed},e.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.proxystate==f.Configured)},e.prototype.isPseudo=function(){return this.mode==h.Pseudo},e.prototype.checkState=function(e,t,n){var r=this;0>=e?(o.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+r.iid+" oid: "+r.oid+"name: "+n+")"),r.onConnected()):setTimeout(function(e,n){r.proxystate==f.Configured?r.onConnected():r.proxystate==f.Error?r.onConnected():r.proxystate==f.Destroyed?r.onConnected():r.checkState(--e,t,n)},t,e,n)},e.prototype.waitUntilConnected=function(e){var t=this;return new Promise(function(n,r){t?(o.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.proxystate+". (iid: "+t.iid+" oid: "+t.oid+")"),t.proxystate==f.Destroyed?(t.onConnected(),o.logger.trace("rejecting already destroyed Object:"+t.user_friendly_id()),r("Object already destroyed :"+t.user_friendly_id())):t.proxystate==f.Configured?(t.onConnected(),n()):t.proxystate==f.Error?(o.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.proxystate+". (iid: "+t.iid+" oid: "+t.oid+")"),t.onConnected(),r()):(o.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+e+'". (iid: '+t.iid+" oid: "+t.oid+")"),t.deferredActions.push(new d(n,r,e)),t.checkState(600,25,e))):r("Invalid Object")})},e.prototype.remoteInvoke=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this.proxystate==f.Destroyed?(o.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id())):this.proxystate==f.Error?(o.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id())):(i=c.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,t),this.hdxms.WSSendObjectWrapper(i,this.iid,t,a.WsJsonUtil.createMessageByid.apply(a.WsJsonUtil,r([e,!1,a.ws_msg_type_t.req,this.iid,t,this.oid],n))))},e.prototype.waitUntilConnectedEx=function(e,t){var n=this;return new Promise(function(r,i){if(n){for(var a=[],s=0;s<t.length;s++){var c=t[s];if(c instanceof Array)for(var d=0;d<c.length;d++){var l=c[d];a.push(l.waitUntilConnected(e+"."+l.user_friendly_id()))}else a.push(c.waitUntilConnected(e+"."+c.user_friendly_id()))}Promise.all(a).then(function(){o.logger.log(n.user_friendly_id()+".waitUntilConnectedEx() success."),r()}).catch(function(e){n.logRemoteInvokeError(e,".waitUntilConnectedEx(): failed."),i()})}else i("Invalid Object")})},e.prototype.oidsFromProxyOjbects=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r instanceof Array){for(var i=[],o=0;o<r.length;o++)i.push({oid:r[o].object_id()});t.push(i)}else t.push({oid:r.object_id()})}return t},e.prototype.remoteInvokeEx=function(e,t,n){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];if(this.proxystate==f.Destroyed)return o.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id());if(this.proxystate==f.Error)return o.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id());var d=this;return new Promise(function(s,l){d.waitUntilConnectedEx(d.user_friendly_id()+".remoteInvokeEx",n).then(function(){o.logger.log(d.user_friendly_id()+".remoteInvokeEx() all parameter rpc objects are ready.");var s=d.oidsFromProxyOjbects(n).concat(i),l=c.WebrpcClassLibInfoUtil.getMethodFeatureByid(d.iid,t);return d.hdxms.WSSendObjectWrapper(l,d.iid,t,a.WsJsonUtil.createMessageByid.apply(a.WsJsonUtil,r([e,!1,a.ws_msg_type_t.req,d.iid,t,d.oid],s)))}).then(function(e){o.logger.log(d.user_friendly_id()+".remoteInvokeEx() success."),s(e)}).catch(function(){o.logger.log(d.user_friendly_id()+".remoteInvokeEx() failed."),l()})})},e.prototype.logRemoteInvokeError=function(e,t){var n="",r=e;return r?n=t+" with error: "+JSON.stringify(r.message):(n=this.param0(e),n=(r=0!==Object.keys(n).length?new DOMException(t+" with error: "+JSON.stringify(n),this.user_friendly_id()):new DOMException(t,this.user_friendly_id())).message),o.logger.logx(this.isdestroyed(),this.user_friendly_id()+n),r},e.prototype.allocate_cbid=function(){return e.cbid_allocator_.allocate()},e.prototype.deallocate_cbid=function(t){e.cbid_allocator_.deallocate(t)},e.prototype.registerCallbacks=function(e,t,n){var r=this,i=this.allocate_cbid();return e=new u(i,t,e),0>i&&o.logger.log(this.user_friendly_id()+".registerCallbacks(). !!!! ran out of cbid !!!!"),t||(this.cbs.set(i,n),e.completion_cb=function(e,t){r.unregisterCallbacks(e)},this.hdxms.registerHandler(this.iid,this.oid,n,e)),e},e.prototype.unregisterCallbacks=function(e){this.cbs.has(e)?(this.hdxms.unregisterHandler(this.iid,this.oid,e),this.deallocate_cbid(e),this.cbs.delete(e)):o.logger.log(this.user_friendly_id()+".unregisterCallbacks(). mid="+this.cbs.get(e)+" cbid="+e+" Cant find callback handler registration!!!!")},e.prototype.clearCallbacks=function(){o.logger.log(this.user_friendly_id()+".clearCallbacks().");for(var e=0,t=Array.from(this.cbs.keys());e<t.length;e++){var n=t[e];this.hdxms.unregisterHandler(this.iid,this.oid,n),this.deallocate_cbid(n)}this.cbs.clear()},e.prototype.object_id=function(){return this.oid},e.prototype.param0=function(e){var t={};return e&&e.params&&(t=e.params[0]),t},e.prototype.isNullCallback=function(e){return void 0==e||null==e},e.prototype.user_friendly_id=function(){var e=this.constructor.name;return 0<=this.iid&&(e=c.class_id_t[this.iid]),e+"["+this.oid+"]"},e.prototype.isRedirected=function(){return this.hdxms.isRedirected()},e.prototype.isValid=function(){return!(this.proxystate===f.Error||this.proxystate===f.Destroyed)},e.prototype.registerStateChangeNotification=function(e){this.hdxms.registerStateChangeNotification(e)},e.prototype.unregisterStateChangeNotification=function(e){this.hdxms.unregisterStateChangeNotification(e)},e.nextId=0,e.CBID_MAX=65536,e.cbid_allocator_=new p(0,e.CBID_MAX,1),e}(),t.ProxyObject=e},144:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;d;)try{if(i=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,a=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if(!(s=0<(s=d.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))d.label=n[1];else if(6===n[0]&&d.label<s[1])d.label=s[1],s=n;else{if(!(s&&d.label<s[2])){s[2]&&d.ops.pop(),d.trys.pop();continue}d.label=s[2],d.ops.push(n)}}n=t.call(e,d)}catch(e){n=[6,e],a=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,s,c,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o.initSymbol(),o.initSymbol(),o.initSymbolIterator(),c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c};Object.defineProperty(t,"__esModule",{value:!0}),t.NavigatorUserMedia=t.RemoteMediaStreamConstraints=t.RemoteMediaTrackConstraints=t.RemoteMediaTrackConstraintSet=t.RemoteDevices=t.RemoteDeviceInfo=t.DeviceInfo=t.RemoteStreamEvent=t.RemoteStream=t.RemoteMediaTrack=t.enumeratedDevices=void 0;var s,c=n(550),d=n(658),l=n(851),u=n(946),f=n(394),h=n(259),p=n(650),_=n(973);t.enumeratedDevices=s;var g=function(e,t){this.type=e,this.target=t},m=function(){function e(){this.is_local_clone=!1,this.clone_id=this.clone_count=0}return e.prototype.clone=function(){this.clone_count++;var t=new e;return t.is_local_clone=!0,t.clone_id=this.clone_count,t},e.prototype.synchronize=function(e){return i(this,void 0,void 0,function(){return a(this,function(t){return this.is_local_clone?[2,e.asyncClone()]:[2,Promise.resolve(e)]})})},e}(),v=function(e){function t(t,n,r){return void 0===r&&(r=d.ProxyMode.Remote),(t=e.call(this,t,c.class_id_t.MediaStreamTrack,n,r)||this).refCount_=0,t.refCount_++,t.clone_state=new m,t}return r(t,e),t.prototype.dumpInfo=function(){l.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] kind="+this.kind+" label="+this.label+" refcount="+this.refcount+" enabled="+this.enabled+" readyState="+this.readyState)},Object.defineProperty(t.prototype,"refcount",{get:function(){return this.refCount_},enumerable:!1,configurable:!0}),t.prototype.addRef=function(){this.refCount_++,l.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)},Object.defineProperty(t.prototype,"onended",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=e,this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onended);return n.then(function(e){l.logger.log(t.user_friendly_id()+"onended event received!!!"),e=new g("ended",t),t.readyState_="ended",t.onended_(e)}),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onended,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".onended failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onmute",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=e,this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onmute);return n.then(function(e){l.logger.log(t.user_friendly_id()+"onmute event received!!!"),e=new g("mute",t),t.muted=!0,t.onmute_(e)}),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onmute,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".onmute failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onunmute",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=e,this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onunmute);return n.then(function(e){l.logger.log("onunmute event received!!!"),e=new g("unmute",t),t.muted=!1,t.onunmute_(e)}),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onunmute,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".onunmute failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onstop",{set:function(e){this.onstop_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return l.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(e){l.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+e+"]"),this.enabled_=e,this.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.enabled,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return l.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!1,configurable:!0}),t.prototype.asyncClone=function(){return i(this,void 0,void 0,function(){var e,n;return a(this,function(r){switch(r.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return r.sent(),[4,this.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.clone)];case 2:return e=r.sent(),n=this.param0(e),[2,new t(this,n.oid).syncBarrier()]}})})},t.prototype.deepClone=function(e){var n=this;if(l.logger.log(this.user_friendly_id()+".deepClone() called. [id="+this.id+"]"),p.RemoteSession.isFeatureTrackCloneWithIdSupported()){var r=new t(null,0,d.ProxyMode.Pseudo),i=new m;return r.id=e||this.id+"."+i.clone_id.toString(),r.label=this.label,r.kind=this.kind,r.enabled_=this.enabled_,r.muted=this.muted,r.readyState_=this.readyState_,r.trackSettings_=this.trackSettings_,r.clone_state=i,r.constraints_=this.constraints_,r.capabilities_=this.capabilities_,r.onended=this.onended,r.onmute=this.onmute,r.onunmute=this.onunmute,r.onstop=this.onstop,this.waitUntilConnected("RemoteMediaTrack.deepClone").then(function(){return n.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.clone,r.id)}).then(function(e){l.logger.log(n.user_friendly_id()+".deepClone() success with oid: "+n.param0(e).oid),r.bind(null,n.param0(e).oid),r.syncBarrier().then(function(){l.logger.log(n.user_friendly_id()+"track.syncBarrier(): success")}).catch(function(e){n.logRemoteInvokeError(e,"track.syncBarrier() failed!")})}).catch(function(e){n.logRemoteInvokeError(e,".deepClone() failed!")}),r}l.logger.log(this.user_friendly_id()+".deepClone() is not supported!")},t.prototype.localClone=function(){l.logger.log(this.user_friendly_id()+".localClone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),n.label=this.label,n.kind=this.kind,n.enabled_=this.enabled_,n.muted=this.muted,n.readyState_=this.readyState_,n.trackSettings_=this.trackSettings_,n.clone_state=e,n.constraints_=this.constraints_,n.capabilities_=this.capabilities_,n},t.prototype.clone=function(){return l.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]"),p.RemoteSession.isFeatureTrackCloneWithIdSupported()?this.deepClone():this.localClone()},t.prototype.stop=function(){var e=this;l.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+this.refCount_),this.readyState_="ended",0<this.refCount_&&(this.refCount_--,0===this.refCount_&&(l.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.stop).catch(function(t){e.logRemoteInvokeError(t,".stop failed!")}),"video"==this.kind&&"remoteapp-track"==this.label&&_.ScreenSharing.screenSharingInstance().stopAppshare(),null!==this.onstop_&&void 0!=this.onstop_))&&this.onstop_()},t.prototype.getCapabilities=function(){return this.capabilities_},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getSettings=function(){return"audio"==this.kind?{deviceId:(e=this.trackSettings_).deviceId,echoCancellation:e.echoCancellation}:function(e){return{aspectRatio:e.aspectRatio,deviceId:e.deviceId,frameRate:e.frameRate,height:e.height,width:e.width}}(this.trackSettings_);var e},t.prototype.getChannelCount=function(){return 2},t.prototype.applyConstraints=function(e){var t=this;return l.logger.log(this.user_friendly_id()+".applyConstraints() called."),new Promise(function(n,r){t.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return Promise.all([t.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.applyConstraints,e),t.syncBarrier()])}).catch(function(e){t.logRemoteInvokeError(e,"applyConstraints failed!"),r({name:"OverconstrainedError",message:"Failed to apply constraints."})}).then(function(){return t.constraints_=e,t.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getConstraints)}).then(function(e){t.constraints_=t.param0(e)}).catch(function(e){t.logRemoteInvokeError(e,".syncBarrier() remote client does not support getConstraints method. Ignore it")}).then(function(){return n()})})},t.convertReadyState=function(e){return 0==e?"live":"ended"},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){e.syncBarrierDeep(n,r)&&e.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.kind,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.id,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.label,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.enabled,!1),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.muted,!1),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.readyState,0),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getSettings),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getCapabilities)])}).then(function(n){var r;n=n.map(function(t){return e.param0(t)}),e.kind=n[0],e.id=n[1],e.label=n[2],e.enabled_=n[3],e.muted=n[4],r=n[5],e.trackSettings_=n[6],e.capabilities_=n[7],e.readyState_=t.convertReadyState(r),e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},t.prototype.dispose=function(){l.logger.log(this.user_friendly_id()+".dispose() called. [id="+this.id+"]"),this.stop(),0===this.refCount_&&this.release()},t}(d.ProxyObject);t.RemoteMediaTrack=v;var y=function(){},b=function(e){function t(n,r,i,o,a){void 0===i&&(i=d.ProxyMode.Local),void 0===o&&(o=[]);var s=this;return l.logger.log("RemoteStream.ctor() streamid="+a+" num tracks="+o.length),i==d.ProxyMode.Remote||a||(a=t.uuidv4()),(s=a&&p.RemoteSession.isFeatureTrackCloneWithIdSupported()?e.call(this,n,c.class_id_t.MediaStream,r,i,null,[o],a)||this:e.call(this,n,c.class_id_t.MediaStream,r,i,null,[o])||this).id=a,s.tracks_=o,s.clone_state=new m,s.active_=!0,s.tracks_.forEach(function(e){e.setParent(s)}),s}return r(t,e),t.uuidv4=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},t.prototype.dumpInfo=function(){l.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] active="+this.active_+" num tracks="+this.tracks_.length);for(var e=0,t=this.tracks_;e<t.length;e++){var n=t[e];n&&n.dumpInfo()}},t.prototype.toggleAudio=function(e){l.logger.log(this.user_friendly_id()+".toggleAudio() called: "+e);for(var t=0,n=this.getAudioTracks();t<n.length;t++)n[t].enabled=e},t.prototype.toJSON=function(){var e=new y;return e.id=this.id,e.active=this.active_,e.oid=this.object_id(),"RemoteStream:"+JSON.stringify(e)},Object.defineProperty(t.prototype,"active",{get:function(){var e=this;return l.logger.log(this.user_friendly_id()+".get active() called. [id="+this.id+"] active="+this.active_),u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_stream_active_status)?this.waitUntilConnected("MediaStream.active").then(function(){return l.logger.log(e.user_friendly_id()+".get active() remote invoking"),e.remoteInvoke(!1,c.method_id_MediaStream_t.active,!1)}).then(function(t){e.active_=e.param0(t),l.logger.log(e.user_friendly_id()+".get active() success, active="+e.active_)}).catch(function(t){e.active_=!0,e.logRemoteInvokeError(t,".get active() failed! active="+e.active_)}):this.active_=!0,this.active_},enumerable:!1,configurable:!0}),t.prototype.getAudioTracks=function(){l.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var r=n[t];"audio"==r.kind&&e.push(r)}return e},t.prototype.getVideoTracks=function(){l.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var r=n[t];"video"==r.kind&&e.push(r)}return e},t.prototype.getTracks=function(){return l.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},t.prototype.getTrackById=function(e){l.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var t=0,n=this.tracks_;t<n.length;t++){var r=n[t];if(r.id==e)return r}},t.prototype.addTrack=function(e){var t=this;l.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(e),e&&e.dumpInfo();var n=this;this.waitUntilConnected("MediaStream.addTrack").then(function(){return l.logger.log(n.user_friendly_id()+".addTrack remote invoking"),n.remoteInvokeEx(!1,c.method_id_MediaStream_t.addTrack,[e])}).then(function(){l.logger.log(n.user_friendly_id()+".addTrack success")}).catch(function(e){t.logRemoteInvokeError(e,".addTrack failed!")})},t.prototype.removeTrack=function(e){var t=this;l.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var n=this.tracks_.indexOf(e);this.tracks_.splice(n,1);var r=this;this.waitUntilConnected("MediaStream.removeTrack").then(function(){return l.logger.log(r.user_friendly_id()+".removeTrack remote invoking"),r.remoteInvokeEx(!1,c.method_id_MediaStream_t.removeTrack,[e])}).then(function(){l.logger.log(r.user_friendly_id()+".removeTrack success")}).catch(function(e){t.logRemoteInvokeError(e,".removeTrack failed!")})},t.prototype.asyncClone=function(){return i(this,void 0,void 0,function(){var e,n;return a(this,function(r){switch(r.label){case 0:return l.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return r.sent(),[4,this.remoteInvoke(!1,c.method_id_MediaStream_t.clone)];case 2:return e=r.sent(),l.logger.log(e),n=this.param0(e),[2,new t(this,n.oid,d.ProxyMode.Remote).syncBarrier()]}})})},t.prototype.deepClone=function(e){var n=this;if(l.logger.log(this.user_friendly_id()+".deepClone() called. [id="+this.id+"]"),p.RemoteSession.isFeatureTrackCloneWithIdSupported()){var r=[];this.tracks_.forEach(function(e){r.push(e.deepClone())});var i=new m;e=e||this.id+"."+i.clone_id.toString();var o=new t(null,0,d.ProxyMode.Local,r,e);return o.id=e,o.active_=this.active_,o.clone_state=i,o.tracks_=r,o.waitUntilConnected("RemoteStream.deepClone").then(function(){o.syncBarrier().then(function(){l.logger.log(n.user_friendly_id()+"stream.syncBarrier(): success")}).catch(function(e){n.logRemoteInvokeError(e,"stream.syncBarrier() failed!")})}).catch(function(e){n.logRemoteInvokeError(e,".deepClone() failed!")}),o}l.logger.log(this.user_friendly_id()+".deepClone() is not supported!")},t.prototype.localClone=function(){l.logger.log(this.user_friendly_id()+".localClone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id(),d.ProxyMode.Remote);return n.id=this.id+"."+e.clone_id.toString(),n.active_=this.active_,this.tracks_.forEach(function(e){e.addRef()}),n.tracks_=this.tracks_,n.clone_state=e,n},t.prototype.clone=function(){return l.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]"),p.RemoteSession.isFeatureTrackCloneWithIdSupported()?this.deepClone():this.localClone()},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("MediaStream.syncBarrier").then(function(){var t=[];return t.push(e.remoteInvoke(!1,c.method_id_MediaStream_t.id,"")),u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_stream_active_status)&&t.push(e.remoteInvoke(!1,c.method_id_MediaStream_t.active,!0)),t.push(e.remoteInvoke(!1,c.method_id_MediaStream_t.getTracks)),Promise.all(t)}).then(function(t){var n;l.logger.log(e.user_friendly_id()+".syncBarrier() remote success"),u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_stream_active_status)?(t=t.map(function(t){return e.param0(t)}),e.id=t[0],e.active_=t[1],n=t[2]):(t=t.map(function(t){return e.param0(t)}),e.id=t[0],n=t[1],e.active_=!0);var r=[];t=function(t){var n=e.tracks_.find(function(e){return e.object_id()===t.oid});void 0===n&&(l.logger.log(e.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+t.oid),n=new v(e,t.oid)),r.push(n.syncBarrier())};for(var i=0;i<n.length;i++)t(n[i]);return Promise.all(r)}).then(function(t){e.tracks_=[],t.forEach(function(t){c.BUILD_TYPE_SDK||(t.onstop=function(){var t=!0;e.tracks_.forEach(function(e){"ended"!=e.readyState&&(t=!1)}),t&&e.release()}),e.tracks_.push(t)}),e.syncBarrierResolve(e)}).catch(function(t){e.logRemoteInvokeError(t,".syncBarrier failed!"),e.syncBarrierReject()})})},t.prototype.dispose=function(){l.logger.log(this.user_friendly_id()+".dispose() called. [id="+this.id+"]"),this.tracks_.forEach(function(e){e.dispose()}),this.release()},t}(d.ProxyObject);t.RemoteStream=b,e=function(e){function t(t,n){return e.call(this,t,c.class_id_t.MediaStreamEvent,n,d.ProxyMode.Remote)||this}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,c.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(t){return new b(e,t.params[0].oid,d.ProxyMode.Remote).syncBarrier()}).then(function(t){e.stream=t,e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},t}(d.ProxyObject),t.RemoteStreamEvent=e;var C=function(e,t,n,r){this.deviceId=e,this.groupId=t,this.kind=n,this.label=r};t.DeviceInfo=C;var S=function(e){function t(t){return e.call(this,null,c.class_id_t.MediaDeviceInfo,t,d.ProxyMode.Remote)||this}return r(t,e),t.convertKind=function(e){return 0==e?"audioinput":1==e?"audiooutput":"videoinput"},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){e.syncBarrierDeep(n,r)&&e.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.deviceId,""),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.kind,0),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.label,""),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(n){e.kind=t.convertKind(e.param0(n.splice(1,1)[0])),n=n.map(function(t){return e.param0(t)}),e.deviceId=n[0],e.label=n[1],e.groupId=n[2],e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},t}(d.ProxyObject);t.RemoteDeviceInfo=S,e=function(e){function n(){var t=e.call(this,null,c.class_id_t.MediaDevices,0,d.ProxyMode.Local,function(){t.setDeviceChangeCallback()})||this;return t.devices_=[],t.enumerateMarker="enumerateDevicesPrivate",t.enumerateRemoteMarker="enumeratedDevicesPrivate-Remote",t.shareSystemAudio_=!1,t.pendingEnumerateDevice_=[],t.panelid_=-1,t}return r(n,e),Object.defineProperty(n.prototype,"panelid",{set:function(e){this.panelid_=e},enumerable:!1,configurable:!0}),n.prototype.clearPanelId=function(){this.panelid_=-1},n.prototype.enumerateDevices=function(){var e=this;return 0<this.devices_.length&&0==this.pendingEnumerateDevice_.length?new Promise(function(t,n){l.logger.log(e.user_friendly_id()+".enumerateDevices: returning cached devices"),t(e.devices_)}):this.enumerateDevicesPrivate(!1)},n.prototype.enumerateDevicesPrivate=function(e){return u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_enumerate_devices_v2)?this.enumerateDevicesPrivateV2(e):this.enumerateDevicesPrivateV1(e)},n.prototype.postEnumerateDevicesResult=function(){for(var e=!0,t=0,n=0,r=this.pendingEnumerateDevice_;n<r.length;n++){var i=r[n];if(0==e&&i.name==this.enumerateRemoteMarker)break;i.postWithResult(!0,this.devices_),t++,e=!1}0<t&&this.pendingEnumerateDevice_.splice(0,t)},n.prototype.enumerateDevicesPrivateV2=function(e){var n=this;return l.logger.log(this.user_friendly_id()+".enumerateDevicesPrivateV2() called. refresh:"+e+" pending:"+this.pendingEnumerateDevice_.length),new Promise(function(r,i){1==e||0==n.pendingEnumerateDevice_.length?(n.pendingEnumerateDevice_.push(new d.deferred_action(r,i,n.enumerateRemoteMarker)),n.waitUntilConnected("RemoteDevices.enumerateDevicesPrivateV2").then(function(){return l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV2() remote invoking..."),n.remoteInvoke(!1,c.method_id_MediaDevices_t.enumerateDevicesV2)}).then(function(e){var r=[];e.params[0].forEach(function(e){e=new C(e.deviceId,e.groupId,S.convertKind(e.kind),e.label),r.push(e)}),n.devices_=r,t.enumeratedDevices=s=r,l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV2: resolving enumerated devices: "+JSON.stringify(n.devices_)),n.postEnumerateDevicesResult()}).catch(function(e){n.devices_=[],t.enumeratedDevices=s=[],n.logRemoteInvokeError(e,".enumerateDevicesPrivateV2() failed, resolving with empty list."),n.postEnumerateDevicesResult()})):(n.pendingEnumerateDevice_.push(new d.deferred_action(r,i,n.enumerateMarker)),l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV2() not remoting this call..."))})},n.prototype.enumerateDevicesPrivateV1=function(e){var n=this;return l.logger.log(this.user_friendly_id()+".enumerateDevicesPrivateV1() called. refresh:"+e+" pending:"+this.pendingEnumerateDevice_.length),new Promise(function(r,i){1==e||0==n.pendingEnumerateDevice_.length?(n.pendingEnumerateDevice_.push(new d.deferred_action(r,i,n.enumerateRemoteMarker)),n.waitUntilConnected("RemoteDevices.enumerateDevicesPrivateV1").then(function(){return l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV1() remote invoking..."),n.remoteInvoke(!1,c.method_id_MediaDevices_t.enumerateDevices)}).then(function(e){var t=[];return e.params[0].forEach(function(e){e=new S(e.oid),t.push(e.syncBarrier())}),Promise.all(t)}).then(function(e){var r=[];e.forEach(function(e){var t=new C(e.deviceId,e.groupId,e.kind,e.label);r.push(t),e.release()}),n.devices_=r,t.enumeratedDevices=s=r,l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV1: resolving enumerated devices: "+JSON.stringify(n.devices_)),n.postEnumerateDevicesResult()}).catch(function(e){t.enumeratedDevices=s=[],n.devices_=[],n.logRemoteInvokeError(e,".enumerateDevicesPrivateV1() failed, resolving with empty list."),n.postEnumerateDevicesResult()})):(n.pendingEnumerateDevice_.push(new d.deferred_action(r,i,n.enumerateMarker)),l.logger.log(n.user_friendly_id()+".enumerateDevicesPrivateV1() not remoting this call..."))})},n.prototype.getDisplayMedia=function(e){var t=this;return new Promise(function(n,r){t.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){return _.ScreenSharing.screenSharingInstance().setActiveSource(t.panelid_,p.RemoteSession.isFeaturAppshareSupported())}).then(function(n){return void 0!==e.video&&null!==e.video&&void 0!==n&&(e.video.deviceId=n),u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_share_system_audio)&&(void 0!==e.audio&&"boolean"!=typeof e.audio?l.logger.log("Non-boolean audio constraints"):e.audio=e.audio||t.shareSystemAudio_),n=t.prepareDisplayConstraints(e),n=T.toRemoteMediaStreamConstraints(n,!0),t.remoteInvoke(!1,c.method_id_MediaDevices_t.getDisplayMedia,n)}).then(function(e){return new b(null,e.params[0].oid,d.ProxyMode.Remote).syncBarrier()}).then(function(e){n(e)}).catch(function(e){_.ScreenSharing.screenSharingInstance().isAppshareActive()&&_.ScreenSharing.screenSharingInstance().stopAppshare(),e=t.logRemoteInvokeError(e,".getDisplayMedia() failed!"),r(e)})})},n.prototype.setDeviceChangeCallback=function(){var e=this;l.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called."),this.waitUntilConnected("MediaDevices.ondevicechange").then(function(){var t=e.registerCallbacks(!1,!1,c.method_id_MediaDevices_t.ondevicechange);return t.then(function(){l.logger.log(e.user_friendly_id()+".ondevicechange(): callback received!!!"),e.enumerateDevicesPrivate(!0).then(function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))}).catch(function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))})}),e.remoteInvoke(!0,c.method_id_MediaDevices_t.ondevicechange,t.success)}).catch(function(t){e.logRemoteInvokeError(t,".set_ondevicechange() failed!")})},n.prototype.prepareDisplayConstraints=function(e){if(u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_common_media_constraints))return e;var t={frameRate:15,width:{max:1920},height:{max:1080}};if(void 0!==e.video&&null!==e.video){var n=e.video;void 0!==n.frameRate&&void 0!==n.width&&void 0!==n.height&&(t.frameRate=n.frameRate,t.width.max=n.width.max||n.width,t.height.max=n.height.max||n.height)}return e.audio?{video:t,audio:e.audio}:{video:t}},n}(d.ProxyObject),t.RemoteDevices=e;var E=function(){function e(){}return e.toRemoteMediaTrackConstraintSet=function(e){var t=void 0;return h.Util.hasValue(e)&&(t={},h.Util.hasValue(e.width)&&(t.width=e.width),h.Util.hasValue(e.height)&&(t.height=e.height),h.Util.hasValue(e.aspectRatio)&&(t.aspectRatio=e.aspectRatio),h.Util.hasValue(e.frameRate)&&(t.frameRate=e.frameRate),h.Util.hasValue(e.facingMode)&&(t.facingMode=e.facingMode),h.Util.hasValue(e.sampleRate)&&(t.sampleRate=e.sampleRate),h.Util.hasValue(e.sampleSize)&&(t.sampleSize=e.sampleSize),h.Util.hasValue(e.volume)&&(t.volume=e.volume),h.Util.hasValue(e.echoCancellation)&&(t.echoCancellation=e.echoCancellation),h.Util.hasValue(e.autoGainControl)&&(t.autoGainControl=e.autoGainControl),h.Util.hasValue(e.noiseSuppression)&&(t.noiseSuppression=e.noiseSuppression),h.Util.hasValue(e.latency)&&(t.latency=e.latency),h.Util.hasValue(e.channelCount)&&(t.channelCount=e.channelCount),h.Util.hasValue(e.deviceId)&&(t.deviceId=e.deviceId),h.Util.hasValue(e.groupId)&&(t.groupId=e.groupId),h.Util.hasValue(e.maxFrameRate)&&(t.maxFrameRate=e.maxFrameRate),h.Util.hasValue(e.maxHeight)&&(t.maxHeight=e.maxHeight),h.Util.hasValue(e.maxWidth)&&(t.maxWidth=e.maxWidth),h.Util.hasValue(e.minHeight)&&(t.minHeight=e.minHeight),h.Util.hasValue(e.minWidth)&&(t.minWidth=e.minWidth),h.Util.hasValue(e.sourceId)&&(t.sourceId=e.sourceId)),t},e}();t.RemoteMediaTrackConstraintSet=E;var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.defMandatory=function(e){var t=e;return h.Util.hasValue(e)?(h.Util.hasValue(e.maxFrameRate)||(t.maxFrameRate=30),h.Util.hasValue(e.minWidth)||(t.minWidth=360),h.Util.hasValue(e.maxWidth)||(t.maxWidth=1920),h.Util.hasValue(e.minHeight)||(t.minHeight=180),h.Util.hasValue(e.maxHeight)||(t.maxHeight=1080)):t={maxFrameRate:30,minWidth:360,maxWidth:1920,minHeight:180,maxHeight:1080},t},t.toRemoteMediaTrackConstraints=function(e){var t=void 0;return h.Util.hasValue(e)&&((t=E.toRemoteMediaTrackConstraintSet(e)).advanced=[],h.Util.hasValue(e.advanced)&&e.advanced.forEach(function(e){e=E.toRemoteMediaTrackConstraintSet(e),t.advanced.push(e)}),h.Util.hasValue(e.mandatory)&&(t.mandatory="boolean"!=typeof e.mandatory?E.toRemoteMediaTrackConstraintSet(e.mandatory):e.mandatory)),t},t}(E);t.RemoteMediaTrackConstraints=R;var T=function(){function e(){}return e.getDefaultAudioDeviceId=function(){if(void 0!==s){var e=s.find(function(e){return"audioinput"===e.kind&&"default"===e.deviceId});if(void 0!==e)return e.deviceId}return""},e.getDefaultVideoDeviceId=function(){if(void 0!==s){var e=s.find(function(e){return"videoinput"===e.kind});if(void 0!==e)return e.deviceId}return""},e.toRemoteMediaStreamConstraints=function(t,n){void 0===n&&(n=!1),l.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() in constraints:"+JSON.stringify(t));var r={};return h.Util.hasValue(t)&&(h.Util.hasValue(t.audio)&&("boolean"!=typeof t.audio?(r.audio=R.toRemoteMediaTrackConstraints(t.audio),0!=Object.keys(r.audio).length&&h.Util.hasValue(r.audio)||(r.audio={dummy:1}),c.BUILD_TYPE_SDK&&0==n&&e.isConstraintsAudioDeviceIdEmpty(t)&&(r.audio.deviceId=e.getDefaultAudioDeviceId(),l.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default audio deviceId:'"+r.audio.deviceId+"'"))):r.audio=t.audio),h.Util.hasValue(t.peerIdentity)&&(r.peerIdentity=t.peerIdentity),h.Util.hasValue(t.video)&&("boolean"!=typeof t.video?(r.video=R.toRemoteMediaTrackConstraints(t.video),0==n&&"boolean"!=typeof r.video.mandatory&&(r.video.mandatory=R.defMandatory(r.video.mandatory),c.BUILD_TYPE_SDK&&e.isConstraintsVideoSourceIdEmpty(t)&&(r.video.mandatory.sourceId=e.getDefaultVideoDeviceId(),l.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default video sourceId:'"+r.video.mandatory.sourceId+"'")))):(r.video=t.video,1==t.video&&0==n&&c.BUILD_TYPE_SDK&&e.isConstraintsVideoSourceIdEmpty(t)&&(r.video={},r.video.mandatory=R.defMandatory(void 0),r.video.mandatory.sourceId=e.getDefaultVideoDeviceId(),l.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() set default video sourceId:'"+r.video.mandatory.sourceId+"'"))))),l.logger.log("RemoteMediaStreamConstraints.toRemoteMediaStreamConstraints() out constraints:"+JSON.stringify(r)),r},e.isConstraintsAudioDeviceIdEmpty=function(e){var t=!1;return h.Util.hasValue(e)&&h.Util.hasValue(e.audio)&&("boolean"==typeof e.audio?1==e.audio&&(t=!0):!(e=e.audio)||!1!==h.Util.hasValue(e.deviceId)&&""!==e.deviceId||(t=!0)),t},e.isConstraintsVideoSourceIdEmpty=function(e){var t=!1;return h.Util.hasValue(e)&&h.Util.hasValue(e.video)&&("boolean"==typeof e.video?1==e.video&&(t=!0):(e=e.video)&&((e=e.mandatory)&&!1!==h.Util.hasValue(e.sourceId)&&""!==e.sourceId||(t=!0))),t},e}();t.RemoteMediaStreamConstraints=T;var w=function(){function e(){this.video=this.audio=e.EmptyCapabilities}return e.EmptyCapabilities={codecs:[],headerExtensions:[]},e}();e=function(e){function t(){return e.call(this,null,c.class_id_t.NavigatorUserMedia,0,d.ProxyMode.Local)||this}return r(t,e),t.getCapabilities=function(e){return l.logger.log("NavigatorUserMedia.getCapabilities for type="+e+" capabilities="+JSON.stringify(t.capabilities[e])),t.capabilities[e]},t.resetCapabilities=function(){t.capabilities=new w},t.prototype.getCapabilities=function(){var e=this;return l.logger.log(this.user_friendly_id()+".getCapabilities..."),new Promise(function(n,r){e.waitUntilConnected("NavigatorUserMedia.getCapabilities").then(function(){return Promise.all([e.remoteInvoke(!1,c.method_id_NavigatorUserMedia_t.getCapabilities,"audio"),e.remoteInvoke(!1,c.method_id_NavigatorUserMedia_t.getCapabilities,"video")])}).then(function(r){t.capabilities.audio=e.param0(r[0]),t.capabilities.video=e.param0(r[1]),l.logger.log(e.user_friendly_id()+".getCapabilities capabilities="+JSON.stringify(t.capabilities)),n(t.capabilities)}).catch(function(t){r(e.logRemoteInvokeError(t,".getCapabilities failed!"))})})},t.prototype.setCodecCapabilities=function(e){var t=this;return l.logger.log(this.user_friendly_id()+".setCodecCapabilities : set codecCapabilities to "+JSON.stringify(e)),new Promise(function(n,r){t.waitUntilConnected("NavigatorUserMedia.setCodecCapabilities").then(function(){return t.remoteInvoke(!1,c.method_id_NavigatorUserMedia_t.setCodecCapabilities,e)}).then(function(){l.logger.log(t.user_friendly_id()+".setCodecCapabilities() success."),n(!0),t.getCapabilities()}).catch(function(e){e=t.logRemoteInvokeError(e,".setCodecCapabilities() failed!"),r(e)})})},t.prototype.webkitGetUserMedia=function(e,t,n){return this.getUserMedia(e,t,n)},t.prototype.LogTelemetryDevice_=function(e){try{if(void 0!==e.audio){var t,n=e.audio.deviceId;s.forEach(function(e){n==e.deviceId&&(t=e.label)}),l.logger.log(t),this.SendTelemetryData(f.tel_key_AudioDeviceUsed,t,0)}if(void 0!==e.video){var r,i=e.video.mandatory;i&&s.forEach(function(e){i.sourceId==e.deviceId&&(r=e.label)}),l.logger.log(r),this.SendTelemetryData(f.tel_key_VideoDeviceUsed,r,0)}}catch(e){l.logger.log(e)}},t.prototype.getUserMedia=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getUserMedia() called: "+JSON.stringify(e)),t&&n?this.getUserMedia_v1(e,t,n):this.getUserMedia_v2(e)},t.prototype.getUserMedia_v2=function(e){var t=this;return l.logger.log(this.user_friendly_id()+".getUserMedia_v2() called: "+JSON.stringify(e)),new Promise(function(n,r){t.getUserMediaPrivate(e,function(e){l.logger.log(t.user_friendly_id()+"getUserMedia_v2: resolving stream"),n(e)},function(e){l.logger.log(t.user_friendly_id()+"getUserMedia_v2: rejecting stream"),r(e)})})},t.prototype.getUserMedia_v1=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getUserMedia_v1() called: "+JSON.stringify(e)),this.getUserMediaPrivate(e,t,n)},t.prototype.getUserMediaPrivate=function(e,t,n){var r=this;this.waitUntilConnected("NavigatorUserMedia.getUserMediaPrivate").then(function(){var t=r.registerCallbacks(!0,!1,c.method_id_NavigatorUserMedia_t.getUserMedia),n=T.toRemoteMediaStreamConstraints(e);return r.remoteInvoke(!1,c.method_id_NavigatorUserMedia_t.getUserMedia,n,t.success,t.fail),t.prom()}).then(function(e){return l.logger.log(r.user_friendly_id()+".getUserMediaPrivate: received success callback!"),new b(null,r.param0(e).oid,d.ProxyMode.Remote).syncBarrier()}).then(function(i){l.logger.log(r.user_friendly_id()+".getUserMediaPrivate: MediaStream ready to deliver",JSON.stringify(i)),0==i.getTracks().length?(l.logger.log(r.user_friendly_id()+".getUserMediaPrivate: reporting no tracks as error."),n({constraintName:"",name:"OverconstrainedError",message:""})):(r.LogTelemetryDevice_(e),t(i))}).catch(function(e){r.logRemoteInvokeError(e,".getUserMediaPrivate() failed!"),u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_1912)&&r.param0&&e?n(r.param0(e)):n({constraintName:"",name:"OverconstrainedError",message:""})})},t.prototype.SendTelemetryData=function(e,t,n){u.getRedirector().telemetry.SendTelemetryData(f.tel_cmd.Data,e,t,n)},t.capabilities=new w,t}(d.ProxyObject),t.NavigatorUserMedia=e},650:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSession=t.SessionInfo=t.RemoteType=void 0;var r,i=n(946),o=n(550),a=n(9),s=n(851),c=n(550),d=n(394);!function(e){e[e.Unknown=0]="Unknown",e[e.Windows=1]="Windows",e[e.Linux=2]="Linux"}(r=t.RemoteType||(t.RemoteType={}));var l=function(){};t.SessionInfo=l,e=function(){function e(e,t){var n=this;this.isremote_=!1,this.isremote_=!0,this.type_=r.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,i.getRedirector().setRemoteSessionInfoCb(function(){return n.remoteSessionInfo()}),this.enginecontrol_=new a.EngineControl(e+"::"+t)}return e.prototype.release=function(){i.getRedirector().setRemoteSessionInfoCb(null)},e.prototype.user_friendly_id=function(){return"[RemoteSession]"},e.prototype.getFeatureFlags=function(){var e={};return null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach(function(t){e[t.name]=t.value}),e},e.prototype.isFeatureSupported=function(e){if("video"===e)return!0;if("givecontrol"===e&&this.sessioninfo_.clientPlatform.includes("Linux")||!(e in c.featureNameMap))return!1;for(var t=c.featureNameMap[e],n=this.getFeatureFlags(),r=0;r<t.length;r++)if(!(t[r]in n)||!0!==n[t[r]])return!1;return!(e in c.vdaFeatureNameMap)||c.vdaFeatureNameMap[e].map(function(e){return i.getRedirector().getVDAFeatureValue(e)}).reduce(function(e,t){return e&&t},!0)},e.isFeaturePstnSupported=function(){return e.pstn_},e.isFeatureDtmfSupported=function(){return e.dtmfswitch_},e.isFeaturAppshareSupported=function(){return e.appshare_},e.isFeatureWebrtc1dot0Supported=function(){return e.webrtc1dot0_},e.isFeatureDataChannelSupported=function(){return e.datachannel_},e.isFeatureVdNoBufferLimitSupported=function(){return e.vdnobuflimit_},e.isFeatureCallConstraintsSupported=function(){return e.callconstraints_},e.isFeatureTrackCloneWithIdSupported=function(){return e.trackclonewithid_},e.isFeatureSenderStatsFixSupported=function(){return e.senderstatsfix_},e.prototype.getSessionInfo=function(){return s.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()},e.prototype.remoteSessionInfo=function(){var t=this,n=this;return s.logger.log(n.user_friendly_id()+".remoteSessionInfo() called."),new Promise(function(r,c){n.enginecontrol_.syncBarrier().then(function(i){if(s.logger.log(n.user_friendly_id()+"enginecontrol info received!"),n.sessioninfo_=new l,n.sessioninfo_.type_script=o.HDXMS_VERSION,n.sessioninfo_.webrpc=i.version_.major.toString()+"."+i.version_.minor.toString()+"."+i.version_.revision.toString()+"."+i.version_.build.toString(),void 0!=i.versions_&&null!=i.versions_){n.SendTelemetryData(d.tel_key_VerTypeScript,o.HDXMS_VERSION,0);for(var c=0,u=0,f=i.versions_;u<f.length;u++){var h=(h=f[u]).major.toString()+"."+h.minor.toString()+"."+h.revision.toString()+"."+h.build.toString();switch(c){case a.VersionType.Webrpc:n.sessioninfo_.webrpc=h,n.SendTelemetryData(d.tel_key_VerWebrpc,h,0);break;case a.VersionType.WebrtcCodecs:n.sessioninfo_.webrtc_codecs=h,n.SendTelemetryData(d.tel_key_VerWebrtcCodecs,h,0);break;case a.VersionType.Receiver:n.sessioninfo_.receiver=h,n.SendTelemetryData(d.tel_key_VerReceiver,h,0);break;case a.VersionType.Vda:n.sessioninfo_.vda=h,n.SendTelemetryData(d.tel_key_VerVda,h,0);break;case a.VersionType.Endpoint:n.sessioninfo_.endpoint=h,n.SendTelemetryData(d.tel_key_VerEndpoint,h,0);break;case a.VersionType.HdxRtcEngine:n.sessioninfo_.hdxrtcengine=h,n.SendTelemetryData(d.tel_key_VerHdxRtcEngine,h,0);break;default:s.logger.log(n.user_friendly_id()+"Unknown version type!")}c++}}void 0!=i.osinfo_&&null!=i.osinfo_&&(n.sessioninfo_.osinfo=i.osinfo_,i.osinfo_.family.includes("Darwin")&&["Mac OS X","macOS","OS X"].some(function(e){return i.osinfo_.edition.startsWith(e)})?n.sessioninfo_.clientPlatform="Mac":n.sessioninfo_.clientPlatform=i.osinfo_.family,n.SendTelemetryData(d.tel_key_OSFamily,i.osinfo_.family,0),n.SendTelemetryData(d.tel_key_OSVersion,i.osinfo_.version,0),n.SendTelemetryData(d.tel_key_OSArchitecture,i.osinfo_.architecture,0),n.SendTelemetryData(d.tel_key_OSDistro,i.osinfo_.distro,0),n.SendTelemetryData(d.tel_key_OSEdition,i.osinfo_.edition,0)),void 0!=i.endpointid_&&null!=i.endpointid_&&(n.sessioninfo_.endpointId=i.endpointid_.machine_id),void 0!=i.hardwareinfo_&&null!=i.hardwareinfo_&&(n.sessioninfo_.hardware_info=i.hardwareinfo_,n.SendTelemetryData(d.tel_key_CPUModel,i.hardwareinfo_.cpu_info.cpumodel,0),n.SendTelemetryData(d.tel_key_CPUProcessors,i.hardwareinfo_.cpu_info.numberofprocessors,0),n.SendTelemetryData(d.tel_key_CPUGpuinfo,JSON.stringify(i.hardwareinfo_.gpu_info.gpus),0),n.SendTelemetryData(d.tel_key_CPUTotalmemory,i.hardwareinfo_.memory_info.totalmemory,0)),e.pstn_=t.isFeatureSupported(o.Features.FEATURE_public_pstn),e.dtmfswitch_=t.isFeatureSupported(o.Features.FEATURE_public_dtmf),e.appshare_=t.isFeatureSupported(o.Features.FEATURE_public_app_sharing),e.webrtc1dot0_=t.isFeatureSupported(o.Features.FEATURE_public_webrtc1dot0),e.datachannel_=t.isFeatureSupported(o.Features.FEATURE_public_data_channel),e.vdnobuflimit_=t.isFeatureSupported(o.Features.FEATURE_public_vdnobuflimit),e.callconstraints_=t.isFeatureSupported(o.Features.FEATURE_public_stream_resolution),e.trackclonewithid_=t.isFeatureSupported(o.Features.FEATURE_public_track_clone_with_id),e.senderstatsfix_=t.isFeatureSupported(o.Features.FEATURE_public_sender_stats_fix),r(n.sessioninfo_),n.enginecontrol_.release()}).catch(function(){i.getRedirector().isPingActive()?n.retrySessionInfo():(c(),n.enginecontrol_.release(),n.enginecontrol_=null)})})},e.prototype.retrySessionInfo=function(){var e=this;setTimeout(function(){s.logger.log("checking if we are connected..."),e.enginecontrol_.bind(),i.getRedirector().handleRemoteSessionInfo()},15e3)},e.prototype.SendTelemetryData=function(e,t,n){i.getRedirector().telemetry.SendTelemetryData(d.tel_cmd.Data,e,t,n)},e.pstn_=!1,e.dtmfswitch_=!1,e.appshare_=!1,e.webrtc1dot0_=!1,e.datachannel_=!1,e.vdnobuflimit_=!1,e.callconstraints_=!1,e.trackclonewithid_=!1,e.senderstatsfix_=!1,e}(),t.RemoteSession=e},24:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RtcDataChannel=t.RTCSctpTransport=void 0;var i,o,a=n(658),s=n(550),c=n(851),d=n(589);!function(e){e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.closed=3]="closed",e[e.max=4]="max"}(i||(i={})),e=function(e){function t(t,n){var r=e.call(this,t,s.class_id_t.RTCSctpTransport,n,a.ProxyMode.Remote)||this;return c.logger.log(r.user_friendly_id()+".constructor"),r}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return c.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("RTCSctpTransport.syncBarrier").then(function(){return c.logger.log(e.user_friendly_id()+".syncBarrierBase success."),Promise.all([e.remoteInvoke(!1,s.method_id_RTCSctpTransport_t.transport,{oid:0}),e.remoteInvoke(!1,s.method_id_RTCSctpTransport_t.state,0),e.remoteInvoke(!1,s.method_id_RTCSctpTransport_t.maxMessageSize,0),e.remoteInvoke(!1,s.method_id_RTCSctpTransport_t.maxChannels,0)])}).then(function(t){var n;t=(n=t.map(function(t){return e.param0(t)}))[0],e.sctpstate_=n[1],e.maxMessageSize_=n[2],e.maxChannels_=n[3],n=e.transport_,void 0==t||!1!==t.is_null||null!==e.transport_&&e.transport_.object_id()==t.oid||(n=new d.DtlsTransport(e,t.oid)),n.syncBarrier().then(function(t){c.logger.log(e.user_friendly_id()+"transport.syncBarrier(): success"),e.transport_=t,e.syncBarrierResolve(e)}).catch(function(){c.logger.log(e.user_friendly_id()+"transport.syncBarrier(): failed!"),e.transport_=null,e.syncBarrierResolve(e)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},Object.defineProperty(t.prototype,"transport",{get:function(){return c.logger.log(this.user_friendly_id()+".get_transport() called: "+this.transport_),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return c.logger.log(this.user_friendly_id()+".get_state() called: "+this.sctpstate_),this.sctpstate_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxMessageSize",{get:function(){return c.logger.log(this.user_friendly_id()+".get_maxMessageSize() called: "+this.maxMessageSize_),this.maxMessageSize_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxChannels",{get:function(){return c.logger.log(this.user_friendly_id()+".get_maxChannels() called: "+this.maxChannels_),this.maxChannels_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onstatechange",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onstatechange() called: "+this.onstatechange_),this.onstatechange_},set:function(e){var n=this;c.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onstatechange").then(function(){var r=n.registerCallbacks(!1,n.isNullCallback(e),s.method_id_RTCSctpTransport_t.onstatechange);return r.then(function(e){c.logger.log(n.user_friendly_id()+".onstatechange callback received!!!"),n.sctpstate_=t.convertState(n.param0(e)),c.logger.log(n.user_friendly_id()+"sctpstate_: "+n.sctpstate_),e=new Event("onstatechange"),n.onstatechange_(e)}),n.remoteInvoke(!0,s.method_id_RTCSctpTransport_t.onstatechange,r.success)}).catch(function(){c.logger.log(n.user_friendly_id()+".onstatechange() failed.")})},enumerable:!1,configurable:!0}),t.convertState=function(e){return e==i.new?"closed":e==i.connecting?"connecting":e==i.connected?"connected":"closed"},t}(a.ProxyObject),t.RTCSctpTransport=e,function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(o||(o={})),e=function(e){function t(t,n,r){return(t=e.call(this,t,s.class_id_t.RTCDataChannel,n,r)||this).binaryType_="blob",c.logger.log(t.user_friendly_id()+".constructor"),t}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return c.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("RtcDataChannel.syncBarrier").then(function(){return c.logger.log(e.user_friendly_id()+".syncBarrier remote invoking."),Promise.all([e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.label,""),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.ordered,!0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.maxPacketLifeTime,0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.maxRetransmits,0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.protocol,""),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.negotiated,!1),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.id,0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.readyState,0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.bufferedAmount,0),e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.bufferedAmountLowThreshold,0)])}).then(function(t){var n;c.logger.log(e.user_friendly_id()+".syncBarrier success."),t=t.map(function(t){return e.param0(t)}),e.label_=t[0],e.ordered_=t[1],e.maxPacketLifeTime_=t[2],e.maxRetransmits_=t[3],e.protocol_=t[4],e.negotiated_=t[5],e.id_=t[6],n=t[7],e.bufferedAmount_=t[8],e.bufferedAmountLowThreshold_=t[9],e.readyState_=e.toRTCDataChannelState(n),e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},Object.defineProperty(t.prototype,"label",{get:function(){return c.logger.log(this.user_friendly_id()+".get_label() called: "+this.label_),this.label_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ordered",{get:function(){return c.logger.log(this.user_friendly_id()+".get_ordered() called: "+this.ordered_),this.ordered_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxPacketLifeTime",{get:function(){return c.logger.log(this.user_friendly_id()+".get_maxPacketLifeTime() called: "+this.maxPacketLifeTime_),this.maxPacketLifeTime_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxRetransmits",{get:function(){return c.logger.log(this.user_friendly_id()+".get_maxRetransmits() called: "+this.maxRetransmits_),this.maxRetransmits_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return c.logger.log(this.user_friendly_id()+".get_protocol() called: "+this.protocol_),this.protocol_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"negotiated",{get:function(){return c.logger.log(this.user_friendly_id()+".get_negotiated() called: "+this.negotiated_),this.negotiated_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return c.logger.log(this.user_friendly_id()+".get_id() called: "+this.id_),this.id_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return c.logger.log(this.user_friendly_id()+".get_readyState() called: "+this.readyState_),this.readyState_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){return c.logger.log(this.user_friendly_id()+".get_bufferedAmount() called: "+this.bufferedAmount_),this.bufferedAmount_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmountLowThreshold",{get:function(){return c.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+this.bufferedAmountLowThreshold_),this.bufferedAmountLowThreshold_},set:function(e){c.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+e),this.bufferedAmountLowThreshold_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return c.logger.log(this.user_friendly_id()+".get_binaryType() called: "+this.binaryType_),this.binaryType_},set:function(e){c.logger.log(this.user_friendly_id()+".set_binaryType() called: "+e),this.binaryType_="blob"==e||"arraybuffer"==e?e:"blob"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onopen",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onopen() called."),this.onopen_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onopen() called."),this.onopen_=e,this.waitUntilConnected(this.user_friendly_id()+".onopen").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onopen);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onopen callback received!!!"),t.syncBarrier().then(function(){c.logger.log(t.user_friendly_id()+".onopen notifying...");var e=new Event("open",{});Object.defineProperty(e,"target",{writable:!1,value:t}),t.onopen_(e)}).catch(function(){c.logger.log(t.user_friendly_id()+".syncBarrier(): failed!")})}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onopen,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onopen() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onbufferedamountlow",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onbufferedamountlow() called."),this.onbufferedamountlow_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onbufferedamountlow() called."),this.onbufferedamountlow_=e,this.waitUntilConnected(this.user_friendly_id()+".onbufferedamountlow").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onbufferedamountlow);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onbufferedamountlow callback received!!!"),e=new Event("onbufferedamountlow"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onbufferedamountlow_(e)}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onbufferedamountlow,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onbufferedamountlows() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onerror() called."),this.onerror_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=e,this.waitUntilConnected(this.user_friendly_id()+".onerror").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onerror);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onerror callback received!"),e=t.param0(e),c.logger.log(t.user_friendly_id()+"error: "+e),e=new Event("onerror"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onerror_(e)}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onerror,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onerror() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onclosing",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onclosing() called."),this.onclosing_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onclosing() called."),this.onclosing_=e,this.waitUntilConnected(this.user_friendly_id()+".onclosing").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onclosing);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onclosing callback received!!!"),e=new Event("onclosing"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onclosing_(e)}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onclosing,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onclosing() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onclose",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onclose() called."),this.onclose_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onclose() called."),this.onclose_=e,this.waitUntilConnected(this.user_friendly_id()+".onclose").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onclose);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onclose callback received!!!"),e=new Event("onclose"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onclose_(e)}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onclose,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onclose() failed.")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onmessage",{get:function(){return c.logger.log(this.user_friendly_id()+".get_onmessage() called."),this.onmessage_},set:function(e){var t=this;c.logger.log(this.user_friendly_id()+".set_onmessage() called."),this.onmessage_=e,this.waitUntilConnected(this.user_friendly_id()+".onmessage").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),s.method_id_RTCDataChannel_t.onmessage);return n.then(function(e){c.logger.log(t.user_friendly_id()+".onmessage callback received!!!");var n=t.param0(e);e=new Event("onmessage"),n.binary?e.data=n.data_ab:(n=atob(n.data_sz),e.data=n),t.onmessage_(e)}),t.remoteInvoke(!0,s.method_id_RTCDataChannel_t.onmessage,n.success)}).catch(function(){c.logger.log(t.user_friendly_id()+".onmessage() failed.")})},enumerable:!1,configurable:!0}),t.prototype.close=function(){var e=this;c.logger.log(this.user_friendly_id()+".close() called."),this.waitUntilConnected("RTCDataChannel.close").then(function(){return e.remoteInvoke(!1,s.method_id_RTCDataChannel_t.close)}).then(function(){c.logger.log(e.user_friendly_id()+".close: success.")}).catch(function(){c.logger.log(e.user_friendly_id()+".close: failed.")})},t.prototype.toByteArray=function(e){var t=[];for(var n in e=new Uint8Array(e instanceof ArrayBuffer?e:e.buffer))t.push(e[n]);return t},t.prototype.send=function(e){var t=this;c.logger.log(this.user_friendly_id()+".send() called."),this.waitUntilConnected("RTCDataChannel.send").then(function(){if("string"==typeof e)return c.logger.log(t.user_friendly_id()+"data(string): "+e),t.remoteInvoke(!1,s.method_id_RTCDataChannel_t.send_text,e);if(!(e instanceof Blob)){var n=t.toByteArray(e);return t.remoteInvoke(!1,s.method_id_RTCDataChannel_t.send_binary,n)}e.arrayBuffer().then(function(e){return e=t.toByteArray(e),t.remoteInvoke(!1,s.method_id_RTCDataChannel_t.send_binary,e)}).catch(function(){c.logger.log(t.user_friendly_id()+".arrayBuffer(): failed.")})}).then(function(){c.logger.log(t.user_friendly_id()+".send: success.")}).catch(function(){c.logger.log(t.user_friendly_id()+".send: failed.")})},t.prototype.toRTCDataChannelState=function(e){var t="closed";return e==o.connecting?t="connecting":e==o.open?t="open":e==o.closing?t="closing":e==o.closed&&(t="closed"),t},t}(a.ProxyObject),t.RtcDataChannel=e},484:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RtcRtpReceiveParameters=t.RtcRtpSendParameters=t.RtcRtpEncodingParameters=t.RtcRtpParameters=t.RtcRtcpParameters=t.RtcRtpHeaderExtensionParameters=t.RtcRtpCodecParameters=void 0;var i=n(851),o=function(){function e(){}return e.defRtcRtpCodecParameters=function(){return{mimeType:"",payloadType:0,sdpFmtpLine:""}},e.defRTCRtpCodecParameters=function(){return{clockRate:0,mimeType:"",payloadType:0}},e.toRtcRtpCodecParameters=function(t){var n=e.defRtcRtpCodecParameters();return t&&(t.channels&&(n.channels=t.channels),t.clockRate&&(n.clockRate=t.clockRate),t.mimeType&&(n.mimeType=t.mimeType),t.payloadType&&(n.payloadType=t.payloadType),t.sdpFmtpLine&&(n.sdpFmtpLine=t.sdpFmtpLine)),n},e.toRTCRtpCodecParameters=function(t){var n=e.defRTCRtpCodecParameters();return t&&(t.channels&&(n.channels=t.channels),t.clockRate&&(n.clockRate=t.clockRate),t.mimeType&&(n.mimeType=t.mimeType),t.payloadType&&(n.payloadType=t.payloadType),t.sdpFmtpLine&&(n.sdpFmtpLine=t.sdpFmtpLine)),n},e}();t.RtcRtpCodecParameters=o;var a=function(){function e(){}return e.defRtcRtpHeaderExtensionParameters=function(){return{encrypted:!1,id:0,uri:""}},e.defRTCRtpHeaderExtensionParameters=function(){return{id:0,uri:""}},e.toRtcRtpHeaderExtensionParameters=function(t){var n=e.defRtcRtpHeaderExtensionParameters();if(t){var r=t.encrypted;void 0!=r&&null!=r&&(n.encrypted=r),t.id&&(n.id=t.id),t.uri&&(n.uri=t.uri)}return n},e.toRTCRtpHeaderExtensionParameters=function(t){var n=e.defRTCRtpHeaderExtensionParameters();if(t){var r=t.encrypted;void 0!=r&&null!=r&&(n.encrypted=r),t.id&&(n.id=t.id),t.uri&&(n.uri=t.uri)}return n},e}();t.RtcRtpHeaderExtensionParameters=a;var s=function(){function e(){}return e.defRtcRtcpParameters=function(){return{cname:"",reducedSize:!1}},e.defRTCRtcpParameters=function(){return{}},e.toRtcRtcpParameters=function(t){var n=e.defRtcRtcpParameters();return t&&(t.cname&&(n.cname=t.cname),void 0!=(t=t.reducedSize)&&null!=t&&(n.reducedSize=t)),n},e.toRTCRtcpParameters=function(t){var n=e.defRTCRtcpParameters();return t&&(t.cname&&(n.cname=t.cname),void 0!=(t=t.reducedSize)&&null!=t&&(n.reducedSize=t)),n},e}();t.RtcRtcpParameters=s;var c=function(){function e(){}return e.defRtcRtpParameters=function(){return{codecs:[],headerExtensions:[],rtcp:s.defRtcRtcpParameters()}},e.defRTCRtpParameters=function(){return{codecs:[],headerExtensions:[],rtcp:s.defRTCRtcpParameters()}},e.toRtcRtpParameters=function(t){var n=e.defRtcRtpParameters();if(t){if(t.codecs)for(var r=0,i=t.codecs;r<i.length;r++)n.codecs.push(o.toRtcRtpCodecParameters(i[r]));if(t.headerExtensions)for(r=0,i=t.headerExtensions;r<i.length;r++)n.headerExtensions.push(a.toRtcRtpHeaderExtensionParameters(i[r]));t.rtcp&&(n.rtcp=s.toRtcRtcpParameters(t.rtcp))}return n},e.toRTCRtpParameters=function(t){var n=e.defRTCRtpParameters();if(t){if(t.codecs)for(var r=0,i=t.codecs;r<i.length;r++)n.codecs.push(o.toRTCRtpCodecParameters(i[r]));if(t.headerExtensions)for(r=0,i=t.headerExtensions;r<i.length;r++)n.headerExtensions.push(a.toRTCRtpHeaderExtensionParameters(i[r]));t.rtcp&&(n.rtcp=s.toRtcRtcpParameters(t.rtcp))}return n},e}();t.RtcRtpParameters=c;var d=function(){function e(){}return e.defRtcRtpEncodingParameters=function(){return{active:!0,rid:""}},e.defRTCRtpEncodingParameters=function(){return{}},e.toRtcRtpEncodingParameters=function(t){var n=e.defRtcRtpEncodingParameters();if(t){var r=t.active;void 0!=r&&null!=r&&(n.active=r),t.maxBitrate&&(n.maxBitrate=t.maxBitrate),t.maxFramerate&&(n.maxFramerate=t.maxFramerate),t.scaleResolutionDownBy&&(n.scaleResolutionDownBy=t.scaleResolutionDownBy),t.rid&&(n.rid=t.rid),t.networkPriority&&(n.networkPriority=t.networkPriority)}return n},e.toRTCRtpEncodingParameters=function(t){var n=e.defRTCRtpEncodingParameters();if(t){var r=t.active;void 0!=r&&null!=r&&(n.active=r),t.maxBitrate&&(n.maxBitrate=t.maxBitrate),t.maxFramerate&&(n.maxFramerate=t.maxFramerate),t.scaleResolutionDownBy&&(n.scaleResolutionDownBy=t.scaleResolutionDownBy),t.rid&&(n.rid=t.rid),t.networkPriority&&(n.networkPriority=t.networkPriority)}return n},e}();t.RtcRtpEncodingParameters=d,e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.defRtcRtpSendParameters=function(){var e=c.defRtcRtpParameters();return e.encodings=[],e.transaction_id="",e},t.defRTCRtpSendParameters=function(){var e=c.defRTCRtpParameters();return e.encodings=[],e.transactionId="",e},t.toRtcRtpSendParameters=function(e){i.logger.log("RtcRtpSendParameters.toRtcRtpSendParameters() in param:"+JSON.stringify(e));var n=t.defRtcRtpSendParameters();if((r=c.toRtcRtpParameters(e)).codecs.forEach(function(e){return n.codecs.push(e)}),r.headerExtensions.forEach(function(e){return n.headerExtensions.push(e)}),n.rtcp=r.rtcp,e){if(e.encodings)for(var r=0,o=e.encodings;r<o.length;r++)n.encodings.push(d.toRtcRtpEncodingParameters(o[r]));e.transactionId&&(n.transaction_id=e.transactionId)}return i.logger.log("RtcRtpSendParameters.toRtcRtpSendParameters() out param:"+JSON.stringify(n)),n},t.toRTCRtpSendParameters=function(e){i.logger.log("RtcRtpSendParameters.toRTCRtpSendParameters() in param:"+JSON.stringify(e));var n=t.defRTCRtpSendParameters();if((r=c.toRTCRtpParameters(e)).codecs.forEach(function(e){return n.codecs.push(e)}),r.headerExtensions.forEach(function(e){return n.headerExtensions.push(e)}),n.rtcp=r.rtcp,e){if(e.encodings)for(var r=0,o=e.encodings;r<o.length;r++)n.encodings.push(d.toRTCRtpEncodingParameters(o[r]));e.transaction_id&&(n.transactionId=e.transaction_id)}return i.logger.log("RtcRtpSendParameters.toRTCRtpSendParameters() out param:"+JSON.stringify(n)),n},t}(c),t.RtcRtpSendParameters=e,e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.defRtcRtpReceiveParameters=function(){return c.defRtcRtpParameters()},t.defRTCRtpReceiveParameters=function(){return c.defRTCRtpParameters()},t.toRtcRtpReceiveParameters=function(e){return i.logger.log("RtcRtpReceiveParameters.toRtcRtpReceiveParameters() in param:"+JSON.stringify(e)),e=c.toRtcRtpParameters(e),i.logger.log("RtcRtpReceiveParameters.toRtcRtpReceiveParameters() out param:"+JSON.stringify(e)),e},t.toRTCRtpReceiveParameters=function(e){return i.logger.log("RtcRtpReceiveParameters.toRTCRtpReceiveParameters() in param:"+JSON.stringify(e)),e=c.toRTCRtpParameters(e),i.logger.log("RtcRtpReceiveParameters.toRTCRtpReceiveParameters() out param:"+JSON.stringify(e)),e},t}(c),t.RtcRtpReceiveParameters=e},589:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RtpReceiver=t.RtpSender=t.RtpSenderReceiver=t.DtlsTransport=t.IceTransport=t.DtmfSender=t.DTMFToneChangeEvent=void 0;var i=n(658),o=n(550),a=n(851),s=n(144),c=n(517),d=n(650),l=n(484),u=function(e){function t(t,n){var r=e.call(this,t,o.class_id_t.RTCDTMFToneChangeEvent,n,i.ProxyMode.Remote)||this;return a.logger.log(r.user_friendly_id()+".constructor"),r}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){Promise.all([e.remoteInvoke(!1,o.method_id_RTCDTMFToneChangeEvent_t.tone,""),e.remoteInvoke(!1,o.method_id_RTCDTMFToneChangeEvent_t.tone_buffer,"")]).then(function(t){a.logger.log(e.user_friendly_id()+".syncBarrier(): success."),t=t.map(function(t){return e.param0(t)}),e.tone=t[0],e.tone_buffer_=t[1],e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".prop.syncBarrier() failed."),e.syncBarrierReject(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed."),e.syncBarrierReject(t)})})},Object.defineProperty(t.prototype,"tone_buffer",{get:function(){return this.tone_buffer_},enumerable:!1,configurable:!0}),t}(i.ProxyObject);t.DTMFToneChangeEvent=u;var f=function(e){function t(t,n){var r=e.call(this,t,o.class_id_t.RTCDTMFSender,n,i.ProxyMode.Remote)||this;return a.logger.log(r.user_friendly_id()+".constructor"),r.canInsertDTMF=!0,r.toneBuffer_="",r}return r(t,e),t.prototype.insertDTMF=function(e,t,n){var r=this;void 0===t&&(t=100),void 0===n&&(n=70),a.logger.log(this.user_friendly_id()+".insertDTMF() called, tones: "+e),this.waitUntilConnected("DtmfSender.insertDTMF").then(function(){return r.remoteInvoke(!1,o.method_id_RTCDTMFSender_t.insertDTMF,e,t,n)}).then(function(){a.logger.log(r.user_friendly_id()+".insertDTMF() success, tones: "+e)}).catch(function(e){r.logRemoteInvokeError(e,".insertDTMF() failed!")})},Object.defineProperty(t.prototype,"ontonechange",{get:function(){return this.ontonechange_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_ontonechange() called."),this.ontonechange_=e,this.waitUntilConnected("DtmfSender.ontonechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCDTMFSender_t.ontonechange);return n.then(function(e){a.logger.log(t.user_friendly_id()+".ontonechange callback received!"),new u(t,t.param0(e).oid).syncBarrier().then(function(e){a.logger.log(t.user_friendly_id()+"tone: "+e.tone+" tone_buffer: "+e.tone_buffer),t.toneBuffer_=e.tone_buffer,t.ontonechange_(e)}).catch(function(e){t.logRemoteInvokeError(e,".toneEvt.syncBarrier() failed!")})}),t.remoteInvoke(!0,o.method_id_RTCDTMFSender_t.ontonechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_ontonechange() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneBuffer",{get:function(){return a.logger.log(this.user_friendly_id()+".toneBuffer() called."),this.toneBuffer_},enumerable:!1,configurable:!0}),t}(i.ProxyObject);t.DtmfSender=f;var h,p=function(e){function t(t,n){var r=e.call(this,t,o.class_id_t.RTCIceTransport,n,i.ProxyMode.Remote)||this;return a.logger.log(r.user_friendly_id()+".constructor"),r.selectedPair=null,r.localCandidates_=[],r.remoteCandidates_=[],r}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){e.syncBarrierDeep(n,r)&&e.waitUntilConnected("IceTransport.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.role,0),e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.component,0),e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.state,0),e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.gatheringState,0)])}).then(function(n){a.logger.log(e.user_friendly_id()+".syncBarrier success.");var r,i;n=n.map(function(t){return e.param0(t)}),e.role_=n[0],e.component_=n[1],r=n[2],i=n[3],e.state_=t.convertState(r),e.gatheringState_=t.convertGatheringState(i),e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},t.prototype.syncCandidates=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncCandidates() called."),new Promise(function(t,n){e.waitUntilConnected("IceTransport.syncCandidates").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.localcandidates,[]),e.remoteInvoke(!1,o.method_id_RTCIceTransport_t.remotecandidates,[])])}).then(function(n){a.logger.log(e.user_friendly_id()+".syncCandidates success."),n=n.map(function(t){return e.param0(t)}),e.localCandidates_=n[0],e.remoteCandidates_=n[1],t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncCandidates() failed!"),n(t)})})},Object.defineProperty(t.prototype,"role",{get:function(){return this.role_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.component_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"State",{get:function(){return this.state_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gatheringState",{get:function(){return this.gatheringState_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;a.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("IceTransport.onstatechange").then(function(){var r=n.registerCallbacks(!1,n.isNullCallback(e),o.method_id_RTCIceTransport_t.onstatechange);return r.then(function(e){a.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.syncCandidates().then(function(e){a.logger.log(n.user_friendly_id()+"received updated ice candidates!")}),n.state_=t.convertState(n.param0(e)),a.logger.log(n.user_friendly_id()+"state: "+n.state_),n.onstatechange_()}),n.remoteInvoke(!0,o.method_id_RTCIceTransport_t.onstatechange,r.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_onstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ongatheringstatechange",{get:function(){return this.ongatheringstatechange_},set:function(e){var n=this;a.logger.log(this.user_friendly_id()+".set_ongatheringstatechange() called."),this.ongatheringstatechange_=e,this.waitUntilConnected("IceTransport.ongatheringstatechange").then(function(){var r=n.registerCallbacks(!1,n.isNullCallback(e),o.method_id_RTCIceTransport_t.ongatheringstatechange);return r.then(function(e){a.logger.log(n.user_friendly_id()+".ongatheringstatechange callback received!"),n.syncCandidates().then(function(e){a.logger.log(n.user_friendly_id()+"received updated ice candidates!")}),n.gatheringState_=t.convertGatheringState(n.param0(e)),a.logger.log(n.user_friendly_id()+"gatheringState: "+n.gatheringState_),n.ongatheringstatechange_()}),n.remoteInvoke(!0,o.method_id_RTCIceTransport_t.ongatheringstatechange,r.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_ongatheringstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onselectedcandidatepairchange",{get:function(){return this.onselectedcandidatepairchange_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onselectedcandidatepairchange() called."),this.onselectedcandidatepairchange_=e,this.waitUntilConnected("IceTransport.onselectedcandidatepairchange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCIceTransport_t.onselectedcandidatepairchange);return n.then(function(e){a.logger.log(t.user_friendly_id()+".onselectedcandidatepairchange callback received!"),t.syncCandidates().then(function(e){a.logger.log(t.user_friendly_id()+"received updated ice candidates!")}),t.selectedPair=t.param0(e),a.logger.log(t.user_friendly_id()+"selectedPair: "+t.selectedPair),t.onselectedcandidatepairchange_()}),t.remoteInvoke(!0,o.method_id_RTCIceTransport_t.onselectedcandidatepairchange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onselectedcandidatepairchange failed!")})},enumerable:!1,configurable:!0}),t.prototype.getLocalCandidates=function(){return this.localCandidates_},t.prototype.getRemoteCandidates=function(){return this.remoteCandidates_},t.prototype.getLocalParameters=function(){return null},t.prototype.getRemoteParameters=function(){return null},t.prototype.getSelectedCandidatePair=function(){return this.selectedPair},t.convertState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},t.convertGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},t}(i.ProxyObject);t.IceTransport=p,function(e){e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.closed=3]="closed",e[e.failed=4]="failed",e[e.max=5]="max"}(h||(h={}));var _=function(e){function t(t,n){var r=e.call(this,t,o.class_id_t.RTCDtlsTransport,n,i.ProxyMode.Remote)||this;return a.logger.log(r.user_friendly_id()+".constructor"),r.state_="new",r.transport_=null,r.remoteCertificates_=[],r}return r(t,e),t.prototype.dumpInfo=function(){a.logger.log("DtlsTransport["+this.object_id()+"].dumpInfo():"),a.logger.log("    - state:"+this.state_),a.logger.log("    - transport:"+this.transport_)},t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){e.syncBarrierDeep(n,r)&&e.waitUntilConnected("DtlsTransport.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCDtlsTransport_t.transport,{}),e.remoteInvoke(!1,o.method_id_RTCDtlsTransport_t.state,0),e.remoteInvoke(!1,o.method_id_RTCDtlsTransport_t.getRemoteCertificates)])}).then(function(n){var r,i;a.logger.log(e.user_friendly_id()+".syncBarrier remote success."),n=(r=n.map(function(t){return e.param0(t)}))[0],i=r[1],e.remoteCertificates_=r[2],e.state_=t.convertState(i),r=[],void 0!=n&&0==n.is_null?(i=e.transport_,null!==e.transport_&&e.transport_.object_id()==n.oid||(i=new p(e,n.oid)),r.push(i.syncBarrier())):r.push(Promise.resolve(null)),Promise.all(r).then(function(t){a.logger.log(e.user_friendly_id()+".syncBarrier success"),e.transport_=t[0],e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".prop.syncBarrier failed!"),e.syncBarrierReject(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),e.syncBarrierReject(t)})})},Object.defineProperty(t.prototype,"transport",{get:function(){return this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return a.logger.log(this.user_friendly_id()+".get_state() called: "+this.state_),this.state_},enumerable:!1,configurable:!0}),t.prototype.getRemoteCertificates=function(){return this.remoteCertificates_},Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;a.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("DtlsTransport.onstatechange").then(function(){var r=n.registerCallbacks(!1,n.isNullCallback(e),o.method_id_RTCDtlsTransport_t.onstatechange);return r.then(function(e){a.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.state_=t.convertState(n.param0(e)),a.logger.log(n.user_friendly_id()+"state_: "+n.state_),n.onstatechange_()}),n.remoteInvoke(!0,o.method_id_RTCDtlsTransport_t.onstatechange,r.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_onstatechange failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this.onerror_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=e,this.waitUntilConnected("DtlsTransport.onerror").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),o.method_id_RTCDtlsTransport_t.onerror);return n.then(function(e){a.logger.log(t.user_friendly_id()+".onerror callback received!"),e=t.param0(e),a.logger.log(t.user_friendly_id()+"error: "+e),t.onerror_(e)}),t.remoteInvoke(!0,o.method_id_RTCDtlsTransport_t.onerror,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onerror failed!")})},enumerable:!1,configurable:!0}),t.convertState=function(e){return e==h.new?"new":e==h.connecting?"connecting":e==h.connected?"connected":e==h.closed?"closed":"failed"},t}(i.ProxyObject);t.DtlsTransport=_,e=function(e){function t(t,n,r,i){return t=e.call(this,t,n,r,i)||this,a.logger.log(t.user_friendly_id()+".constructor base"),t.track_=null,t.transport_=null,t}return r(t,e),t.prototype.syncBarrierBase=function(){a.logger.log(this.user_friendly_id()+".syncBarrierBase() called.");var e,t,n=[];return this instanceof g?(e=o.method_id_RTCRtpSender_t.track,t=o.method_id_RTCRtpSender_t.transport):this instanceof m&&(e=o.method_id_RTCRtpReceiver_t.track,t=o.method_id_RTCRtpReceiver_t.transport),d.RemoteSession.isFeaturePstnSupported()&&d.RemoteSession.isFeatureDtmfSupported()?(n.push(this.remoteInvoke(!1,e,{oid:0})),n.push(this.remoteInvoke(!1,t,{oid:0}))):n.push(this.remoteInvoke(!1,e,{oid:0})),n},t.prototype.syncBarrierBaseResults=function(e){var t,n,r=this;t=0,a.logger.log(this.user_friendly_id()+".syncBarrierBaseResults"),d.RemoteSession.isFeaturePstnSupported()&&d.RemoteSession.isFeatureDtmfSupported()?(e=(t=e.map(function(e){return r.param0(e)}))[0],n=t[1],t=2):(e=e.map(function(e){return r.param0(e)})[0],t=1);var i=[];if(void 0!=e&&!1===e.is_null){var o=this.track_;null===this.track_||this.track_.object_id()!=e.oid?o=new s.RemoteMediaTrack(this,e.oid):this.track_.bind(this,e.oid),i.push(o.syncBarrier())}else i.push(Promise.resolve(null));return void 0!=n&&!1===n.is_null?(e=this.transport_,null!==this.transport_&&this.transport_.object_id()==n.oid||(e=new _(this,n.oid)),i.push(e.syncBarrier())):i.push(Promise.resolve(null)),[t,i]},t.prototype.syncBarrierBaseResultsWithAllPromisesFulFilled=function(e){this.track_=e[0],this.transport_=e[1]},Object.defineProperty(t.prototype,"transport",{get:function(){return a.logger.log(this.user_friendly_id()+".get transport() called."),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rtcpTransport",{get:function(){return a.logger.log(this.user_friendly_id()+".get rtcpTransport() called."),this.transport_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"track",{get:function(){return this.track_},enumerable:!1,configurable:!0}),t.prototype.reinitTrack=function(e){this.track_=e},t.prototype.getStats=function(){a.logger.log(this.user_friendly_id()+".getStats() called.");var e=this;return new Promise(function(t,n){e.isRedirected()?e.waitUntilConnected("RtpReceiver.getStats").then(function(){if(d.RemoteSession.isFeatureSenderStatsFixSupported()){var n;e instanceof g?n=o.method_id_RTCRtpSender_t.getStats:e instanceof m&&(n=o.method_id_RTCRtpReceiver_t.getStats);var r=e.registerCallbacks(!0,!1,n);return r.then(function(e){void 0===e.params||0===e.params.length||0===e.params[0].length?t():t(c.StatsReport.fromJSON(JSON.parse(e.params[0])))}),e.remoteInvoke(!1,n,r.success)}t()}).catch(function(t){t=e.logRemoteInvokeError(t,".getStats() failed!"),n(t)}):(a.logger.log(e.user_friendly_id()+".getStats(): not in active redirection!"),t())})},t}(i.ProxyObject),t.RtpSenderReceiver=e;var g=function(e){function t(t,n,r,i){return t=e.call(this,t,o.class_id_t.RTCRtpSender,n,r)||this,a.logger.log(t.user_friendly_id()+".constructor"),t.dtmf_=null,t.params_=l.RtcRtpSendParameters.defRtcRtpSendParameters(),t.unified_=i,t}return r(t,e),t.prototype.dumpInfo=function(){a.logger.log("RtpSender["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo()},t.prototype.syncBarrier=function(){var t=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){t.syncBarrierDeep(n,r)&&t.waitUntilConnected("RtpSender.syncBarrier").then(function(){var n=e.prototype.syncBarrierBase.call(t);return d.RemoteSession.isFeaturePstnSupported()&&d.RemoteSession.isFeatureDtmfSupported()&&(n.push(t.remoteInvoke(!1,o.method_id_RTCRtpSender_t.dtmf,{oid:0})),n.push(t.remoteInvoke(!1,o.method_id_RTCRtpSender_t.getParameters))),Promise.all(n)}).then(function(e){var n,r;r=(n=t.syncBarrierBaseResults(e))[0],n=n[1],r=(e=e.slice(r).map(function(e){return t.param0(e)}))[0],t.params_=e[1],void 0==r||!1!==r.is_null||null!==t.dtmf_&&t.dtmf_.object_id()==r.oid||(t.dtmf_=new f(t,r.oid)),Promise.all(n).then(function(e){t.syncBarrierBaseResultsWithAllPromisesFulFilled(e),a.logger.log(t.user_friendly_id()+".syncBarrierBase success."),t.syncBarrierResolve(t)}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier() promises_base failed!"),t.syncBarrierReject(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier failed!"),t.syncBarrierReject(e)})})},t.getCapabilities=function(e){return a.logger.log(this.constructor.name+".getCapabilities() called."),s.NavigatorUserMedia.getCapabilities(e)},Object.defineProperty(t.prototype,"dtmf",{get:function(){return a.logger.log(this.user_friendly_id()+".get dtmf() called."),this.dtmf_},enumerable:!1,configurable:!0}),t.prototype.setParameters=function(e){return this.setParametersAsync(e)},t.prototype.setParametersAsync=function(e){var t=this;return a.logger.log(this.user_friendly_id()+".setParametersAsync() called."),new Promise(function(n,r){t.waitUntilConnected("RtpSender.setParametersAsync").then(function(){return Promise.all([t.remoteInvoke(!1,o.method_id_RTCRtpSender_t.setParameters,l.RtcRtpSendParameters.toRtcRtpSendParameters(e))])}).then(function(r){a.logger.log(t.user_friendly_id()+".setParametersAsync(): success."),n(),t.params_=l.RtcRtpSendParameters.toRtcRtpSendParameters(e)}).catch(function(e){e=t.logRemoteInvokeError(e,".setParametersAsync() failed!"),r(e)})})},t.prototype.getParameters=function(){return a.logger.log(this.user_friendly_id()+".getParameters() called."),this.getParametersInternal(!1)},t.prototype.getParametersAsync=function(){return a.logger.log(this.user_friendly_id()+".getParametersAsync() called."),this.getParametersInternal(!0)},t.prototype.getParametersInternal=function(e){var t=this,n=new Promise(function(e,n){t.waitUntilConnected(t.user_friendly_id()+".getParametersInternal").then(function(){return a.logger.log(t.user_friendly_id()+".getParametersInternal() remote invoking"),t.remoteInvoke(!1,o.method_id_RTCRtpSender_t.getParameters)}).then(function(n){t.params_=t.param0(n),a.logger.log(t.user_friendly_id()+".getParametersInternal() success returning: "+t.params_),e(l.RtcRtpSendParameters.toRTCRtpSendParameters(t.params_))}).catch(function(e){e=t.logRemoteInvokeError(e,".getParametersInternal() failed!"),n(e)})});return e?n:(a.logger.log(this.user_friendly_id()+".getParametersInternal() returning: "+this.params_),l.RtcRtpSendParameters.toRTCRtpSendParameters(this.params_))},t.prototype.replaceTrack=function(e){var t=this;return a.logger.log(this.user_friendly_id()+".replaceTrack() called. current track:"+(this.track_?this.track_.object_id():"null")+" with track="+(e?e.object_id():"null")),new Promise(function(n,r){t.waitUntilConnected("RtpSender.replaceTrack").then(function(){return e||d.RemoteSession.isFeatureWebrtc1dot0Supported()?e?t.remoteInvokeEx(!1,o.method_id_RTCRtpSender_t.replaceTrack,[e]):t.remoteInvoke(!1,o.method_id_RTCRtpSender_t.replaceTrack,{oid:-1}):Promise.reject(new DOMException("Does not support replace track with null in non-Unified SDP semantic!"))}).then(function(r){a.logger.log(t.user_friendly_id()+".replaceTrack(): success."),n(),t.reinitTrack(e)}).catch(function(e){e=t.logRemoteInvokeError(e,".replaceTrack() failed!"),r(e)})})},t}(e);t.RtpSender=g;var m=function(e){function t(t,n,r,i,s){return t=e.call(this,t,o.class_id_t.RTCRtpReceiver,n,r)||this,a.logger.log(t.user_friendly_id()+".constructor"),t.contribsources_=[],t.syncsources_=[],t.params_=l.RtcRtpParameters.defRtcRtpParameters(),t.unified_=i,s&&(t.track_=s),t}return r(t,e),t.prototype.dumpInfo=function(){a.logger.log("RtpReceiver["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo(),this.transport&&this.transport.dumpInfo()},t.prototype.syncBarrier=function(){var t=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,r){t.syncBarrierDeep(n,r)&&t.waitUntilConnected("RtpReceiver.syncBarrier").then(function(){var n=e.prototype.syncBarrierBase.call(t);return d.RemoteSession.isFeaturePstnSupported()&&d.RemoteSession.isFeatureDtmfSupported()?(n.push(t.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getContributingSources)),n.push(t.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getSynchronizationSources)),n.push(t.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getParameters))):n.push(t.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getContributingSources)),Promise.all(n)}).then(function(e){var n,r;r=(n=t.syncBarrierBaseResults(e))[0],n=n[1],e=e.slice(r).map(function(e){return t.param0(e)}),t.contribsources_=e[0],t.syncsources_=e[1],t.params_=e[2],Promise.all(n).then(function(e){t.syncBarrierBaseResultsWithAllPromisesFulFilled(e),a.logger.log(t.user_friendly_id()+".syncBarrier success."),t.syncBarrierResolve(t)}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier() promises_base failed!"),t.syncBarrierReject(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier() failed!"),t.syncBarrierReject(e)})})},t.getCapabilities=function(e){return a.logger.log(this.constructor.name+".getCapabilities() called."),s.NavigatorUserMedia.getCapabilities(e)},t.prototype.getContributingSources=function(){var e=this;return a.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources_)),this.waitUntilConnected("RtpReceiver.getContributingSources").then(function(){return Promise.all([e.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getContributingSources)])}).then(function(t){e.contribsources_=t.map(function(t){return e.param0(t)})[0],a.logger.log(e.user_friendly_id(),".getContributingSources() success: "+JSON.stringify(e.contribsources_))}).catch(function(t){e.logRemoteInvokeError(t,".getContributingSources() failed!"),e.contribsources_=[]}),this.contribsources_},t.prototype.getParameters=function(){var e=this;return a.logger.log(this.user_friendly_id()+".getParameters() called."),this.waitUntilConnected(this.user_friendly_id()+".getParameters").then(function(){return a.logger.log(e.user_friendly_id()+".getParameters() remote invoking"),e.remoteInvoke(!1,o.method_id_RTCRtpReceiver_t.getParameters)}).then(function(t){a.logger.log(e.user_friendly_id()+".getParameters() success"),e.params_=e.param0(t)}).catch(function(t){e.logRemoteInvokeError(t,".getParameters() failed!")}),a.logger.log(this.user_friendly_id()+".getParameters() returning: "+this.params_),l.RtcRtpReceiveParameters.toRTCRtpReceiveParameters(this.params_)},t.prototype.getSynchronizationSources=function(){return a.logger.log(this.user_friendly_id()+".getSynchronizationSources() called."),this.syncsources_},t}(e);t.RtpReceiver=m},377:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RtpTransceiver=t.RtcRtpTransceiverInit=t.RtcRtpTransceiverDirection=void 0;var i,o=n(658),a=n(550),s=n(851),c=n(589),d=n(484);!function(e){e[e.sendrecv=0]="sendrecv",e[e.sendonly=1]="sendonly",e[e.recvonly=2]="recvonly",e[e.inactive=3]="inactive",e[e.stopped=4]="stopped"}(i=t.RtcRtpTransceiverDirection||(t.RtcRtpTransceiverDirection={}));var l=function(){function e(){}return e.toRtcRtpTransceiverDirection=function(e){switch(e){case"inactive":e=i.inactive;break;case"recvonly":e=i.recvonly;break;case"sendonly":e=i.sendonly;break;case"sendrecv":e=i.sendrecv;break;case"stopped":e=i.stopped;break;default:e=i.sendrecv}return e},e.toRTCRtpTransceiverDirection=function(e){switch(e){case i.inactive:e="inactive";break;case i.recvonly:e="recvonly";break;case i.sendonly:e="sendonly";break;case i.sendrecv:e="sendrecv";break;case i.stopped:e="stopped";break;default:e="sendrecv"}return e},e.toRtcRtpTransceiverInit=function(t){s.logger.log("RtcRtpTransceiverInit.toRtcRtpTransceiverInit() in init:"+JSON.stringify(t));var n={};return t&&(t.direction&&(n.direction=e.toRtcRtpTransceiverDirection(t.direction)),t.sendEncodings&&(n.sendEncodings=[],t.sendEncodings.forEach(function(e){return n.sendEncodings.push(d.RtcRtpEncodingParameters.toRtcRtpEncodingParameters(e))})),t.streams&&(n.streams=t.streams)),s.logger.log("RtcRtpTransceiverInit.toRtcRtpTransceiverInit() out init:"+JSON.stringify(n)),n},e}();t.RtcRtpTransceiverInit=l,e=function(e){function t(t,n,r,d,l,u){return t=e.call(this,t,a.class_id_t.RTCRtpTransceiver,n,r)||this,s.logger.log(t.user_friendly_id()+".constructor"),t.unified_=d,t.sender_=new c.RtpSender(t,0,o.ProxyMode.Pseudo,d),t.receiver_=u||new c.RtpReceiver(t,0,o.ProxyMode.Pseudo,d),l?(t.direction_=l,t.currentDirection_=l):(t.direction_=i.sendrecv,t.currentDirection_=i.sendrecv),t}return r(t,e),t.prototype.dumpInfo=function(){s.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.mid+"] direction="+l.toRTCRtpTransceiverDirection(this.direction_)+" currentDirection="+l.toRTCRtpTransceiverDirection(this.currentDirection_)),this.sender&&this.sender.dumpInfo(),this.receiver&&this.receiver.dumpInfo()},t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected("RtpTransceiver.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,a.method_id_RTCRtpTransceiver_t.mid,""),e.remoteInvoke(!1,a.method_id_RTCRtpTransceiver_t.direction,0),e.remoteInvoke(!1,a.method_id_RTCRtpTransceiver_t.currentDirection,0),e.remoteInvoke(!1,a.method_id_RTCRtpTransceiver_t.sender,{oid:0}),e.remoteInvoke(!1,a.method_id_RTCRtpTransceiver_t.receiver,{oid:0})])}).then(function(t){var n;s.logger.log(e.user_friendly_id()+".syncBarrier remote success."),n=t.map(function(t){return e.param0(t)}),e.mid_=n[0],e.direction_=n[1],e.currentDirection_=n[2],t=n[3],n=n[4];var r=[];if(void 0!=t&&!1===t.is_null&&(e.sender_.bind(e,t.oid),r.push(e.sender_.syncBarrier())),void 0!=n&&!1===n.is_null&&(e.receiver_.bind(e,n.oid),r.push(e.receiver_.syncBarrier())),0!=r.length)return s.logger.log(e.user_friendly_id()+".prop.syncBarrier start"),Promise.all(r);s.logger.log(e.user_friendly_id()+".syncBarrier success"),e.syncBarrierResolve(e)}).then(function(){s.logger.log(e.user_friendly_id()+".syncBarrier success"),e.syncBarrierResolve(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),e.syncBarrierReject(t)})})},Object.defineProperty(t.prototype,"mid",{get:function(){return s.logger.log(this.user_friendly_id()+".get_mid() called: "+this.mid_),this.mid_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this.sender_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"receiver",{get:function(){return this.receiver_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return s.logger.log(this.user_friendly_id()+".get_direction() called. "+l.toRTCRtpTransceiverDirection(this.direction_)),l.toRTCRtpTransceiverDirection(this.direction_)},set:function(e){var t=this;s.logger.log(this.user_friendly_id()+".set_direction() called. "+e),this.direction_=l.toRtcRtpTransceiverDirection(e),this.waitUntilConnected("RtpTransceiver.set_direction").then(function(){return t.remoteInvoke(!0,a.method_id_RTCRtpTransceiver_t.direction,l.toRtcRtpTransceiverDirection(e))}).then(function(){s.logger.log(t.user_friendly_id()+".set_direction: success.")}).catch(function(e){t.logRemoteInvokeError(e,".set_direction() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentDirection",{get:function(){return s.logger.log(this.user_friendly_id()+".get_currentDirection() called. "+l.toRTCRtpTransceiverDirection(this.currentDirection_)),l.toRTCRtpTransceiverDirection(this.currentDirection_)},enumerable:!1,configurable:!0}),t.prototype.stop=function(){var e=this;s.logger.log(this.user_friendly_id()+".stop() called."),this.waitUntilConnected("RtpTransceiver.stop").then(function(){return e.remoteInvoke(!0,a.method_id_RTCRtpTransceiver_t.stop)}).then(function(){s.logger.log(e.user_friendly_id()+".stop: success.")}).catch(function(t){e.logRemoteInvokeError(t,".stop() failed!")})},t.prototype.setCodecPreferences=function(e){var t=this;s.logger.log(this.user_friendly_id()+".setCodecPreferences() called."),this.waitUntilConnected("RtpTransceiver.setCodecPreferences").then(function(){return t.remoteInvoke(!0,a.method_id_RTCRtpTransceiver_t.setCodecPreferences,e)}).then(function(){s.logger.log(t.user_friendly_id()+".setCodecPreferences: success.")}).catch(function(e){t.logRemoteInvokeError(e,".setCodecPreferences() failed!")})},t}(o.ProxyObject),t.RtpTransceiver=e},973:function(e,t,n){function r(e,t,n){t/=e.width,n/=e.height;var r=document.createElement("canvas"),i=r.getContext("2d");return r.width=e.width*t,r.height=e.height*n,i.putImageData(e,0,0),1==t&&1==n||(i.scale(t,n),i.drawImage(r,0,0)),r}function i(e,t,n){return e=r(e,t,n),(t=document.createElement("img")).src=e.toDataURL(),t}function o(e,t,n,o){return n=void 0!==n?n:g.Width,o=void 0!==o?o:g.Height,!0===t?i(e,n,o):(t=null,n==e.width&&o===e.height?t=e:t=(e=r(e,n,o)).getContext("2d").getImageData(0,0,e.width,e.height),t)}var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSource=t.ScreenSourceVda=t.ScreenSharingVda=t.ScreenSharingRemote=t.ScreenSharing=t.ImageDataRemote=void 0;var s,c=n(658),d=n(550),l=n(851),u=n(946),f=n(691),h=n(650);!function(e){e[e.Legacy=0]="Legacy",e[e.MonitorsAndApps=10]="MonitorsAndApps"}(s||(s={})),e=function(e,t,n){this.data=e,this.height=t,this.width=n},t.ImageDataRemote=e,e=function(){function e(){this.local_=this.remote_=null}return e.screenSharingInstance=function(t){return e.instance||(e.instance=new e,t&&(e.instance.onscreentopologychanged=t)),e.instance},e.destroyInstance=function(){e.instance&&e.instance.remote_&&e.instance.remote_.release(),e.instance=null},e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(e.prototype,"onscreentopologychanged",{set:function(e){this.remote_||(this.remote_=new p),this.remote_.onscreentopologychanged=e,this.local_||(this.local_=new _),this.local_.onscreentopologychanged=e},enumerable:!1,configurable:!0}),e.prototype.getWindowsAsync=function(){var e=this;return l.logger.log(this.user_friendly_id()+".getWindowsAsync() called."),null==this.local_&&(this.local_=new _),new Promise(function(t,n){var r=[];e.local_.getWindowsAsync().then(function(n){n&&(r=n),l.logger.log(e.user_friendly_id()+".getWindowsAsync() returning sources"),t(r)}).catch(function(){l.logger.log("ScreenSharing.getWindowsAsync(): rejected"),t(r)})})},e.prototype.getScreensAsync=function(){var e=this;return l.logger.log(this.user_friendly_id()+".getScreensAsync() called."),null==this.remote_&&(this.remote_=new p),new Promise(function(t,n){var r=[];e.remote_.getScreensAsync().then(function(n){n&&(r=n),l.logger.log(e.user_friendly_id()+".getScreensAsync() returning sources"),t(r)}).catch(function(){l.logger.log("ScreenSharing.getScreensAsync(): rejected"),t(r)})})},e.prototype.setActiveSource=function(e,t){var n=this;return l.logger.log(this.user_friendly_id()+".setActiveSource() called. id="+e+" appshare="+t),new Promise(function(r,i){n.remote_.contains(e)?n.remote_.setActive(e).then(function(e){r(e)}).catch(function(){l.logger.log("ScreenSharing.setActiveSource(): rejected"),i()}):t&&n.local_.contains(e)?n.local_.setActive(!0,e).then(function(e){r(e)}).catch(function(){l.logger.log("ScreenSharing.setActiveSource(): rejected"),i()}):(l.logger.log("ScreenSharing.setActiveSource(): legacy screen sharing"),r(""))})},e.prototype.isAppshareActive=function(){return this.local_&&-1!==this.local_.lastActive},e.prototype.stopAppshare=function(){l.logger.log(this.user_friendly_id()+".stopAppshare() called."),this.local_&&this.local_.setActive(!1).then(function(e){l.logger.log("ScreenSharing.stopAppshare(): success, deviceid=",e)}).catch(function(){l.logger.log("ScreenSharing.stopAppshare(): failure or timeout due to nonresponsive WS Agent")})},e.instance=null,e}(),t.ScreenSharing=e;var p=function(e){function t(){var t=e.call(this,null,d.class_id_t.ScreenSharingRemote,0,c.ProxyMode.Local)||this;return l.logger.log(t.user_friendly_id()+".constructor"),t.sources_=[],t}return a(t,e),t.prototype.getSourceById=function(e){return this.sources_.find(function(t){return t.getId()==e})},t.prototype.contains=function(e){return void 0!==this.getSourceById(e)},Object.defineProperty(t.prototype,"onscreentopologychanged",{get:function(){return this.onscreentopologychanged_},set:function(e){var t=this;this.onscreentopologychanged_=e,this.waitUntilConnected(this.user_friendly_id()+".onscreentopologychanged").then(function(){var e=t.registerCallbacks(!1,t.isNullCallback(t.onscreentopologychanged_),d.method_id_VDISharingRemote_t.onscreentopologychanged);return e.then(function(){l.logger.log(t.user_friendly_id()+"onscreentopologychanged event received!!!"),t.onscreentopologychanged_&&t.onscreentopologychanged_()}),t.remoteInvoke(!0,d.method_id_VDISharingRemote_t.onscreentopologychanged,e.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onscreentopologychanged() failed!")})},enumerable:!1,configurable:!0}),t.prototype.getScreensAsync=function(){var e=this;l.logger.log(this.user_friendly_id()+".getScreensAsync() called.");var t=this.sources_;this.sources_=[];var n=u.getRedirector().vdabufferNoLimit()&&h.RemoteSession.isFeatureVdNoBufferLimitSupported();return new Promise(function(r,i){e.waitUntilConnected(e.user_friendly_id()+".getScreensAsync").then(function(){return e.remoteInvoke(!1,d.method_id_VDISharingRemote_t.getScreensAsync,n)}).then(function(n){var o=[];n.params[0].forEach(function(n){var r=t.find(function(e){return e.object_id()===n.oid});void 0===r&&(l.logger.log(e.user_friendly_id()+" create a ScreenSource with oid:"+n.oid),r=new m(e,n.oid,c.ProxyMode.Remote)),o.push(r.syncBarrier())}),Promise.all(o.map(function(e){return e.then(function(e){return{value:e,status:"fulfilled"}},function(e){return{value:e,status:"rejected"}})})).then(function(n){var i=n.filter(function(e){return"fulfilled"===e.status}).map(function(e){return e.value});e.sources_=i,t.filter(function(e){return!function(e,t){return void 0!==e.find(function(e){return e===t})}(i,e)}).forEach(function(e){return e.release()}),r(i)}).catch(function(n){n=e.logRemoteInvokeError(n,".getScreensAsync() failed!"),t.forEach(function(e){e.release()}),i(n)})}).catch(function(n){n=e.logRemoteInvokeError(n,".getScreensAsync() failed!"),t.forEach(function(e){e.release()}),i(n)})})},t.prototype.setActive=function(e){var t=this;return l.logger.log(this.user_friendly_id()+".setActive() called. uniqueid="+e),new Promise(function(n,r){-1!=e?n(t.getSourceById(e).getDeviceId()):r()})},t}(c.ProxyObject);t.ScreenSharingRemote=p;var _=function(){function e(){l.logger.log(this.user_friendly_id()+".constructor"),this.sources_=[],this.lastactive_=-1}return e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(e.prototype,"onscreentopologychanged",{set:function(e){u.getRedirector().screenshare.setTopologyChangeCB(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastActive",{get:function(){return this.lastactive_},enumerable:!1,configurable:!0}),e.prototype.getSourceById=function(e){return this.sources_.find(function(t){return t.getId()==e})},e.prototype.contains=function(e){return void 0!==this.getSourceById(e)},e.prototype.getWindowsAsync=function(){var e=this;l.logger.log(this.user_friendly_id()+".getWindowsAsync() called.");var t=this.sources_;return this.sources_=[],new Promise(function(n,r){u.getRedirector().screenshare.getSources(new f.getSourcesReqData(2)).then(function(r){if(r=r.map(function(n){var r=t.find(function(e){return e.equivalent(n)});return void 0!==r?(r.setDescription(n.getDescription()),n.getIcon().then(function(e){r.setIcon(e)}).catch(function(){l.logger.log(e.user_friendly_id()+".getWindowsAsync() failed to retrieve new icon.")}),n.getPreviewAsync().then(function(e){r.setPreview(e)}).catch(function(){l.logger.log(e.user_friendly_id()+".getWindowsAsync() failed to retrieve new preview.")}),r):n}),-1!=e.lastactive_){var i=t.find(function(t){return t.getId()==e.lastactive_}),o=r.find(function(t){return t.getId()==e.lastactive_});void 0!==i&&void 0===o&&r.push(i)}e.sources_=r,n(e.sources_)}).catch(function(){l.logger.log(e.user_friendly_id()+".getWindowsAsync(): rejected"),r()})})},e.prototype.activateSource=function(e,t){var n=this;return new Promise(function(r,i){var o=t?"activate":"deactivate";l.logger.log(n.user_friendly_id()+".activateSource() called. action="+o);var a=new f.setActiveReqData(e.srcid,e.hwnd,e.origin,e.pid,!0,!0,t);u.getRedirector().screenshare.setActive(a).then(function(t){l.logger.log(n.user_friendly_id()+": "+o+" success: srcid="+t.srcid+" deviceid="+t.bufferid),e.deviceid=t.bufferid,r(t.bufferid)}).catch(function(){l.logger.log(n.user_friendly_id()+"failed to "+o+": srcid="+e.srcid+", maybe WS Agent is too slow to respond"),i()})})},e.prototype.setActive=function(e,t){var n=this;return l.logger.log(this.user_friendly_id()+".setActive() called. uniqueid="+t),new Promise(function(r,i){e||(t=n.lastactive_),-1!=t?(e?(t!=n.lastactive_&&-1!=n.lastactive_&&n.activateSource(n.getSourceById(n.lastactive_),!1),n.lastactive_=t):n.lastactive_=-1,n.activateSource(n.getSourceById(t),e).then(function(t){r(e?"RemoteApplication-"+t:t)}).catch(function(){i()})):i()})},e}();t.ScreenSharingVda=_;var g=function(){function e(){}return e.Width=140,e.Height=90,e}();e=function(){function e(e,t,n,r,i,o,a,s,c,d){this.uniqueid_=m.nextId_++,this.srcid_=e,this.deviceid_=t,this.type_=n,this.imagedata_=r,this.icon_=i,this.name_=o,this.hwnd_=a,this.origin_=s,this.caption_=c,this.pid_=d}return e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},Object.defineProperty(e.prototype,"srcid",{get:function(){return this.srcid_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hwnd",{get:function(){return this.hwnd_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this.origin_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pid",{get:function(){return this.pid_},enumerable:!1,configurable:!0}),e.prototype.getId=function(){return this.uniqueid_},e.prototype.getDeviceId=function(){return this.deviceid_},Object.defineProperty(e.prototype,"deviceid",{set:function(e){this.deviceid_=e},enumerable:!1,configurable:!0}),e.prototype.getType=function(){return 2},e.prototype.getPreview=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreview() called, width:"+e+" height:"+t+" asImage:"+n),Promise.reject(null)},e.prototype.setPreview=function(e){this.imagedata_=e},e.prototype.getPreviewAsync=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+e+" height:"+t),!0===n?(e=i(this.imagedata_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},e.prototype.getPreviewImage=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreviewImage() called, width:"+t+" height:"+n),Promise.resolve(o(this.imagedata_,e,t,n))},e.prototype.getDescription=function(){return this.name_},e.prototype.setDescription=function(e){this.name_=e},e.prototype.getIcon=function(e,t,n){return!0===n?(e=i(this.icon_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.icon_)},e.prototype.getIconImage=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getIconImage() called, width:"+t+" height:"+n),Promise.resolve(o(this.icon_,e,void 0!==t?t:this.icon_.width,void 0!==n?n:this.icon_.height))},e.prototype.setIcon=function(e){this.icon_=e},e.prototype.getBounds=function(){return{x:0,y:0,width:0,height:0}},e.prototype.equivalent=function(e){return this.pid_===e.pid_&&this.hwnd_===e.hwnd_},e}(),t.ScreenSourceVda=e;var m=function(e){function t(n,r,i){return(n=e.call(this,n,d.class_id_t.ScreenSource,r,i)||this).screenshare_=new f.ScreenShareUtil,n.uniqueid_=t.nextId_++,l.logger.log(n.user_friendly_id()+".constructor"),n}return a(t,e),t.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},t.prototype.toJSImageData=function(e){var t=atob(e.data.toString());t=this.screenshare_.str2ab(t),t=new Uint8ClampedArray(t,0,t.byteLength);this.imagedata_=new ImageData(t,e.width,e.height)},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.syncBarrierDeep(t,n)&&e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){Promise.all([e.remoteInvoke(!1,d.method_id_ScreenSource_t.srcid,0),e.remoteInvoke(!1,d.method_id_ScreenSource_t.deviceid,""),e.remoteInvoke(!1,d.method_id_ScreenSource_t.type,0),e.remoteInvoke(!1,d.method_id_ScreenSource_t.name,""),e.remoteInvoke(!1,d.method_id_ScreenSource_t.imagedata),e.remoteInvoke(!1,d.method_id_ScreenSource_t.hwnd,""),e.remoteInvoke(!1,d.method_id_ScreenSource_t.origin,0),e.remoteInvoke(!1,d.method_id_ScreenSource_t.caption,""),e.remoteInvoke(!1,d.method_id_ScreenSource_t.pid,0)]).then(function(t){var n;l.logger.log(e.user_friendly_id()+".syncBarrier(): success."),t=t.map(function(t){return e.param0(t)}),e.srcid_=t[0],e.deviceid_=t[1],e.type_=t[2],e.name_=t[3],n=t[4],e.hwnd_=t[5],e.origin_=t[6],e.caption_=t[7],e.pid_=t[8],e.toJSImageData(n),e.remoteInvoke(!1,d.method_id_ScreenSource_t.bounds,0).then(function(t){e.bounds_=e.param0(t),e.syncBarrierResolve(e)}).catch(function(t){e.bounds_=void 0,t=e.logRemoteInvokeError(t,".prop.syncBarrier() getBounds failed."),e.syncBarrierReject(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".prop.syncBarrier() failed."),e.syncBarrierReject(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed."),e.syncBarrierReject(t)})})},t.prototype.getId=function(){return this.uniqueid_},t.prototype.getDeviceId=function(){return this.deviceid_},t.prototype.getType=function(){return 1},t.prototype.getPreview=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreview() called, width:"+e+" height:"+t+" asImage:"+n),Promise.reject(null)},t.prototype.getPreviewAsync=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+e+" height:"+t),!0===n?(e=i(this.imagedata_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},t.prototype.getPreviewImage=function(e,t,n){return l.logger.log(this.user_friendly_id()+".getPreviewImage() called, width:"+t+" height:"+n),Promise.resolve(o(this.imagedata_,e,t,n))},t.prototype.getDescription=function(){return this.name_},t.prototype.getIcon=function(e,t){return Promise.resolve(this.imagedata_)},t.prototype.getBounds=function(){return this.bounds_||{x:0,y:0,width:0,height:0}},t.nextId_=s.MonitorsAndApps,t}(c.ProxyObject);t.ScreenSource=m},691:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenShareUtil=t.Bitmap=t.BitmapInfoHeader=t.BitmapFileHeader=t.setActiveRespData=t.setActiveReqData=t.getSourcesReqData=t.sshare_state=t.sshare_cmd=void 0;var r,i,o=n(946),a=n(973),s=n(851);!function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.GetSources=2]="GetSources",e[e.SetActive=3]="SetActive",e[e.TopologyChanged=4]="TopologyChanged"}(r=t.sshare_cmd||(t.sshare_cmd={})),function(e){e[e.Unknown=0]="Unknown",e[e.Initialized=1]="Initialized",e[e.Error=2]="Error"}(i=t.sshare_state||(t.sshare_state={})),e=function(e){this.origin=e},t.getSourcesReqData=e,e=function(e,t,n,r,i,o,a){this.srcid=e,this.hwnd=t,this.origin=n,this.pid=r,this.border=i,this.cursor=o,this.activate=a},t.setActiveReqData=e;var c=function(e,t,n){this.srcid=e,this.origin=t,this.bufferid=n};t.setActiveRespData=c;var d=function(){function e(e,t,n,r,i){this.id_=e,this.resolve_=t,this.reject_=n,this.cmd_=r,this.data_=i,this.sent_=!1,this.timeoutId=void 0}return e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.id_+"]"},e.prototype.cmdString=function(){return this.cmd_==r.Cap?"Cap":this.cmd_==r.GetSources?"GetSources":this.cmd_==r.SetActive?"SetActive":"Unknown"},e}(),l=function(){};t.BitmapFileHeader=l;var u=function(){};t.BitmapInfoHeader=u;var f=function(){};t.Bitmap=f,e=function(){function e(){this.cmdque_=[]}return e.prototype.reqid=function(){return e.nextId++},e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},e.prototype.stateString=function(){return e.state_==i.Initialized?"Initialized":e.state_==i.Error?"Error":"Unknown"},e.prototype.reset=function(){e.state_=i.Unknown,this.cmdque_=[]},e.prototype.dispatchCmds=function(){var t=this;e.state_==i.Initialized?this.cmdque_.forEach(function(e){0==e.sent_&&(e.cmd_==r.GetSources?(t.WSSendGetSources(e.id_,e.data_),e.sent_=!0,e.timeoutId=setTimeout(t.abortCmd.bind(t,e.id_),5e3)):e.cmd_==r.SetActive?(t.WSSendSetActive(e.id_,e.data_),e.sent_=!0,e.timeoutId=setTimeout(t.abortCmd.bind(t,e.id_),5e3)):s.logger.log(e.user_friendly_id()+".dispatchCmds(): invalid cmd: "+e.cmdString()))}):e.state_==i.Error?(this.cmdque_.forEach(function(e){s.logger.log(e.user_friendly_id()+".dispatchCmds(): purging cmd: "+e.cmdString()),e.reject_()}),this.cmdque_=[]):s.logger.log(this.user_friendly_id()+".dispatchCmds(): invalid state: "+this.stateString())},e.prototype.abortCmd=function(e){var t=this.cmdque_.findIndex(function(t){return t.id_===e});-1!==t?(t=this.cmdque_.splice(t,1)[0],s.logger.log(t.user_friendly_id()+NaN+t.cmdString()+"]: aborted due to nonresponsive WS Agent!"),t.cmd_===r.SetActive&&t.data_.activate&&a.ScreenSharing.screenSharingInstance().stopAppshare(),t.reject_()):s.logger.log(this.user_friendly_id()+".abortCmd(): Cmd not found!")},e.prototype.finalizeCmd=function(e,t,n){for(var r=0;r<this.cmdque_.length;r++){var i=this.cmdque_[r];if(void 0!=t&&t==i.id_&&1==i.sent_||void 0==t&&1==i.sent_){clearTimeout(i.timeoutId),s.logger.log(i.user_friendly_id()+".finalizeCmd(): purging cmd: "+i.cmdString()),e?void 0!=n?i.resolve_(n):i.resolve_():i.reject_(),this.cmdque_.splice(r,1);break}}},e.prototype.onInitialized=function(t){s.logger.log(this.user_friendly_id()+".onInitialized(): init: "+t+" state:"+this.stateString()),e.state_!=i.Initialized&&(e.state_=t?i.Initialized:i.Error),this.dispatchCmds()},e.prototype.onInitComplete=function(){s.logger.log(this.user_friendly_id()+".onInitComplete(): state:"+this.stateString()),e.state_==i.Unknown&&(e.state_=i.Error,s.logger.log(this.user_friendly_id()+".onInitComplete(): items in queue:"+this.cmdque_.length),this.dispatchCmds())},e.prototype.onError=function(t){s.logger.log(this.user_friendly_id()+".onError(): state: "+this.stateString()),e.state_==i.Unknown?(e.state_=i.Error,this.dispatchCmds()):e.state_==i.Initialized&&this.finalizeCmd(!1,t)},e.prototype.ab2str=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},e.prototype.str2ab=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return t},e.prototype.getBMP=function(e){var t=new DataView(e),n=new f;return n.fileheader=new l,n.fileheader.bfType=t.getUint16(0,!0),n.fileheader.bfSize=t.getUint32(2,!0),n.fileheader.bfReserved1=t.getUint16(6,!0),n.fileheader.bfReserved2=t.getUint16(8,!0),n.fileheader.bfOffBits=t.getUint32(10,!0),n.infoheader=new u,n.infoheader.biSize=t.getUint32(14,!0),n.infoheader.biWidth=t.getUint32(18,!0),n.infoheader.biHeight=t.getUint32(22,!0),n.infoheader.biPlanes=t.getUint16(26,!0),n.infoheader.biBitCount=t.getUint16(28,!0),n.infoheader.biCompression=t.getUint32(30,!0),n.infoheader.biSizeImage=t.getUint32(34,!0),n.infoheader.biXPelsPerMeter=t.getUint32(38,!0),n.infoheader.biYPelsPerMeter=t.getUint32(42,!0),n.infoheader.biClrUsed=t.getUint32(46,!0),n.infoheader.biClrImportant=t.getUint32(50,!0),t=n.fileheader.bfOffBits,n.stride=4*Math.floor((n.infoheader.biBitCount*n.infoheader.biWidth+31)/32),n.pixels=new Uint8Array(e,t),n},e.prototype.convertToImageData=function(e){var t=document.createElement("canvas").getContext("2d"),n=e.infoheader.biWidth,r=e.infoheader.biHeight,i=(t=t.createImageData(n,r)).data,o=e.pixels;e=e.stride;for(var a=0;a<r;++a)for(var s=0;s<n;++s){var c=4*(s+n*(r-a)),d=4*s+e*a;i[c]=o[d+2],i[c+1]=o[d+1],i[c+2]=o[d],i[c+3]=255}return t},e.prototype.onGetSources=function(e,t){this.sources_=[];var n=this;t.sources.forEach(function(e){var t=e.image,r=atob(t.data),i=(r=n.str2ab(r),r=new Uint8ClampedArray(r,0,r.byteLength),t=new ImageData(r,t.width,t.height),r=e.icon,atob(r.data));i=n.str2ab(i),i=new Uint8ClampedArray(i,0,i.byteLength),r=new ImageData(i,r.width,r.height);e=new a.ScreenSourceVda(e.srcid,e.devicdid,e.type,t,r,e.name,e.hwnd,e.origin,e.caption,e.pid),n.sources_.push(e)}),this.finalizeCmd(!0,e,this.sources_)},e.prototype.getSources=function(t){var n=this;return new Promise(function(o,a){if(e.state_!=i.Error){var s=new d(n.reqid(),o,a,r.GetSources,t);n.cmdque_.push(s)}else a();e.state_==i.Initialized&&n.dispatchCmds()})},e.prototype.onSetActive=function(e,t){var n=new c(t.srcid,t.origin,t.bufferid);this.finalizeCmd(!0,e,n)},e.prototype.setActive=function(t){var n=this;return new Promise(function(o,a){if(e.state_!=i.Error){var s=new d(n.reqid(),o,a,r.SetActive,t);n.cmdque_.push(s)}else a();e.state_==i.Initialized&&n.dispatchCmds()})},e.prototype.setTopologyChangeCB=function(e){this.onwindowtopologychanged_=e},e.prototype.onToplogyChanged=function(){this.onwindowtopologychanged_&&this.onwindowtopologychanged_()},e.prototype.WSSendGetSources=function(e,t){try{o.getRedirector().WSSendObject({v:"appsharing",hdr:{command:r.GetSources,id:e},data:{origin:t.origin}})}catch(e){s.logger.log(e)}},e.prototype.WSSendSetActive=function(e,t){try{o.getRedirector().WSSendObject({v:"appsharing",hdr:{command:r.SetActive,id:e},data:{srcid:t.srcid,hwnd:t.hwnd,origin:t.origin,pid:t.pid,border:t.border,cursor:t.cursor,activate:t.activate}})}catch(e){s.logger.log(e)}},e.state_=i.Unknown,e.nextId=0,e}(),t.ScreenShareUtil=e},517:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stats=t.StatsReport=void 0;var n=function(){function e(){this.items=[]}return e.fromJSON=function(t){for(var n=new e,i=0;i<t.length;i++){var o=r.fromJSON(t[i]);n.items.push(o)}return n},e.toRTCStatsReport=function(e){return e},e.prototype.toJSON=function(){return JSON.stringify(this.items)},e.prototype.result=function(){return this.items},e}();t.StatsReport=n;var r=function(){function e(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return e.fromJSON=function(t){var n=new e;return n.id=t.id||"",n.timestamp=t.timestamp||"",n.type=t.type||"",Object.keys(t).forEach(function(e){"id"!==e&&"timestamp"!==e&&"type"!==e&&(n.names_.push(e),n.stat_.set(e,t[e]))}),n},e.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},e.prototype.names=function(){return this.names_},e.prototype.stat=function(e){return this.stat_.get(e)},e}();t.Stats=r},704:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StreamResolution=t.RemoteCallConstraints=void 0;var i=n(550),o=n(658),a=n(851);e=function(){},t.RemoteCallConstraints=e,e=function(e){function t(){var t=e.call(this,null,i.class_id_t.StreamResolution,0,o.ProxyMode.Local)||this;return t.lastSentConstraints_=null,t}return r(t,e),Object.defineProperty(t.prototype,"onupdate",{get:function(){return this.onupdate_},set:function(e){var n=this;this.onupdate_=e,this.waitUntilConnected(this.user_friendly_id()+".onupdate").then(function(){var e=n.registerCallbacks(!1,n.isNullCallback(n.onupdate_),i.method_id_StreamResolution_t.onupdate);return e.then(function(e){var r=(e=e.params)[0];e.slice(1),a.logger.log(n.user_friendly_id()+".onupdate",JSON.stringify(r)),n.lastSentConstraints_&&JSON.stringify(n.lastSentConstraints_)==JSON.stringify(r)?a.logger.log(n.user_friendly_id()+".onupdate constraints unchanged, ignoring"):n.onupdate_&&(t.isValidRemoteConstraints(r)?(n.lastSentConstraints_=r,n.onupdate_(n.toICallConstraints(n.lastSentConstraints_))):a.logger.log(n.user_friendly_id()+".onupdate invalid RemoteCallConstraints"))}),n.remoteInvoke(!0,i.method_id_StreamResolution_t.onupdate,e.success)}).catch(function(){return a.logger.log(n.user_friendly_id()+".onupdate, could not set listener")})},enumerable:!1,configurable:!0}),t.prototype.toICallConstraints=function(e){var t={maxParticipantResolutions:null};if(e.max_participant_resolutions_dynamic){t.maxParticipantResolutions={};for(var n=0,r=e.max_participant_resolutions_dynamic;n<r.length;n++){var i=r[n];t.maxParticipantResolutions[i.count]=i.resolution}}else e.max_participant_resolutions_static&&(t.maxParticipantResolutions=e.max_participant_resolutions_static);return t.maxIncomingStreams=e.max_incoming_streams,t.maxOutgoingResolution=e.max_outgoing_resolution,t.maxSimulcastLayers=e.max_simulcast_layers,a.logger.log(this.user_friendly_id()+".toICallConstraints: "+JSON.stringify(t)),t},t.isValidRemoteConstraints=function(e){return null!=e&&(null!=e.max_participant_resolutions_dynamic||null!=e.max_participant_resolutions_static)&&null!=e.max_incoming_streams&&null!=e.max_outgoing_resolution&&null!=e.max_simulcast_layers},t.prototype.getCallConstraints=function(){var e=this;return new Promise(function(n,r){e.waitUntilConnected(e.user_friendly_id()+".getCallConstraints").then(function(){return e.remoteInvoke(!1,i.method_id_StreamResolution_t.getCallConstraints)}).then(function(i){i=e.param0(i),a.logger.log(e.user_friendly_id()+".getCallConstraints",JSON.stringify(i)),t.isValidRemoteConstraints(i)?(e.onupdate_&&(e.lastSentConstraints_=i),n(e.toICallConstraints(i))):(a.logger.log(e.user_friendly_id()+".getCallConstraints invalid RemoteCallConstraints"),r())}).catch(function(){a.logger.log(e.user_friendly_id()+".getCallConstraints promise rejected"),r()})})},t.getDefaultConstraints=function(){var e={maxParticipantResolutions:{1:720,2:720,3:360,more:360},maxIncomingStreams:4,maxOutgoingResolution:720,maxSimulcastLayers:0};return a.logger.log("StreamResolution.getDefaultConstraints: "+JSON.stringify(e)),e},t.prototype.updateStreamResolution=function(){var e=this;this.getCallConstraints().then(function(t){return e.onupdate&&e.onupdate(t)}).catch(function(){return a.logger.log("Failed to get stream resolution information!")})},t}(o.ProxyObject),t.StreamResolution=e},394:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Telemetry=t.tel_key_CPUTotalmemory=t.tel_key_CPUGpuinfo=t.tel_key_CPUMachineid=t.tel_key_CPUProcessors=t.tel_key_CPUCores=t.tel_key_CPUModel=t.tel_key_CPUSpeed=t.tel_key_OSEdition=t.tel_key_OSDistro=t.tel_key_OSArchitecture=t.tel_key_OSVersion=t.tel_key_OSFamily=t.tel_key_VerHdxRtcEngine=t.tel_key_VerTypeScript=t.tel_key_VerEndpoint=t.tel_key_VerVda=t.tel_key_VerReceiver=t.tel_key_VerWebrtcCodecs=t.tel_key_VerWebrpc=t.tel_key_PerfCallType=t.tel_key_PerfCallState=t.tel_key_PerfCallDirection=t.tel_key_SpeakerDeviceUsed=t.tel_key_VideoDeviceUsed=t.tel_key_AudioDeviceUsed=t.tel_key_CallEstOutgoing=t.tel_key_CallEstIncoming=t.tel_key_ScreensharingCallDuration=t.tel_key_VideoCallDuration=t.tel_key_AudioCallDuration=t.tel_key_ConferenceCallDuration=t.tel_cmd=t.tel_CallType=t.tel_CallDirection=t.tel_CallState=void 0;var r,i=n(946),o=n(851);!function(e){e[e.unknown=0]="unknown",e[e.active=1]="active",e[e.idle=2]="idle"}(t.tel_CallState||(t.tel_CallState={})),function(e){e[e.unknown=0]="unknown",e[e.incoming=1]="incoming",e[e.outgoing=2]="outgoing"}(t.tel_CallDirection||(t.tel_CallDirection={})),function(e){e[e.unknown=0]="unknown",e[e.audio=1]="audio",e[e.video=2]="video",e[e.multi=3]="multi",e[e.dshare=4]="dshare"}(t.tel_CallType||(t.tel_CallType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.Init=2]="Init",e[e.Data=3]="Data"}(r=t.tel_cmd||(t.tel_cmd={})),t.tel_key_ConferenceCallDuration="ConferenceCallDuration",t.tel_key_AudioCallDuration="AudioCallDuration",t.tel_key_VideoCallDuration="VideoCallDuration",t.tel_key_ScreensharingCallDuration="ScreensharingCallDuration",t.tel_key_CallEstIncoming="CallEstIncoming",t.tel_key_CallEstOutgoing="CallEstOutgoing",t.tel_key_AudioDeviceUsed="AudioDeviceUsed",t.tel_key_VideoDeviceUsed="VideoDeviceUsed",t.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed",t.tel_key_PerfCallDirection="PerfCallDirection",t.tel_key_PerfCallState="PerfCallState",t.tel_key_PerfCallType="PerfCallType",t.tel_key_VerWebrpc="VerWebrpc",t.tel_key_VerWebrtcCodecs="VerWebrtcCodecs",t.tel_key_VerReceiver="VerReceiver",t.tel_key_VerVda="VerVda",t.tel_key_VerEndpoint="VerEndpoint",t.tel_key_VerTypeScript="VerTypeScript",t.tel_key_VerHdxRtcEngine="VerHdxRtcEngine",t.tel_key_OSFamily="OSFamily",t.tel_key_OSVersion="OSVersion",t.tel_key_OSArchitecture="OSArchitecture",t.tel_key_OSDistro="OSDistro",t.tel_key_OSEdition="OSEdition",t.tel_key_CPUSpeed="CPUSpeed",t.tel_key_CPUModel="CPUModel",t.tel_key_CPUCores="CPUCores",t.tel_key_CPUProcessors="CPUProcessors",t.tel_key_CPUMachineid="CPUMachineid",t.tel_key_CPUGpuinfo="CPUGpuinfo",t.tel_key_CPUTotalmemory="CPUTotalmemory";var a=function(){function e(e,t,n,r){this.cmd=e,this.key=t,this.value=n,this.flags=r}return e.prototype.SendTelemetryData=function(e){e.SendTelemetryData(this.cmd,this.key,this.value,this.flags)},e}();e=function(){function e(){this.id=0,this.deferredData=[]}return e.prototype.reset=function(){this.id=0,this.deferredData=[]},e.prototype.onInitialized=function(e){for(this.id=e;this.deferredData&&0<this.deferredData.length;)this.deferredData.shift().SendTelemetryData(this)},e.prototype.SendTelemetryInit=function(){0<this.id&&this.reset();try{i.getRedirector().WSSendObject({v:"telemetry",hdr:{command:r.Init,id:0},init:{domain:"HDXMM Teams",subdomain:"Teams",feature:"msteams",version:"1.1.1.1"}})}catch(e){o.logger.log(e)}},e.prototype.SendTelemetryData=function(e,t,n,s){if(e!=r.Data)o.logger.log("invalid telemetry command!");else if(0==this.id)this.deferredData.push(new a(e,t,n,s));else try{i.getRedirector().WSSendObject({v:"telemetry",hdr:{command:e,id:this.id},data:{key:t,value:n,flags:s}})}catch(e){o.logger.log(e)}},e}(),t.Telemetry=e},259:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=void 0;var r=n(851);e=function(){function e(){}return e.stringifyArray=function(e){for(var t="[",n=0;n<e.length;++n)0!=n&&(t+=","),t+=this.stringify(e[n]);return t+"]"},e.stringifyObject=function(e){var t,n="{",r=!0;for(t in e)r?r=!1:n+=",",n=n+'"'+t+'":',n=e[t]instanceof Array?n+this.stringifyArray(e[t]):"object"==typeof e[t]?n+this.stringifyObject(e[t]):n+JSON.stringify(e[t]);return n+"}"},e.stringify=function(e){return"object"==typeof e?"[object Array]"==Object.prototype.toString.call(e)?this.stringifyArray(e):this.stringifyObject(e):JSON.stringify(e)},e.GetObjectPropertyDescriptor=function(e,t){for(var n=void 0;e!=Object.prototype&&void 0===(n=Object.getOwnPropertyDescriptor(e,t));)e=e.__proto__;return n},e.sendEvent=function(e,t){try{var n=document.createEvent("Event");n.initEvent(t,!0,!0),e.dispatchEvent(n)}catch(e){r.logger.log('sendEvent(): exception dispatching "'+t+'" event: '+e.message)}},e.hasValue=function(e){var t=!1;return null!==e&&void 0!==e&&(t=!0),t},e}(),t.Util=e},307:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;d;)try{if(i=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,a=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if(!(s=0<(s=d.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3]))d.label=n[1];else if(6===n[0]&&d.label<s[1])d.label=s[1],s=n;else{if(!(s&&d.label<s[2])){s[2]&&d.ops.pop(),d.trys.pop();continue}d.label=s[2],d.ops.push(n)}}n=t.call(e,d)}catch(e){n=[6,e],a=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,s,c,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o.initSymbol(),o.initSymbol(),o.initSymbolIterator(),c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},a=n(360),s=n(144);n(679);var c=n(945),d=n(368),l=n(851).logger,u=n(650),f=n(973),h=n(247).getGC,p=n(946),_=n(613).E911Service,g=(e=n(550)).Features,m=e.FEATURE_vda_delete_viewport,v=n(704).StreamResolution,y=n(239).E;!function(e,t){e.CitrixWebRTC=function(){function e(e,t){l.log("VDI Shim createMediaStreamInternal"),C();var n=new s.RemoteStream(null,0,0,e),r=new Promise(function(e,t){n.syncBarrier().then(function(t){l.log("stream.syncBarrier(): success."),e(t)}).catch(function(e){l.log("stream.syncBarrier(): failed with error: "+JSON.stringify(e)),n.release(),t()})});return t?r:n}function t(e){null==x&&(x=new d.Frames(!V.isFeatureSupported(g.FEATURE_public_multi_window))),e(x)}function n(e,n){t(function(t){var r=t.findFrame(e);void 0==r&&(r=t.newFrame(e)),n(r)})}function o(e,n){t(function(t){null!=(t=t.findFrame(e))&&n(t)})}function b(e,t){if(U)try{"vdiE911InfoChanged"===e?e="vdiE911DataChanged":"vdiCallConstraintsChanged"===e&&(e="vdiStreamConstraintsChanged");var n=Object.assign({event:e},t);l.log("Dispatching VM event:"+JSON.stringify(n)),U(n)}catch(t){l.log("Exception onVMEvent(), eventName:"+e+" message:"+t.message)}}function C(){var e=window.getCitrixWebrtcRedir;void 0!==e?e().then(function(e){l.log("sucesss on connect, getCitrixWebrtcRedir reg value:"+e),"1"!==e||V||(l.log("supported client"),E(H))}).catch(function(){l.log("Failure to Read Webrtc redir Reg Key"),k()}):(l.log("window.getCitrixWebrtcRedir() method is not available yet"),k())}function S(e){if(l.log("VDI Event: vdiClientDisconnected"),I(),!0===e&&!1===L){l.log("VDI Event: vdiClientDisconnected with failure reported"),L=!0;try{U({event:"vdiClientDisconnected",reason:"failure",msg:"Websocket Connection Failure"})}catch(e){l.log("onVMEvent(): exception: "+e.message)}}else{L=!1;try{U({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(e){l.log("onVMEvent(): exception: "+e.message)}}}function E(e){l.log("initRemoteSession with vendor:"+e),V||(V=new u.RemoteSession("CitrixWebRTCSDK",e))}function R(){l.log("VDI Event: onVdiClientDisconnectedTimer"),E(H)}function T(){var e=this;l.log("VDI Shim onVdiClientConnected..."),V?V.getSessionInfo().then(function(n){return r(e,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return l.log("VDI Shim onVdiClientConnected, client endpoint info:"+JSON.stringify(n)),O&&O.isValid()||(O=new s.RemoteDevices),M&&M.isValid()||(M=new s.NavigatorUserMedia),t(function(e){e.reconnect()}),b("vdiClientConnected",{version:n,endpointId:n.endpointId}),[4,M.getCapabilities().then(function(e){l.log("VDI Shim onVdiClientConnected, caps = "+e)}).catch(function(){l.log("VDI Shim onVdiClientConnected, could not get capabilities")})];case 1:return e.sent(),j||((j=new _).onupdate=function(e){b("vdiE911InfoChanged",e)},j.updateE911Info()),F||(b("vdiCallConstraintsChanged",v.getDefaultConstraints()),null!==V&&u.RemoteSession.isFeatureCallConstraintsSupported()&&((F=new v).onupdate=function(e){b("vdiCallConstraintsChanged",e)},F.updateStreamResolution())),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange")),[2]}})})}).catch(function(){l.log("VDI Shim onVdiClientConnected, getSessionInfo failure! Session is not fully connected yet...")}):l.log("VDI Shim onVdiClientConnected, remoteSession does not exist")}function w(e){if("1"===e)l.log("Supported client"),p.getRedirector().pingConnectionBegin(!0);else if("0"===e){l.log("VDI Event: Unsupported client reported");try{U({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(e){l.log("onVMEvent(): exception: "+e.message)}}else l.log("Citrix Webrtc Redir Reg Key value is incorrect")}function k(){!1===W&&(l.log("starting MS Reg retry..."),W=!0,function e(t){if(0>=t){W=!1,l.log("VDI Event: Reg Key not Updated after timer reported, Fallback");try{U({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix Webrtc Redir Reg Key not Present"})}catch(e){l.log("onVMEvent(): exception: "+e.message)}}else{var n=window.getCitrixWebrtcRedir;void 0!==n?n().then(function(n){l.log("CitrixMSTeamsRedir reg value:"+n),"0"===n||"1"===n?(w(n),W=!1):(l.log("MS Teams Redir Reg key not updated - Start timer"),setTimeout(function(){l.log("Timer waiting for registry to be updated count :"+t),e(--t)},1e3))}).catch(function(){l.log("Failure to Read MS Teams redir Reg Key - Start timer"),setTimeout(function(){l.log("Timer waiting for registry to be updated count :"+t),e(--t)},1e3)}):(l.log("window.getCitrixWebrtcRedir() method is not available yet"),setTimeout(function(){l.log("Timer waiting for registry to be updated count :"+t),e(--t)},1e3))}}(10))}function I(){l.log("VDI : cleanup"),p.getRedirector().clearReqs(),s.NavigatorUserMedia.resetCapabilities(),x=O=M=null,N&&N.release(),V&&V.release(),V=null,f.ScreenSharing.destroyInstance(),j&&(j.release(),j=null),F&&(F.release(),F=null),h().reset(),l.log("VDI : cleanup done")}function P(){return f.ScreenSharing.screenSharingInstance(function(){if(U)try{U({event:"vdiScreenTopologyChanged"})}catch(e){l.log("onVMEvent('vdiScreenTopologyChanged'): exception: "+e.message)}})}function A(e){if(!B)throw l.log("VDI Shim "+e+": throwing exception: not initialized!!"),new DOMException("UCSDK is not initialized!!!")}var M=null,D=s.NavigatorUserMedia.getCapabilities,O=null,x=null,N=null,U=null,j=null,F=null,L=!1,V=void 0,W=!1,B=!1,H=void 0;return{Features:g,CitrixPeerConnection:a.PeerConnection,getUserMedia:function(e,t,n){A("getUserMedia"),C(),l.log("VDI Shim getUserMedia"),null!==M&&M.isValid()||(M=new s.NavigatorUserMedia);var r=s.RemoteMediaStreamConstraints.isConstraintsAudioDeviceIdEmpty(e),i=s.RemoteMediaStreamConstraints.isConstraintsVideoSourceIdEmpty(e);return r||i?new Promise(function(r,i){O.enumerateDevices().then(function(r){return M.webkitGetUserMedia(e,t,n)}).then(function(e){l.log("webkitGetUserMedia for default was resolved"),r(e)}).catch(function(e){l.log("getUserMedia() for default failed with error:"+JSON.stringify(e)),i()})}):M.webkitGetUserMedia(e,t,n)},getDisplayMedia:function(e){return A("getDisplayMedia"),C(),l.log("VDI Shim getDisplayMedia"),null!==O&&O.isValid()||(O=new s.RemoteDevices),O.getDisplayMedia(e)},enumerateDevices:function(){return A("enumerateDevices"),C(),l.log("VDI Shim enumerateDevices"),null!==O&&O.isValid()||(O=new s.RemoteDevices),O.enumerateDevices()},onWindowClose:function(e,n,r){A("onWindowClose"),l.log("VDI Shim onWindowClose: (handle: "+e+")"),p.getRedirector().getVDAFeatureValue(m)&&t(function(t){t.disposeFrame(e)})},setClientAreaOffset:function(e,t,r){A("setClientAreaOffset"),l.log("VDI setClientAreaOffset with xOffset = "+e+", yOffset = "+t+", windowHandle = "+r),C(),n(r,function(n){n.setClientAreaOffset(e,t)})},mapVideoElement:function(e,t){A("mapVideoElement"),l.log("VDI New Video Element Created, Creating Mapping to Thin Client DOM"),C(),n(t,function(t){t.newVideoElement(e)})},mapAudioElement:function(e){if(A("mapAudioElement"),l.log("VDI New Audio Element Created, Creating Mapping to VDA"),void 0!==e.remoteAudioElement)l.log("Audio element is already configured!");else{C(),delete e.remoteAudioElement,Object.defineProperty(e,"remoteAudioElement",{writable:!0,configurable:!0,value:null}),e.remoteAudioElement=new c.AudioElement,delete e.sinkId,Object.defineProperty(e,"sinkId",{configurable:!0,get:function(){return e.remoteAudioElement?e.remoteAudioElement.sinkId:void 0},set:function(t){l.log("VDI Shim set audio element SinkId value = "+t),e.setSinkId(t).then(function(){l.log("VDI Shim set audio element SinkId success")}).catch(function(){l.log("VDI Shim set audio element SinkId failure")})}});var t=e.remoteAudioElement.play;e.play=function(){return l.log("VDI Shim remote audio play"),t.apply(e.remoteAudioElement,arguments)};var n=e.remoteAudioElement.pause;e.pause=function(){return l.log("VDI Shim remote audio pause"),n.apply(e.remoteAudioElement,arguments)},e.setSinkId=function(t){l.log("VDI Shim set audio element SinkId value = "+t);var n,r=e.remoteAudioElement.setSinkId(t);return s.enumeratedDevices.forEach(function(e){t===e.deviceId&&(n=e.label)}),function(e){p.getRedirector().SendTelemetryData_Speaker(e)}(n),r},delete e.srcObject,Object.defineProperty(e,"srcObject",{configurable:!0,get:function(){return e.remoteAudioElement?e.remoteAudioElement.srcObject:void 0},set:function(t){l.log("VDI Shim set audio element srcObject "+JSON.stringify(t)),e.remoteAudioElement.srcObject=t}})}},disposeVideoElement:function(e,t){A("disposeVideoElement"),l.log("VDI Shim disposeVideoElement: "),o(t,function(t){t.disposeVideoElement(e)})},disposeAudioElement:function(e,t,n){A("disposeAudioElement"),l.log("VDI Shim disposeAudioElement: "),e&&(t=e.remoteAudioElement)&&(t.dispose(),e.remoteAudioElement=void 0)},setVMEventCallback:function(e){var t=this;U=e,p.getRedirector().isConnected()&&V.getSessionInfo().then(function(e){return r(t,void 0,void 0,function(){return i(this,function(t){return l.log("VDI Shim onVdiClientConnected, client endpoint info:"+JSON.stringify(e)),b("vdiClientConnected",{version:e,endpointId:e.endpointId}),[2]})})}),l.log("VDI Event Callback Set")},playNotifyAudio:function(e,t){A("playNotifyAudio"),l.log("VDI Shim Audio playNotifyAudio audioId:"+e+" src:"+t),N&&N.playNotifyAudio(e,t)},stopNotifyAudio:function(e,t){A("stopNotifyAudio"),l.log("VDI Shim Audio pauseNotifyAudio audioId:"+e+" src:"+t),N&&N.pauseNotifyAudio(e,t)},setSinkId:function(e,t){A("setSinkId"),l.log("VDI Shim Audio setSinkId audioId:"+e+" sinkId:"+t),N&&N.setSinkId(e,t)},getLoop:function(e){var t;return A("getLoop"),N&&(t=N.getLoop(e)),l.log("VDI Shim Audio getLoop audioId:"+e+" loop: "+t),t},setLoop:function(e,t){A("setLoop"),l.log("VDI Shim Audio setLoop audioId:"+e+" bool:"+t),N&&N.setLoop(e,t)},addClipRect:function(e,t){A("addClipRect"),l.log("VDI Adding Occlusion "+JSON.stringify(e)),n(t,function(t){t.addOcclusion(e)})},removeClipRect:function(e,t){A("removeClipRect"),l.log("VDI Removing Occlusion "+JSON.stringify(e)),n(t,function(t){t.removeOcclusion(e)})},initLog:function(e,t){l.setMSLogger(e,t),l.log("VDI init logger")},isFeatureOn:function(e){return A("isFeatureOn"),!!V&&V.isFeatureSupported(e)},onConnectionChange:function(e){A("onConnectionChange"),l.log("VDI : onConnectionChange to "+e),!1===e?l.log("Disconnecting from the VDA"):(l.log("Connecting to the VDA"),void 0!==(e=window.getCitrixWebrtcRedir)?e().then(function(e){l.log("Sucesss on connect, CitrixRedir reg value:"+e),"0"===e||"1"===e?w(e):(l.log("MS Teams Redir Reg key not updated yet"),k())}).catch(function(){l.log("Failure to Read MS Teams redir Reg Key"),k()}):(l.log("window.getCitrixWebrtcRedir() method is not available yet"),k()))},getScreensAsync:function(){A("getScreensAsync"),l.log("VDI Shim getScreensAsync"),C();var e=P();return e.getScreensAsync.apply(e,arguments)},getWindowsAsync:function(){A("getWindowsAsync"),l.log("VDI Shim getWindowsAsync"),C();var e=P();return e.getWindowsAsync.apply(e,arguments)},setScreenSharePanelId:function(e){A("setScreenSharePanelId"),l.log("VDI: setScreenSharePanelId set to "+JSON.stringify(e)),C(),null!==O&&O.isValid()||(O=new s.RemoteDevices),O.panelid=e},setCodecCapabilities:function(e){return A("setCodecCapabilities"),C(),l.log("VDI Shim setCodecCapabilities"),null!==M&&M.isValid()||(M=new s.NavigatorUserMedia),M.setCodecCapabilities(e)},getE911Data:function(){return A("getE911Data"),j?j.getE911Info():null},createMediaStream:function(t){return A("createMediaStream"),l.log("VDI Shim createMediaStream"),e(t,!1)},createMediaStreamAsync:function(t){return A("createMediaStreamAsync"),l.log("VDI Shim createMediaStreamAsync"),e(t,!0)},disposeMediaStream:function(e){A("disposeMediaStream"),l.log("VDI Shim disposeMediaStream: ");for(var t=0;t<e.length;t++){var n=e[t];n&&n.dispose()}},getCapabilities:function(e){return A("getCapabilities"),C(),l.log("VDI Shim getCapabilities"),null!==M&&M.isValid()||(M=new s.NavigatorUserMedia,D=s.NavigatorUserMedia.getCapabilities),D.apply(M,arguments)},initUCSDK:function(e){l.log("VDI Shim initUCSDK vendor:"+e);var t=!0;if(void 0==e||null==e||"string"!=typeof e||0==e.length?t=!1:0==e.split(" ").join("").length&&(t=!1),!t)throw l.log("VDI Shim initUCSDK: throwing exception: vendor info cannot be empty!!!"),new DOMException("vendor info cannot be empty, please pass vendor info string!!!");B||(H=e,M=new s.NavigatorUserMedia,O=new s.RemoteDevices,N=new y,O=new s.RemoteDevices,E(H),window.onVdiClientDisconnected=S,window.onVdiClientDisconnectedTimer=R,window.onVdiClientConnected=T,B=!0)},deinitUCSDK:function(){l.log("VDI Shim deinitUCSDK"),B&&(p.getRedirector().terminateOptimization(),I(),window.onVdiClientDisconnected=void 0,window.onVdiClientDisconnectedTimer=void 0,H=window.onVdiClientConnected=void 0,B=!1)}}}()}("undefined"!=typeof self?self:this)},679:function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.VideoElement=t.VideoRect=void 0;var i,o=n(658),a=n(550),s=n(851),c=n(946),d=n(550),l=function(e,t){this.x=Math.round(e.x)*t.devicePixelRatio,this.y=Math.round(e.y)*t.devicePixelRatio,this.width=Math.round(e.width)*t.devicePixelRatio,this.height=Math.round(e.height)*t.devicePixelRatio};t.VideoRect=l,function(e){e[e.pixels=0]="pixels",e[e.percent=1]="percent"}(i||(i={}));var u,f=function(){function e(e){this.value=parseInt(e),this.units=this.detectUnits(e)}return e.prototype.detectUnits=function(e){return-1===e.toLowerCase().indexOf("px")?i.pixels:i.percent},e}();!function(e){e[e.fill=0]="fill",e[e.contain=1]="contain",e[e.cover=2]="cover"}(u||(u={}));var h,p=function(e,t){this.x=e,this.y=t},_=function(){function e(e,t,n){this.fit=this.convertFit(e),this.position=new p(t,n)}return e.prototype.convertFit=function(e){return"fill"==e?u.fill:"contain"==e?u.contain:"cover"==e?u.cover:u.fill},e}();!function(e){e[e.NotReady=0]="NotReady",e[e.Ready=1]="Ready"}(h||(h={})),e=function(e){function t(t,n){var r=e.call(this,null,a.class_id_t.VideoElement,0,o.ProxyMode.Local)||this;return r.srcObject_=null,r.sinkId_="",r.videoWidth=0,r.videoHeight=0,r.isLoaded=!1,r.connectionState="disconnected",r.styleObserver=null,r.readyState_=h.NotReady,r.deferredVideoActions=[],r.pendingRelease_=!1,r.activeConnectionEvent_=null,r.connectionEventQueue_=[],r.window_=n,r.elementId=t,s.logger.log("VideoElement.constructor (elementid: "+t+")"),r}return r(t,e),t.prototype.dispose=function(){var e=this;s.logger.log("VideoElement.dispose (elementId: "+this.elementId+" oid: "+this.object_id()+")"),this.pendingRelease_=!0,this.srcObject=this.ontimeupdate=this.onloadedmetadata=null,this.waitUntilReady("VideoElement.dispose").then(function(){}).catch(function(){e.pendingRelease_=!1,e.setState("disconnected"),e.onconnectionstatechange=null,e.release()}),this.onReady()},t.prototype.setState=function(e){this.connectionState=e,this.onconnectionstatechange_&&this.onconnectionstatechange_()},Object.defineProperty(t.prototype,"Id",{get:function(){return this.elementId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;s.logger.log("VideoElement.sinkId: (id="+e+")"),this.waitUntilConnected("VideoElement.sinkId").then(function(){return void 0!=e?t.remoteInvoke(!0,a.method_id_VideoElement_t.sinkId,e):new Promise(function(e){return e(void 0)})}).then(function(){s.logger.log("videoElement: setting state to ready. (oid: "+t.object_id()+")"),t.sinkId_=e,t.readyState_=h.Ready,t.onReady()}).catch(function(e){t.logRemoteInvokeError(e,".set_sinkId() failed!")})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){if(s.logger.log(this.user_friendly_id()+".srcObject: set srcObject... this.srcObject:"+this.srcObject+" obj:"+e),this.srcObject_!==e){var t=c.getRedirector().getFeatureValue(d.FEATURE_ms_teams_1911);null!==this.srcObject_&&(null===e&&t&&this.disconnect(),t||this.disconnect(),this.isLoaded=!1),this.srcObject_=e,null!==this.srcObject_&&this.connectTo(this.srcObject_)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){s.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onloadedmetadata",{set:function(e){s.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=e},enumerable:!1,configurable:!0}),t.prototype.setupOnVideoFrameChanged=function(){var e=this,t=this.registerCallbacks(!1,!1,a.method_id_VideoElement_t.onvideoframechanged);t.then(function(t){s.logger.log(e.user_friendly_id()+".onvideoframechanged",t.params),e.videoWidth=t.params[0]||0,e.videoHeight=t.params[1]||0,e.isLoaded||(e.isLoaded=!0,e.onloadedmetadata_&&e.onloadedmetadata_())}),this.remoteInvoke(!0,a.method_id_VideoElement_t.onvideoframechanged,t.success)},t.prototype.processConnectionEvent=function(){var e=this;if(0!==this.connectionEventQueue_.length&&!this.activeConnectionEvent_){var t=this.connectionEventQueue_.pop();"connectTo"==t.operation?this.activeConnectionEvent_=this.connectToAsync(t.param):"disconnect"==t.operation&&(this.activeConnectionEvent_=this.disconnectAsync()),this.activeConnectionEvent_.then(function(){e.activeConnectionEvent_=void 0,e.processConnectionEvent()}).catch(function(){s.logger.log(e.user_friendly_id()+" : Failed to handle connection event! "),e.activeConnectionEvent_=void 0,e.processConnectionEvent()})}},t.prototype.connectTo=function(e){this.connectionEventQueue_.push({operation:"connectTo",param:e}),this.processConnectionEvent()},t.prototype.disconnect=function(){this.connectionEventQueue_.push({operation:"disconnect",param:null}),this.processConnectionEvent()},t.prototype.connectToAsync=function(e){var t=this;return new Promise(function(n,r){s.logger.log(t.user_friendly_id()+".connectTo: connect media stream with id = "+e.id+", clone_id = "+e.clone_state.clone_id),t.streamId_=e.id,t.waitUntilReady("VideoElement.connectTo").then(function(){return e.waitUntilConnected("MediaStream.connectTo")}).then(function(){return t.setupOnVideoFrameChanged(),e.clone_state.synchronize(e)}).then(function(e){s.logger.log(t.user_friendly_id()+".connectTo: remote invoking");var n=t.registerCallbacks(!0,!1,a.method_id_VideoElement_t.connectTo);return Promise.all([t.remoteInvokeEx(!1,a.method_id_VideoElement_t.connectTo,[e],n.success,n.fail),n.prom()])}).then(function(e){s.logger.log(t.user_friendly_id()+".connectTo: remote media stream is connected!"),t.setState("connected"),t.watch(),t.updateTimer=setInterval(function(){t.ontimeupdate&&t.ontimeupdate()},250),(e=t.window_.document.getElementById(t.elementId))&&t.updateStyle(e),n()}).catch(function(e){t.logRemoteInvokeError(e,".connectTo: failed to connect!"),r()})})},t.prototype.disconnectAsync=function(){var e=this;return new Promise(function(t,n){s.logger.log(e.user_friendly_id()+".disconnect: disconnecting stream : "+e.streamId_),e.unwatch(),e.waitUntilReady("VideoElement.disconnect").then(function(){e.updateTimer&&clearInterval(e.updateTimer);var t=e.registerCallbacks(!1,!0,a.method_id_VideoElement_t.onvideoframechanged);return e.remoteInvoke(!0,a.method_id_VideoElement_t.onvideoframechanged,t.success),e.remoteInvoke(!1,a.method_id_VideoElement_t.disconnect)}).then(function(){s.logger.log(e.user_friendly_id()+".disconnect: remote media stream is disconnected!"),e.setState("disconnected"),1==e.pendingRelease_&&(e.pendingRelease_=!1,e.onconnectionstatechange=null,e.release()),t()}).catch(function(t){e.logRemoteInvokeError(t,".disconnect: failed to connect!"),n()})})},t.prototype.setFrame=function(e){var t=this;s.logger.log(this.user_friendly_id()+".setFrame: set video frame to",e.x,e.y,e.width,e.height),this.waitUntilReady("VideoElement.setFrame").then(function(){var n=new l(e,t.window_);return t.remoteInvoke(!1,a.method_id_VideoElement_t.setFrame,n)}).then(function(){s.logger.log(t.user_friendly_id()+".setFrame: success!")}).catch(function(e){t.logRemoteInvokeError(e,".setFrame: failed to connect!")})},t.prototype.addClipRect=function(e){var t=this;s.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(e)),this.waitUntilReady("VideoElement.addClipRect").then(function(){var n=new l(e,t.window_);return t.remoteInvoke(!1,a.method_id_VideoElement_t.addClipRect,n)}).catch(function(e){t.logRemoteInvokeError(e,".addClipRect failed!")})},t.prototype.removeClipRect=function(e){var t=this;s.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(e)),this.waitUntilReady("VideoElement.removeClipRect").then(function(){var n=new l(e,t.window_);return t.remoteInvoke(!1,a.method_id_VideoElement_t.removeClipRect,n)}).catch(function(e){t.logRemoteInvokeError(e,".removeClipRect failed!")})},t.prototype.watch=function(){var e=this;if(c.getRedirector().getFeatureValue(d.FEATURE_ms_teams_video_placement)){var t=this.window_.document.getElementById(this.elementId);t&&(this.unwatch(),this.styleObserver=new MutationObserver(function(t){t.forEach(function(t){"style"==t.attributeName?e.updateStyle(t.target):e.elementId=t.target.id})}),this.styleObserver.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:["style","id"]}))}},t.prototype.unwatch=function(){this.styleObserver&&(this.styleObserver.disconnect(),this.styleObserver=null)},t.prototype.updateStyle=function(e){if("connected"==this.connectionState){var t=this.window_.getComputedStyle(e).getPropertyValue("object-fit"),n=this.window_.getComputedStyle(e).getPropertyValue("object-position").split(" ");e=new f(n[0]),n=new f(n[1]),this.placement=new _(t,e,n)}else s.logger.log(this.user_friendly_id()+".updateStyle: video element is not connected")},Object.defineProperty(t.prototype,"placement",{get:function(){return this.placement_},set:function(e){var t=this;c.getRedirector().getFeatureValue(d.FEATURE_ms_teams_video_placement)?this.waitUntilReady("VideoElement.placement").then(function(){return t.remoteInvoke(!0,a.method_id_VideoElement_t.placement,e)}).then(function(){t.placement_=e}).catch(function(e){t.logRemoteInvokeError(e,".placement setter: failed to connect!")}):s.logger.log(this.user_friendly_id()+".placement: video placement feature is not supported on a client")},enumerable:!1,configurable:!0}),t.prototype.waitUntilReady=function(e){var t=this;return new Promise(function(n,r){s.logger.log("VideoElement.waitUntilReady(): readyState="+t.readyState_+". (oid: "+t.object_id()+")"),t.readyState_==h.Ready?n():(s.logger.log('videoElement.waitUntilReady(): deferring action "'+e+'". (oid: '+t.object_id()+")"),t.deferredVideoActions.push(new o.deferred_action(n,r,e)))})},t.prototype.onReady=function(){for(;this.deferredVideoActions&&0<this.deferredVideoActions.length;)this.deferredVideoActions.shift().post(this.readyState_==h.Ready)},t}(o.ProxyObject),t.VideoElement=e},269:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HardwareInfo=t.MemoryInfo=t.GPUInfo=t.GPU=t.CPUInfo=t.WebrpcClassLibInfo=t.WebrpcClassInfo=t.WebrpcMethodInfo=t.EndpointId=t.OSInfo=t.WebrpcFeatureInfo=t.FeatureData=t.VersionData=t.FEATURE_unsupported=t.FEATURE_ms_teams_redirection=void 0,t.FEATURE_ms_teams_redirection="ms_teams_redirection",t.FEATURE_unsupported="unsupported";var n=function(e,t,n,r){this.major=e,this.minor=t,this.revision=n,this.build=r};t.VersionData=n,n=function(){},t.FeatureData=n,n=function(e,t){this.fature=e,this.version=t},t.WebrpcFeatureInfo=n,n=function(e,t,n,r,i){this.family=e,this.version=t,this.architecture=n,this.distro=r,this.edition=i},t.OSInfo=n,n=function(e,t){this.machine_id=e,this.user_id=t},t.EndpointId=n,n=function(e,n,r,i,o){void 0===o&&(o=t.FEATURE_ms_teams_redirection),this.iid=e,this.mid=n,this.name=r,this.isprop=i,this.feature=o},t.WebrpcMethodInfo=n,n=function(e,t,n){this.id=e,this.name=t,this.methods=n},t.WebrpcClassInfo=n,n=function(e,t){this.name=e,this.classes=t},t.WebrpcClassLibInfo=n,n=function(e,t){this.cpumodel=e,this.numberofprocessors=t},t.CPUInfo=n,n=function(e,t){this.name=e,this.driver=t},t.GPU=n,n=function(e){this.gpus=e},t.GPUInfo=n,n=function(e){this.totalmemory=e},t.MemoryInfo=n,n=function(e,t,n){this.cpu_info=e,this.gpu_info=t,this.memory_info=n},t.HardwareInfo=n},550:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]});e=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)},Object.defineProperty(t,"__esModule",{value:!0}),t.WebrpcClassLibInfoUtil=void 0;var i=n(187);e(n(187),t),n=function(){function e(){}return e.getInterfaceByid=function(e){for(var t=0,n=i.class_lib_info.classes;t<n.length;t++){var r=n[t];if(r.id==e)return r}return null},e.getMethodByid=function(e,t){if(null!=(r=this.getInterfaceByid(e)))for(var n=0,r=r.methods;n<r.length;n++){var i=r[n];if(i.mid==t)return i}return null},e.getMethodFeatureByid=function(e,t){if(null!=(r=this.getInterfaceByid(e)))for(var n=0,r=r.methods;n<r.length;n++){var i=r[n];if(i.mid==t)return i.feature}return null},e.composeClassInfoData=function(e){if(void 0==(e=e.hdr))return"*** Invalid packet: Couldn't find hdr object ***";if(void 0==(t=e.proc))return"";e=t.iid;for(var t=t.methodid,n=0,r=i.class_lib_info.classes;n<r.length;n++){var o=r[n];if(o.id==e)for(var a=0,s=o.methods;a<s.length;a++){var c=s[a];if(c.mid==t)return o.name+"::"+c.name}}return""},e}(),t.WebrpcClassLibInfoUtil=n},187:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.class_lib_info=t.method_id_StreamResolution_t=t.method_id_RTCSctpTransport_t=t.method_id_RTCDataChannel_t=t.method_id_E911Service_t=t.method_id_ScreenSource_t=t.method_id_VDISharingRemote_t=t.method_id_RTCRtpTransceiver_t=t.method_id_RTCIceCandidatePair_t=t.method_id_RTCDTMFToneChangeEvent_t=t.method_id_RTCDTMFSender_t=t.method_id_RTCIceTransport_t=t.method_id_RTCDtlsTransport_t=t.method_id_RTCRtpSender_t=t.method_id_RTCRtpReceiver_t=t.method_id_AudioElement_t=t.method_id_VideoElement_t=t.method_id_MediaStreamEvent_t=t.method_id_RTCIceCandidateEvent_t=t.method_id_RTCIceCandidate_t=t.method_id_NavigatorUserMedia_t=t.method_id_MediaStream_t=t.method_id_MediaStreamTrack_t=t.method_id_RTCSessionDescription_t=t.method_id_MediaDeviceInfo_t=t.method_id_MediaDevices_t=t.method_id_RTCPeerConnection_t=t.method_id_EngineControl_t=t.class_id_t=t.vdaFeatureNameMap=t.featureNameMap=t.Features=t.FEATURE_ms_teams_sender_stats_fix=t.FEATURE_ms_teams_enumerate_devices_v2=t.FEATURE_ms_teams_track_clone_with_id=t.FEATURE_ms_teams_audio_notifications_loop=t.FEATURE_ms_teams_share_system_audio=t.FEATURE_ms_teams_stream_active_status=t.FEATURE_ms_teams_hardware_info=t.FEATURE_ms_teams_secondary_audio_notifications=t.FEATURE_ms_teams_stream_resolution=t.FEATURE_ms_teams_client_info=t.FEATURE_ms_teams_no_vd_buffer_limit=t.FEATURE_ms_teams_data_channel=t.FEATURE_ms_teams_webrtc_1dot0=t.FEATURE_ms_teams_multi_window=t.FEATURE_ms_teams_gtc=t.FEATURE_ms_teams_e911=t.FEATURE_ms_teams_codec_capability=t.FEATURE_ms_teams_app_sharing=t.FEATURE_ms_teams_monitor_sharing=t.FEATURE_ms_teams_video_placement=t.FEATURE_ms_teams_dtmf=t.FEATURE_ms_teams_device_group_id=t.FEATURE_ms_teams_remote_audio_notifications=t.FEATURE_ms_teams_endpoint_id=t.FEATURE_ms_teams_osinfo=t.FEATURE_ms_teams_mstrack_constraints=t.FEATURE_ms_teams_1912=t.FEATURE_ms_teams_pstn=t.FEATURE_ms_teams_1911=t.FEATURE_ms_teams_common_media_constraints=t.FEATURE_ms_teams_speaking_indicator=t.FEATURE_ms_teams_desktop_sharing=t.FEATURE_vda_delete_viewport=t.FEATURE_vda_multi_window=t.FEATURE_vda_app_sharing=t.FEATURE_vda_service_no_buffer_limit=t.HDXMS_VERSION=t.BUILD_TYPE_SDK=void 0,e=n(269);var r,i,o,a,s,c,d,l,u,f,h,p,_,g,m,v,y,b,C,S,E,R,T,w,k,I,P,A=n(269);Object.defineProperty(t,"VersionData",{enumerable:!0,get:function(){return A.VersionData}}),Object.defineProperty(t,"FeatureData",{enumerable:!0,get:function(){return A.FeatureData}}),Object.defineProperty(t,"OSInfo",{enumerable:!0,get:function(){return A.OSInfo}}),Object.defineProperty(t,"EndpointId",{enumerable:!0,get:function(){return A.EndpointId}}),Object.defineProperty(t,"HardwareInfo",{enumerable:!0,get:function(){return A.HardwareInfo}}),t.BUILD_TYPE_SDK=!0,t.HDXMS_VERSION="3.1.0",t.FEATURE_vda_service_no_buffer_limit="wsservice_no_buffer_limit",t.FEATURE_vda_app_sharing="webrtc_app_sharing",t.FEATURE_vda_multi_window="webrtc_multi_window",t.FEATURE_vda_delete_viewport="overlay_delete_viewport",t.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing",t.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator",t.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints",t.FEATURE_ms_teams_1911="ms_teams_1911",t.FEATURE_ms_teams_pstn="ms_teams_pstn",t.FEATURE_ms_teams_1912="ms_teams_1912",t.FEATURE_ms_teams_mstrack_constraints="ms_teams_mstrack_constraints",t.FEATURE_ms_teams_osinfo="ms_teams_osinfo",t.FEATURE_ms_teams_endpoint_id="ms_teams_endpoint_id",t.FEATURE_ms_teams_remote_audio_notifications="ms_teams_remote_audio_notifications",t.FEATURE_ms_teams_device_group_id="ms_teams_device_group_id",t.FEATURE_ms_teams_dtmf="ms_teams_dtmf",t.FEATURE_ms_teams_video_placement="ms_teams_video_placement",t.FEATURE_ms_teams_monitor_sharing="ms_teams_multi_monitor_sharing",t.FEATURE_ms_teams_app_sharing="ms_teams_app_sharing",t.FEATURE_ms_teams_codec_capability="ms_teams_codec_capability",t.FEATURE_ms_teams_e911="ms_teams_e911",t.FEATURE_ms_teams_gtc="ms_teams_gtc",t.FEATURE_ms_teams_multi_window="ms_teams_multi_windows",t.FEATURE_ms_teams_webrtc_1dot0="ms_teams_webrtc_1.0",t.FEATURE_ms_teams_data_channel="ms_teams_data_channel",t.FEATURE_ms_teams_no_vd_buffer_limit="ms_teams_no_vd_buffer_limit",t.FEATURE_ms_teams_client_info="ms_teams_client_info",t.FEATURE_ms_teams_stream_resolution="ms_teams_stream_resolution",t.FEATURE_ms_teams_secondary_audio_notifications="ms_teams_secondary_audio_notifications",t.FEATURE_ms_teams_hardware_info="ms_teams_hardware_info",t.FEATURE_ms_teams_stream_active_status="ms_teams_stream_active_status",t.FEATURE_ms_teams_share_system_audio="ms_teams_share_system_audio",t.FEATURE_ms_teams_audio_notifications_loop="ms_teams_audio_notifications_loop",t.FEATURE_ms_teams_track_clone_with_id="ms_teams_track_clone_with_id",t.FEATURE_ms_teams_enumerate_devices_v2="ms_teams_enumerate_devices_v2",t.FEATURE_ms_teams_sender_stats_fix="ms_teams_sender_stats_fix",new e.WebrpcFeatureInfo(e.FEATURE_ms_teams_redirection,new e.VersionData(1,1,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_desktop_sharing,new e.VersionData(1,2,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_speaking_indicator,new e.VersionData(1,2,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_common_media_constraints,new e.VersionData(1,4,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_1911,new e.VersionData(1,4,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_1912,new e.VersionData(1,5,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_mstrack_constraints,new e.VersionData(1,6,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_pstn,new e.VersionData(1,6,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_osinfo,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_endpoint_id,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_remote_audio_notifications,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_device_group_id,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_codec_capability,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_dtmf,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_video_placement,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_monitor_sharing,new e.VersionData(1,7,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_app_sharing,new e.VersionData(1,8,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_webrtc_1dot0,new e.VersionData(1,8,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_data_channel,new e.VersionData(1,8,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_e911,new e.VersionData(1,13,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_multi_window,new e.VersionData(1,14,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_client_info,new e.VersionData(1,19,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_stream_resolution,new e.VersionData(1,25,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_secondary_audio_notifications,new e.VersionData(1,21,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_hardware_info,new e.VersionData(1,35,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_stream_active_status,new e.VersionData(1,32,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_audio_notifications_loop,new e.VersionData(1,33,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_track_clone_with_id,new e.VersionData(1,33,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_enumerate_devices_v2,new e.VersionData(1,35,0,0)),new e.WebrpcFeatureInfo(t.FEATURE_ms_teams_sender_stats_fix,new e.VersionData(1,36,0,0)),n=function(){function e(){}return e.FEATURE_public_screenshare="screenshare",e.FEATURE_public_redirection="redirection",e.FEATURE_public_speaking_indicator="speaking_indicator",e.FEATURE_public_pstn="pstn",e.FEATURE_public_osinfo="osinfo",e.FEATURE_public_endpoint_id="endpointid",e.FEATURE_public_remote_audio_notifications="remoteaudionotifications",e.FEATURE_public_device_group_id="compositedevices",e.FEATURE_public_dtmf="dtmf",e.FEATURE_public_monitor_sharing="multimonitorscreenshare",e.FEATURE_public_app_sharing="appshare",e.FEATURE_public_codec_capability="codec_capability",e.FEATURE_public_e911="e911",e.FEATURE_public_webrtc1dot0="webrtc1.0",e.FEATURE_public_data_channel="datachannel",e.FEATURE_public_vdnobuflimit="vdnobuflimit",e.FEATURE_public_multi_window="multiwindow",e.FEATURE_public_secondary_audio_notifications="secondaryringer",e.FEATURE_public_stream_resolution="streamresolution",e.FEATURE_public_track_clone_with_id="track_clone_with_id",e.FEATURE_public_sender_stats_fix="sender_stats_fix",e.FEATURE_public_audio_notification_loop="loop",e}(),t.Features=n,t.featureNameMap={},t.featureNameMap[n.FEATURE_public_screenshare]=[t.FEATURE_ms_teams_desktop_sharing],t.featureNameMap[n.FEATURE_public_redirection]=[e.FEATURE_ms_teams_redirection],t.featureNameMap[n.FEATURE_public_speaking_indicator]=[t.FEATURE_ms_teams_speaking_indicator],t.featureNameMap[n.FEATURE_public_pstn]=[t.FEATURE_ms_teams_pstn],t.featureNameMap[n.FEATURE_public_osinfo]=[t.FEATURE_ms_teams_osinfo],t.featureNameMap[n.FEATURE_public_endpoint_id]=[t.FEATURE_ms_teams_endpoint_id],t.featureNameMap[n.FEATURE_public_remote_audio_notifications]=[t.FEATURE_ms_teams_remote_audio_notifications,t.FEATURE_ms_teams_secondary_audio_notifications],t.featureNameMap[n.FEATURE_public_device_group_id]=[t.FEATURE_ms_teams_device_group_id],t.featureNameMap[n.FEATURE_public_dtmf]=[t.FEATURE_ms_teams_dtmf],t.featureNameMap[n.FEATURE_public_monitor_sharing]=[t.FEATURE_ms_teams_monitor_sharing],t.featureNameMap[n.FEATURE_public_app_sharing]=[t.FEATURE_ms_teams_app_sharing],t.featureNameMap[n.FEATURE_public_codec_capability]=[t.FEATURE_ms_teams_codec_capability],t.featureNameMap[n.FEATURE_public_e911]=[t.FEATURE_ms_teams_e911],t.featureNameMap[n.FEATURE_public_webrtc1dot0]=[t.FEATURE_ms_teams_webrtc_1dot0],t.featureNameMap[n.FEATURE_public_multi_window]=[t.FEATURE_ms_teams_multi_window],t.featureNameMap[n.FEATURE_public_data_channel]=[t.FEATURE_ms_teams_data_channel],t.featureNameMap[n.FEATURE_public_vdnobuflimit]=[t.FEATURE_ms_teams_no_vd_buffer_limit],t.featureNameMap[n.FEATURE_public_secondary_audio_notifications]=[t.FEATURE_ms_teams_remote_audio_notifications,t.FEATURE_ms_teams_secondary_audio_notifications],t.featureNameMap[n.FEATURE_public_stream_resolution]=[t.FEATURE_ms_teams_stream_resolution],t.featureNameMap[n.FEATURE_public_track_clone_with_id]=[t.FEATURE_ms_teams_track_clone_with_id],t.featureNameMap[n.FEATURE_public_sender_stats_fix]=[t.FEATURE_ms_teams_sender_stats_fix],t.featureNameMap[n.FEATURE_public_audio_notification_loop]=[t.FEATURE_ms_teams_audio_notifications_loop],t.vdaFeatureNameMap={},t.vdaFeatureNameMap[n.FEATURE_public_multi_window]=[t.FEATURE_vda_multi_window],t.vdaFeatureNameMap[n.FEATURE_public_app_sharing]=[t.FEATURE_vda_app_sharing],function(e){e[e.EngineControl=0]="EngineControl",e[e.RTCPeerConnection=1]="RTCPeerConnection",e[e.RTCSessionDescription=2]="RTCSessionDescription",e[e.RTCIceCandidate=3]="RTCIceCandidate",e[e.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",e[e.MediaDevices=5]="MediaDevices",e[e.MediaDeviceInfo=6]="MediaDeviceInfo",e[e.MediaStreamTrack=7]="MediaStreamTrack",e[e.MediaStreamEvent=8]="MediaStreamEvent",e[e.MediaStream=9]="MediaStream",e[e.NavigatorUserMedia=10]="NavigatorUserMedia",e[e.VideoElement=11]="VideoElement",e[e.AudioElement=12]="AudioElement",e[e.RTCRtpReceiver=13]="RTCRtpReceiver",e[e.RTCRtpSender=14]="RTCRtpSender",e[e.RTCDtlsTransport=15]="RTCDtlsTransport",e[e.RTCIceTransport=16]="RTCIceTransport",e[e.RTCDTMFSender=17]="RTCDTMFSender",e[e.RTCDTMFToneChangeEvent=18]="RTCDTMFToneChangeEvent",e[e.RTCIceCandidatePair=19]="RTCIceCandidatePair",e[e.RTCRtpTransceiver=20]="RTCRtpTransceiver",e[e.ScreenSharingRemote=21]="ScreenSharingRemote",e[e.ScreenSource=22]="ScreenSource",e[e.E911Service=23]="E911Service",e[e.reserved2=24]="reserved2",e[e.RTCDataChannel=25]="RTCDataChannel",e[e.RTCSctpTransport=26]="RTCSctpTransport",e[e.StreamResolution=27]="StreamResolution",e[e.VideoEffect=28]="VideoEffect",e[e.reserved6=29]="reserved6",e[e.reserved7=30]="reserved7",e[e.reserved8=31]="reserved8"}(n=t.class_id_t||(t.class_id_t={})),function(e){e[e.ctor=0]="ctor",e[e.version=1]="version",e[e.feature_flags=2]="feature_flags",e[e.version_info=3]="version_info",e[e.osinfo=4]="osinfo",e[e.endpoint_id=5]="endpoint_id",e[e.set_client_info=6]="set_client_info",e[e.hardware_info=7]="hardware_info"}(r=t.method_id_EngineControl_t||(t.method_id_EngineControl_t={})),function(e){e[e.ctor=0]="ctor",e[e.localDescription=1]="localDescription",e[e.remoteDescription=2]="remoteDescription",e[e.readyState=3]="readyState",e[e.iceState=4]="iceState",e[e.localStreams=5]="localStreams",e[e.remoteStreams=6]="remoteStreams",e[e.createOffer=7]="createOffer",e[e.createAnswer=8]="createAnswer",e[e.setLocalDescription=9]="setLocalDescription",e[e.setRemoteDescription=10]="setRemoteDescription",e[e.updateIce=11]="updateIce",e[e.addIceCandidate=12]="addIceCandidate",e[e.addStream=13]="addStream",e[e.removeStream=14]="removeStream",e[e.close=15]="close",e[e.iceConnectionState=16]="iceConnectionState",e[e.iceGatheringState=17]="iceGatheringState",e[e.signalingState=18]="signalingState",e[e.onaddstream=19]="onaddstream",e[e.onicecandidate=20]="onicecandidate",e[e.oniceconnectionstatechange=21]="oniceconnectionstatechange",e[e.onicegatheringstatechange=22]="onicegatheringstatechange",e[e.onsignalingstatechange=23]="onsignalingstatechange",e[e.onnegotiationneeded=24]="onnegotiationneeded",e[e.onremovestream=25]="onremovestream",e[e.getStats=26]="getStats",e[e.getReceivers=27]="getReceivers",e[e.getSenders=28]="getSenders",e[e.addTrack=29]="addTrack",e[e.removeTrack=30]="removeTrack",e[e.ontrack=31]="ontrack",e[e.setLocalDescription_v2=32]="setLocalDescription_v2",e[e.setRemoteDescription_v2=33]="setRemoteDescription_v2",e[e.addTransceiverWithTrack=34]="addTransceiverWithTrack",e[e.addTransceiverWithKind=35]="addTransceiverWithKind",e[e.getTransceivers=36]="getTransceivers",e[e.onconnectionstatechange=37]="onconnectionstatechange",e[e.sctp=38]="sctp",e[e.ondatachannel=39]="ondatachannel",e[e.createDataChannel=40]="createDataChannel",e[e.getStats_v2=41]="getStats_v2"}(i=t.method_id_RTCPeerConnection_t||(t.method_id_RTCPeerConnection_t={})),function(e){e[e.ctor=0]="ctor",e[e.enumerateDevices=1]="enumerateDevices",e[e.getDisplayMedia=2]="getDisplayMedia",e[e.ondevicechange=3]="ondevicechange",e[e.enumerateDevicesV2=4]="enumerateDevicesV2"}(o=t.method_id_MediaDevices_t||(t.method_id_MediaDevices_t={})),function(e){e[e.ctor=0]="ctor",e[e.deviceId=1]="deviceId",e[e.kind=2]="kind",e[e.label=3]="label",e[e.groupId=4]="groupId"}(a=t.method_id_MediaDeviceInfo_t||(t.method_id_MediaDeviceInfo_t={})),function(e){e[e.ctor=0]="ctor",e[e.type=1]="type",e[e.sdp=2]="sdp"}(s=t.method_id_RTCSessionDescription_t||(t.method_id_RTCSessionDescription_t={})),function(e){e[e.ctor=0]="ctor",e[e.kind=1]="kind",e[e.id=2]="id",e[e.label=3]="label",e[e.enabled=4]="enabled",e[e.muted=5]="muted",e[e.readyState=6]="readyState",e[e.onended=7]="onended",e[e.onmute=8]="onmute",e[e.onunmute=9]="onunmute",e[e.clone=10]="clone",e[e.stop=11]="stop",e[e.getCapabilities=12]="getCapabilities",e[e.getSettings=13]="getSettings",e[e.applyConstraints=14]="applyConstraints",e[e.getConstraints=15]="getConstraints"}(c=t.method_id_MediaStreamTrack_t||(t.method_id_MediaStreamTrack_t={})),function(e){e[e.ctor=0]="ctor",e[e.id=1]="id",e[e.getAudioTracks=2]="getAudioTracks",e[e.getVideoTracks=3]="getVideoTracks",e[e.getTracks=4]="getTracks",e[e.getTrackById=5]="getTrackById",e[e.addTrack=6]="addTrack",e[e.removeTrack=7]="removeTrack",e[e.clone=8]="clone",e[e.active=9]="active"}(d=t.method_id_MediaStream_t||(t.method_id_MediaStream_t={})),function(e){e[e.ctor=0]="ctor",e[e.getUserMedia=1]="getUserMedia",e[e.setCodecCapabilities=2]="setCodecCapabilities",e[e.getCapabilities=3]="getCapabilities"}(l=t.method_id_NavigatorUserMedia_t||(t.method_id_NavigatorUserMedia_t={})),function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate",e[e.sdpMid=2]="sdpMid",e[e.sdpMLineIndex=3]="sdpMLineIndex"}(u=t.method_id_RTCIceCandidate_t||(t.method_id_RTCIceCandidate_t={})),function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate"}(f=t.method_id_RTCIceCandidateEvent_t||(t.method_id_RTCIceCandidateEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.stream=1]="stream"}(h=t.method_id_MediaStreamEvent_t||(t.method_id_MediaStreamEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.connectTo=2]="connectTo",e[e.disconnect=3]="disconnect",e[e.setFrame=4]="setFrame",e[e.addClipRect=5]="addClipRect",e[e.removeClipRect=6]="removeClipRect",e[e.onerror=7]="onerror",e[e.onvideoframechanged=8]="onvideoframechanged",e[e.placement=9]="placement"}(p=t.method_id_VideoElement_t||(t.method_id_VideoElement_t={})),function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.srcObject=2]="srcObject",e[e.src=3]="src",e[e.play=4]="play",e[e.pause=5]="pause",e[e.loop=6]="loop"}(_=t.method_id_AudioElement_t||(t.method_id_AudioElement_t={})),function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.getContributingSources=2]="getContributingSources",e[e.getSynchronizationSources=3]="getSynchronizationSources",e[e.transport=4]="transport",e[e.rtcpTransport=5]="rtcpTransport",e[e.getCapabilities=6]="getCapabilities",e[e.getParameters=7]="getParameters",e[e.getStats=8]="getStats",e[e.getCapabilities_v2=9]="getCapabilities_v2"}(g=t.method_id_RTCRtpReceiver_t||(t.method_id_RTCRtpReceiver_t={})),function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.transport=2]="transport",e[e.rtcpTransport=3]="rtcpTransport",e[e.dtmf=4]="dtmf",e[e.getCapabilities=5]="getCapabilities",e[e.getParameters=6]="getParameters",e[e.setParameters=7]="setParameters",e[e.replaceTrack=8]="replaceTrack",e[e.getStats=9]="getStats",e[e.setStreams=10]="setStreams",e[e.getCapabilities_v2=11]="getCapabilities_v2"}(m=t.method_id_RTCRtpSender_t||(t.method_id_RTCRtpSender_t={})),function(e){e[e.ctor=0]="ctor",e[e.transport=1]="transport",e[e.state=2]="state",e[e.getRemoteCertificates=3]="getRemoteCertificates",e[e.onstatechange=4]="onstatechange",e[e.onerror=5]="onerror"}(v=t.method_id_RTCDtlsTransport_t||(t.method_id_RTCDtlsTransport_t={})),function(e){e[e.ctor=0]="ctor",e[e.role=1]="role",e[e.component=2]="component",e[e.state=3]="state",e[e.gatheringState=4]="gatheringState",e[e.localcandidates=5]="localcandidates",e[e.remotecandidates=6]="remotecandidates",e[e.onstatechange=7]="onstatechange",e[e.ongatheringstatechange=8]="ongatheringstatechange",e[e.onselectedcandidatepairchange=9]="onselectedcandidatepairchange"}(y=t.method_id_RTCIceTransport_t||(t.method_id_RTCIceTransport_t={})),function(e){e[e.ctor=0]="ctor",e[e.insertDTMF=1]="insertDTMF",e[e.ontonechange=2]="ontonechange",e[e.canInsertDTMF=3]="canInsertDTMF",e[e.toneBuffer=4]="toneBuffer"}(b=t.method_id_RTCDTMFSender_t||(t.method_id_RTCDTMFSender_t={})),function(e){e[e.ctor=0]="ctor",e[e.tone=1]="tone",e[e.tone_buffer=2]="tone_buffer"}(C=t.method_id_RTCDTMFToneChangeEvent_t||(t.method_id_RTCDTMFToneChangeEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.local=1]="local",e[e.remote=2]="remote"}(S=t.method_id_RTCIceCandidatePair_t||(t.method_id_RTCIceCandidatePair_t={})),function(e){e[e.ctor=0]="ctor",e[e.mid=1]="mid",e[e.sender=2]="sender",e[e.receiver=3]="receiver",e[e.direction=4]="direction",e[e.currentDirection=5]="currentDirection",e[e.stop=6]="stop",e[e.setCodecPreferences=7]="setCodecPreferences"}(E=t.method_id_RTCRtpTransceiver_t||(t.method_id_RTCRtpTransceiver_t={})),function(e){e[e.ctor=0]="ctor",e[e.getScreensAsync=1]="getScreensAsync",e[e.onscreentopologychanged=2]="onscreentopologychanged"}(R=t.method_id_VDISharingRemote_t||(t.method_id_VDISharingRemote_t={})),function(e){e[e.ctor=0]="ctor",e[e.srcid=1]="srcid",e[e.deviceid=2]="deviceid",e[e.type=3]="type",e[e.name=4]="name",e[e.imagedata=5]="imagedata",e[e.hwnd=6]="hwnd",e[e.origin=7]="origin",e[e.caption=8]="caption",e[e.pid=9]="pid",e[e.bounds=10]="bounds"}(T=t.method_id_ScreenSource_t||(t.method_id_ScreenSource_t={})),function(e){e[e.ctor=0]="ctor",e[e.getE911Info=1]="getE911Info",e[e.onupdate=2]="onupdate"}(w=t.method_id_E911Service_t||(t.method_id_E911Service_t={})),function(e){e[e.ctor=0]="ctor",e[e.label=1]="label",e[e.ordered=2]="ordered",e[e.maxPacketLifeTime=3]="maxPacketLifeTime",e[e.maxRetransmits=4]="maxRetransmits",e[e.protocol=5]="protocol",e[e.negotiated=6]="negotiated",e[e.id=7]="id",e[e.readyState=8]="readyState",e[e.bufferedAmount=9]="bufferedAmount",e[e.bufferedAmountLowThreshold=10]="bufferedAmountLowThreshold",e[e.onopen=11]="onopen",e[e.onbufferedamountlow=12]="onbufferedamountlow",e[e.onerror=13]="onerror",e[e.onclosing=14]="onclosing",e[e.onclose=15]="onclose",e[e.onmessage=16]="onmessage",e[e.close=17]="close",e[e.send_text=18]="send_text",e[e.send_binary=19]="send_binary"}(k=t.method_id_RTCDataChannel_t||(t.method_id_RTCDataChannel_t={})),function(e){e[e.ctor=0]="ctor",e[e.transport=1]="transport",e[e.state=2]="state",e[e.maxMessageSize=3]="maxMessageSize",e[e.maxChannels=4]="maxChannels",e[e.onstatechange=5]="onstatechange"}(I=t.method_id_RTCSctpTransport_t||(t.method_id_RTCSctpTransport_t={})),function(e){e[e.ctor=0]="ctor",e[e.getCallConstraints=1]="getCallConstraints",e[e.onupdate=2]="onupdate"}(P=t.method_id_StreamResolution_t||(t.method_id_StreamResolution_t={})),t.class_lib_info=new e.WebrpcClassLibInfo("webrpc_class_library",[new e.WebrpcClassInfo(n.EngineControl,"EngineControl",[new e.WebrpcMethodInfo(n.EngineControl,r.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.EngineControl,r.version,"version",!0),new e.WebrpcMethodInfo(n.EngineControl,r.feature_flags,"feature_flags",!0),new e.WebrpcMethodInfo(n.EngineControl,r.version_info,"version_info",!0,t.FEATURE_ms_teams_desktop_sharing),new e.WebrpcMethodInfo(n.EngineControl,r.osinfo,"osinfo",!0,t.FEATURE_ms_teams_osinfo),new e.WebrpcMethodInfo(n.EngineControl,r.endpoint_id,"endpoint_id",!0,t.FEATURE_ms_teams_endpoint_id),new e.WebrpcMethodInfo(n.EngineControl,r.set_client_info,"set_client_info",!1,t.FEATURE_ms_teams_client_info),new e.WebrpcMethodInfo(n.EngineControl,r.hardware_info,"hardware_info",!0,t.FEATURE_ms_teams_hardware_info)]),new e.WebrpcClassInfo(n.RTCPeerConnection,"RTCPeerConnection",[new e.WebrpcMethodInfo(n.RTCPeerConnection,i.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.localDescription,"localDescription",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.remoteDescription,"remoteDescription",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.readyState,"readyState",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.iceState,"iceState",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.localStreams,"localStreams",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.remoteStreams,"remoteStreams",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.createOffer,"createOffer",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.createAnswer,"createAnswer",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.setLocalDescription,"setLocalDescription",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.setRemoteDescription,"setRemoteDescription",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.updateIce,"updateIce",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.addIceCandidate,"addIceCandidate",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.addStream,"addStream",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.removeStream,"removeStream",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.close,"close",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.iceConnectionState,"iceConnectionState",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.iceGatheringState,"iceGatheringState",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.signalingState,"signalingState",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onaddstream,"onaddstream",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onicecandidate,"onicecandidate",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onicegatheringstatechange,"onicegatheringstatechange",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onsignalingstatechange,"onsignalingstatechange",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onnegotiationneeded,"onnegotiationneeded",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onremovestream,"onremovestream",!0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.getStats,"getStats",!1),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.getReceivers,"getReceivers",!1,t.FEATURE_ms_teams_speaking_indicator),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.getSenders,"getSenders",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.addTrack,"addTrack",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.removeTrack,"removeTrack",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.ontrack,"ontrack",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.setLocalDescription_v2,"setLocalDescription_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.setRemoteDescription_v2,"setRemoteDescription_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.addTransceiverWithTrack,"addTransceiverWithTrack",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.addTransceiverWithKind,"addTransceiverWithKind",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.getTransceivers,"getTransceivers",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.onconnectionstatechange,"onconnectionstatechange",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.sctp,"sctp",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.ondatachannel,"ondatachannel",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.createDataChannel,"createDataChannel",!1,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCPeerConnection,i.getStats_v2,"getStats_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new e.WebrpcClassInfo(n.RTCSessionDescription,"RTCSessionDescription",[new e.WebrpcMethodInfo(n.RTCSessionDescription,s.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.RTCSessionDescription,s.type,"type",!0),new e.WebrpcMethodInfo(n.RTCSessionDescription,s.sdp,"sdp",!0)]),new e.WebrpcClassInfo(n.RTCIceCandidate,"RTCIceCandidate",[new e.WebrpcMethodInfo(n.RTCIceCandidate,u.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.RTCIceCandidate,u.candidate,"candidate",!0),new e.WebrpcMethodInfo(n.RTCIceCandidate,u.sdpMid,"sdpMid",!0),new e.WebrpcMethodInfo(n.RTCIceCandidate,u.sdpMLineIndex,"sdpMLineIndex",!0)]),new e.WebrpcClassInfo(n.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new e.WebrpcMethodInfo(n.RTCIceCandidateEvent,f.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.RTCIceCandidateEvent,f.candidate,"candidate",!0)]),new e.WebrpcClassInfo(n.MediaDevices,"MediaDevices",[new e.WebrpcMethodInfo(n.MediaDevices,o.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.MediaDevices,o.enumerateDevices,"enumerateDevices",!1),new e.WebrpcMethodInfo(n.MediaDevices,o.getDisplayMedia,"getDisplayMedia",!1,t.FEATURE_ms_teams_desktop_sharing),new e.WebrpcMethodInfo(n.MediaDevices,o.ondevicechange,"ondevicechange",!0,t.FEATURE_ms_teams_speaking_indicator),new e.WebrpcMethodInfo(n.MediaDevices,o.enumerateDevicesV2,"enuerateDevicesV2",!1,t.FEATURE_ms_teams_enumerate_devices_v2)]),new e.WebrpcClassInfo(n.MediaDeviceInfo,"MediaDeviceInfo",[new e.WebrpcMethodInfo(n.MediaDeviceInfo,a.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.MediaDeviceInfo,a.deviceId,"deviceId",!0),new e.WebrpcMethodInfo(n.MediaDeviceInfo,a.kind,"kind",!0),new e.WebrpcMethodInfo(n.MediaDeviceInfo,a.label,"label",!0),new e.WebrpcMethodInfo(n.MediaDeviceInfo,a.groupId,"groupId",!0)]),new e.WebrpcClassInfo(n.MediaStreamTrack,"MediaStreamTrack",[new e.WebrpcMethodInfo(n.MediaStreamTrack,c.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.clone,"clone",!1),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.stop,"stop",!1),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.getCapabilities,"getCapabilities",!1),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.getSettings,"getSettings",!1),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.applyConstraints,"applyConstraints",!1,t.FEATURE_ms_teams_desktop_sharing),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.kind,"kind",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.id,"id",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.label,"label",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.enabled,"enabled",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.muted,"muted",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.readyState,"readyState",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.onended,"onended",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.onmute,"onmute",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.onunmute,"onunmute",!0),new e.WebrpcMethodInfo(n.MediaStreamTrack,c.getConstraints,"getConstraints",!1,t.FEATURE_ms_teams_mstrack_constraints)]),new e.WebrpcClassInfo(n.MediaStream,"MediaStream",[new e.WebrpcMethodInfo(n.MediaStream,d.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.MediaStream,d.id,"id",!0),new e.WebrpcMethodInfo(n.MediaStream,d.getAudioTracks,"getAudioTracks",!1),new e.WebrpcMethodInfo(n.MediaStream,d.getVideoTracks,"getVideoTracks",!1),new e.WebrpcMethodInfo(n.MediaStream,d.getTracks,"getTracks",!1),new e.WebrpcMethodInfo(n.MediaStream,d.getTrackById,"getTrackById",!1),new e.WebrpcMethodInfo(n.MediaStream,d.addTrack,"addTrack",!1),new e.WebrpcMethodInfo(n.MediaStream,d.removeTrack,"removeTrack",!1),new e.WebrpcMethodInfo(n.MediaStream,d.clone,"clone",!0),new e.WebrpcMethodInfo(n.MediaStream,d.active,"active",!0)]),new e.WebrpcClassInfo(n.NavigatorUserMedia,"NavigatorUserMedia",[new e.WebrpcMethodInfo(n.NavigatorUserMedia,l.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.NavigatorUserMedia,l.getUserMedia,"getUserMedia",!1),new e.WebrpcMethodInfo(n.NavigatorUserMedia,l.setCodecCapabilities,"setCodecCapabilities",!1,t.FEATURE_ms_teams_codec_capability),new e.WebrpcMethodInfo(n.NavigatorUserMedia,l.getCapabilities,"getRtpCapabilities",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new e.WebrpcClassInfo(n.MediaStreamEvent,"MediaStreamEvent",[new e.WebrpcMethodInfo(n.MediaStreamEvent,h.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.MediaStreamEvent,h.stream,"stream",!0)]),new e.WebrpcClassInfo(n.VideoElement,"VideoElement",[new e.WebrpcMethodInfo(n.VideoElement,p.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.VideoElement,p.sinkId,"sinkId",!0),new e.WebrpcMethodInfo(n.VideoElement,p.connectTo,"connectTo",!1),new e.WebrpcMethodInfo(n.VideoElement,p.disconnect,"disconnect",!1),new e.WebrpcMethodInfo(n.VideoElement,p.setFrame,"setFrame",!1),new e.WebrpcMethodInfo(n.VideoElement,p.addClipRect,"addClipRect",!1),new e.WebrpcMethodInfo(n.VideoElement,p.removeClipRect,"removeClipRect",!1),new e.WebrpcMethodInfo(n.VideoElement,p.onerror,"onerror",!0),new e.WebrpcMethodInfo(n.VideoElement,p.onvideoframechanged,"onvideoframechanged",!0),new e.WebrpcMethodInfo(n.VideoElement,p.placement,"placement",!0,t.FEATURE_ms_teams_video_placement)]),new e.WebrpcClassInfo(n.AudioElement,"AudioElement",[new e.WebrpcMethodInfo(n.AudioElement,_.ctor,"ctor",!1),new e.WebrpcMethodInfo(n.AudioElement,_.sinkId,"sinkId",!0),new e.WebrpcMethodInfo(n.AudioElement,_.srcObject,"srcObject",!0),new e.WebrpcMethodInfo(n.AudioElement,_.src,"src",!0),new e.WebrpcMethodInfo(n.AudioElement,_.play,"play",!1),new e.WebrpcMethodInfo(n.AudioElement,_.pause,"pause",!1),new e.WebrpcMethodInfo(n.AudioElement,_.loop,"loop",!0,t.FEATURE_ms_teams_audio_notifications_loop)]),new e.WebrpcClassInfo(n.RTCRtpReceiver,"RTCRtpReceiver",[new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.ctor,"ctor",!1,t.FEATURE_ms_teams_speaking_indicator),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.track,"track",!0,t.FEATURE_ms_teams_speaking_indicator),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getContributingSources,"getContributingSources",!1,t.FEATURE_ms_teams_speaking_indicator),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getSynchronizationSources,"getSynchronizationSources",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.rtcpTransport,"rtcptransport",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpReceiver,g.getCapabilities_v2,"getCapabilities_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new e.WebrpcClassInfo(n.RTCRtpSender,"RTCRtpSender",[new e.WebrpcMethodInfo(n.RTCRtpSender,m.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.track,"track",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.rtcpTransport,"rtcpTransport",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.dtmf,"dtmf",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.setParameters,"setParameters",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.replaceTrack,"replaceTrack",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.setStreams,"setStreams",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCRtpSender,m.getCapabilities_v2,"getCapabilities_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new e.WebrpcClassInfo(n.RTCDtlsTransport,"RTCDtlsTransport",[new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.state,"state",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.getRemoteCertificates,"getRemoteCertificates",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDtlsTransport,v.onerror,"onerror",!0,t.FEATURE_ms_teams_pstn)]),new e.WebrpcClassInfo(n.RTCIceTransport,"RTCIceTransport",[new e.WebrpcMethodInfo(n.RTCIceTransport,y.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.role,"role",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.component,"component",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.state,"state",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.gatheringState,"gatheringState",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.localcandidates,"localcandidates",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.remotecandidates,"remotecandidates",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.ongatheringstatechange,"ongatheringstatechange",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceTransport,y.onselectedcandidatepairchange,"onselectedcandidatepairchange",!0,t.FEATURE_ms_teams_pstn)]),new e.WebrpcClassInfo(n.RTCDTMFSender,"RTCDTMFSender",[new e.WebrpcMethodInfo(n.RTCDTMFSender,b.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFSender,b.insertDTMF,"insertDTMF",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFSender,b.ontonechange,"ontonechange",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFSender,b.canInsertDTMF,"canInsertDTMF",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFSender,b.toneBuffer,"toneBuffer",!0,t.FEATURE_ms_teams_pstn)]),new e.WebrpcClassInfo(n.RTCDTMFToneChangeEvent,"RTCDTMFToneChangeEvent",[new e.WebrpcMethodInfo(n.RTCDTMFToneChangeEvent,C.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFToneChangeEvent,C.tone,"tone",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCDTMFToneChangeEvent,C.tone_buffer,"tone_buffer",!0,t.FEATURE_ms_teams_pstn)]),new e.WebrpcClassInfo(n.RTCIceCandidatePair,"RTCIceCandidatePair",[new e.WebrpcMethodInfo(n.RTCIceCandidatePair,S.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceCandidatePair,S.local,"local",!0,t.FEATURE_ms_teams_pstn),new e.WebrpcMethodInfo(n.RTCIceCandidatePair,S.remote,"remote",!0,t.FEATURE_ms_teams_pstn)]),new e.WebrpcClassInfo(n.RTCRtpTransceiver,"RTCRtpTransceiver",[new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.ctor,"ctor",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.mid,"mid",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.sender,"sender",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.receiver,"receiver",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.direction,"direction",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.currentDirection,"currentDirection",!0,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.stop,"stop",!1,t.FEATURE_ms_teams_webrtc_1dot0),new e.WebrpcMethodInfo(n.RTCRtpTransceiver,E.setCodecPreferences,"setCodecPreferences",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new e.WebrpcClassInfo(n.ScreenSharingRemote,"ScreenSharingRemote",[new e.WebrpcMethodInfo(n.ScreenSharingRemote,R.ctor,"ctor",!1,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSharingRemote,R.getScreensAsync,"getScreensAsync",!1,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSharingRemote,R.onscreentopologychanged,"onscreentopologychanged",!0,t.FEATURE_ms_teams_monitor_sharing)]),new e.WebrpcClassInfo(n.ScreenSource,"ScreenSource",[new e.WebrpcMethodInfo(n.ScreenSource,T.ctor,"ctor",!1,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.srcid,"srcid",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.deviceid,"deviceid",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.type,"type",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.name,"name",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.imagedata,"imagedata",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.hwnd,"hwnd",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.origin,"origin",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.caption,"caption",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.pid,"pid",!0,t.FEATURE_ms_teams_monitor_sharing),new e.WebrpcMethodInfo(n.ScreenSource,T.bounds,"bounds",!0,t.FEATURE_ms_teams_gtc)]),new e.WebrpcClassInfo(n.E911Service,"E911Service",[new e.WebrpcMethodInfo(n.E911Service,w.ctor,"ctor",!1,t.FEATURE_ms_teams_e911),new e.WebrpcMethodInfo(n.E911Service,w.getE911Info,"getE911Info",!1,t.FEATURE_ms_teams_e911),new e.WebrpcMethodInfo(n.E911Service,w.onupdate,"onupdate",!0,t.FEATURE_ms_teams_e911)]),new e.WebrpcClassInfo(n.RTCDataChannel,"RTCDataChannel",[new e.WebrpcMethodInfo(n.RTCDataChannel,k.ctor,"ctor",!1,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.label,"label",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.ordered,"ordered",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.maxPacketLifeTime,"maxPacketLifeTime",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.maxRetransmits,"maxRetransmits",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.protocol,"protocol",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.negotiated,"negotiated",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.id,"id",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.readyState,"readyState",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.bufferedAmount,"bufferedAmount",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.bufferedAmountLowThreshold,"bufferedAmountLowThreshold",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onopen,"onopen",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onbufferedamountlow,"onbufferedamountlow",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onerror,"onerror",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onclosing,"onclosing",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onclose,"onclose",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.onmessage,"onmessage",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.close,"close",!1,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.send_text,"send_text",!1,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCDataChannel,k.send_binary,"send_binary",!1,t.FEATURE_ms_teams_data_channel)]),new e.WebrpcClassInfo(n.RTCSctpTransport,"RTCSctpTransport",[new e.WebrpcMethodInfo(n.RTCSctpTransport,I.ctor,"ctor",!1,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCSctpTransport,I.transport,"transport",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCSctpTransport,I.state,"state",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCSctpTransport,I.maxMessageSize,"maxMessageSize",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCSctpTransport,I.maxChannels,"maxChannels",!0,t.FEATURE_ms_teams_data_channel),new e.WebrpcMethodInfo(n.RTCSctpTransport,I.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_data_channel)]),new e.WebrpcClassInfo(n.StreamResolution,"StreamResolution",[new e.WebrpcMethodInfo(n.StreamResolution,P.ctor,"ctor",!1,t.FEATURE_ms_teams_stream_resolution),new e.WebrpcMethodInfo(n.StreamResolution,P.getCallConstraints,"getCallConstraints",!1,t.FEATURE_ms_teams_stream_resolution),new e.WebrpcMethodInfo(n.StreamResolution,P.onupdate,"onupdate",!0,t.FEATURE_ms_teams_stream_resolution)])])},545:function(e,t,n){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;e=Array(e);var r=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,r++)e[r]=i[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.WsJsonUtil=t.ws_msg_type_t=void 0;var i,o=n(550);!function(e){e[e.req=0]="req",e[e.reply=1]="reply",e[e.event_req=2]="event_req",e[e.event_reply=3]="event_reply"}(i=t.ws_msg_type_t||(t.ws_msg_type_t={})),e=function(){function e(){}return e.createMessageByid=function(e,t,n,i,a,s){for(var c=[],d=6;d<arguments.length;d++)c[d-6]=arguments[d];return(d=o.WebrpcClassLibInfoUtil.getMethodByid(i,a))&&d.isprop||(e=!1),this.createMessage.apply(this,r([n,e,t,i,a,s],c))},e.createMessage=function(e,t,n,i,o,a){for(var s=[],c=6;c<arguments.length;c++)s[c-6]=arguments[c];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(e),modifier:t,destroy:n,proc:{iid:i,methodid:o}},objref:{oid:a},params:r(s)}},e.getMsgType=function(e){var t="";switch(e){default:t="req";break;case i.reply:t="reply";break;case i.event_req:t="event-req";break;case i.event_reply:t="event-reply"}return t},e._version=1,e}(),t.WsJsonUtil=e}},t={};return function n(r){var i=t[r];return void 0!==i?i.exports:(i=t[r]={exports:{}},e[r].call(i.exports,i,i.exports,n),i.exports)}(307)}()},"object"==typeof n&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof n?n.CitrixWebRTC=i():r.CitrixWebRTC=i()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){var r;r=function(e,t){"use strict";var n={createInstance:30,createInstanceResult:31,newVideoElement:32,removeVideoElement:33,updateVideoElement:34,newFrame:36,removeFrame:37,version:40,enumDevices:41,enumVideoDevice:42,createPeerConnection:43,createOffer:44,createAnswer:45,setLocalDescription:46,setRemoteDescription:47,addIceCandidate:48,addStream:49,getLocalStreams:50,getStats:51,removeStream:52,close:53,getUserMediaShim:54,mediaTrkStop:55,trackEnabled:56,newAudioElement:57,setSinkId:58,updateSrcObject:59,notifyAudio:60,mediaStreamClone:61,mediaTrackClone:62,getDisplayMediaShim:63,setDefaultSinkId:64,shimLogToWebSocket:65,insertDTMF:66,getReceivers:67,customClipRect:69,applyConstraints:70,getScreens:71,setScreenId:72,addTrack:74,removeTrack:75,senderCmd:76,createMediaStream:77,connectedStateChanged:78,updateObjectFit:79,transceiverCmd:300,dataChannelCmd:301,dataChannelEvent:302,getHWND:309,pcCmd:310},r={ERROR:0,WARN:1,INFO:2,DEBUG:3},i=2,o=0,a=1,s=2,c={DURATION:100,INTERTONEGAP:70},d="unified-plan",l={TRANSCEIVER_ADD_TRANSCEIVER:1,TRANSCEIVER_SET_CODECPREFERENCE:2,TRANSCEIVER_STOP:3,TRANSCEIVER_SET_DIRECTION:4},u=0,f={RPF_ACTIVE:1,RPF_CODEPAYLOADTYPE:2,RPF_DTX:4,RPF_MAXBITRATE:8,RPF_MAXFRAMERATE:16,RPF_PTIME:32,RPF_RID:64,RPF_SCALE_RESOLUTION_DOWNBY:128},h=0,p=1,_=0,g=1,m=4,v=32,y=2,b="52406081",C="1.0.",S=(C+="@"===b[0]?"00000":b,{UNSUPPORTED:"unsupported",CHROME:"chrome",CHROMIUM_EDGE:"chromium_edge",ELECTRON:"electron"}),E=1,R=2;const T="0";function w(e){setTimeout(e,0)}function k(e){if(!e||!e.ownerDocument)return 1;if((t=e.ownerDocument.defaultView)&&"function"==typeof t.getZoomFactor)return t.getZoomFactor(e);var{innerWidth:e,outerWidth:t}=t;if(0===e)return t;var n=document.body&&document.body.clientWidth?document.body.clientWidth:e;let r,i;return oe==S.ELECTRON?r=Math.round((t-(e-n))/e*1e3)/1e3:oe==S.CHROME||oe==S.CHROMIUM_EDGE?(i=ce(r=(t-8)/e*100),Math.round(i||r)/100):1}function I(e){var t;ee.multiwindow&&Y?(t=se(e))?te[t]?ae.debug("ensureFrame skipped due to frame already registered."):(Y.send({cmd:"newFrame",frame:t,browser:oe,customClipRect:1},-1),te[t]=e):ae.debug("ensureFrame skipped due to no frameWnd"):ae.debug("ensureFrame skipped due to feature not enabled or no connection.")}var P,A=-1,M=-1,D=-1,O=0,x=0,N=0,U=0,j=0,F=0,L={},V={},W={},B={},H={},z=window.navigator.mediaDevices.enumerateDevices,G=null,q={},J={},K={},Z={},Y=null,X=null,$=[],Q=[],ee={},te={},ne={},re={},ie=[],oe=0<navigator.userAgent.indexOf("Electron")?S.ELECTRON:0<navigator.userAgent.indexOf("Chrome")?0<navigator.userAgent.indexOf("Edg")?S.CHROMIUM_EDGE:S.CHROME:S.UNSUPPORTED,ae={logLevel:r.DEBUG,websocketlogLevel:r.INFO,logToConsole:!0,updateLogLevel:function(e,t){ae.logLevel=e,ae.websocketlogLevel=t},error:function(e){ae.log("ERROR",e),X&&"function"==typeof X.error&&X.error(e)},warn:function(e){ae.log("WARN",e),X&&"function"==typeof X.warn&&X.warn(e)},info:function(e){ae.log("INFO",e),X&&"function"==typeof X.info&&X.info(e)},debug:function(e){ae.log("DEBUG",e)},log:function(e,t){try{r[e]<=ae.logLevel&&(ae.logToConsole&&console&&("object"==typeof t?console.log(t):console.log(e+": "+t)),"string"==typeof t)&&r[e]<=ae.websocketlogLevel&&Y&&Y.sendLogToWebSocket(t,e)}catch(e){}}},se=function(e){return e},ce=function(e){for(var t=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500],n=0;n<t.length;n++){var r=t[n],i=.05*r;if(Math.abs(r-e)<i)return r}};function de(e,t,n){var r,i,o="_id#",a=e.indexOf(t);return-1==a?e+t+"1"+o+n:(r=e.substring(0,a),i=e.indexOf(o,a+t.length),e=Number(e.substring(a+t.length,i)),r+t+((e=isNaN(e)?0:e)+1)+o+n)}function le(e,t){function n(){return 1<=arguments.length&&"function"==typeof arguments[0]}function r(){return 2<=arguments.length&&"function"==typeof arguments[1]}function i(e,t,n,r){return new Promise(function(i,o){var a=new DOMException("createOffer cancelled","OperationError"),s=new DOMException("The RTCPeerConnection is closed","InvalidStateError"),c=e?i:n,d=e?o:r;Y.send({cmd:"createOffer",options:t},f.id,function(e){V[f.id]?void 0===e.error?(ae.debug("createOffer done"),ae.debug(e.desc),e.transceivers&&b(e.transceivers),c(e.desc)):d(a):d(s)})})}function o(e,t,n,r){return new Promise(function(i,o){var a=new DOMException("createAnswer cancelled","OperationError"),s=new DOMException("The RTCPeerConnection is closed","InvalidStateError"),c=e?i:n,d=e?o:r;Y.send({cmd:"createAnswer",options:t},f.id,function(e){V[f.id]?void 0===e.error?(ae.debug("createAnswer done"),ae.debug(e.desc),e.transceivers&&b(e.transceivers),c(e.desc)):d(a):d(s)})})}function a(e,t,n,r){return f._remoteDescription=t,new Promise(function(i,o){var a=new DOMException("setRemoteDescription cancelled","OperationError"),s=new DOMException("The RTCPeerConnection is closed","InvalidStateError"),c=e?i:n,d=e?o:r;Y.send({cmd:"setRemoteDescription",desc:t},f.id,function(e){V[f.id]?void 0===e.error?(e.transceivers&&b(e.transceivers,e.transceiversRemoved),c()):d(a):d(s)})})}function s(e,t,n,r){return f._localDescription=t,new Promise(function(i,o){var a=new DOMException("setLocalDescription cancelled","OperationError"),s=new DOMException("The RTCPeerConnection is closed","InvalidStateError"),c=e?i:n,d=e?o:r;Y.send({cmd:"setLocalDescription",desc:t},f.id,function(e){V[f.id]?void 0===e.error?(e.transceivers&&b(e.transceivers,e.transceiversRemoved),c()):d(a):d(s)})})}function c(e,t,n,r){return new Promise(function(i,o){var a=new DOMException("addIceCandidate cancelled","OperationError"),s=new DOMException("The RTCPeerConnection is closed","InvalidStateError"),c=e?i:n,d=e?o:r;Y.send({cmd:"addIceCandidate",candidate:t},f.id,function(e){V[f.id]?void 0===e.error?c():d(a):d(s)})})}function u(e,t){return new Promise(function(n,r){new DOMException("getStats cancelled","InvalidAccessError");var i=e?n:t;n={cmd:"getStats"};e==g&&(n.capability=m),Y.send(n,f.id,function(t){var n;"function"==typeof i&&(void 0===t.error&&void 0!==t.stats&&void 0!==V[f.id]?e==g?i(t.stats):((n=new function(){this.reports=[],this.result=function(){return this.reports},this._create=function(e){var t=this;e.forEach(function(e){var n=new ye;n._create(e),t.reports.push(n)})}})._create(t.stats),i(n)):i({}))})})}var f=this,h={},p={},v={},y=!1,b=(this.id=++D,this._localStreams=[],this._remoteStreams=[],this._dataChannelMap={},this._dataChannelIdToShimIdMap={},this._iceConnectionState="new",e&&e.sdpSemantics===d&&(y=!0),this.isUnifiedPlan=function(){return y},Object.defineProperty(this,"iceConnectionState",{get:function(){return ae.debug("get iceConnectionState:"+this._iceConnectionState),this._iceConnectionState},configurable:!0}),this._iceGatheringState="new",Object.defineProperty(this,"iceGatheringState",{get:function(){return ae.debug("get iceGatheringState:"+this._iceGatheringState),this._iceGatheringState},configurable:!0}),this._signalingState="stable",Object.defineProperty(this,"signalingState",{get:function(){return ae.debug("get signalingState:"+this._signalingState),this._signalingState},configurable:!0}),this._connectionState="new",ee.connectionState&&Object.defineProperty(this,"connectionState",{get:function(){return ae.debug("get connectionState:"+this._connectionState),this._connectionState},configurable:!0}),this._localDescription=null,Object.defineProperty(this,"localDescription",{get:function(){return ae.debug("get localDescription:"+this._localDescription),this._localDescription},configurable:!0}),this._remoteDescription=null,Object.defineProperty(this,"remoteDescription",{get:function(){return ae.debug("get remoteDescription:"+this._remoteDescription),this._remoteDescription},configurable:!0}),this.cleanUp=function(){var e,t;"complete"!==this._iceGatheringState&&(t={type:"icecandidate",candidate:null,target:this},this.onicecandidate&&this.onicecandidate(t),this._iceGatheringState="complete",e={type:"icegatheringstatechange",target:this},this.onicegatheringstatechange)&&this.onicegatheringstatechange(e),"disconnected"!=this._iceConnectionState&&(this._iceConnectionState="disconnected",t={type:"iceconnectionstatechange",target:this},this.oniceconnectionstatechange)&&this.oniceconnectionstatechange(t),this._localStreams=[],this._remoteStreams=[]},this.createOfferV0=function(e,t,n){i(_,n,e,t)},this.createOfferV1=function(){return n.apply(null,arguments)?this.createOfferV0.apply(this,arguments):i(g,arguments[0])},this.createAnswerV0=function(e,t,n){o(_,n,e,t)},this.createAnswerV1=function(){return n.apply(null,arguments)?this.createAnswerV0.apply(this,arguments):o(g,arguments[0])},this.setRemoteDescriptionV0=function(e,t,n){a(_,e,t,n)},this.setRemoteDescriptionV1=function(){return r.apply(null,arguments)?this.setRemoteDescriptionV0.apply(this,arguments):a(g,arguments[0])},this.setLocalDescriptionV0=function(e,t,n){s(_,e,t,n)},this.setLocalDescriptionV1=function(){return r.apply(null,arguments)?this.setLocalDescriptionV0.apply(this,arguments):s(g,arguments[0])},this.addIceCandidateV0=function(e,t,n){c(_,e,t,n)},this.addIceCandidateV1=function(){return r.apply(null,arguments)?this.addIceCandidateV0.apply(this,arugments):c(g,arguments[0])},this.createDTMFSender=function(e){var t;return"audio"!==e.kind?(ae.error("DTMF only could be associated with audio track."),null):((t=new ue).initPlanB(f.id,e),H[e.id]=t)},this.getStatsV0=function(e){return u(_,e)},this.getStatsV1=function(){return n.apply(null,arguments)?this.getStatsV0.apply(this,arguments):u(g)},this.getLocalStreams=function(){return y?(ae.warn("getLocalStreams is not supported in the unified plan, use getSenders()"),[]):(ae.debug("getLocalStreams():"+this._localStreams.length),this._localStreams)},this.getRemoteStreams=function(){return y?(ae.warn("getRemoteStreams is not supported in the unified plan, use getReceivers()"),[]):(ae.debug("getRemoteStreams():"+this._remoteStreams.length),this._remoteStreams)},this.addStream=function(e){this._localStreams.push(e),Y.send({cmd:"addStream",sid:e.id},f.id)},this.removeStream=function(e){ae.debug("RTCPeerConnection.removeStream(): "+e.id);var t=this._localStreams.indexOf(e);-1!=t?this._localStreams.splice(t,1):ae.error("RTCPeerConnection.removeStream(): Failed to find stream: "+e.id),Y.send({cmd:"removeStream",sid:e.id},f.id)},this.addTrackImplV1=function(e,t){var n,r;if(e&&t)return y?((n=new fe(f)).initTrackOrKind(e),(r=(v[n.id]=n).sender).setTrack(e,t),Y.send({cmd:"addTrack",transceiverId:n.id,tid:e.id,sid:t.id},f.id,function(e){void 0===e.error?b(e.transceivers):delete v[n.id]})):(r=p[e.id])?ae.warn("RTCPeerConnection.addTrack: sender already exists."):((r=new Ce(f)).initPlanB(e,t),p[r.id]=r,Y.send({cmd:"addTrack",transceiverId:"",tid:e.id,sid:t.id},f.id,function(e){void 0!==e.error&&delete p[r.id]})),r;throw new Error("both media track and stream need to be provided")},this.removeTrackImplV1=function(e){e?void 0===e._cap?ae.error("sender object doesn't have the capability bits"):e.id?(e.removeTrack(),y||delete p[e.id]):ae.error("RTCPeerConnection.removeTrack: not a valid sender object"):ae.error("RTCPeerConnection.removeTrack: invalid sender.")},this.getSendersImplV1=function(){ae.debug("RTCPeerConnection.getSendersImplV1");var e=[];if(y)for(var t in v){var n=v[t].sender;n&&e.push(n)}else for(var t in p)p[t]&&e.push(p[t]);return e},this.getTranceiversImplV1=function(){ae.debug("RTCPeerConnection.getTranceiversImplV1");var e,t=[];for(e in v)ae.debug("RTCPeerConnection.getTranceiversImplV1 id="+e),t.push(v[e]);return t},this.addTransceiverImplV1=function(e,t){var n=new fe(f),r=(n.initTrackOrKind(e,t),v[n.id]=n,{cmd:"transceiverCmd",transceiverCmd:l.TRANSCEIVER_ADD_TRANSCEIVER,hint:"RTCRtpTransceiver.addTransceiver",transceiverId:n.id});if("audio"===e||"video"===e)r.trackOrKind=e;else{if(!(e instanceof ve))return ae.error("addTranceiver: Unknown type"),null;ae.debug("addTranceiver with track is not Implemented"),r.trackOrKind=e.id}if(e={},t.direction&&(e.direction=t.direction),t.sendEncodings&&(e.sendEncodings=t.sendEncodings),t.streams){for(var i in streamIds=[],t.streams)streamIds.push(i.id);e.streams=streamIds}return r.init=e,Y.send(r,f.id,function(e){void 0===e.error&&b(e.transceivers)}),n},this.createDataChannelImplV1=function(e,t){var n,r;return ae.debug("RTCPeerConnection.createDataChannel: "+e+" option: "+JSON.stringify(this.options)),e?(n=++F,(r=new ge(f.id,n))._createChannel(e,t),f._dataChannelMap[n]=r):(ae.error("RTCPeerConnection.createDataChannel: missing label"),null)},this._untrackDataChannel=function(e,t){void 0!==t&&f._dataChannelMap[t]&&(ae.debug("Untrack datachannel: "+e+" shimId: "+t),delete f._dataChannelMap[t]),e!=M&&f._dataChannelIdToShimIdMap[e]&&(ae.debug("Remove mapped datachannel: "+e+" shimId:"+t),delete f._dataChannelIdToShimIdMap[e])},function(e,t){for(var n in e){var r,i=e[n],o=v[i.id];(o||(o=i.id,ae.debug("_updateTransceivers: addTransceiver id="+o),(r=new fe(f)).initId(o),v[o]=r)).update(i)}if(t)for(var n in t){var a=t[n];ae.debug("_updateTransceivers: removeTransceiver id="+a),delete v[a]}}),C=(this.close=function(){C=null,Y.send({cmd:"close"},f.id,function(e){delete V[f.id]},!0)},null);this.getReceivers=function(){if(y){var e=[];if(v)for(var t in v){var n=v[t].receiver;n&&e.push(n)}}else for(t in C||(C={},Y.send({cmd:"getReceivers"},f.id,function(e){},!0)),e=[],C)C[t]&&e.push(C[t]);return e},this.addEventListener=function(e,t){ae.debug("RTCPeerConnection.addEventListener(): "+e),"function"!=typeof t?ae.error("RTCPeerConnection.addEventListener(): The listener handler is invalid."):"string"!=typeof e?ae.error("RTCPeerConnection.addEventListener(): The event name is invalid."):(void 0===h[e]&&(h[event]={listeners:[]}),h[e].listeners.push(t))},this.removeEventListener=function(e,t){ae.debug("RTCPeerConnection.removeEventListener(): "+e),void 0===h[e]?ae.error("RTCPeerConnection.removeEventListener(): Event does not exist = "+e):h[e].listeners=h[e].listeners.filter(function(e){return e.toString()!==t.toString()})},this._onReceiveDataChannelEvent=function(e){var t;void 0===e.shimId?ae.error("RTCPeerConnection._onReceiveDataChannelEvent: missing shimId"):((t=e.shimId)==M&&e.channel&&void 0!==e.channel.id&&(ae.debug("Try to find mapped "+e.channel.id+" in:"+JSON.stringify(f._dataChannelIdToShimIdMap)),void 0!==f._dataChannelIdToShimIdMap[e.channel.id])&&(t=f._dataChannelIdToShimIdMap[e.channel.id],ae.debug("RTCPeerConnection._onReceiveDataChannelEvent: use mapped shimId: "+t)),t!=M&&f._dataChannelMap[t]?f._dataChannelMap[t]._onReceiveEvent(e):ae.error("RTCPeerConnection._onReceiveDataChannelEvent: dataChannle "+t+" not existed"))},this._onReceiveEvent=function(e){if(void 0===e||void 0===e.evt)ae.error("_onReceiveEvent(): evt property is invalid.");else{var t={type:e.evt,target:this};switch(e.details&&this._updateVars(e.details),e.evt){case"connectionstatechange":this.onconnectionstatechange&&this.onconnectionstatechange(t);break;case"negotiationneeded":this.onnegotiationneeded&&this.onnegotiationneeded(t);break;case"icecandidate":t.candidate=e.candidate,this.onicecandidate&&this.onicecandidate(t);break;case"icegatheringstatechange":this.onicegatheringstatechange&&this.onicegatheringstatechange(t);break;case"iceconnectionstatechange":this.oniceconnectionstatechange&&this.oniceconnectionstatechange(t);break;case"signalingstatechange":this.onsignalingstatechange&&this.onsignalingstatechange(t);break;case"ondatachannel":e.channel?this.ondatachannel&&(i=++F,o=new ge(f.id,i),void 0!==e.channel.id&&(ae.debug("ondatachannel shimId: "+e.channel.id+" mapped to "+i),f._dataChannelIdToShimIdMap[e.channel.id]=i),(f._dataChannelMap[i]=o)._updateChannel(e.channel),t.channel=o,ae.debug("ondatachannel shimId: "+i+" channel:"+JSON.stringify(e.channel)),this.ondatachannel(t)):ae.warn("ondatachannel from legacy client");break;case"addStream":void 0===e.stream?ae.debug("_onReceiveEvent(): stream property is invalid."):(t.stream=new me,t.stream._create(e.stream,e.peer),this._remoteStreams.push(t.stream),this.onaddstream&&this.onaddstream(t));break;case"removeStream":void 0===e.stream?ae.debug("_onReceiveEvent(): stream property is invalid."):(t.stream=B[e.stream],void 0===t.stream?ae.debug("_onReceiveEvent(): no stream found."):(-1!=(o=this._remoteStreams.indexOf(t.stream))&&(e.trackId&&t.stream.removeTrackById(e.trackId),this._remoteStreams.splice(o,1)),this.onremovestream&&this.onremovestream(t)));break;case"ontrack":void 0===e.transceiver||void 0===e.stream?ae.error("_onReceiveEvent ontrack property is invalid"):(n=e.transceiver.id,(r=v[n])||(ae.debug("ontrack: add transceiver id="+n),(r=new fe(f)).initId(n),v[n]=r),r.update(e.transceiver),(i=new me)._create(e.stream,e.peer),this._remoteStreams.push(i),t.transceiver=r,t.receiver=r.receiver,t.streams=[i],t.track=i.track[0],this.ontrack&&this.ontrack(t));break;case"tonechange":var n,r,i,o=null;(o=y?(n=e.transceiverId,(i=(r=v?v[n]:null)?r.sender:null)?i.dtmf:null):H[e.tid])?o.ontonechange&&o.ontonechange(e):ae.debug("_onReceiveEvent(): tonechange, dtmfId is invalid  or not found.");break;case"onreceivers":(n=e.receivers)&&n.forEach(function(e){var t,n;e.id&&(t=e.id,"-"===e.op?delete C[t]:("+"===e.op&&delete C[t],(n=C[t])||(n=new be,C[t]=n),n.update(e)))});break;case"onsenders":(r=e.senders)&&r.forEach(function(e){var t=p[e.id];t&&t.update(e)});break;case"ontransceivers":b(e.transceivers)}}},this._updateVars=function(e){e.iceConnectionState&&(this._iceConnectionState=e.iceConnectionState),e.iceGatheringState&&(this._iceGatheringState=e.iceGatheringState),e.signalingState&&(this._signalingState=e.signalingState),e.connectionState&&(this._connectionState=e.connectionState),e.localDescription&&(this._localDescription=e.localDescription),e.remoteDescription&&(this._remoteDescription=e.remoteDescription)},this.setConfigurationImpl=function(e){Y.send({cmd:"pcCmd",pcCmdId:E,hint:"peerConnection.setConfiguration",config:e},f.id,function(e){null==e.error&&e.configuration})},this.restartIceImpl=function(){Y.send({cmd:"pcCmd",pcCmdId:R,hint:"peerConnection.restartIce"},f.id)}}function ue(){this.canInsertDTMF=!0;var e=void 0,t=null,n="",r=null,i=null;this.initPlanB=function(n,r){e=n,t=r},this.initUnifiedPlan=function(n,o,a,s){o&&a?(e=n,t=s,r=o,i=a):ae.error("RTCDTMFSender.initUnifiedPlan: invalid transceiver or sender")},Object.defineProperty(this,"toneBuffer",{get:function(){return ae.debug("get DTMF tone buffer"+n),n},set:function(e){void 0===e&&ae.warn("Set RTCDTMFSender.toneBuffer to undefined."),ae.debug("set DTMF tone buffer"+e),n=e},configurable:!0}),this.insertDTMF=function(n,o,a){ae.debug("insertDTMF audio tones: "+n),void 0===o&&(ae.debug("Duration is not set, use default"),o=c.DURATION),void 0===a&&(ae.debug("Gap is not set, use default"),a=c.INTERTONEGAP),Y.send({cmd:"insertDTMF",transceiverId:r?r.id:"",senderId:i?i.id:"",tid:t.id,tones:n,duration:o,gap:a},e)}}function fe(e){function t(e){ae.info(e+"("+n+")")}var n,r=this,i=e,o="inactive",a="inactive",s=null,c=!1,d=null,u=null;this.initId=function(e){n=e,(d=new Ce(i)).initUnifiedPlan(r,null),u=new be},this.initTrackOrKind=function(e,t){var o="";"audio"===(e=e instanceof ve?e.kind:e)?o="A":"video"===e&&(o="V"),n="Transceiver#"+o+j.toString(),j++,(d=new Ce(i)).initUnifiedPlan(r,t),u=new be,t&&t.direction&&(a=t.direction),t&&t.stream&&ae.debug("RTCRtpTransceiver.init with stream is not implemented.")},this.update=function(e){e.currentDirection&&(o=e.currentDirection),e.direction&&(a=e.direction),e.mid&&(s=e.mid),void 0!==e.stopped&&(c=e.stopped),e.sender&&d&&d.update(e.sender),e.receiver&&u&&u.update(e.receiver)},Object.defineProperty(this,"id",{get:function(){return n},configurable:!0}),Object.defineProperty(this,"mid",{get:function(){return t("RTCRtpTransceiver.mid="+s),s}}),Object.defineProperty(this,"currentDirection",{get:function(){return t("RTCRtpTransceiver.currentDirection"),o},configurable:!0}),Object.defineProperty(this,"direction",{get:function(){return t("RTCRtpTransceiver.direction="+a),a},set:function(e){t("RTCRtpTransceiver.direction setter"),a=e,e={cmd:"transceiverCmd",transceiverCmd:l.TRANSCEIVER_SET_DIRECTION,hint:"RTCRtpTransceiver.direction",transceiverId:n,value:e},Y.send(e,i.id)},configurable:!0}),Object.defineProperty(this,"receiver",{get:function(){return t("RTCRtpTransceiver.receiver"),u},configurable:!0}),Object.defineProperty(this,"sender",{get:function(){return t("RTCRtpTransceiver.sender"),d},configurable:!0}),Object.defineProperty(this,"stopped",{get:function(){return t("RTCRtpTransceiver stopped"),c},set:function(e){t("RTCRtpTransceiver stopped setter"),c=e},configurable:!0}),this.setCodecPreferences=function(e){t("RTCRtpTransceiver setCodecPreferences"),Y.send({cmd:"transceiverCmd",transceiverCmd:l.TRANSCEIVER_SET_CODECPREFERENCE,hint:"RTCRtpTransceiver.setCodecPreference",transceiverId:n,codecs:e},i.id,function(e){void 0!==e.error&&t("RTCRtpTransceiver.setCodecPreferences failed.")})},this.stop=function(){t("RTCRtpTransceiver stop"),Y.send({cmd:"transceiverCmd",transceiverCmd:l.TRANSCEIVER_STOP,hint:"RTCRtpTransceiver.stop",transceiverId:n},i.id,function(e){void 0!==e.error&&t("RTCRtpTransceiver.stop failed.")})}}function he(e){"function"==typeof G?(ae.info("onVMEvent(): Fire event = "+JSON.stringify(e)),G(e)):ae.warn("onVMEvent(): setVMEventCallback is not called yet.")}function pe(){var e=this,t=null,c=o,d={},l=0,u=null,f=!1,_=void 0,g=!0,m=(Object.defineProperty(this,"state",{get:function(){return c},configurable:!0}),Object.defineProperty(this,"shortPollingIntervalMs",{get:function(){return 500}}),Object.defineProperty(this,"shortPollingTimeout",{get:function(){return 1e4}}),Object.defineProperty(this,"longPollingIntervalMs",{get:function(){return 5e3}}),Object.defineProperty(this,"isHorizonRegistryPresent",{get:function(){return f},set:function(e){f=e},configurable:!0}),Object.defineProperty(this,"sendVdiClientEventsOnError",{get:function(){return g},set:function(e){g=e},configurable:!0}),this.sendLogToWebSocket=function(e,t){return"string"==typeof e&&0!==e.length&&c===s&&(A({cmd:"shimLogToWebSocket",message:e,level:t},-1),!0)},this.isSocketConnected=function(){return c===s},this.isSocketOpen=function(){return!!t&&t.readyState===WebSocket.OPEN},this.init=function(){ae.info("RequestManager.init(): Initializing Request Manager."),this.startPolling(500,1e4,this.sendEvents)},this.startPolling=function(t,n,r){var i;ae.info("RequestManager.startPolling(): stop the old polling timer(if there is any) and start a new one"),e.stopPolling(),c!==o?ae.info("RequestManager.startPolling(): Socket state not disconnected, exiting"):(i=n,ae.info("intervalMs "+t+" timeout "+n),u=setInterval(function(){ae.info("RequestManager: connectToHorizon"),e.connectToHorizon(),void 0!==i&&(i-=t,f||e.queryHorizonRegistry()),void 0!==i&&i<=0&&(e.stopPolling(),r)&&!0===f&&r()},t))},this.stopPolling=function(){ae.info("RequestManager.stopPolling()"),null!==u&&(clearInterval(u),u=null,ae.info("Stopped polling websocket"))},this.sendEvents=function(){var e=((e={}).shimVersion=C,{event:"vdiClientConnected",version:e});try{he(e)}catch(e){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(e))}try{he({event:"vdiClientDisconnected",reason:"endpointUnsupported"})}catch(e){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(e))}Y.startPolling(5e3)},this.queryHorizonRegistry=function(){window.getHorizonClientID().then(function(e){ae.info("queryHorizonRegistry(): Horizon Client ID "+e),e&&Y&&(Y.isHorizonRegistryPresent=!0,ae.info("queryHorizonRegistry(): isHorizonRegistryPresent true"))},function(){return ae.error("queryHorizonRegistry(): Failed to query Horizon Client ID"),!1})},this.connectToHorizon=function(){c===o&&window.getHorizonWSSPort().then(function(e){"string"!=typeof e||0===e.length?(ae.error("connectToHorizon(): Port is not valid"),O("Horizon HTML5 Server port not valid")):(ae.info("connectToHorizon(): port is "+e),c=a,(t=new WebSocket("wss://view-localhost:"+e+"/")).binaryType="arraybuffer",t.onopen=E,t.onclose=R,t.onerror=k,t.onmessage=I)},function(){ae.error("connectToHorizon(): Failed to receive port number"),O("Failed to receive port number")})},function(){return new Promise(function(e,t){oe===S.ELECTRON?(ae.error("getWindowHandleByTitle: function called on unsupported browser"),t("function called on unsupported browser")):_=setInterval(function(){y(e,t,_)},500)})}),y=function(t,n,r){var i="function"==typeof window.getHorizonWindowTitle?window.getHorizonWindowTitle():document.title;void 0===i?ae.error("getWindowHandleByTitle:: cannot find the window with undefined title"):e.send({cmd:"getHWND",title:i},-1,function(e){void 0===e.error&&void 0!==e.hwnd&&e.hwnd!=T?(ae.debug("getWindowHandleByTitle: received window handle"+e.hwnd),clearInterval(r),_=void 0,t(e.hwnd)):ae.error("getWindowHandleByTitle:: cannot find the window that matches the title"+e.error)})},b=async function(e,t){e===T&&(ae.info("Start polling window from server"),e=await m()),ae.info("window handle ="+e),K.hwnd=e,window.getWindowReference=function(){return Promise.resolve(K.hwnd)},he(t)},E=function(){ae.info("onWebSocketOpen(): Websocket opened"),Y.stopPolling();var t="function"==typeof window.getHorizonWindowTitle?window.getHorizonWindowTitle():document.title;A({cmd:"createInstance",hwnd:K.hwnd,shimVersion:C,shimMinAgentVersion:1,customClipRect:1,allowFeatureChange:1,supportObjectFit:1,supportE911:0,streamBundleWithPeer:1,sdkConfig:re,appName:P,appType:i,title:t,browser:oe},-1,function(t){if(c!=o){t.uid&&ae.info("onWebSocketOpen(): ["+t.uid+"] createInstanceDone"),"true"===t.traceEnabled&&ae.updateLogLevel(r.DEBUG,r.DEBUG);var n=["agentOsVersion","clientOsVersion","haVersion","hcVersion","shimVersion","webrtcClientVer","webRTCRedirAgentVersion","webRTCRedirClientVersion"],i={};ae.logToConsole=!!t.logToConsole,ae.debug("VDI Shim: Log to console = "+ae.logToConsole),ae.debug("VDI createInstance = "+JSON.stringify(t));for(var a=0;a<n.length;a++)t[n[a]]?(i[n[a]]=t[n[a]],ae.debug("onWebSocketOpen(): "+n[a]+" = "+t[n[a]])):ae.warn("onWebSocketOpen(): Could not find property "+n[a]);t.clientOsVersion?t.clientOsVersion.startsWith("Win")?i.clientPlatform="Windows":t.clientOsVersion.startsWith("mac")?i.clientPlatform="Mac":t.clientOsVersion.startsWith("Lin")?i.clientPlatform="Linux":(ae.error("Unknown client os: "+t.clientOsVersion),i.clientPlatform="Unknown"):(ae.error("Missing client os information."),i.clientPlatform="Unknown"),ae.debug("onWebSocketOpen(): clientPlatform = "+i.clientPlatform);var d={event:"vdiClientConnected",version:i};if(t.hcId&&(d.endpointId=t.hcId,ae.debug("onWebSocketOpen(): ClientId = "+t.hcId)),"true"===t.allow&&"Mac"!==i.clientPlatform&&"Unknown"!==i.clientPlatform){c=s,ee=t["api-capabilities"]||{},ne=t.rtpCapabilities||{},ie=t.callConfigs||[],Array.isArray(t.featuresSupported)?($=t.featuresSupported,ae.info("onWebSocketOpen(): Supported features = "+JSON.stringify($))):ae.warn("onWebSocketOpen(): featureSupported property not valid");try{K.hwnd!==T?he(d):w(function(){var e=t.hwnd||T;b(e,d)})}catch(n){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(n))}e.invokeDeviceChange()}else{try{he(d)}catch(n){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(n))}var l="";for(n=["errorCode","errorMsg"],a=0;a<n.length;a++)void 0!==t[n[a]]?(ae.debug("onWebSocketOpen(): "+n[a]+": "+t[n[a]]),l+=n[a]+" = "+t[n[a]],a!=n.length-1&&(l+="; ")):ae.warn("onWebSocketOpen(): Could not find property "+n[a]);try{he({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:l})}catch(n){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(n))}O("Horizon HTML5 Server connection not allowed")}}})},R=function(){ae.info("onWebSocketClose(): Websocket closed"),O("Horizon HTML5 Server connection closed")},k=function(e){ae.debug("onWebSocketError(): Websocket error");var t=o;Y&&(t=Y.state),O("Horizon HTML5 Server connection error: "+e.message),t==a&&(ae.debug("Error in connecting socket"),Y)&&Y.sendVdiClientEventsOnError&&(ae.error("Error in connecting to websocket"),Y.stopPolling(),Y.sendEvents(),Y.sendVdiClientEventsOnError=!1)},I=function(e){if("object"==typeof e.data){var t=new Uint8Array(e.data),n=new DataView(e.data),r=n.getInt32(0),i=n.getInt32(36);if(1396920910!=r)ae.warn("Unsupport binary data: "+r.toString(16));else{ee.getScreens&&ee.getScreens&v&&ae.warn("New client should return string for getScreen.");for(var o=40,a=[];o+12<t.length;){var s=n.getInt32(o),c=(g=n.getInt32(o+4))*(m=n.getInt32(o+8))*4;if(g<0||m<0||o+12+c>t.length){ae.warn("Invalid screen "+g+"X"+m+" offs:"+o+" size:"+c+" len:"+t.length);break}o+=12;var l=new Uint8ClampedArray(t.buffer,o,c),u=new ImageData(l,g,m),f=new _e(s,"Screen "+s,u);o+=c,a.push(f),ae.debug("Screen:"+s+": "+g+"X"+m+" offs:"+o+" size:"+c+" len:"+t.length)}var h=d[i];delete d[i],void 0!==h&&"function"==typeof h.responseCb&&h.responseCb(a)}}else if("string"!=typeof e.data)ae.error("onWebSocketMessage(): invalid data type: "+typeof e.data);else{r=e.data;var p=JSON.parse(r);if(ae.logToConsole&&console.log("onWebSocketMessage(): "+r),"number"==typeof p.id&&0<p.id){if(h=d[p.id],delete d[p.id],h&&"function"==typeof h.responseCb)if("getScreens"!==p.evt||p.screens)h.responseCb(p);else if(p.error)h.responseCb(p);else{a=[];var _="number"==typeof p.screens?p.screens:1;for(s=1;s<=_;s++){for(var g,m,y=4*(g=100)*(m=100),b=(l=new Uint8ClampedArray(y),0);b<y;b+=4)l[b]=81,l[b+1]=144,l[b+2]=201,l[b+3]=255;f=new _e(s,"Screen "+s,u=new ImageData(l,g,m)),a.push(f)}h.responseCb(a)}}else if(void 0===p.evt)ae.error("onWebSocketMessage(): evt property is invalid");else switch(p.evt){case"version":void 0===p.ver?ae.error("onWebSocketMessage(): ver property is invalid."):ae.info("onWebSocketMessage(): version = "+p.ver);break;case"negotiationneeded":case"icecandidate":case"icegatheringstatechange":case"iceconnectionstatechange":case"signalingstatechange":case"connectionstatechange":case"addStream":case"ontrack":case"tonechange":case"onreceivers":case"onsenders":case"ontransceivers":case"ondatachannel":case"removeStream":void 0!==p.peer&&void 0!==V[p.peer]?V[p.peer]._onReceiveEvent(p):ae.error("onWebSocketMessage(): peerConnection is invalid.");break;case"loadedmetadata":void 0!==p.videoId&&void 0!==q[p.videoId]?q[p.videoId].onReceiveEvent(p):ae.error("onReceiveCommand(): Invalid context.");break;case"devicechange":var C=new Event("devicechange");navigator.mediaDevices.dispatchEvent(C);break;case"vdiScreenTopologyChanged":try{he({event:"vdiScreenTopologyChanged"})}catch(e){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(e))}break;case"featuresSupportedChanged":for(var b in p.features){var S=p.features[b],E=$.indexOf(S.feature);"+"==S.op&&E<0?$.push(S.feature):"-"==S.op&&0<=E&&$.splice(E,1)}he({event:"vdiFeatureSupportedChanged",reason:p.reason||"endpoint changes supported features"});break;case"vdiE911InfoChanged":p.event="vdiE911InfoChanged",he(p);break;case"powerevent":C=p.eventData,D(C);break;case"dconopen":case"dconbufferedamountlow":case"dconclosing":case"dconerror":case"dconmessage":case"dconclose":void 0!==p.peer&&void 0!==V[p.peer]?V[p.peer]._onReceiveDataChannelEvent(p):ae.error("Datachannel event: peerConnection is invalid.")}}},A=function(e,r,i,o){var a;r=null==r?-1:r,void 0===e?(a=new DOMException("Invalid command, operation cancelled","OperationError"),i?i({error:a}):ae.error(a)):-1===r||V[r]?(e.feature=3,e.commandId=n[e.cmd],e.id=++l,e.peer=r,e.browser=oe,e.player=1,"createInstance"===e.cmd&&(e.uid=2147483647&Date.now(),ae.info("sendHelper(): ["+e.uid+"] createInstance")),"createInstance"!==e.cmd&&c!==s||(i&&(o?i():d[e.id]={id:e.id,webCommandId:e.commandId,responseCb:i}),t.send(JSON.stringify(e)))):(a=new DOMException("peer Id is not found, operation cancelled","OperationError"),i?i({error:a}):ae.error(a))},M=(this.send=function(e,t,n,r){"getStats"!=e.cmd&&ae.debug(JSON.stringify(e)),A(e,t,n,r)},this.invokeDeviceChange=function(){w(function(){ae.info("invokeDeviceChange(): Fire devicechange event");var e=new Event("devicechange");navigator.mediaDevices.dispatchEvent(e)})},this.sendBinary=function(e){c===s?t.send(e):ae.warn("sendBinary(): WSS is not connected.")},function(){var e=Math.random()*Number.MAX_SAFE_INTEGER;e=Math.floor(e),e="v=0\no=- "+String(e)+" 2 IP4 127.0.0.1\n";return(e+="s=-\n")+"t= 0 0\na=msid-semantic: WMS"}),D=function(e){if(e==h)try{ae.info("onPowerEvent(): received suspend"),he({event:"vdiRequestEndCalls",reason:"vdiClientPowerEventSuspend"})}catch(e){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(e))}else if(e==p){ae.info("onPowerEvent(): received resume");try{he({event:"vdiRequestEndCalls",reason:"vdiClientPowerEventResume"})}catch(e){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(e))}}else ae.error("powerevent: Invalid param.")},O=function(r,i){ae.info("cleanup: Clean up all script resources");var l=c;if(c=i?a:o,Object.keys(d).forEach(function(e){var t,i=new DOMException(r,"OperationError");d[e].responseCb?d[e].webCommandId===n.createOffer||d[e].webCommandId===n.createAnswer?(t={desc:{sdp:M()}},ae.debug("Resolving createoffer/createAnswer with desc "+t.desc),d[e].responseCb(t)):d[e].responseCb({error:i}):ae.error(i)}),d={},t&&t.readyState===WebSocket.OPEN&&c==o&&t.close(),t=null,Object.keys(V).forEach(function(e){V[e].cleanUp()}),V={},Object.keys(W).forEach(function(e){(e=W[e]).onended&&e.onended()}),W={},B={},$=[],Q=[],te={},ne={},ie=[],l===s){try{he({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(i){ae.warn("Catch exception in onVMEvent()"+JSON.stringify(i))}e.invokeDeviceChange()}ee={}}}function _e(e,t,n,r){var i=this;this.id=e,this.name=t,this.image=n,this.icon=void 0,this.bounds=r||{x:0,y:0,width:0,height:0},this.getId=function(){return ae.debug("getId "+i.id),i.id},this.getDeviceId=function(){return ae.debug("getDeviceId "+i.id),Te+"-"+i.id},this.getType=function(){return Re.Monitor},this.getPreview=function(e,t,n){return ae.debug("ScreensAsync getPreview "),new Promise(function(e,t){t()})},this.getPreviewAsync=function(e,t,n){return ae.debug("ScreensAsync getPreviewAsync"),n?new Promise(function(e,t){var n=document.createElement("canvas");n.getContext("2d").putImageData(i.image,0,0),e({data:n.toDataURL().replace("data:image/png;base64,","")})}):new Promise(function(e,t){e(i.image)})},this.getDescription=function(){return ae.debug("ScreensAsync getDescription "),i.name},this.getIcon=function(e,t){return ae.debug("ScreensAsync getIcon"),new Promise(function(e,t){e(i.image)})},this.getAppName=function(){return ae.warn("getAppName: not support."),null},this.getBounds=function(){return(i.bounds.width<=0||i.bounds.height<=0)&&ae.warn("getBounds: invalid bounds."),i.bounds}}function ge(e,t){var n=this,r=(this.id=M,this.binaryType="arraybuffer",this.bufferedAmount=0,this.maxPacketLifeTime=0,this.maxRetransmits=0,this.negotiated=!1,this.ordered=!0,this.protocol="",this.readyState=!1,this.reliable=!0,this.label="",t),i=e,o=0;Object.defineProperty(this,"bufferedAmountLowThreshold",{get:function(){return o},set:function(e){void 0===e&&ae.warn("RTCDataChannel bufferedAmountLowThreshold value undefined."),n.id!=M&&Y.send({cmd:"dataChannelCmd",hint:"setBufferAmountLowThreshold",dataChannelCmd:we.SET_BUFFER_AMOUNT_LOW_THRESHOLD,dataChannelId:n.id,shimId:r,label:n.label,threshold:e},i),o=e},configurable:!0}),this._createChannel=function(e,t){n.id==M?(n.label=e,Y.send({cmd:"dataChannelCmd",hint:"create",label:e,shimId:r,options:t,dataChannelCmd:we.CREATE},i)):ae.warn("RTCDataChannel.create channel "+n.id+" already existed")},this._updateChannel=function(e){n.id=e.id,n.binaryType=e.binaryType,n.bufferedAmount=e.bufferedAmount,n.maxPacketLifeTime=e.maxPacketLifeTime,n.maxRetransmits=e.maxRetransmits,n.negotiated=e.negotiated,n.ordered=e.ordered,n.protocol=e.protocol,n.readyState=e.readyState,n.reliable=e.reliable,n.label=e.label},this.send=function(e){if(n.id!=M)if(e instanceof Blob)e.arrayBuffer(),e.arrayBuffer().then(function(e){for(var t=new Uint8Array(e),o=t.byteLength,a="",s=0;s<o;s++)a+=String.fromCharCode(t[s]);Y.send({cmd:"dataChannelCmd",label:n.label,dataChannelId:n.id,shimId:r,dataChannelCmd:we.SEND,hint:"send",data:window.btoa(a),dataType:"binary",dataLen:o},i)});else{var t=null,o=0,a="binary";if("string"==typeof e||e instanceof String)t=window.btoa(e),a="string",o=e.length;else{for(var s=new Uint8Array(e),c=(o=s.byteLength,""),d=0;d<o;d++)c+=String.fromCharCode(s[d]);c&&(t=window.btoa(c))}t?Y.send({cmd:"dataChannelCmd",label:n.label,dataChannelId:n.id,shimId:r,hint:"send",dataChannelCmd:we.SEND,data:t,dataType:a,dataLen:o},i):ae.warn("RTCDataChannel.send: Unsupported data format")}else ae.error("RTCDataChannel.send: invalid datachannel id.")},this.close=function(){V[i]?(Y.send({cmd:"dataChannelCmd",hint:"close",label:n.label,dataChannelId:n.id,shimId:r,dataChannelCmd:we.CLOSE},i),V[i]._untrackDataChannel(n.id,r)):ae.warn("RTCDataChannel.close: peerconnection is untracked.")},this._onReceiveEvent=function(e){if(void 0===e||void 0===e.evt)ae.error("_onReceiveEvent(): evt property is invalid.");else{var t={target:this};switch(e.evt){case"dconopen":this.onopen&&(this._updateChannel(e.channel),this.onopen(t));break;case"dconbufferedamountlow":this.onbufferedamountlow&&this.onbufferedamountlow(t);break;case"dconerror":this.onerror&&this.onerror(t);break;case"dconmessage":if(this.onmessage){if("string"===e.dataType)t.data=window.atob(e.data);else{var n=window.atob(e.data),r=n.length;t.data=new Uint8Array(r);for(var i=0;i<r;i++)t.data[i]=n.charCodeAt(i)}this.onmessage(t)}break;case"dconclose":this.onclose&&this.onclose(t)}}}}var me=function(e){var t=this,n={};this._objectId=++N,this.id="",this.peer=A,this.active=!1,this.ended=!1,this.cloned=null,this.track=[],this.createMediaStream=function(e){void 0===e||Array.isArray(e)?(this.id="Stream#"+t._objectId,ae.debug("MediaStream.createMediaStream() with "+t.id+"MediaStreamTracks num ="+!(e=e)?0:e.length),this.active=!1,this.track=[],void 0!==e&&e.forEach(function(e){e&&e instanceof ve&&t.track.push(e)}),Y.send({cmd:"createMediaStream",sid:t.id,tracks:t.track},-1)):ae.debug("MediaStream.createMediaStream failed with invalid parameter")},this._create=function(e,n){this.id=e.id,this.peer=n,this.active=e.active,this.track=[],e.track.forEach(function(e){var n=new ve;n._create(e),t.track.push(n)}),B[this.id]=this},this.dispatchEvent=function(e){ae.debug("MediaStream.dispatchEvent(): "+e.type),void 0!==n[event.type]&&n[event.type].listeners.forEach(function(t){t(e)}),"active"===e.type?this.onactive&&this.onactive(e):"addtrack"===e.type?this.onaddtrack&&this.onaddtrack(e):"inactive"===e.type?this.oninactive&&this.oninactive(e):"removetrack"===e.type?this.onremovetrack&&this.onremovetrack(e):ae.debug("MediaStream.dispatchEvent(): Undefined event: ",e.type)},this.addEventListener=function(e,t){ae.debug("MediaStream.addEventListener(): "+e),"function"!=typeof t?ae.error("MediaStream.addEventListener(): The listener handler is invalid."):"string"!=typeof e?ae.error("MediaStream.addEventListener(): The event name is invalid."):(void 0===n[e]&&(n[event]={listeners:[]}),n[e].listeners.push(t))},this.removeEventListener=function(e,t){ae.debug("MediaStream.removeEventListener(): "+e),void 0===n[e]?ae.error("MediaStream.removeEventListener(): Event does not exist = "+e):n[e].listeners=n[e].listeners.filter(function(e){return e.toString()!==t.toString()})},this.addTrack=function(e){ae.debug("MediaStream.addTrack(): "+e.id);var t=!1;this.track.forEach(function(n){n.id==e.id&&(t=!0)}),t||this.track.push(e)},this.removeTrack=function(e){ae.debug("MediaStream.removeTrack(): "+e.id);for(var t=0;t<this.track.length;t++)if(this.track[t].id==e.id)return void this.track.splice(t,1)},this.removeTrackById=function(e){ae.debug("MediaStream.removeTrackById(): "+e);for(var t,n=0;n<this.track.length;n++)if(this.track[n].id==e)return t={type:"removetrack",track:this.track[n]},this.dispatchEvent(t),void this.track.splice(n,1)},this.getTracks=function(){return ae.debug("["+this.id+"]MediaStream.getTracks(): "+this.track.length),ae.debug(this.track),this.track},this.getAudioTracks=function(){var e=[];return this.track.forEach(function(t){"audio"==t.kind&&e.push(t)}),ae.debug("MediaStream.getAudioTracks(): Audio tracks = "+e.length),e},this.getVideoTracks=function(){var e=[];return this.track.forEach(function(t){"video"==t.kind&&e.push(t)}),ae.debug("MediaStream.getVideoTracks(): Video tracks = "+e.length),e},this.getTrackById=function(e){var t=null;return ae.debug("MediaStream.getTrackById(): "+e),this.track.forEach(function(n){n.id==e&&(t=n)}),t},this.clone=function(){if(ae.debug("MediaStream.clone(): Clone mediaStream = "+this.id),this.cloned)return ae.debug("MediaStream.clone(): Use cached clone: "+this.cloned.id),this.cloned;var e=new me,t=de(this.id,"StreamCln#",e._objectId),n=[];e._create({id:t,active:this.active,track:[]},this.peer);for(var r=0;r<this.track.length;r++){var i=this.track[r]._internalClone();e.track.push(i),n.push({tid:this.track[r].id,cid:i.id})}return Y.send({cmd:"mediaStreamClone",sid:this.id,cid:e.id,streamPeer:this.peer,trackClones:n},-1),ae.debug("MediaStream.clone(): MediaStream cloned = "+e.id+" from = "+this.id),e}},ve=function(){var e={};this._objectId=++U,this.remote=!1,this.readonly=!1,this.contentHint="",this.id="",this.kind="",this.label="",this.muted=!1,this.readyState="",this._enabled=!1,Object.defineProperty(this,"enabled",{get:function(){return this._enabled},set:function(e){void 0===(this._enabled=e)&&ae.warn("Set MediaStreamTrack.enabled to undefined."),Y.send({cmd:"trackEnabled",trackId:this.id,enabled:e},-1)},configurable:!0}),this._create=function(e){this._update(e),W[this.id]=this},this._update=function(e){e&&(this.contentHint=e.contentHint,this.id=e.id,this.kind=e.kind,this.label=e.label,this._enabled=e.enabled,this.muted=e.muted,this.readyState=e.readyState,this.remote=e.remote,this.readonly=e.readonly,this.settings=e.settings)},this.dispatchEvent=function(e){"started"==e.type?this.onstarted&&this.onstarted(e):"ended"==e.type?this.onended&&this.onended(e):"isolationchange"==e.type?this.onisolationchange&&this.onisolationchange(e):"mute"==e.type?this.onmute&&this.onmute(e):"unmute"==e.type?this.onunmute&&this.onunmute(e):"overconstrained"==e.type?this.onoverconstrained&&this.onoverconstrained(e):ae.debug("Undefined media track evt: ",e.type)},this.addEventListener=function(t,n){ae.debug("MediaStreamTrack.addEventListener(): "+t),"function"!=typeof n?ae.error("MediaStreamTrack.addEventListener(): The listener handler is invalid."):"string"!=typeof t?ae.error("MediaStreamTrack.addEventListener(): The event name is invalid."):(void 0===e[t]&&(e[event]={listeners:[]}),e[t].listeners.push(n))},this.removeEventListener=function(t,n){ae.debug("MediaStreamTrack.removeEventListener(): "+t),void 0===e[t]?ae.error("MediaStreamTrack.removeEventListener(): Event does not exist = "+t):e[t].listeners=e[t].listeners.filter(function(e){return e.toString()!==n.toString()})},this.applyConstraints=function(e){var t=this.id,n=this.settings;return ae.debug("MediaStreamTrack.applyConstraints()"),new Promise(function(r,i){var o=new DOMException("applyConstraints failed","OperationError");Y.send({cmd:"applyConstraints",constraints:e,trkid:t},-1,function(e){void 0===e.error?(void 0!==e.settings.width&&void 0!==e.settings.height&&(n.width=e.settings.width,n.height=e.settings.height),r()):i(o)})})},this.getConstraints=function(){ae.debug("MediaStreamTrack.getConstraints(): Not implemented")},this.getCapabilities=function(){ae.debug("MediaStreamTrack.getCapabilities(): Not implemented")},this.getSettings=function(){return ae.debug("MediaStreamTrack.getSettings(): "+JSON.stringify(this.settings)),this.settings},this.stop=function(){Y.send({cmd:"mediaTrkStop",trkid:this.id})},this._internalClone=function(){var e=new ve,t=de(this.id,"TrackCln#",e._objectId);return e._create({id:t,kind:this.kind,label:this.label,enabled:this.enabled,muted:this.muted,readyState:this.readyState,remote:this.remote,readonly:this.readonly,settings:this.settings}),e},this.clone=function(){var e=this._internalClone();return Y.send({cmd:"mediaTrackClone",tid:this.id,cid:e.id},-1),e}},ye=function(){this.stats={},this._create=function(e){this.stats=e,this.type=e.type,this.id=e.id,this.timestamp=e.timestamp,delete this.stats.type,delete this.stats.id,delete this.stats.timestamp},this.names=function(){return Object.keys(this.stats)},this.stat=function(e){return this.stats[e]}},be=function(){function e(e){var t,r=[];for(t in n){var i=n[t];i.type&&i.type===e&&r.push(i)}return r}var t={},n={};this.update=function(e){var r;(r=e)&&("+"===r.op&&(t=null,n={}),r.track&&(t?Object.keys(r.track).forEach(function(e){"enabled"!=e?t[e]=r.track[e]:t._enabled=r.track[e]}):(t=new ve)._update(r.track)),r.sources)&&r.sources.forEach(function(e){var t,r=e.source;"-"===e.op?delete n[r]:("+"===e.op&&(delete n[r],n[r]={}),t=n[r],Object.keys(e).forEach(function(n){t[n]=e[n]}))})},Object.defineProperty(this,"track",{get:function(){return t},configurable:!0}),this.getContributingSources=function(){return e(1)},this.getSynchronizationSources=function(){return e(0)}},Ce=(be.getCapabilities=function(e){if(ae.info("RTCRtpReceiver.getCapabilities for kind = "+e),ne.receiver&&ne.receiver[e])return ne.receiver[e]},function(e){var t=this,n=!1,r=(this._cap=ee.sender||0,e),i=null,o=null,a=u,s="",c=null,d=null,l=null;this.initPlanB=function(e,r){ae.debug("RtcRtpSender.initPlanB"),n=!1,i=r,s=e?e.id:"",o=e,c=new Se(t)},this.initUnifiedPlan=function(e,r){e?(n=!0,d=e,c=new Se(t),r&&r.sendEncodings):ae.error("RTCRtpSender.initUnifiedPlan: Invalid transceiver")},Object.defineProperty(this,"dtmf",{get:function(){return n?(l||(l=new ue).initUnifiedPlan(r.id,d,this,o),l):r?r.createDTMFSender(o):null},configurable:!0}),Object.defineProperty(this,"rtcpTransport",{get:function(){ae.debug("RTCRtpSender.rtcpTransport getter: Not implemented")},configurable:!0}),Object.defineProperty(this,"track",{get:function(){return ae.debug("RTCRtpSender.track Transceiver="+(d?d.id:"")+")"),o},configurable:!0}),Object.defineProperty(this,"transport",{get:function(){ae.debug("RTCRtpSender.transport getter: Not implemented")},configurable:!0}),Object.defineProperty(this,"id",{get:function(){return ae.debug("RTCRtpSender.id:"+s),s},configurable:!0}),Object.defineProperty(this,"proxyState",{get:function(){return a},configurable:!0}),this.setTrack=function(e,t){o=e,i=t},this.removeTrack=function(){o?r?(Y.send({cmd:"removeTrack",transceiverId:d?d.id:"",senderId:s},r.id),o=c=null):ae.error("RTCRtpSender.removeTrack: invalid peer object."):ae.error("RTCRtpSender.removeTrack: track is already removed.")},this.update=function(e){if(r)if(e){if(d)e.id?s=e.id:ae.error("RTCRtpSender.update invalid id");else if(s!=e.id||!c)return void ae.error("RTCRtpSender.update Invalid state detected, self = "+JSON.stringify(t));e.track&&o&&o._update(e.track),e.parameters&&c&&c.update(e.parameters),a=1}else ae.error("RTCRtpSender.update: invalid sender object.");else ae.error("RTCRtpSender.update: invalid peer object.")},this.getParameters=function(){return ae.debug("RTCRtpSender.getParameters"),r?(a===u&&ae.warn("RTCRtpSender.getParameters without peer, use cached value and the behavior will be undefined."),c):(ae.error("RTCRtpSender.getParameters: invalid peer object."),null)},this.setParameters=function(e){return ae.debug("RTCRtpSender.setParameters"),new Promise(function(t,n){r?Y.send({cmd:"senderCmd",senderCmd:1,hint:"setParameter",transceiverId:d?d.id:"",senderId:s,parameters:e.modifiedValues()},r.id,function(e){var r;void 0===e.error?(r=Array.isArray(e.senders)&&0<e.senders.length?e.senders[0]:null)&&r.id==s?(c.update(r.parameters),t()):(ae.debug("RTCRtpSender.setParameters invaild response."),r=new DOMException("setParameters failed","OperationError"),n(r)):n(e.error)}):n(new DOMException("RTCRtpSender.setParameters: invalid peer object","OperationError"))})},this.getStats=function(){ae.debug("RTCRtpSender.getStats: Not implemented")},this.replaceTrack=function(e){return ae.debug("RTCRtpSender.replaceTrack"),new Promise(function(n,a){r?(Y.send({cmd:"senderCmd",senderCmd:2,hint:"replaceTrack",transceiverId:d?d.id:"",senderId:s,sid:i?i.id:"",trackId:o?o.id:"",newTrackId:e?e.id:""},r.id,function(e){void 0===e.error?n():a(e.error)}),o=e,c=new Se(t)):a(new DOMException("RTCRtpSender.replaceTrack no peer","OperationError"))})}}),Se=(Ce.getCapabilities=function(e){if(ae.info("RTCRtpSender.getCapabilities for kind = "+e),ne.sender&&ne.sender[e])return ne.sender[e]},function(e){function t(t){e&&e.proxyState!=u?ae.debug("RTCRtpSendParameters."+t):ae.warn("RTCRtpSendParameters."+t+": sender is pending.")}var n,r,i,o=[],a=0;o[0]=new Ee,Object.defineProperty(this,"degradationPreference",{get:function(){return t("degradationPreference getter"),n},set:function(e){n=e,a|=1},configurable:!0}),Object.defineProperty(this,"encodings",{get:function(){return t("encodings getter"),o},set:function(e){o=e,a|=2},configurable:!0}),Object.defineProperty(this,"priority",{get:function(){return t("priority getter"),r},set:function(e){r=e,a|=4},configurable:!0}),Object.defineProperty(this,"transactionId",{get:function(){return t("transactionId getter"),i},set:function(e){i=e,a|=16},configurable:!0}),this.update=function(e){0==(1&a)&&(n=e.degradationPreference),0==(2&a)&&e.encodings&&(o=[],e.encodings.forEach(function(e){var t=new Ee;t.update(e),o.push(t)})),0==(4&a)&&(r=e.priority),0==(16&a)&&(i=e.transactionId)},this.modifiedValues=function(){var e={},t=((1&a||void 0!==n)&&(e.degradationPreference=n),[]);return o.forEach(function(e){e=e.modifiedValues(),Object.keys(e).length&&t.push(e)}),t.length&&(e.encodings=t),(4&a||void 0!==r)&&(e.priority=r),a=0,e}}),Ee=function(){var e,t,n,r,i,o,a,s=!0,c=0;Object.defineProperty(this,"active",{get:function(){return s},set:function(e){s=e,c|=f.RPF_ACTIVE},configurable:!0}),Object.defineProperty(this,"codecPayloadType",{get:function(){return e},configurable:!0}),Object.defineProperty(this,"dtx",{get:function(){return t},set:function(e){dtx=e,c|=f.RPF_DTX},configurable:!0}),Object.defineProperty(this,"maxBitrate",{get:function(){return n},set:function(e){n=e,c|=f.RPF_MAXBITRATE},configurable:!0}),Object.defineProperty(this,"maxFramerate",{get:function(){return r},set:function(e){r=e,c|=f.RPF_MAXFRAMERATE},configurable:!0}),Object.defineProperty(this,"ptime",{get:function(){return i},set:function(e){i=e,c|=f.RPF_PTIME},configurable:!0}),Object.defineProperty(this,"rid",{get:function(){return o},set:function(e){o=e,c|=f.RPF_RID},configurable:!0}),Object.defineProperty(this,"scaleResolutionDownBy",{get:function(){return a},set:function(e){a=e,c|=f.RPF_SCALE_RESOLUTION_DOWNBY},configurable:!0}),this.update=function(d){0==(c&f.RPF_ACTIVE)&&(s=d.active),0==(c&f.RPF_CODEPAYLOADTYPE)&&(e=d.codecPayloadType),0==(c&f.RPF_DTX)&&(t=d.dtx),0==(c&f.RPF_MAXBITRATE)&&(n=d.maxBitrate),0==(c&f.RPF_MAXFRAMERATE)&&(r=d.maxFramerate),0==(c&f.RPF_PTIME_)&&(i=d.ptime),0==(c&f.RPF_RID)&&(o=d.rid),0==(c&f.RPF_SCALE_RESOLUTION_DOWNBY)&&(a=d.scaleResolutionDownBy)},this.modifiedValues=function(){var d={};return(c&f.RPF_ACTIVE||void 0!==s)&&(d.active=s),(c&f.RPF_CODEPAYLOADTYPE||void 0!==e)&&(d.codecPayloadType=e),(c&f.RPF_DTX||void 0!==t)&&(d.dtx=t),(c&f.RPF_MAXBITRATE||void 0!==n)&&(d.maxBitrate=n),(c&f.RPF_MAXFRAMERATE||void 0!==r)&&(d.maxFramerate=r),(c&f.RPF_PTIME||void 0!==i)&&(d.ptime=i),(c&f.RPF_RID||void 0!==o)&&(d.rid=o),(c&f.RPF_SCALE_RESOLUTION_DOWNBY||void 0!==a)&&(d.scaleResolutionDownBy=a),c=0,d}},Re={Monitor:1,Window:2,Camera:3},Te="VDI_Mon",we={CREATE:1,SEND:2,SET_BUFFER_AMOUNT_LOW_THRESHOLD:3,CLOSE:4};return{initSDK:function(e,t,n,r){return"function"!=typeof n?(ae.error("initSDK(): The event callback function is not valid."),!1):(ae.info("setVMEventCallback(): Set event callback"),G=n,P=t||"",X=e,ae.info("init(): VMware VDI shim version = "+C),r&&(re=r),n=1,r&&!isNaN(r.numOfCallConfigs)&&(n=t=(t=0<(t=parseInt(Number(r.numOfCallConfigs)))?t:1)<=3?t:3),re.numOfCallConfigs=n,"function"==typeof window.getWindowReference?window.getWindowReference().then(function(e){ae.info("init(): HWND: "+e),K.hwnd=e,(Y=new pe).init()},function(e){ae.error("init(): Failed to retrieve window handle: "+e.message)}):(ae.info("init() webapp with HWND: 0"),K.hwnd=T,(Y=new pe).init()),!0)},getCallConfig:function(e){return ie[e]},newPeerConnection:function(e,t){return this.newPeerConnectionEx(e,t)},newPeerConnectionEx:function(e,t,n){if(Y){if(Y.isSocketConnected()){var r=new le(e);if(ee.sender)r.createOffer=r.createOfferV1,r.createAnswer=r.createAnswerV1,r.setRemoteDescription=r.setRemoteDescriptionV1,r.setLocalDescription=r.setLocalDescriptionV1,r.addIceCandidate=r.addIceCandidateV1,r.getStats=r.getStatsV1,r.addTrack=r.addTrackImplV1,r.removeTrack=r.removeTrackImplV1,r.getSenders=r.getSendersImplV1,r.getTransceivers=r.getTranceiversImplV1,r.addTransceiver=r.addTransceiverImplV1,4&ee.pcCapability&&(r.setConfiguration=r.setConfigurationImpl),2&ee.pcCapability&&(r.restartIce=r.restartIceImpl);else{if(r.isUnifiedPlan())throw ae.error("createPeerConnection failed due to endpoint does not support unified plan"),"endpoint does not support unified plan";r.createOffer=r.createOfferV0,r.createAnswer=r.createAnswerV0,r.setRemoteDescription=r.setRemoteDescriptionV0,r.setLocalDescription=r.setLocalDescriptionV0,r.addIceCandidate=r.addIceCandidateV0,r.getStats=r.getStatsV0}return r.createDataChannel=r.createDataChannelImplV1,V[r.id]=r,Y.send({cmd:"createPeerConnection",arg1:e,arg2:t,callConfig:n},r.id),ae.debug("createPeerConnection(): Create peer: "+r.id),r}ae.error("createPeerConnection: WebSocket is not in connected state")}else ae.error("createPeerConnection: gRequestManager is not created yet.")},newMediaStream:function(e){var t=new me;return t.createMediaStream(e),t},getDisplayMedia:function(e){return this.getDisplayMediaEx(e)},getDisplayMediaEx:function(e,t){if(Y.isSocketConnected())return new Promise(function(n,r){ae.debug("getDisplayMediaShim(): Constraints = "+JSON.stringify(e)),Y.send({cmd:"getDisplayMediaShim",constraints:e,callConfig:t},-1,function(e){var t;void 0===e.error?((t=new me)._create(e.stream,A),ae.debug("getDisplayMediaShim(): Media ="+t.id),n(t)):r(e.error)})});ae.error("getDisplayMediaShim: WebSocket is not in connected state")},getUserMedia:function(e){return this.getUserMediaEx(e)},getUserMediaEx:function(e,t){if(!Y.isSocketConnected())return Promise.reject({name:"NotFoundError",message:"WebSocket is not in connected state"});if(void 0!==e.video&&void 0!==e.video.mandatory&&void 0!==e.video.mandatory.sourceId&&void 0!==Z[e.video.mandatory.sourceId]){var n=0,r=0,i=0,o=!1,a=e.video.mandatory.sourceId,s=e.video.mandatory.minWidth,c=e.video.mandatory.maxWidth,d=e.video.mandatory.minHeight,l=e.video.mandatory.maxHeight,u=e.video.mandatory.maxFrameRate,f=s,h=d,p={width:0,height:0},_={width:0,height:0};if((a=(Z[a].forEach(function(e){(void 0===s||e.width>=s)&&(void 0===c||e.width<=c)&&(void 0===d||e.height>=d)&&(void 0===l||e.height<=l)&&(void 0===u||e.fps>=u)?(e.width*e.height>p.width*p.height&&(p=e),f&&h&&f*e.height==h*e.width&&e.width*e.height>_.width*_.height&&(_=e)):(void 0!==s&&e.width>=s||void 0!==c&&e.width>=c)&&(o=!0)}),0<_.width?_:p))&&(n=a.width,r=a.height,i=a.fps),0<n&&0<r&&0<i)ae.debug("Constraints: "+JSON.stringify(e)+" ==> "+n+"x"+r+" @"+i+":"+(u||"undefined")),u&&(e.video.mandatory.origFps=u),e.video.mandatory.maxFrameRate=i,e.video.mandatory.maxWidth=e.video.mandatory.minWidth=n,e.video.mandatory.maxHeight=e.video.mandatory.minHeight=r;else{if(!o)return ae.debug("getUserMediaShim(): constraints does not match."),void reject({name:"OverconstrainedError",message:null});ae.debug("getUserMediaShim(): low resolution video forward to client.")}}return new Promise(function(n,r){Y.send({cmd:"getUserMediaShim",constraints:e,callConfig:t},-1,function(e){var t,i;void 0===e.error?(t=null,void 0!==e.clone&&((t=new me)._create(e.clone,A),ae.debug("Media cloned:"+t.id)),(i=new me)._create(e.stream,A),i.cloned=t,ae.debug("Media:"+i.id),n(i)):(new DOMException("Abort","AbortError"),r(e.error))})})},enumerateDevices:function(){return Y.isSocketConnected()?new Promise(function(e,t){Y.send({cmd:"enumDevices"},-1,function(n){void 0===n.error?(e(n.devices),void 0!==n.caps&&Object.keys(n.caps).forEach(function(e){Z[e]=n.caps[e]})):t("enumDevices cancelled.")})}):(ae.info("enumerateDevicesShim(): Use fallback mode."),new Promise(function(e,t){z.call(navigator.mediaDevices).then(function(t){e(t),Y.isSocketConnected()&&(ae.info("enumerateDevicesShim(): [Resolve] Fallback cancelled. Invoke device change."),Y.invokeDeviceChange())},function(n){Y.isSocketConnected()?(ae.info("enumerateDevicesShim(): [Reject] Fallback cancelled. Invoke device change."),e([]),Y.invokeDeviceChange()):t(n)})}))},onVideoCreated:function(e,t){if(Y.isSocketConnected()){ae.debug("newVideoElement: New video element from app.");for(var n=Object.keys(q),r=0;r<n.length;r++){var i=n[r];if(q[i]._rawVideo===e)return void ae.debug("newVideoElement(): Video already found")}t=new function e(t,n){var r=this,i=n,o=se(n),a=!1,s=(this._srcObject=t.srcObject,this._videoWidth=t.videoWidth,this._videoHeight=t.videoHeight,this._cloaked=!1,this._id=O++,this._clientRect=null,this._bodyClientRect=null,this._colorKey=null,this._rawVideo=t,this._removeTimer=null,this._removed=!1,this._objectFit=t.style.objectFit,this._transform,this._dpiServerTranslate=!!ee.multiwindow&&0!=(ee.multiwindow&y),this._styleObserver=new MutationObserver(function(e){e.forEach(function(e){r.handleStyleChanges(e,t)})}),function(e){return(e=Number(e).toString(16)).length<2?"0"+e:e});this.sendVideoElement=function(){this._colorKey=function(){for(var e="";""==e;){var t,n=Math.floor(16*Math.random())+1,r=Math.floor(16*Math.random())+1,i=Math.floor(16*Math.random())+1,o=(e="#"+s(n)+s(r)+s(i),Object.keys(q));for(t in o){var a=q[o[t]];if(a&&a._colorKey==e){e="";break}}}return e}();var e,n={cmd:"newVideoElement",videoId:this._id,colorKey:this._colorKey,requestDpiTranslate:this._dpiServerTranslate?1:0,body:{},zoomFactor:k(this._rawVideo)};for(e in o&&(n.frame=o),this._clientRect)n[e]=this._clientRect[e];for(e in this._bodyClientRect)n.body[e]=this._bodyClientRect[e];""!==this._objectFit&&(n.objectFit=this._objectFit),t.setAttribute("data-vdi_videoid",this._id),t.setAttribute("data-vmw_videoid",this._id),Y.send(n,-1)},this.updateVideoElement=function(){var e=this.getBoundingClientRect(t),n=(this._cloaked||(e.right=e.left,e.bottom=e.top),this.getBoundingClientRect(document.body));if(e.left==this._clientRect.left&&e.right==this._clientRect.right&&e.top==this._clientRect.top&&e.bottom==this._clientRect.bottom&&n.left==this._bodyClientRect.left&&n.right==this._bodyClientRect.right&&n.top==this._bodyClientRect.top&&n.bottom==this._bodyClientRect.bottom)return!1;this._clientRect=e,this._bodyClientRect=n;var r,i={cmd:"updateVideoElement",videoId:this._id,requestDpiTranslate:this._dpiServerTranslate?1:0,transform:t.style.transform,body:{}};for(r in o&&(i.frame=o),e)i[r]=e[r];for(r in n)i.body[r]=n[r];""!==this._objectFit&&(i.objectFit=this._objectFit),i.zoomFactor=k(this._rawVideo),ae.debug(i),Y.send(i,-1)},this.removeVideoElement=function(){var e={cmd:"removeVideoElement",videoId:r._id};o&&(e.frame=o),ae.debug("RemoveVideoElement: "+r._id),Y.send(e,-1),delete q[r._id],r._removeTimer=null,r._removed=!0},this.disposeVideo=function(){a=!0},this.cloak=function(){!0!==this._cloaked&&(this._colorKey?(t.style.backgroundColor=this._colorKey,this._styleObserver.observe(t,{attributes:!0,attributeFilter:["style"]}),this._cloaked=!0,this._poll=setInterval(function(){r.updateVideoElement()},500)):ae.error("cloak(): Invalid color key."))},this.uncloak=function(){if(!1===this._cloaked)return!1;t.style.backgroundColor="",this._styleObserver.disconnect(),clearInterval(this._poll),this._cloaked=!1,this.updateVideoElement()},this.getBoundingClientRect=function(e){e=e.getBoundingClientRect();var t=1;return this._dpiServerTranslate||"number"!=typeof window.devicePixelRatio||(t=window.devicePixelRatio),{left:e.left*t,top:e.top*t,bottom:e.bottom*t,right:e.right*t,width:e.width*t,height:e.height*t}},this.onReceiveEvent=function(e){var t;void 0===e||void 0===e.evt?ae.error("onReceiveEvent(): evt property is invalid."):this._rawVideo?"loadedmetadata"===e.evt&&(""==this._objectFit&&""!==(t=window.getComputedStyle(this._rawVideo).objectFit)&&(ae.debug("onReceiveEvent(): updating objectfit to "+t),this._objectFit=t,this.sendObjectFit()),void 0!==e.videoWidth&&(this._videoWidth=e.videoWidth),void 0!==e.videoHeight&&(this._videoHeight=e.videoHeight),t=new Event(e.evt),this._rawVideo.dispatchEvent(t)):ae.error("onReceiveEvent(): Invalid rawVideo object.")},this.sendSrcObject=function(){var e=this._srcObject?this._srcObject.id:"null",t=this._srcObject?this._srcObject.peer:A;Y.send({cmd:"updateSrcObject",mediaStreamId:e,videoId:this._id,type:"video",streamPeer:t},-1),this._srcObject?this.cloak():this.uncloak()},this.sendObjectFit=function(){Y.send({cmd:"updateObjectFit",videoId:this._id,objectFit:this._objectFit},-1)},Object.defineProperty(t,"srcObject",{get:function(){return r._srcObject},set:function(e){r._removed?ae.warn("Setting srcObject of zombie video element: "+r._id):(r._removeTimer&&(clearTimeout(r._removeTimer),r._removeTimer=null),void 0===e&&ae.warn("Set video.srcObject to undefined."),ae.debug("Setting srcObject for video element: "+r._id),ae.debug(e),r._srcObject=e,r.sendSrcObject(),r._srcObject||(a?r.removeVideoElement():(ae.debug("srcObject is null, setup removeTimer for "+r._id),r._removeTimer=setTimeout(r.removeVideoElement,5e3))))},configurable:!0}),Object.defineProperty(t,"videoWidth",{get:function(){return r._videoWidth},configurable:!0}),Object.defineProperty(t,"videoHeight",{get:function(){return r._videoHeight},configurable:!0}),Object.defineProperty(t.style,"objectFit",{get:function(){return console.log("keyword defineProperty get objectFit "+r._objectFit),r._objectFit},set:function(e){console.log("keyword defineProperty set objectFit "+e),r._objectFit=e,r.sendObjectFit()},configurable:!0}),e.prototype.handleStyleChanges=function(e,t){"attributes"===e.type&&"style"===e.attributeName&&(ae.debug("video style change in id = "+this._id+", object-fit = "+t.style.objectFit),ae.debug(t),this._objectFit!==t.style.objectFit&&(ae.debug("change in object-fit. Old = "+this._objectFit+", new = "+t.style.objectFit),this._objectFit=t.style.objectFit,this.sendObjectFit()),this._transform!=t.style.transform)&&(this._transform=t.style.transform,this.updateVideoElement())},this.init=function(){this._clientRect=this.getBoundingClientRect(t),this._bodyClientRect=this.getBoundingClientRect(document.body),I(i),this.sendVideoElement(),this._srcObject&&(ae.debug("srcObject already set for video: "+this._id),this.sendSrcObject()),ae.debug(t)},this.init()}(e,t),q[t._id]=t,e._context=t}else ae.error("newVideoElement: WebSocket is not in connected state")},onAudioCreated:function(e,t){if(Y.isSocketConnected()){ae.debug("newAudioElement(): A new audio element created.");for(var n=Object.keys(J),r=0;r<n.length;r++){var i=n[r];if(J[i]._rawAudio===e)return void ae.debug("newAudioElement(): Audio already found")}t=new function(e,t){var n=this,r=t;this._srcObject=e.srcObject,this._id=x++,this._rawAudio=e,this.sendAudioElement=function(){var t={cmd:"newAudioElement",audioId:this._id};e.setAttribute("data-vdi_audioid",this._id),Y.send(t,-1)},Object.defineProperty(e,"srcObject",{get:function(){return n._srcObject},set:function(e){void 0===e&&ae.warn("Set audio.srcObject to undefined."),ae.debug("Setting srcObject for audio element: "+n._id),ae.debug(e),n._srcObject=void 0===e?null:e,n.sendSrcObject()},configurable:!0}),this.sendSrcObject=function(){var e=this._srcObject?this._srcObject.id:"null",t=this._srcObject?this._srcObject.peer:A;Y.send({cmd:"updateSrcObject",mediaStreamId:e,audioId:this._id,type:"audio",streamPeer:t},-1)},Object.defineProperty(e,"sinkId",{get:function(){return n._sinkId},set:function(e){},configurable:!0}),e.setSinkId=function(e){return n._sinkId=e,ae.debug("Audio.setSinkId for ID = "+n._id+" Value = "+e),0===(void 0!==ee.setSinkId?ee.setSinkId:0)?new Promise(function(t,r){Y.send({cmd:"setSinkId",deviceId:e,audioId:n._id,context:"audioElement"},-1),t()}):new Promise(function(t,r){Y.send({cmd:"setSinkId",deviceId:e,audioId:n._id,context:"audioElement"},-1,function(e){void 0===e.error?t():r(e.error)})})},e.play=function(){return Promise.resolve()},this.init=function(){I(r),this.sendAudioElement(),this._srcObject&&(ae.debug("srcObject already set for audio: "+this._id),this.sendSrcObject()),ae.debug(e)},this.init()}(e,t),J[t._id]=t,e._context=t}else ae.error("newAudioElement: WebSocket is not in connected state")},onVideoDisposed:function(e,t){e&&e._context&&e._context.disposeVideo(),e=e&&e._context?e._context._id:void 0,ae.info("disposeElement video id="+e)},onAudioDisposed:function(e,t){e&&e._context&&e._context._id,ae.info("disposeElement audio id="+_id)},playRingtone:function(e,t,n){var r,i;Y.isSocketConnected()?t?(ae.debug("playNotifyAudio(): id = "+e+" src = "+t+" loop = "+n),void 0===(r=L[e])&&(r=x++,L[e]=r),Y.send({cmd:"notifyAudio",action:"play",src:t,audid:r,loop:n},-1),(i=new XMLHttpRequest).open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){var e,n,o,a;i.readyState==XMLHttpRequest.DONE&&200==i.status?(e=16+i.response.byteLength,(n=new Uint8Array(16))[0]=65,n[1]=78,n[2]=84,n[3]=70,n[4]=e>>24&255,n[5]=e>>16&255,n[6]=e>>8&255,n[7]=255&e,n[8]=r>>24&255,n[9]=r>>16&255,n[10]=r>>8&255,n[11]=255&r,o=new Uint8Array(e),a=new Uint8Array(i.response),o.set(n,0),o.set(a,16),Y.sendBinary(o),ae.debug("onreadystatechange(): Send "+e+"bytes")):ae.debug("onreadystatechange(): Download "+t+" status = "+i.status)},i.send()):ae.error("playNotifyAudio(): src cannot be null or undefined"):ae.error("playNotifyAudio(): WebSocket is not in connected state")},pauseRingtone:function(e){var t;Y.isSocketConnected()?(ae.debug("pauseNotifyAudio(): id = "+e),void 0===(t=L[e])?ae.warn("pauseNotifyAudio(): id = "+e+" did not play yet."):Y.send({cmd:"notifyAudio",action:"pause",audid:t},-1)):ae.error("playNotifyAudio: WebSocket is not in connected state")},setVideoClipRegion:function(e,t,n){ae.debug("setVideoClipRegion: "+e+", "+JSON.stringify(t)),Y.isSocketConnected()?(e={cmd:"customClipRect",op:e?0:1,clip:JSON.parse(JSON.stringify(t))},(t=se(n))&&(I(n),e.frame=t),Y.send(e,-1)):ae.error("setVideoClipRegion: WebSocket is not in connected state.")},getReceiverCapabilities:function(e){return ae.debug("getCapabilitiesShim"),be.getCapabilities(e)},setSinkId:function(e,t){var n;Y.isSocketConnected()?(void 0===(n=L[e])&&(n=x++,L[e]=n),ae.debug("setSinkId id = "+n+" srcId = "+e+" Value = "+t),Y.send({cmd:"setSinkId",deviceId:t,audioId:n,srcId:e,context:"global"},-1,function(e){})):ae.error("setSinkId: WebSocket is not in connected state")},setPrimarySinkId:function(e){ae.debug("setDefaultSinkId = "+e),Y.isSocketConnected()?Y.send({cmd:"setDefaultSinkId",deviceId:e},-1):ae.error("setDefaultSinkId: WebSocket is not in connected state")},isFeatureSupported:function(e){var t;return"string"!=typeof e?(ae.debug("isFeatureSupported(): Invalid feature parameter"),!1):!(!Y||Y.state!==s)&&("datachannel"===e?ee.datachannel?1==ee.datachannel||(ae.debug("isFeatureSupported(): disable datachannel by settings."),!1):(ae.debug("isFeatureSupported(): disable datachannel for old client."),!1):(t=!1,(t=!(!Array.isArray($)||-1==$.indexOf(e))||t)||ae.debug("isFeatureSupported(): Input feature string not supported = "+e),t))},getScreensInfo:function(){if(ae.debug("getScreensAsync get called."),Y.isSocketConnected())return new Promise(function(e,t){var n=0;ee.getScreens&&ee.getScreens&v&&(n=1),Y.send({cmd:"getScreens",bounds:n},-1,function(n){if(Array.isArray(n))e(Q=r=n);else if(n.screens&&Array.isArray(n.screens)){for(var r=[],i=0;i<n.screens.length;i++){var o=n.screens[i].w,a=n.screens[i].h,s=n.screens[i].id,c=n.screens[i].bounds,d=n.screens[i].imageData;if(0<o&&0<a&&s&&c&&d){for(var l=window.atob(d),u=l.length,f=new Uint8ClampedArray(u),h=0;h<u;h++)f[h]=l.charCodeAt(h);o=new _e(s,"Screen "+s,d=new ImageData(f,o,a),c),r.push(o),ae.debug("Screen:"+s+":  image size:"+u)}else ae.error("Invalid screen data:"+JSON.stringify(n.screens[i]))}e(Q=r)}else{var p=n.error&&n.error.message?n.error.message:"Invalid getScreen response";t(new DOMException(p,"OperationError"))}})});ae.error("getScreensAsync: WebSocket is not in connected state")},onScreenSelected:function(e){ae.debug("setScreenSharePanelId = "+e+" for getDisplayMedia"),Y.isSocketConnected()?Y.send({cmd:"setScreenId",scrnId:e,numScreens:Q.length},-1):ae.error("setScreenSharePanelId: WebSocket is not in connected state")},onWindowSessionConnected:function(e){ae.info("connectedStateChanged called "+e),Y&&(Y.state===s&&Y.send({cmd:"connectedStateChanged",connectionState:!0===e?1:0},-1),!0===e?(Y.sendVdiClientEventsOnError=!0,Y.startPolling(Y.shortPollingIntervalMs,Y.shortPollingTimeout,Y.sendEvents)):(Y.sendVdiClientEventsOnError=!1,Y.isHorizonRegistryPresent=!1,ae.info("connectedStateChanged(): isHorizonRegistryPresent false"),Y.stopPolling()))}}},"function"==typeof define&&define.amd||"object"!=typeof t||!t.exports?window.HorizonWebRtcRedirectionAPI=r():t.exports=r()},{}],4:[function(e,t,n){var r;r=function(e,t){"use strict";const n="getClientId",r="getWssPort",i="notifyContentReady",o="notifyWindowSessionConnected",a="pollContentReady",s="horizon.webrtcsdk.foregroundToContent",c="horizon.webrtcsdk.contentToForeground";return new function(){var e,t=this,d=0,l={},u=!0,f=(this.onWindowSessionConnected,this.getHorizonClientID=function(){return new Promise(function(e,t){f({cmd:n},function(n){void 0!==n.clientId?e(n.clientId):t(n.error||"getHorizonClientID failed")})})},this.getHorizonWSSPort=function(){return new Promise(function(e,t){f({cmd:r},function(n){void 0!==n.wssPort?e(n.wssPort):t(n.error||"getHorizonWSSPort failed")})})},function(t,n){var r;t.cmd==a||e?(r=++d,t.seqId=r,l[r]=n,r={detail:void 0!==t?t:{}},window.dispatchEvent(new CustomEvent(s,r))):(t.error="content is not ready",n(t),void 0===e&&(console.log("HorizonWebRTCExtension.toContentScript: content ready state is undefined, Start content state poll"),new Promise(function(t,n){f({cmd:a},function(r){void 0!==r.ready?(e=r.ready,t(e)):n(r.error||"fail to pollContentReady")})})))}),h=function(e){"function"==typeof t.onWindowSessionConnected&&t.onWindowSessionConnected(e)};console.log("HorizonWebRTCExtension foreground register content callback"),window.addEventListener(c,function(t){if(null===t.detail)console.log("HorizonWebRTCExtension.onContentScript: data is null in injected script");else{var n,r=t.detail;if(console.log("HorizonWebRTCExtension.onContentScript(): Received message from content script "+JSON.stringify(r)),"number"==typeof r.seqId&&0<r.seqId)t=r.seqId,n=l[t],delete l[t],void 0!==n&&"function"==typeof n&&n(r);else switch(r.cmd){case i:e=r.state;break;case o:u=r.connected,h(u)}}})}},"function"==typeof define&&define.amd||"object"!=typeof t||!t.exports?window.HorizonWebRTCExtension=r():t.exports=r()},{}],5:[function(e,t,n){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":28}],6:[function(e,t,n){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":29}],7:[function(e,t,n){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":30}],8:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":31}],9:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":32}],10:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":33}],11:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":34}],12:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":35}],13:[function(e,t,n){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":36}],14:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":37}],15:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":38}],16:[function(e,t,n){"use strict";n.__esModule=!0;var r,i=e("../core-js/promise"),o=(r=i)&&r.__esModule?r:{default:r};n.default=function(e){return function(){var t=e.apply(this,arguments);return new o.default(function(e,n){return function r(i,a){try{var s=t[i](a),c=s.value}catch(e){return void n(e)}if(!s.done)return o.default.resolve(c).then(function(e){r("next",e)},function(e){r("throw",e)});e(c)}("next")})}}},{"../core-js/promise":13}],17:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],18:[function(e,t,n){"use strict";n.__esModule=!0;var r,i=e("../core-js/object/define-property"),o=(r=i)&&r.__esModule?r:{default:r};n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":9}],19:[function(e,t,n){"use strict";n.__esModule=!0;var r=o(e("../core-js/object/get-prototype-of")),i=o(e("../core-js/object/get-own-property-descriptor"));function o(e){return e&&e.__esModule?e:{default:e}}n.default=function e(t,n,o){null===t&&(t=Function.prototype);var a=(0,i.default)(t,n);if(void 0===a){var s=(0,r.default)(t);return null===s?void 0:e(s,n,o)}if("value"in a)return a.value;var c=a.get;return void 0!==c?c.call(o):void 0}},{"../core-js/object/get-own-property-descriptor":10,"../core-js/object/get-prototype-of":11}],20:[function(e,t,n){"use strict";n.__esModule=!0;var r=a(e("../core-js/object/set-prototype-of")),i=a(e("../core-js/object/create")),o=a(e("../helpers/typeof"));function a(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":8,"../core-js/object/set-prototype-of":12,"../helpers/typeof":24}],21:[function(e,t,n){"use strict";n.__esModule=!0;var r,i=e("../helpers/typeof"),o=(r=i)&&r.__esModule?r:{default:r};n.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":24}],22:[function(e,t,n){"use strict";n.__esModule=!0;var r=o(e("../core-js/is-iterable")),i=o(e("../core-js/get-iterator"));function o(e){return e&&e.__esModule?e:{default:e}}n.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(e);!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":6,"../core-js/is-iterable":7}],23:[function(e,t,n){"use strict";n.__esModule=!0;var r,i=e("../core-js/array/from"),o=(r=i)&&r.__esModule?r:{default:r};n.default=function(e){return Array.isArray(e)?e:(0,o.default)(e)}},{"../core-js/array/from":5}],24:[function(e,t,n){"use strict";n.__esModule=!0;var r=a(e("../core-js/symbol/iterator")),i=a(e("../core-js/symbol")),o="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}n.default="function"==typeof i.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},{"../core-js/symbol":14,"../core-js/symbol/iterator":15}],25:[function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},{"./runtime":26}],26:[function(e,t,n){!function(e){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",d="object"==typeof t,l=e.regeneratorRuntime;if(l)d&&(t.exports=l);else{(l=e.regeneratorRuntime=d?t.exports:{}).wrap=b;var u="suspendedStart",f="suspendedYield",h="executing",p="completed",_={},g={};g[a]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(M([])));v&&v!==r&&i.call(v,a)&&(g=v);var y=R.prototype=S.prototype=Object.create(g);E.prototype=y.constructor=R,R.constructor=E,R[c]=E.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,R):(e.__proto__=R,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(y),e},l.awrap=function(e){return{__await:e}},T(w.prototype),w.prototype[s]=function(){return this},l.AsyncIterator=w,l.async=function(e,t,n,r){var i=new w(b(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},T(y),y[c]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=M,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(c&&d){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),_}}}function b(e,t,n,r){var i=t&&t.prototype instanceof S?t:S,o=Object.create(i.prototype),a=new A(r||[]);return o._invoke=function(e,t,n){var r=u;return function(i,o){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return D()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=k(a,n);if(s){if(s===_)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=C(e,t,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===_)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function C(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function E(){}function R(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function w(e){var t;this._invoke=function(n,r){function o(){return new Promise(function(t,o){!function t(n,r,o,a){var s=C(e[n],e,r);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==typeof d&&i.call(d,"__await")?Promise.resolve(d.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(d).then(function(e){c.value=e,o(c)},a)}a(s.arg)}(n,r,t,o)})}return t=t?t.then(o,o):o()}}function k(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,k(e,t),"throw"===t.method))return _;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var i=C(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,_;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,_):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,_)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:D}}function D(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},{}],27:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":25}],28:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":46,"../../modules/es6.array.from":116,"../../modules/es6.string.iterator":125}],29:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":114,"../modules/es6.string.iterator":125,"../modules/web.dom.iterable":131}],30:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":115,"../modules/es6.string.iterator":125,"../modules/web.dom.iterable":131}],31:[function(e,t,n){e("../../modules/es6.object.create");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.create(e,t)}},{"../../modules/_core":46,"../../modules/es6.object.create":118}],32:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":46,"../../modules/es6.object.define-property":119}],33:[function(e,t,n){e("../../modules/es6.object.get-own-property-descriptor");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},{"../../modules/_core":46,"../../modules/es6.object.get-own-property-descriptor":120}],34:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":46,"../../modules/es6.object.get-prototype-of":121}],35:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":46,"../../modules/es6.object.set-prototype-of":122}],36:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":46,"../modules/es6.object.to-string":123,"../modules/es6.promise":124,"../modules/es6.string.iterator":125,"../modules/es7.promise.finally":127,"../modules/es7.promise.try":128,"../modules/web.dom.iterable":131}],37:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":46,"../../modules/es6.object.to-string":123,"../../modules/es6.symbol":126,"../../modules/es7.symbol.async-iterator":129,"../../modules/es7.symbol.observable":130}],38:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":111,"../../modules/es6.string.iterator":125,"../../modules/web.dom.iterable":131}],39:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],40:[function(e,t,n){t.exports=function(){}},{}],41:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],42:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":66}],43:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-absolute-index");t.exports=function(e){return function(t,n,a){var s,c=r(t),d=i(c.length),l=o(a,d);if(e&&n!=n){for(;d>l;)if((s=c[l++])!=s)return!0}else for(;d>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":102,"./_to-iobject":104,"./_to-length":105}],44:[function(e,t,n){var r=e("./_cof"),i=e("./_wks")("toStringTag"),o="Arguments"==r(function(){return arguments}());t.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},{"./_cof":45,"./_wks":112}],45:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],46:[function(e,t,n){var r=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=r)},{}],47:[function(e,t,n){"use strict";var r=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},{"./_object-dp":78,"./_property-desc":91}],48:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":39}],49:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],50:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":55}],51:[function(e,t,n){var r=e("./_is-object"),i=e("./_global").document,o=r(i)&&r(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":57,"./_is-object":66}],52:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],53:[function(e,t,n){var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,s=n(e),c=o.f,d=0;s.length>d;)c.call(e,a=s[d++])&&t.push(a);return t}},{"./_object-gops":83,"./_object-keys":86,"./_object-pie":87}],54:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_ctx"),a=e("./_hide"),s=e("./_has"),c=function(e,t,n){var d,l,u,f=e&c.F,h=e&c.G,p=e&c.S,_=e&c.P,g=e&c.B,m=e&c.W,v=h?i:i[t]||(i[t]={}),y=v.prototype,b=h?r:p?r[t]:(r[t]||{}).prototype;for(d in h&&(n=t),n)(l=!f&&b&&void 0!==b[d])&&s(v,d)||(u=l?b[d]:n[d],v[d]=h&&"function"!=typeof b[d]?n[d]:g&&l?o(u,r):m&&b[d]==u?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(u):_&&"function"==typeof u?o(Function.call,u):u,_&&((v.virtual||(v.virtual={}))[d]=u,e&c.R&&y&&!y[d]&&a(y,d,u)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},{"./_core":46,"./_ctx":48,"./_global":57,"./_has":58,"./_hide":59}],55:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],56:[function(e,t,n){var r=e("./_ctx"),i=e("./_iter-call"),o=e("./_is-array-iter"),a=e("./_an-object"),s=e("./_to-length"),c=e("./core.get-iterator-method"),d={},l={};(n=t.exports=function(e,t,n,u,f){var h,p,_,g,m=f?function(){return e}:c(e),v=r(n,u,t?2:1),y=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(o(m)){for(h=s(e.length);h>y;y++)if((g=t?v(a(p=e[y])[0],p[1]):v(e[y]))===d||g===l)return g}else for(_=m.call(e);!(p=_.next()).done;)if((g=i(_,v,p.value,t))===d||g===l)return g}).BREAK=d,n.RETURN=l},{"./_an-object":42,"./_ctx":48,"./_is-array-iter":64,"./_iter-call":67,"./_to-length":105,"./core.get-iterator-method":113}],57:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],58:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],59:[function(e,t,n){var r=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":50,"./_object-dp":78,"./_property-desc":91}],60:[function(e,t,n){var r=e("./_global").document;t.exports=r&&r.documentElement},{"./_global":57}],61:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":50,"./_dom-create":51,"./_fails":55}],62:[function(e,t,n){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],63:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":45}],64:[function(e,t,n){var r=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},{"./_iterators":72,"./_wks":112}],65:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":45}],66:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],67:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},{"./_an-object":42}],68:[function(e,t,n){"use strict";var r=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),a={};e("./_hide")(a,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},{"./_hide":59,"./_object-create":77,"./_property-desc":91,"./_set-to-string-tag":96,"./_wks":112}],69:[function(e,t,n){"use strict";var r=e("./_library"),i=e("./_export"),o=e("./_redefine"),a=e("./_hide"),s=e("./_iterators"),c=e("./_iter-create"),d=e("./_set-to-string-tag"),l=e("./_object-gpo"),u=e("./_wks")("iterator"),f=!([].keys&&"next"in[].keys()),h=function(){return this};t.exports=function(e,t,n,p,_,g,m){c(n,t,p);var v,y,b,C=function(e){if(!f&&e in T)return T[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",E="values"==_,R=!1,T=e.prototype,w=T[u]||T["@@iterator"]||_&&T[_],k=w||C(_),I=_?E?C("entries"):k:void 0,P="Array"==t&&T.entries||w;if(P&&(b=l(P.call(new e)))!==Object.prototype&&b.next&&(d(b,S,!0),r||"function"==typeof b[u]||a(b,u,h)),E&&w&&"values"!==w.name&&(R=!0,k=function(){return w.call(this)}),r&&!m||!f&&!R&&T[u]||a(T,u,k),s[t]=k,s[S]=h,_)if(v={values:E?k:C("values"),keys:g?k:C("keys"),entries:I},m)for(y in v)y in T||o(T,y,v[y]);else i(i.P+i.F*(f||R),t,v);return v}},{"./_export":54,"./_hide":59,"./_iter-create":68,"./_iterators":72,"./_library":73,"./_object-gpo":84,"./_redefine":93,"./_set-to-string-tag":96,"./_wks":112}],70:[function(e,t,n){var r=e("./_wks")("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},{"./_wks":112}],71:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],72:[function(e,t,n){t.exports={}},{}],73:[function(e,t,n){t.exports=!0},{}],74:[function(e,t,n){var r=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),a=e("./_object-dp").f,s=0,c=Object.isExtensible||function(){return!0},d=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),l=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},u=t.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return d&&u.NEED&&c(e)&&!o(e,r)&&l(e),e}}},{"./_fails":55,"./_has":58,"./_is-object":66,"./_object-dp":78,"./_uid":108}],75:[function(e,t,n){var r=e("./_global"),i=e("./_task").set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,c="process"==e("./_cof")(a);t.exports=function(){var e,t,n,d=function(){var r,i;for(c&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){a.nextTick(d)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(d)}}else n=function(){i.call(r,d)};else{var u=!0,f=document.createTextNode("");new o(d).observe(f,{characterData:!0}),n=function(){f.data=u=!u}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},{"./_cof":45,"./_global":57,"./_task":101}],76:[function(e,t,n){"use strict";var r=e("./_a-function");t.exports.f=function(e){return new function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}(e)}},{"./_a-function":39}],77:[function(e,t,n){var r=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),a=e("./_shared-key")("IE_PROTO"),s=function(){},c=function(){var t,n=e("./_dom-create")("iframe"),r=o.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;r--;)delete c.prototype[o[r]];return c()};t.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=c(),void 0===t?n:i(n,t)}},{"./_an-object":42,"./_dom-create":51,"./_enum-bug-keys":52,"./_html":60,"./_object-dps":79,"./_shared-key":97}],78:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),a=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":42,"./_descriptors":50,"./_ie8-dom-define":61,"./_to-primitive":107}],79:[function(e,t,n){var r=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,c=0;s>c;)r.f(e,n=a[c++],t[n]);return e}},{"./_an-object":42,"./_descriptors":50,"./_object-dp":78,"./_object-keys":86}],80:[function(e,t,n){var r=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),a=e("./_to-primitive"),s=e("./_has"),c=e("./_ie8-dom-define"),d=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?d:function(e,t){if(e=o(e),t=a(t,!0),c)try{return d(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},{"./_descriptors":50,"./_has":58,"./_ie8-dom-define":61,"./_object-pie":87,"./_property-desc":91,"./_to-iobject":104,"./_to-primitive":107}],81:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},{"./_object-gopn":82,"./_to-iobject":104}],82:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},{"./_enum-bug-keys":52,"./_object-keys-internal":85}],83:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],84:[function(e,t,n){var r=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},{"./_has":58,"./_shared-key":97,"./_to-object":106}],85:[function(e,t,n){var r=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),a=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,s=i(e),c=0,d=[];for(n in s)n!=a&&r(s,n)&&d.push(n);for(;t.length>c;)r(s,n=t[c++])&&(~o(d,n)||d.push(n));return d}},{"./_array-includes":43,"./_has":58,"./_shared-key":97,"./_to-iobject":104}],86:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"./_enum-bug-keys":52,"./_object-keys-internal":85}],87:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],88:[function(e,t,n){var r=e("./_export"),i=e("./_core"),o=e("./_fails");t.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",a)}},{"./_core":46,"./_export":54,"./_fails":55}],89:[function(e,t,n){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],90:[function(e,t,n){var r=e("./_an-object"),i=e("./_is-object"),o=e("./_new-promise-capability");t.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},{"./_an-object":42,"./_is-object":66,"./_new-promise-capability":76}],91:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],92:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},{"./_hide":59}],93:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":59}],94:[function(e,t,n){var r=e("./_is-object"),i=e("./_an-object"),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{(r=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return o(e,t),n?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:o}},{"./_an-object":42,"./_ctx":48,"./_is-object":66,"./_object-gopd":80}],95:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_core"),o=e("./_object-dp"),a=e("./_descriptors"),s=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},{"./_core":46,"./_descriptors":50,"./_global":57,"./_object-dp":78,"./_wks":112}],96:[function(e,t,n){var r=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},{"./_has":58,"./_object-dp":78,"./_wks":112}],97:[function(e,t,n){var r=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return r[e]||(r[e]=i(e))}},{"./_shared":98,"./_uid":108}],98:[function(e,t,n){var r=e("./_core"),i=e("./_global"),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(t.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:e("./_library")?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},{"./_core":46,"./_global":57,"./_library":73}],99:[function(e,t,n){var r=e("./_an-object"),i=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||void 0==(n=r(a)[o])?t:i(n)}},{"./_a-function":39,"./_an-object":42,"./_wks":112}],100:[function(e,t,n){var r=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,n){var o,a,s=String(i(t)),c=r(n),d=s.length;return c<0||c>=d?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===d||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},{"./_defined":49,"./_to-integer":103}],101:[function(e,t,n){var r,i,o,a=e("./_ctx"),s=e("./_invoke"),c=e("./_html"),d=e("./_dom-create"),l=e("./_global"),u=l.process,f=l.setImmediate,h=l.clearImmediate,p=l.MessageChannel,_=l.Dispatch,g=0,m={},v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){v.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++g]=function(){s("function"==typeof e?e:Function(e),t)},r(g),g},h=function(e){delete m[e]},"process"==e("./_cof")(u)?r=function(e){u.nextTick(a(v,e,1))}:_&&_.now?r=function(e){_.now(a(v,e,1))}:p?(o=(i=new p).port2,i.port1.onmessage=y,r=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",y,!1)):r="onreadystatechange"in d("script")?function(e){c.appendChild(d("script")).onreadystatechange=function(){c.removeChild(this),v.call(e)}}:function(e){setTimeout(a(v,e,1),0)}),t.exports={set:f,clear:h}},{"./_cof":45,"./_ctx":48,"./_dom-create":51,"./_global":57,"./_html":60,"./_invoke":62}],102:[function(e,t,n){var r=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},{"./_to-integer":103}],103:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],104:[function(e,t,n){var r=e("./_iobject"),i=e("./_defined");t.exports=function(e){return r(i(e))}},{"./_defined":49,"./_iobject":63}],105:[function(e,t,n){var r=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./_to-integer":103}],106:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":49}],107:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":66}],108:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],109:[function(e,t,n){var r=e("./_global").navigator;t.exports=r&&r.userAgent||""},{"./_global":57}],110:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_library"),a=e("./_wks-ext"),s=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},{"./_core":46,"./_global":57,"./_library":73,"./_object-dp":78,"./_wks-ext":111}],111:[function(e,t,n){n.f=e("./_wks")},{"./_wks":112}],112:[function(e,t,n){var r=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,a="function"==typeof o;(t.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},{"./_global":57,"./_shared":98,"./_uid":108}],113:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},{"./_classof":44,"./_core":46,"./_iterators":72,"./_wks":112}],114:[function(e,t,n){var r=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":42,"./_core":46,"./core.get-iterator-method":113}],115:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},{"./_classof":44,"./_core":46,"./_iterators":72,"./_wks":112}],116:[function(e,t,n){"use strict";var r=e("./_ctx"),i=e("./_export"),o=e("./_to-object"),a=e("./_iter-call"),s=e("./_is-array-iter"),c=e("./_to-length"),d=e("./_create-property"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,u,f=o(e),h="function"==typeof this?this:Array,p=arguments.length,_=p>1?arguments[1]:void 0,g=void 0!==_,m=0,v=l(f);if(g&&(_=r(_,p>2?arguments[2]:void 0,2)),void 0==v||h==Array&&s(v))for(n=new h(t=c(f.length));t>m;m++)d(n,m,g?_(f[m],m):f[m]);else for(u=v.call(f),n=new h;!(i=u.next()).done;m++)d(n,m,g?a(u,_,[i.value,m],!0):i.value);return n.length=m,n}})},{"./_create-property":47,"./_ctx":48,"./_export":54,"./_is-array-iter":64,"./_iter-call":67,"./_iter-detect":70,"./_to-length":105,"./_to-object":106,"./core.get-iterator-method":113}],117:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),a=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":40,"./_iter-define":69,"./_iter-step":71,"./_iterators":72,"./_to-iobject":104}],118:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{create:e("./_object-create")})},{"./_export":54,"./_object-create":77}],119:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":50,"./_export":54,"./_object-dp":78}],120:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_object-gopd").f;e("./_object-sap")("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},{"./_object-gopd":80,"./_object-sap":88,"./_to-iobject":104}],121:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(r(e))}})},{"./_object-gpo":84,"./_object-sap":88,"./_to-object":106}],122:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":54,"./_set-proto":94}],123:[function(e,t,n){},{}],124:[function(e,t,n){"use strict";var r,i,o,a,s=e("./_library"),c=e("./_global"),d=e("./_ctx"),l=e("./_classof"),u=e("./_export"),f=e("./_is-object"),h=e("./_a-function"),p=e("./_an-instance"),_=e("./_for-of"),g=e("./_species-constructor"),m=e("./_task").set,v=e("./_microtask")(),y=e("./_new-promise-capability"),b=e("./_perform"),C=e("./_user-agent"),S=e("./_promise-resolve"),E=c.TypeError,R=c.process,T=R&&R.versions,w=T&&T.v8||"",k=c.Promise,I="process"==l(R),P=function(){},A=i=y.f,M=!!function(){try{var t=k.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(P,P)};return(I||"function"==typeof PromiseRejectionEvent)&&t.then(P)instanceof n&&0!==w.indexOf("6.6")&&-1===C.indexOf("Chrome/66")}catch(e){}}(),D=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;v(function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,s=i?t.ok:t.fail,c=t.resolve,d=t.reject,l=t.domain;try{s?(i||(2==e._h&&U(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),a=!0)),n===t.promise?d(E("Promise-chain cycle")):(o=D(n))?o.call(n,c,d):c(n)):d(r)}catch(e){l&&!a&&l.exit(),d(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&x(e)})}},x=function(e){m.call(c,function(){var t,n,r,i=e._v,o=N(e);if(o&&(t=b(function(){I?R.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=I||N(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},U=function(e){m.call(c,function(){var t;I?R.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw E("Promise can't be resolved itself");(t=D(e))?v(function(){var r={_w:n,_d:!1};try{t.call(e,d(F,r,1),d(j,r,1))}catch(e){j.call(r,e)}}):(n._v=e,n._s=1,O(n,!1))}catch(e){j.call({_w:n,_d:!1},e)}}};M||(k=function(e){p(this,k,"Promise","_h"),h(e),r.call(this);try{e(d(F,this,1),d(j,this,1))}catch(e){j.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(k.prototype,{then:function(e,t){var n=A(g(this,k));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=I?R.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&O(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=d(F,e,1),this.reject=d(j,e,1)},y.f=A=function(e){return e===k||e===a?new o(e):i(e)}),u(u.G+u.W+u.F*!M,{Promise:k}),e("./_set-to-string-tag")(k,"Promise"),e("./_set-species")("Promise"),a=e("./_core").Promise,u(u.S+u.F*!M,"Promise",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),u(u.S+u.F*(s||!M),"Promise",{resolve:function(e){return S(s&&this===a?k:this,e)}}),u(u.S+u.F*!(M&&e("./_iter-detect")(function(e){k.all(e).catch(P)})),"Promise",{all:function(e){var t=this,n=A(t),r=n.resolve,i=n.reject,o=b(function(){var n=[],o=0,a=1;_(e,!1,function(e){var s=o++,c=!1;n.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,n[s]=e,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=A(t),r=n.reject,i=b(function(){_(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},{"./_a-function":39,"./_an-instance":41,"./_classof":44,"./_core":46,"./_ctx":48,"./_export":54,"./_for-of":56,"./_global":57,"./_is-object":66,"./_iter-detect":70,"./_library":73,"./_microtask":75,"./_new-promise-capability":76,"./_perform":89,"./_promise-resolve":90,"./_redefine-all":92,"./_set-species":95,"./_set-to-string-tag":96,"./_species-constructor":99,"./_task":101,"./_user-agent":109,"./_wks":112}],125:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":69,"./_string-at":100}],126:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_has"),o=e("./_descriptors"),a=e("./_export"),s=e("./_redefine"),c=e("./_meta").KEY,d=e("./_fails"),l=e("./_shared"),u=e("./_set-to-string-tag"),f=e("./_uid"),h=e("./_wks"),p=e("./_wks-ext"),_=e("./_wks-define"),g=e("./_enum-keys"),m=e("./_is-array"),v=e("./_an-object"),y=e("./_is-object"),b=e("./_to-object"),C=e("./_to-iobject"),S=e("./_to-primitive"),E=e("./_property-desc"),R=e("./_object-create"),T=e("./_object-gopn-ext"),w=e("./_object-gopd"),k=e("./_object-gops"),I=e("./_object-dp"),P=e("./_object-keys"),A=w.f,M=I.f,D=T.f,O=r.Symbol,x=r.JSON,N=x&&x.stringify,U=h("_hidden"),j=h("toPrimitive"),F={}.propertyIsEnumerable,L=l("symbol-registry"),V=l("symbols"),W=l("op-symbols"),B=Object.prototype,H="function"==typeof O&&!!k.f,z=r.QObject,G=!z||!z.prototype||!z.prototype.findChild,q=o&&d(function(){return 7!=R(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=A(B,t);r&&delete B[t],M(e,t,n),r&&e!==B&&M(B,t,r)}:M,J=function(e){var t=V[e]=R(O.prototype);return t._k=e,t},K=H&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},Z=function(e,t,n){return e===B&&Z(W,t,n),v(e),t=S(t,!0),v(n),i(V,t)?(n.enumerable?(i(e,U)&&e[U][t]&&(e[U][t]=!1),n=R(n,{enumerable:E(0,!1)})):(i(e,U)||M(e,U,E(1,{})),e[U][t]=!0),q(e,t,n)):M(e,t,n)},Y=function(e,t){v(e);for(var n,r=g(t=C(t)),i=0,o=r.length;o>i;)Z(e,n=r[i++],t[n]);return e},X=function(e){var t=F.call(this,e=S(e,!0));return!(this===B&&i(V,e)&&!i(W,e))&&(!(t||!i(this,e)||!i(V,e)||i(this,U)&&this[U][e])||t)},$=function(e,t){if(e=C(e),t=S(t,!0),e!==B||!i(V,t)||i(W,t)){var n=A(e,t);return!n||!i(V,t)||i(e,U)&&e[U][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=D(C(e)),r=[],o=0;n.length>o;)i(V,t=n[o++])||t==U||t==c||r.push(t);return r},ee=function(e){for(var t,n=e===B,r=D(n?W:C(e)),o=[],a=0;r.length>a;)!i(V,t=r[a++])||n&&!i(B,t)||o.push(V[t]);return o};H||(s((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===B&&t.call(W,n),i(this,U)&&i(this[U],e)&&(this[U][e]=!1),q(this,e,E(1,n))};return o&&G&&q(B,e,{configurable:!0,set:t}),J(e)}).prototype,"toString",function(){return this._k}),w.f=$,I.f=Z,e("./_object-gopn").f=T.f=Q,e("./_object-pie").f=X,k.f=ee,o&&!e("./_library")&&s(B,"propertyIsEnumerable",X,!0),p.f=function(e){return J(h(e))}),a(a.G+a.W+a.F*!H,{Symbol:O});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var re=P(h.store),ie=0;re.length>ie;)_(re[ie++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return i(L,e+="")?L[e]:L[e]=O(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){G=!0},useSimple:function(){G=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?R(e):Y(R(e),t)},defineProperty:Z,defineProperties:Y,getOwnPropertyDescriptor:$,getOwnPropertyNames:Q,getOwnPropertySymbols:ee});var oe=d(function(){k.f(1)});a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return k.f(b(e))}}),x&&a(a.S+a.F*(!H||d(function(){var e=O();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(y(t)||void 0!==e)&&!K(e))return m(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),r[1]=t,N.apply(x,r)}}),O.prototype[j]||e("./_hide")(O.prototype,j,O.prototype.valueOf),u(O,"Symbol"),u(Math,"Math",!0),u(r.JSON,"JSON",!0)},{"./_an-object":42,"./_descriptors":50,"./_enum-keys":53,"./_export":54,"./_fails":55,"./_global":57,"./_has":58,"./_hide":59,"./_is-array":65,"./_is-object":66,"./_library":73,"./_meta":74,"./_object-create":77,"./_object-dp":78,"./_object-gopd":80,"./_object-gopn":82,"./_object-gopn-ext":81,"./_object-gops":83,"./_object-keys":86,"./_object-pie":87,"./_property-desc":91,"./_redefine":93,"./_set-to-string-tag":96,"./_shared":98,"./_to-iobject":104,"./_to-object":106,"./_to-primitive":107,"./_uid":108,"./_wks":112,"./_wks-define":110,"./_wks-ext":111}],127:[function(e,t,n){"use strict";var r=e("./_export"),i=e("./_core"),o=e("./_global"),a=e("./_species-constructor"),s=e("./_promise-resolve");r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},{"./_core":46,"./_export":54,"./_global":57,"./_promise-resolve":90,"./_species-constructor":99}],128:[function(e,t,n){"use strict";var r=e("./_export"),i=e("./_new-promise-capability"),o=e("./_perform");r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},{"./_export":54,"./_new-promise-capability":76,"./_perform":89}],129:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":110}],130:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":110}],131:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),i=e("./_hide"),o=e("./_iterators"),a=e("./_wks")("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var d=s[c],l=r[d],u=l&&l.prototype;u&&!u[a]&&i(u,a,d),o[d]=o.Array}},{"./_global":57,"./_hide":59,"./_iterators":72,"./_wks":112,"./es6.array.iterator":117}],132:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var l=r.getMediaSections(i._localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+l.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,l=a.dtlsTransport,u=a.localCapabilities,f=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var h=r.getIceParameters(e,n),p=r.getDtlsParameters(e,n);s&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===d.state&&d.start(c,h,s?"controlling":"controlled"),"new"===l.state&&l.start(p));var _=o(u,f);i._transceive(a,_.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var u={};l.remoteStreams.forEach(function(e){u[e.id]=e});var f=[],h=r.splitSections(i.sdp),p=h.shift(),_=r.matchPrefix(p,"a=ice-lite").length>0,g=r.matchPrefix(p,"a=group:BUNDLE ").length>0;l.usingBundle=g;var m=r.matchPrefix(p,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!m&&m.substr(14).split(" ").indexOf("trickle")>=0,h.forEach(function(a,c){var d=r.splitLines(a),h=r.getKind(a),m=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,v=d[0].substr(2).split(" ")[2],y=r.getDirection(a,p),b=r.parseMsid(a),C=r.getMid(a)||r.generateIdentifier();if(m||"application"===h&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))l.transceivers[c]={mid:C,kind:h,protocol:v,rejected:!0};else{var S,E,R,T,w,k,I,P,A;!m&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(h,!0));var M,D,O=r.parseRtpParameters(a);m||(M=r.getIceParameters(a,p),(D=r.getDtlsParameters(a,p)).role="client"),I=r.parseRtpEncodingParameters(a);var x=r.parseRtcpParameters(a),N=r.matchPrefix(a,"a=end-of-candidates",p).length>0,U=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!m&&g&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||m){if("answer"===i.type&&!m){E=(S=l.transceivers[c]).iceGatherer,R=S.iceTransport,T=S.dtlsTransport,w=S.rtpReceiver,k=S.sendEncodingParameters,P=S.localCapabilities,l.transceivers[c].recvEncodingParameters=I,l.transceivers[c].remoteCapabilities=O,l.transceivers[c].rtcpParameters=x,U.length&&"new"===R.state&&(!_&&!N||g&&0!==c?U.forEach(function(e){s(S.iceTransport,e)}):R.setRemoteCandidates(U)),g&&0!==c||("new"===R.state&&R.start(E,M,"controlling"),"new"===T.state&&T.start(D)),!o(S.localCapabilities,S.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,l._transceive(S,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete S.rtpReceiver:(A=w.track,b?(u[b.stream]||(u[b.stream]=new e.MediaStream),n(A,u[b.stream]),f.push([A,w,u[b.stream]])):(u.default||(u.default=new e.MediaStream),n(A,u.default),f.push([A,w,u.default])))}}else{(S=l.transceivers[c]||l._createTransceiver(h)).mid=C,S.iceGatherer||(S.iceGatherer=l._createIceGatherer(c,g)),U.length&&"new"===S.iceTransport.state&&(!N||g&&0!==c?U.forEach(function(e){s(S.iceTransport,e)}):S.iceTransport.setRemoteCandidates(U)),P=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),k=S.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,F=!1;if("sendrecv"===y||"sendonly"===y){if(F=!S.rtpReceiver,w=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,h),F)A=w.track,b&&"-"===b.stream||(b?(u[b.stream]||(u[b.stream]=new e.MediaStream,Object.defineProperty(u[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(A,"id",{get:function(){return b.track}}),j=u[b.stream]):(u.default||(u.default=new e.MediaStream),j=u.default)),j&&(n(A,j),S.associatedRemoteMediaStreams.push(j)),f.push([A,w,j])}else S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(t){var n,r,i=t.getTracks().find(function(e){return e.id===S.rtpReceiver.track.id});i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),S.associatedRemoteMediaStreams=[]);S.localCapabilities=P,S.remoteCapabilities=O,S.rtpReceiver=w,S.rtcpParameters=x,S.sendEncodingParameters=k,S.recvEncodingParameters=I,l._transceive(l.transceivers[c],!1,F)}}}),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(u).forEach(function(t){var n=u[t];if(n.getTracks().length){if(-1===l.remoteStreams.indexOf(n)){l.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){l._dispatchEvent("addstream",r)})}f.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&d(l,t,r,[n])})}}),f.forEach(function(e){e[2]||d(l,e[0],e[1],[])}),e.setTimeout(function(){l&&l.transceivers&&l.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,a=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var d=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(d+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<n.transceivers.length;d++)if(n.transceivers[d].mid===e.sdpMid){a=d;break}var l=n.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var u=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===a||a>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,u))return o(c("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(u.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));h++);i()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var u=["createOffer","createAnswer"];return u.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},{sdp:133}],133:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i,o=void 0!==t?t:2;return i=e||r.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}],134:[function(e,t,n){!function(e,r){"use strict";var i="model",o="name",a="type",s="vendor",c="version",d="mobile",l="tablet",u="smarttv",f=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},h=function(e,t){return"string"==typeof e&&-1!==p(t).indexOf(p(e))},p=function(e){return e.toLowerCase()},_=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,""),void 0===t?e:e.substring(0,500)},g=function(e,t){for(var n,r,i,o,a,s,c=0;c<t.length&&!a;){var d=t[c],l=t[c+1];for(n=r=0;n<d.length&&!a&&d[n];)if(a=d[n++].exec(e))for(i=0;i<l.length;i++)s=a[++r],"object"==typeof(o=l[i])&&o.length>0?2===o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3===o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4===o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0;c+=2}},m=function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(h(t[n][r],e))return"?"===n?void 0:n}else if(h(t[n],e))return"?"===n?void 0:n;return t.hasOwnProperty("*")?t["*"]:e},v={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[c,[o,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[c,[o,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[o,c],[/opios[\/ ]+([\w\.]+)/i],[c,[o,"Opera Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[c,[o,"Opera GX"]],[/\bopr\/([\w\.]+)/i],[c,[o,"Opera"]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[c,[o,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[c,[o,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[o,c],[/quark(?:pc)?\/([-\w\.]+)/i],[c,[o,"Quark"]],[/\bddg\/([\w\.]+)/i],[c,[o,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[c,[o,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[c,[o,"WeChat"]],[/konqueror\/([\w\.]+)/i],[c,[o,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[c,[o,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[c,[o,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[c,[o,"Smart Lenovo Browser"]],[/(avast|avg)\/([\w\.]+)/i],[[o,/(.+)/,"$1 Secure Browser"],c],[/\bfocus\/([\w\.]+)/i],[c,[o,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[c,[o,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[c,[o,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[c,[o,"Dolphin"]],[/coast\/([\w\.]+)/i],[c,[o,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[c,[o,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[c,[o,"Firefox"]],[/\bqihoobrowser\/?([\w\.]*)/i],[c,[o,"360"]],[/\b(qq)\/([\w\.]+)/i],[[o,/(.+)/,"$1Browser"],c],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[o,/(.+)/,"$1 Browser"],c],[/samsungbrowser\/([\w\.]+)/i],[c,[o,"Samsung Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[c,[o,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[o,"Sogou Mobile"],c],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[o,c],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[o],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[c,o],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[o,"Facebook"],c],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[o,c],[/\bgsa\/([\w\.]+) .*safari\//i],[c,[o,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[c,[o,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[c,[o,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[o,"Chrome WebView"],c],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[c,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[o,c],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[c,[o,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[c,o],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[o,[c,m,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[o,c],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[o,"Netscape"],c],[/(wolvic|librewolf)\/([\w\.]+)/i],[o,c],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[c,[o,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[o,[c,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[o,[c,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",p]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",p]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",p]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[i,[s,"Samsung"],[a,l]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[i,[s,"Samsung"],[a,d]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[i,[s,"Apple"],[a,d]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[i,[s,"Apple"],[a,l]],[/(macintosh);/i],[i,[s,"Apple"]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[i,[s,"Sharp"],[a,d]],[/(?:honor)([-\w ]+)[;\)]/i],[i,[s,"Honor"],[a,d]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[i,[s,"Huawei"],[a,l]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[i,[s,"Huawei"],[a,d]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[i,/_/g," "],[s,"Xiaomi"],[a,d]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[i,/_/g," "],[s,"Xiaomi"],[a,l]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[i,[s,"OPPO"],[a,d]],[/\b(opd2\d{3}a?) bui/i],[i,[s,"OPPO"],[a,l]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[i,[s,"Vivo"],[a,d]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[i,[s,"Realme"],[a,d]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[i,[s,"Motorola"],[a,d]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[i,[s,"Motorola"],[a,l]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[i,[s,"LG"],[a,l]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[i,[s,"LG"],[a,d]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[i,[s,"Lenovo"],[a,l]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[i,/_/g," "],[s,"Nokia"],[a,d]],[/(pixel c)\b/i],[i,[s,"Google"],[a,l]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[i,[s,"Google"],[a,d]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[i,[s,"Sony"],[a,d]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[i,"Xperia Tablet"],[s,"Sony"],[a,l]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[i,[s,"OnePlus"],[a,d]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[i,[s,"Amazon"],[a,l]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[i,/(.+)/g,"Fire Phone $1"],[s,"Amazon"],[a,d]],[/(playbook);[-\w\),; ]+(rim)/i],[i,s,[a,l]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[i,[s,"BlackBerry"],[a,d]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[i,[s,"ASUS"],[a,l]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[i,[s,"ASUS"],[a,d]],[/(nexus 9)/i],[i,[s,"HTC"],[a,l]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[s,[i,/_/g," "],[a,d]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[i,[s,"TCL"],[a,l]],[/(itel) ((\w+))/i],[[s,p],i,[a,m,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[i,[s,"Acer"],[a,l]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[i,[s,"Meizu"],[a,d]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[i,[s,"Ulefone"],[a,d]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[i,[s,"Energizer"],[a,d]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[i,[s,"Cat"],[a,d]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[i,[s,"Smartfren"],[a,d]],[/droid.+; (a(?:015|06[35]|142p?))/i],[i,[s,"Nothing"],[a,d]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[s,i,[a,d]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[s,i,[a,l]],[/(surface duo)/i],[i,[s,"Microsoft"],[a,l]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[i,[s,"Fairphone"],[a,d]],[/(u304aa)/i],[i,[s,"AT&T"],[a,d]],[/\bsie-(\w*)/i],[i,[s,"Siemens"],[a,d]],[/\b(rct\w+) b/i],[i,[s,"RCA"],[a,l]],[/\b(venue[\d ]{2,7}) b/i],[i,[s,"Dell"],[a,l]],[/\b(q(?:mv|ta)\w+) b/i],[i,[s,"Verizon"],[a,l]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[i,[s,"Barnes & Noble"],[a,l]],[/\b(tm\d{3}\w+) b/i],[i,[s,"NuVision"],[a,l]],[/\b(k88) b/i],[i,[s,"ZTE"],[a,l]],[/\b(nx\d{3}j) b/i],[i,[s,"ZTE"],[a,d]],[/\b(gen\d{3}) b.+49h/i],[i,[s,"Swiss"],[a,d]],[/\b(zur\d{3}) b/i],[i,[s,"Swiss"],[a,l]],[/\b((zeki)?tb.*\b) b/i],[i,[s,"Zeki"],[a,l]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[s,"Dragon Touch"],i,[a,l]],[/\b(ns-?\w{0,9}) b/i],[i,[s,"Insignia"],[a,l]],[/\b((nxa|next)-?\w{0,9}) b/i],[i,[s,"NextBook"],[a,l]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[s,"Voice"],i,[a,d]],[/\b(lvtel\-)?(v1[12]) b/i],[[s,"LvTel"],i,[a,d]],[/\b(ph-1) /i],[i,[s,"Essential"],[a,d]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[i,[s,"Envizen"],[a,l]],[/\b(trio[-\w\. ]+) b/i],[i,[s,"MachSpeed"],[a,l]],[/\btu_(1491) b/i],[i,[s,"Rotor"],[a,l]],[/(shield[\w ]+) b/i],[i,[s,"Nvidia"],[a,l]],[/(sprint) (\w+)/i],[s,i,[a,d]],[/(kin\.[onetw]{3})/i],[[i,/\./g," "],[s,"Microsoft"],[a,d]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[i,[s,"Zebra"],[a,l]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[i,[s,"Zebra"],[a,d]],[/smart-tv.+(samsung)/i],[s,[a,u]],[/hbbtv.+maple;(\d+)/i],[[i,/^/,"SmartTV"],[s,"Samsung"],[a,u]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[s,"LG"],[a,u]],[/(apple) ?tv/i],[s,[i,"Apple TV"],[a,u]],[/crkey/i],[[i,"Chromecast"],[s,"Google"],[a,u]],[/droid.+aft(\w+)( bui|\))/i],[i,[s,"Amazon"],[a,u]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[i,[s,"Sharp"],[a,u]],[/(bravia[\w ]+)( bui|\))/i],[i,[s,"Sony"],[a,u]],[/(mitv-\w{5}) bui/i],[i,[s,"Xiaomi"],[a,u]],[/Hbbtv.*(technisat) (.*);/i],[s,i,[a,u]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[s,_],[i,_],[a,u]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[a,u]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[s,i,[a,"console"]],[/droid.+; (shield) bui/i],[i,[s,"Nvidia"],[a,"console"]],[/(playstation [345portablevi]+)/i],[i,[s,"Sony"],[a,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[i,[s,"Microsoft"],[a,"console"]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[i,[s,"Samsung"],[a,"wearable"]],[/((pebble))app/i],[s,i,[a,"wearable"]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[i,[s,"Apple"],[a,"wearable"]],[/droid.+; (glass) \d/i],[i,[s,"Google"],[a,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[i,[s,"Zebra"],[a,"wearable"]],[/droid.+; (glass) \d/i],[i,[s,"Google"],[a,"wearable"]],[/(pico) (4|neo3(?: link|pro)?)/i],[s,i,[a,"wearable"]],[/; (quest( \d| pro)?)/i],[i,[s,"Facebook"],[a,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[s,[a,"embedded"]],[/(aeobc)\b/i],[i,[s,"Amazon"],[a,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[i,[a,d]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[i,[a,l]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[a,l]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[a,d]],[/(android[-\w\. ]{0,9});.+buil/i],[i,[s,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[c,[o,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[o,c],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[c,[o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[o,c],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[c,o]],os:[[/microsoft (windows) (vista|xp)/i],[o,c],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[o,[c,m,v]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,m,v],[o,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[c,/_/g,"."],[o,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[o,"Mac OS"],[c,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[c,o],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[o,c],[/\(bb(10);/i],[c,[o,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[c,[o,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[c,[o,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[c,[o,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[c,[o,"watchOS"]],[/crkey\/([\d\.]+)/i],[c,[o,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[o,"Chromium OS"],c],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[o,c],[/(sunos) ?([\w\.\d]*)/i],[[o,"Solaris"],c],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[o,c]]},b=function(t,n){if("object"==typeof t&&(n=t,t=void 0),!(this instanceof b))return new b(t,n).getResult();var r=void 0!==e&&e.navigator?e.navigator:void 0,i=t||(r&&r.userAgent?r.userAgent:""),o=r&&r.userAgentData?r.userAgentData:void 0,a=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(y,n):y,s=r&&r.userAgent==i;return this.getBrowser=function(){var e,t={};return t.name=void 0,t.version=void 0,g.call(t,i,a.browser),t.major="string"==typeof(e=t.version)?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,s&&r&&r.brave&&"function"==typeof r.brave.isBrave&&(t.name="Brave"),t},this.getCPU=function(){var e={architecture:void 0};return g.call(e,i,a.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return g.call(e,i,a.device),s&&!e.type&&o&&o.mobile&&(e.type=d),s&&"Macintosh"==e.model&&r&&void 0!==r.standalone&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e.model="iPad",e.type=l),e},this.getEngine=function(){var e={name:void 0,version:void 0};return g.call(e,i,a.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return g.call(e,i,a.os),s&&!e.name&&o&&o.platform&&"Unknown"!=o.platform&&(e.name=o.platform.replace(/chrome os/i,"Chromium OS").replace(/macos/i,"Mac OS")),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i="string"==typeof e&&e.length>500?_(e,500):e,this},this.setUA(i),this};b.VERSION="1.0.40",b.BROWSER=f([o,c,"major"]),b.CPU=f(["architecture"]),b.DEVICE=f([i,s,a,"console",d,u,l,"wearable","embedded"]),b.ENGINE=b.OS=f([o,c]),void 0!==n?(void 0!==t&&t.exports&&(n=t.exports=b),n.UAParser=b):"function"==typeof define&&define.amd?define(function(){return b}):void 0!==e&&(e.UAParser=b);var C=void 0!==e&&(e.jQuery||e.Zepto);if(C&&!C.ua){var S=new b;C.ua=S.getResult(),C.ua.get=function(){return S.getUA()},C.ua.set=function(e){S.setUA(e);var t=S.getResult();for(var n in t)C.ua[n]=t[n]}}}("object"==typeof window?window:this)},{}],135:[function(e,t,n){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},{}],136:[function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],137:[function(e,t,n){var r=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},{"./lib/bytesToUuid":135,"./lib/rng":136}],138:[function(e,t,n){(function(n){(function(){"use strict";var r=e("./adapter_factory.js");t.exports=r({window:n.window})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":139}],139:[function(e,t,n){"use strict";var r=e("./utils");t.exports=function(t,n){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in n)hasOwnProperty.call(n,a)&&(o[a]=n[a]);var s=r.log,c=r.detectBrowser(i),d=e("./chrome/chrome_shim")||null,l=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,f=e("./safari/safari_shim")||null,h=e("./common_shim")||null,p={browserDetails:c,commonShim:h,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),p;s("adapter.js shimming chrome."),p.browserShim=d,h.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),d.fixNegotiationNeeded(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),p;s("adapter.js shimming firefox."),p.browserShim=u,h.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"edge":if(!l||!l.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),p;s("adapter.js shimming edge."),p.browserShim=l,h.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimPeerConnection(i),l.shimReplaceTrack(i),l.shimGetDisplayMedia(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;case"safari":if(!f||!o.shimSafari)return s("Safari shim is not included in this adapter release."),p;s("adapter.js shimming safari."),p.browserShim=f,h.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCreateOfferLegacy(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimTrackEventTransceiver(i),f.shimGetUserMedia(i),h.shimRTCIceCandidate(i),h.shimMaxMessageSize(i),h.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return p}},{"./chrome/chrome_shim":140,"./common_shim":142,"./edge/edge_shim":143,"./firefox/firefox_shim":146,"./safari/safari_shim":148,"./utils":149}],140:[function(e,t,n){"use strict";var r=e("../utils.js"),i=r.log;function o(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(function(i){i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(function(n){e(t,t.get(n),r)})}))}(e,n,i)})}),i}t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?r=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(n?r=!0:n=e),e.track===i}),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var t=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}i.apply(n,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(t){return c(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(r){n._streams[r].getTracks().find(function(t){return e.track===t})&&(t=n._streams[r])}),t&&(1===t.getTracks().length?n.removeStream(n._reverseStreams[t.id]):t.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof arguments[0]))return n.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return n.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){n.apply(i,[function(t){e(s(a(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){r.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||("function"==typeof t?(e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})},e.navigator.getDisplayMedia=function(t){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},{"../utils.js":149,"./getusermedia":141}],141:[function(e,t,n){"use strict";var r=e("../utils.js"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,d=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==c.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};var c=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":149}],142:[function(e,t,n){"use strict";var r=e("sdp"),i=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,i,o,a;if(this._sctp=null,o=arguments[0],(a=r.splitSections(o.sdp)).shift(),a.some(function(e){var t=r.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var s,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),d=(e=c,i=65536,"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i),l=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=r.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],c);s=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var u={};Object.defineProperty(u,"maxMessageSize",{get:function(){return s}}),this._sctp=u}return n.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return n(e.channel,e.target),e})}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}}},{"./utils":149,sdp:133}],143:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./filtericeservers"),o=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,t){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var n=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(t){return n.call(e.navigator,t)},e.navigator.getDisplayMedia=function(t){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),n.call(e.navigator,t)}}}}},{"../utils":149,"./filtericeservers":144,"./getusermedia":145,"rtcpeerconnection-shim":132}],144:[function(e,t,n){"use strict";var r=e("../utils");t.exports=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},{"../utils":149}],145:[function(e,t,n){"use strict";t.exports=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],146:[function(e,t,n){"use strict";var r=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)},e.navigator.getDisplayMedia=function(t){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)})}}},{"../utils":149,"./getusermedia":147}],147:[function(e,t,n){"use strict";var r=e("../utils"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){s(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},o&&o.prototype.getSettings){var f=o.prototype.getSettings;o.prototype.getSettings=function(){var e=f.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":149}],148:[function(e,t,n){"use strict";var r=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}}},{"../utils":149}],149:[function(e,t,n){"use strict";var r=!0,i=!0;function o(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}t.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},{}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.UNDEFINED="undefined",n.DCV_STRATEGY="DCVStrategy",n.AUDIO="audio",n.ANSWER="answer",n.CHROME="chrome"},{}],151:[function(e,t,n){(function(t){(function(){"use strict";e("webrtc-adapter");var n=u(e("./rtc_session")),r=e("./rtc_const"),i=u(e("./rtc_peer_connection_factory")),o=u(e("uuid/v4")),a=u(e("./strategies/StandardStrategy")),s=u(e("./strategies/CitrixVDIStrategy")),c=u(e("./strategies/DCVWebRTCStrategy")),d=u(e("./strategies/OmnissaVDIStrategy")),l=u(e("./rtc_peer_connection_manager"));function u(e){return e&&e.__esModule?e:{default:e}}t.connect=t.connect||{},t.connect.RTCSession=n.default,t.connect.RTCErrors=r.RTC_ERRORS,t.connect.RtcPeerConnectionFactory=i.default,t.connect.RtcPeerConnectionManager=l.default,t.connect.uuid=o.default,t.connect.StandardStrategy=a.default,t.connect.CitrixVDIStrategy=s.default,t.connect.DCVWebRTCStrategy=c.default,t.connect.OmnissaVDIStrategy=d.default,t.lily=t.lily||{},t.lily.RTCSession=n.default,t.lily.RTCErrors=r.RTC_ERRORS}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./rtc_const":153,"./rtc_peer_connection_factory":154,"./rtc_peer_connection_manager":155,"./rtc_session":156,"./strategies/CitrixVDIStrategy":162,"./strategies/DCVWebRTCStrategy":163,"./strategies/OmnissaVDIStrategy":164,"./strategies/StandardStrategy":165,"uuid/v4":137,"webrtc-adapter":138}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignalingChannelDownError=n.SignalingChannelDownErrorName=n.AccessDeniedException=n.AccessDeniedExceptionName=n.UnknownSignalingError=n.UnknownSignalingErrorName=n.IdempotencyException=n.IdempotencyExceptionName=n.BadRequestException=n.BadRequestExceptionName=n.InternalServerException=n.InternalServerExceptionName=n.RequestTimeoutException=n.RequestTimeoutExceptionName=n.CallNotFoundException=n.CallNotFoundExceptionName=n.BusyException=n.BusyExceptionName=n.UnsupportedOperation=n.UnsupportedOperationExceptionName=n.IllegalState=n.IllegalStateExceptionName=n.IllegalParameters=n.IllegalParametersExceptionName=n.GumTimeout=n.GumTimeoutExceptionName=n.Timeout=n.TimeoutExceptionName=void 0;var r=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}var s=n.TimeoutExceptionName="Timeout",c=n.Timeout=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=s,n}return(0,o.default)(t,e),t}(Error),d=n.GumTimeoutExceptionName="GumTimeout",l=(n.GumTimeout=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=d,n}return(0,o.default)(t,e),t}(c),n.IllegalParametersExceptionName="IllegalParameters"),u=(n.IllegalParameters=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=l,n}return(0,o.default)(t,e),t}(Error),n.IllegalStateExceptionName="IllegalState"),f=(n.IllegalState=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=u,n}return(0,o.default)(t,e),t}(Error),n.UnsupportedOperationExceptionName="UnsupportedOperation"),h=(n.UnsupportedOperation=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=f,n}return(0,o.default)(t,e),t}(Error),n.BusyExceptionName="BusyException"),p=(n.BusyException=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=h,n}return(0,o.default)(t,e),t}(Error),n.CallNotFoundExceptionName="CallNotFoundException"),_=(n.CallNotFoundException=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=p,n}return(0,o.default)(t,e),t}(Error),n.RequestTimeoutExceptionName="RequestTimeoutException"),g=(n.RequestTimeoutException=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=_,e}return(0,o.default)(t,e),t}(Error),n.InternalServerExceptionName="InternalServerException"),m=(n.InternalServerException=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=g,e}return(0,o.default)(t,e),t}(Error),n.BadRequestExceptionName="BadRequestException"),v=(n.BadRequestException=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=m,n}return(0,o.default)(t,e),t}(Error),n.IdempotencyExceptionName="IdempotencyException"),y=(n.IdempotencyException=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=v,e}return(0,o.default)(t,e),t}(Error),n.UnknownSignalingErrorName="UnknownSignalingError"),b=(n.UnknownSignalingError=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=y,e}return(0,o.default)(t,e),t}(Error),n.AccessDeniedExceptionName="AccessDeniedException"),C=(n.AccessDeniedException=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=b,e}return(0,o.default)(t,e),t}(Error),n.SignalingChannelDownErrorName="SignalingChannelDownError");n.SignalingChannelDownError=function(e){function t(){(0,r.default)(this,t);var e=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name=C,e}return(0,o.default)(t,e),t}(Error)},{"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.MAX_ACCEPT_BYE_DELAY_MS=2e3,n.MAX_INVITE_DELAY_MS=5e3,n.DEFAULT_CONNECT_TIMEOUT_MS=1e4,n.DEFAULT_ICE_TIMEOUT_MS=8e3,n.DEFAULT_GUM_TIMEOUT_MS=1e4,n.SOFTPHONE_ROUTE_KEY="aws/softphone",n.INVITE_METHOD_NAME="invite",n.ACCEPT_METHOD_NAME="accept",n.BYE_METHOD_NAME="bye",n.PC_BYE_METHOD_NAME="PCBye",n.CONNECT_CONTACT_METHOD_NAME="connectContact",n.DISCONNECT_CONTACT_METHOD_NAME="disconnectContact",n.RTC_PEER_CONNECTION_CONFIG={iceTransportPolicy:"relay",rtcpMuxPolicy:"require",bundlePolicy:"balanced",sdpSemantics:"unified-plan",enableDtlsSrtp:!0},n.RTC_PEER_CONNECTION_OPTIONAL_CONFIG={optional:[{googDscp:!0},{DtlsSrtpKeyAgreement:!0}]},n.DEFAULT_ICE_CANDIDATE_POOL_SIZE=1,n.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS=6e4,n.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS=250,n.CHROME_SUPPORTED_VERSION=59,n.RTC_ERRORS={ICE_COLLECTION_TIMEOUT:"Ice Collection Timeout",USER_BUSY:"User Busy",SIGNALLING_CONNECTION_FAILURE:"Signalling Connection Failure",SIGNALLING_HANDSHAKE_FAILURE:"Signalling Handshake Failure",SET_REMOTE_DESCRIPTION_FAILURE:"Set Remote Description Failure",CREATE_OFFER_FAILURE:"Create Offer Failure",SET_LOCAL_DESCRIPTION_FAILURE:"Set Local Description Failure",INVALID_REMOTE_SDP:"Invalid Remote SDP",NO_REMOTE_ICE_CANDIDATE:"No Remote ICE Candidate",GUM_TIMEOUT_FAILURE:"GUM Timeout Failure",GUM_OTHER_FAILURE:"GUM Other Failure",CALL_NOT_FOUND:"Call Not Found",ACCESS_DENIED:"Access Denied"},n.ICE_CONNECTION_STATE={NEW:"new",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},n.PEER_CONNECTION_STATE={NEW:"new",CONNECTING:"connecting",CONNECTED:"connected",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},n.RTC_SESSION_STATE={TALKING_STATE:"TalkingState",GRAB_LOCAL_MEDIA_STATE:"GrabLocalMediaState",CREATE_OFFER_STATE:"CreateOfferState",SET_LOCAL_SESSION_DESCRIPTION_STATE:"SetLocalSessionDescriptionState",CONNECT_SIGNALING_AND_ICE_COLLECTION_STATE:"ConnectSignalingAndIceCollectionState",INVITE_ANSWER_STATE:"InviteAnswerState",ACCEPT_STATE:"AcceptState",CONNECT_CONTACT_STATE:"ConnectContactState",CLEAN_UP_STATE:"CleanUpState",DISCONNECTED_STATE:"DisconnectedState"},n.BROWSER_LIST=["Google Chrome","Microsoft Edge","Firefox"],n.FIREFOX="Firefox",n.ACITVE_SOFTPHONE_TAB="Active Softphone Tab"},{}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=d(e("babel-runtime/helpers/classCallCheck")),i=d(e("babel-runtime/helpers/createClass")),o=e("./utils"),a=e("./rtc_const"),s=d(e("./strategies/CCPInitiationStrategyInterface")),c=d(e("./strategies/StandardStrategy"));function d(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,n,i,a,d){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new c.default;if((0,r.default)(this,e),!(l instanceof s.default))throw new Error("Expected a strategy of type CCPInitiationStrategyInterface");(0,o.assertTrue)((0,o.isFunction)(a),"transportHandle must be a function"),(0,o.assertTrue)((0,o.isFunction)(d),"publishError must be a function"),this._strategy=l,this._logger=t,this._clientId=i,this._wssManager=n,this._requestIceAccess=a,this._publishError=d,this._earlyMediaConnectionSupported=this._isEarlyMediaConnectionSupported(),this._initializeWebSocketEventListeners(),this._requestPeerConnection(),this._networkConnectivityChecker(),this._logger.log("RTC.js is using "+l.getStrategyName())}return(0,i.default)(e,[{key:"_isEarlyMediaConnectionSupported",value:function(){return this._strategy._isEarlyMediaConnectionSupported()}},{key:"_webSocketManagerOnMessage",value:function(e){var t=void 0;e.content&&(t=JSON.parse(e.content)),t&&this._clientId===t.clientId&&("idleConnection"===t.jsonRpcMsg.method?this._clearIdleRtcPeerConnection():"quotaBreached"===t.jsonRpcMsg.method&&(this._logger.log("Number of active sessions are more then allowed limit for the client "+this._clientId),this._closeRTCPeerConnection(),this._publishError("multiple_softphone_active_sessions","Number of active sessions are more then allowed limit.")))}},{key:"_initializeWebSocketEventListeners",value:function(){this._wssManager.subscribeTopics([a.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(a.SOFTPHONE_ROUTE_KEY,(0,o.hitch)(this,this._webSocketManagerOnMessage))}},{key:"get",value:function(e){var t=this._idlePc;return this._idlePc=null,null==t&&(t=this._createRtcPeerConnection(e)),this.clearIdleRtcPeerConnectionTimerId(),this._requestPeerConnection(),t}},{key:"clearIdleRtcPeerConnectionTimerId",value:function(){this._idleRtcPeerConnectionTimerId&&(clearTimeout(this._idleRtcPeerConnectionTimerId),this._idleRtcPeerConnectionTimerId=null)}},{key:"_requestPeerConnection",value:function(){var e=this;!e._peerConnectionRequestInFlight&&e._earlyMediaConnectionSupported&&(e._peerConnectionRequestInFlight=!0,e._requestIceAccess().then(function(t){e._idlePc=e._createRtcPeerConnection(t),e._peerConnectionRequestInFlight=!1,e._idleRtcPeerConnectionTimerId=setTimeout((0,o.hitch)(e,e._refreshRtcPeerConnection),a.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS)},function(t){e._peerConnectionRequestInFlight=!1}))}},{key:"_networkConnectivityChecker",value:function(){var e=this;setInterval(function(){!navigator.onLine&&e._idlePc&&(e._logger.log("Network offline. Cleaning up early connection"),e._idlePc.close(),e._idlePc=null)},a.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS)}},{key:"_createRtcPeerConnection",value:function(e){var t=JSON.parse(JSON.stringify(a.RTC_PEER_CONNECTION_CONFIG));return t.iceServers=e,t.iceCandidatePoolSize=a.DEFAULT_ICE_CANDIDATE_POOL_SIZE,this._strategy._createRtcPeerConnection(t,a.RTC_PEER_CONNECTION_OPTIONAL_CONFIG)}},{key:"_clearIdleRtcPeerConnection",value:function(){this._logger.log("session is idle from long time. closing the peer connection for client "+this._clientId),this._closeRTCPeerConnection()}},{key:"_refreshRtcPeerConnection",value:function(){this._idleRtcPeerConnectionTimerId=null,this._clearIdleRtcPeerConnection(),this._logger.log("RtcPeerConnectionFactory is refreshing peer connection for client "+this._clientId),this._requestPeerConnection()}},{key:"_closeRTCPeerConnection",value:function(){this._idlePc&&(this._idlePc.close(),this._idlePc=null)}},{key:"close",value:function(){this._logger.log("close method invoked. Clear timer and close idle peer connection "+this._clientId),this.clearIdleRtcPeerConnectionTimerId(),this._closeRTCPeerConnection()}}]),e}();n.default=l},{"./rtc_const":153,"./strategies/CCPInitiationStrategyInterface":161,"./strategies/StandardStrategy":165,"./utils":167,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}],155:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=_(e("babel-runtime/regenerator")),i=_(e("babel-runtime/helpers/asyncToGenerator")),o=_(e("babel-runtime/helpers/typeof")),a=_(e("babel-runtime/helpers/classCallCheck")),s=_(e("babel-runtime/helpers/createClass")),c=_(e("uuid/v4")),d=_(e("./strategies/StandardStrategy")),l=_(e("./strategies/CCPInitiationStrategyInterface")),u=_(e("./rtc_session")),f=e("./exceptions"),h=e("./utils"),p=e("./rtc_const");function _(e){return e&&e.__esModule?e:{default:e}}var g=function(){function e(t,n,r,i,s,u,p,_,g,m){var v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new d.default,y=this,b=arguments[11],C=arguments[12];if((0,a.default)(this,e),e.instance)p.info("Peer Connection Manager has already been initialized");else{if((0,h.assertTrue)((0,h.isFunction)(r),"transportHandle must be a function"),(0,h.assertTrue)((0,h.isFunction)(i),"publishError must be a function"),!p||"object"!==(void 0===p?"undefined":(0,o.default)(p)))throw new f.IllegalParameters("logger required");if(this._callId=_||(0,c.default)(),this._connectionId=g||(0,c.default)(),!(v instanceof l.default))throw new Error("Expected a strategy of type CCPInitiationStrategyInterface");this._strategy=v,this._wssManager=m,this._signalingUri=t,this._iceServers=n,this._contactToken=u,this._originalLogger=p,this._logger=(0,h.wrapLogger)(this._originalLogger,"","RtcPeerConnectionManager"),this._isPPCEnabled=b,this._isRTPSAllowlisted=!1,this._peerConnectionId=null,this._browserId=C,this._clientId=s,this._requestIceAccess=r,this._publishError=i,this._initializeWebSocketEventListeners(),this.requestPeerConnection().then(function(){y.isPersistentConnectionEnabled()&&!y._contactToken&&(y.createSession(),y._rtcSessionConnectPromise=y.connect())}),this._networkConnectivityChecker(),e.instance=this,this._logger.info("Initializing Peer Connection Manager..."),this._logger.log("RTC.js is using "+v.getStrategyName())}return this.browserTabCloseEventListener(),e.instance}return(0,s.default)(e,[{key:"_isEarlyMediaConnectionSupported",value:function(){return!this.isPersistentConnectionEnabled()&&this._strategy._isEarlyMediaConnectionSupported()}},{key:"_webSocketManagerOnMessage",value:function(e){var t=void 0;e.content&&(t=JSON.parse(e.content)),t&&this._clientId===t.clientId&&("idleConnection"===t.jsonRpcMsg.method?this._clearIdleRtcPeerConnection():"quotaBreached"===t.jsonRpcMsg.method&&(this._logger.log("Number of active sessions are more then allowed limit for the client "+this._clientId),this._closeIdleRTCPeerConnection(),this._publishError("multiple_softphone_active_sessions","Number of active sessions are more then allowed limit.")))}},{key:"_initializeWebSocketEventListeners",value:function(){this._wssManager.subscribeTopics([p.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(p.SOFTPHONE_ROUTE_KEY,(0,h.hitch)(this,this._webSocketManagerOnMessage))}},{key:"getPeerConnection",value:function(){var e;return this.isPersistentConnectionEnabled()?null!==(e=this._pc)&&void 0!==e||(e=this._createRtcPeerConnection(this._iceServers)):(e=this._idlePc,this._idlePc=null,null!==e&&void 0!==e||(e=this._createRtcPeerConnection(this._iceServers)),this.clearIdleRtcPeerConnectionTimerId(),this.requestPeerConnection()),this._pc=e,e}},{key:"clearIdleRtcPeerConnectionTimerId",value:function(){this._idleRtcPeerConnectionTimerId&&(clearTimeout(this._idleRtcPeerConnectionTimerId),this._idleRtcPeerConnectionTimerId=null)}},{key:"requestPeerConnection",value:function(){var e=(0,i.default)(r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)._earlyMediaConnectionSupported=t._isEarlyMediaConnectionSupported(),!t.isPersistentConnectionEnabled()||t._contactToken){e.next=11;break}return t._logger.info("RtcPeerConnectionManager initiates persistent peer connection"),e.next=6,t._requestIceAccess().catch(function(e){t._logger.info("RtcPeerConnectionManager request ICE access failed for persistent peer connection creation. ",e)});case 6:n=e.sent,t._iceServers=n,t._pc=t._createRtcPeerConnection(n),e.next=12;break;case 11:t.isPersistentConnectionEnabled()||t._peerConnectionRequestInFlight||!t._earlyMediaConnectionSupported||(t._logger.info("RtcPeerConnectionManager initiates idle peer connection for non-persistent connection"),t._peerConnectionRequestInFlight=!0,t._requestIceAccess().then(function(e){t._idlePc=t._createRtcPeerConnection(e),t._peerConnectionRequestInFlight=!1,t._idleRtcPeerConnectionTimerId=setTimeout((0,h.hitch)(t,t._refreshRtcPeerConnection),p.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS)},function(e){t._peerConnectionRequestInFlight=!1}).catch(function(e){t._logger.info("RtcPeerConnectionManager request ICE access failed for idle peer connection creation. ",e)}));case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_networkConnectivityChecker",value:function(){var e=this;setInterval(function(){!navigator.onLine&&e._idlePc&&(e._logger.log("Network offline. Cleaning up early connection"),e._idlePc.close(),e._idlePc=null)},p.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS)}},{key:"_createRtcPeerConnection",value:function(e){var t=JSON.parse(JSON.stringify(p.RTC_PEER_CONNECTION_CONFIG));return t.iceServers=e,t.iceCandidatePoolSize=p.DEFAULT_ICE_CANDIDATE_POOL_SIZE,this._strategy._createRtcPeerConnection(t,p.RTC_PEER_CONNECTION_OPTIONAL_CONFIG)}},{key:"_clearIdleRtcPeerConnection",value:function(){this._logger.log("session is idle from long time. closing the peer connection for client "+this._clientId),this._closeIdleRTCPeerConnection()}},{key:"_refreshRtcPeerConnection",value:function(){this._idleRtcPeerConnectionTimerId=null,this._clearIdleRtcPeerConnection(),this._logger.log("RtcPeerConnectionManager is refreshing peer connection for client "+this._clientId),this.requestPeerConnection()}},{key:"_closeIdleRTCPeerConnection",value:function(){this._idlePc&&(this._idlePc.close(),this._idlePc=null)}},{key:"closeEarlyMediaConnection",value:function(){this._logger.log("close method invoked. Clear timer and close idle peer connection "+this._clientId),this.clearIdleRtcPeerConnectionTimerId(),this._closeIdleRTCPeerConnection()}},{key:"createSession",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new d.default;return this._callId=e||this._callId,this._iceServers=t||this._iceServers,this._contactToken=n||this._contactToken,this._connectionId=r||this._connectionId,this._wssManager=i||this._wssManager,this._strategy=o||this._strategy,this._logger.info("PeerConnectionManager creates RtcSession"),this._logger=(0,h.wrapLogger)(this._originalLogger,this._callId,"RtcPeerConnectionManager"),this._rtcSession=new u.default(this._signalingUri,this._iceServers,this._contactToken,this._logger,this._callId,this._connectionId,this._wssManager,this._strategy,this),this.isPersistentConnectionEnabled()&&(this._rtcSession.remoteAudioElement=document.getElementById("remote-audio")||window.parent.parent.document.getElementById("remote-audio"),this._remoteAudioElement=this._rtcSession.remoteAudioElement),this._rtcSession}},{key:"getSession",value:function(){return this._rtcSession}},{key:"connect",value:function(){var e=(0,i.default)(r.default.mark(function e(){var t,n,o,a,s=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this)._rtcSessionConnectPromise){e.next=19;break}return e.prev=2,e.next=5,t._rtcSessionConnectPromise;case 5:e.next=16;break;case 7:return e.prev=7,e.t0=e.catch(2),this._rtcSession._onSessionFailed(this._rtcSession,e.t0.name),t._rtcSession=null,t.destroy(),t._contactToken=null,t._iceServers=null,t._callId=null,e.abrupt("return");case 16:return e.prev=16,t._rtcSessionConnectPromise=null,e.finish(16);case 19:if(t._inactivityTimer&&t.clearInactivityTimer(),n=t._rtcSession._onSessionFailed,t._rtcSession.onSessionFailed=function(e,r){t.logger.error("Peer connection manager detects RtcSession failure: "+r),n&&n(e,r),t._rtcSession=null,t._iceServers=null,t.destroy(),t._contactToken=null,t._callId=null},o=t._rtcSession._onSessionCompleted,t._rtcSession.onSessionCompleted=function(e){t.logger.info("Peer connection manager detects RtcSession completed. Performing health check to decide if we want to keep the peer connection"),o&&o(e),"FailedState"!==t._signalingChannel._state.name&&t._pc.iceConnectionState!==p.ICE_CONNECTION_STATE.FAILED&&t._pc.iceConnectionState!==p.ICE_CONNECTION_STATE.DISCONNECTED&&t._pc.iceConnectionState!==p.ICE_CONNECTION_STATE.CLOSED||(t.logger.error("Peer connection manager detected unhealthy connection at call ends, tearing down the connection"),t._rtcSession=null,t._iceServers=null,t.destroy(),t._contactToken=null,t._callId=null)},t._rtcSession._signalingRemoteHungup=function(){t.hangup()},this._userAgentData){e.next=29;break}return e.next=28,(0,h.getUserAgentData)().catch(function(e){t.logger.error("Peer connection manager failed to get user agent data",e)});case 28:this._userAgentData=e.sent;case 29:return this._rtcSession._sessionReport.userAgentData=JSON.stringify(this._userAgentData),a=this.getPeerConnection(),this._rtcSession.connect(a),e.abrupt("return",new Promise(function(e,n){var o=(0,h.hitch)(t._rtcSession,t._rtcSession._signalingHandshaked);t._rtcSession._signalingHandshaked=(0,i.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o(),e();case 2:case"end":return t.stop()}},t,s)}));var a,c=(0,h.hitch)(t._rtcSession,t._rtcSession._signalingFailed);t._rtcSession._signalingFailed=(a=(0,i.default)(r.default.mark(function e(t){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c(t),n();case 2:case"end":return e.stop()}},e,s)})),function(e){return a.apply(this,arguments)})}));case 33:case"end":return e.stop()}},e,this,[[2,7,16,19]])}));return function(){return e.apply(this,arguments)}}()},{key:"startInactivityTimer",value:function(){var e=this;this._logger.info("PeerConnectionManager start inactivity timer"),this._inactivityTimer=setTimeout(function(){e._logger.info("Inactivity timer breached, teardown peer connection "),e.destroy()},this._inactivityDuration)}},{key:"clearInactivityTimer",value:function(){this._logger.info("PeerConnectionManager clear inactivity timer"),clearTimeout(this._inactivityTimer),this._inactivityTimer=null}},{key:"hangup",value:function(){if(this._logger.info("PeerConnectionManager hangs up RtcSession"),this._rtcSession)try{this._rtcSession.hangup()}catch(e){this._logger.error("Error occurred while hanging up RtcSession:",e)}this._contactToken=null,this._callId=null,this._rtcSession=null,this.isPersistentConnectionEnabled()||(this._signalingChannel=null,this._iceServers=null,this._pc=null,this._peerConnectionId=null,this._peerConnectionToken=null,this._iceRestart=!1)}},{key:"destroy",value:function(e){try{if(!this._rtcSession||this._rtcSession._state.name!==p.RTC_SESSION_STATE.TALKING_STATE&&this._rtcSession._state.name!==p.RTC_SESSION_STATE.CONNECT_CONTACT_STATE){if(this._pc){if(this._logger.info("PeerConnectionManager destroy persistent peer connection"),!e&&this._signalingChannel)try{this._signalingChannel.bye()}catch(e){this._logger.error("Error occurred while sending bye:",e)}this._signalingChannel=null,this._pc.close(),this._pc=null,this._peerConnectionId=null,this._peerConnectionToken=null,this._iceRestart=!1,this._mediaStream&&(this._mediaStream.getTracks().forEach(function(e){return e.stop()}),this._mediaStream=null),this._remoteAudioElement&&(this._remoteAudioElement.srcObject=null,this._remoteAudioStream=null),this.clearInactivityTimer()}}else this._logger.info("Peer connection is in use, PeerConnectionManager can NOT destroy persistent peer connection")}catch(e){this._logger.error("Error occurred in PeerConnectionManager destroy method:",e)}}},{key:"handlePersistentPeerConnectionToggle",value:function(e){null===this._rtcSession&&this.isPPCEnabled!==e&&this.isRTPSAllowlisted&&(this.isPPCEnabled=e,this.isPPCEnabled?(this._logger.info("softphonePersistentConnection changed to ture, initiate a persistent peer connection").sendInternalLogToServer(),this.activatePersistentPeerConnectionMode()):(this._logger.info("softphonePersistentConnection changed to false, destroy the existing persistent peer connection").sendInternalLogToServer(),this.deactivatePersistentPeerConnectionMode()))}},{key:"activatePersistentPeerConnectionMode",value:function(){var e=this;this.closeEarlyMediaConnection(),this.requestPeerConnection().then(function(){e.createSession(),e._rtcSessionConnectPromise=e.connect()})}},{key:"deactivatePersistentPeerConnectionMode",value:function(){this.destroy(),this.requestPeerConnection()}},{key:"isPersistentConnectionEnabled",value:function(){return this._isPPCEnabled&&this._isRTPSAllowlisted&&!(0,h.isFirefoxBrowser)(this._userAgentData)}},{key:"close",value:function(){this.isPersistentConnectionEnabled()?this.destroy():this.closeEarlyMediaConnection()}},{key:"browserTabCloseEventListener",value:function(){var e=this;window.addEventListener("beforeunload",function(){e._logger.info("User leaves the page, destroy peer connection manager"),e.destroy()})}},{key:"signalingUri",get:function(){return this._signalingUri},set:function(e){this._signalingUri=e}},{key:"iceServers",get:function(){return this._iceServers},set:function(e){this._iceServers=e}},{key:"contactToken",get:function(){return this._contactToken},set:function(e){this._contactToken=e}},{key:"logger",get:function(){return this._logger},set:function(e){this._logger=e}},{key:"callId",get:function(){return this._callId},set:function(e){this._callId=e}},{key:"connectionId",get:function(){return this._connectionId},set:function(e){this._connectionId=e}},{key:"wssManager",get:function(){return this._wssManager},set:function(e){this._wssManager=e}},{key:"strategy",get:function(){return this._strategy},set:function(e){this._strategy=e}},{key:"isPPCEnabled",get:function(){return this._isPPCEnabled},set:function(e){this._isPPCEnabled=e}},{key:"isRTPSAllowlisted",get:function(){return this._isRTPSAllowlisted},set:function(e){this._isRTPSAllowlisted=e}},{key:"browserId",get:function(){return this._browserId},set:function(e){this._browserId=e}},{key:"peerConnectionId",get:function(){return this._peerConnectionId},set:function(e){this._peerConnectionId=e}},{key:"peerConnectionToken",get:function(){return this._peerConnectionToken},set:function(e){this._peerConnectionToken=e}},{key:"inactivityDuration",get:function(){return this._inactivityDuration},set:function(e){this._inactivityDuration=e}}]),e}();n.default=g},{"./exceptions":152,"./rtc_const":153,"./rtc_session":156,"./strategies/CCPInitiationStrategyInterface":161,"./strategies/StandardStrategy":165,"./utils":167,"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/typeof":24,"babel-runtime/regenerator":27,"uuid/v4":137}],156:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FailedState=n.DisconnectedState=n.CleanUpState=n.TalkingState=n.ConnectContactState=n.AcceptState=n.InviteAnswerState=n.ConnectSignalingAndIceCollectionState=n.SetLocalSessionDescriptionState=n.CreateOfferState=n.GrabLocalMediaState=n.RTCSessionState=void 0;var r=S(e("babel-runtime/helpers/typeof")),i=S(e("babel-runtime/helpers/get")),o=S(e("babel-runtime/regenerator")),a=S(e("babel-runtime/helpers/asyncToGenerator")),s=S(e("babel-runtime/helpers/possibleConstructorReturn")),c=S(e("babel-runtime/helpers/inherits")),d=S(e("babel-runtime/helpers/classCallCheck")),l=S(e("babel-runtime/helpers/createClass")),u=e("./utils"),f=e("./session_report"),h=e("./rtc_const"),p=e("./exceptions"),_=S(e("./signaling")),g=S(e("uuid/v4")),m=e("./rtp-stats"),v=e("sdp"),y=S(e("./strategies/CCPInitiationStrategyInterface")),b=S(e("./strategies/StandardStrategy")),C=e("./rtc_session_talking_substates");function S(e){return e&&e.__esModule?e:{default:e}}var E=n.RTCSessionState=function(){function e(t){(0,d.default)(this,e),this._rtcSession=t}return(0,l.default)(e,[{key:"onEnter",value:function(){}},{key:"onExit",value:function(){}},{key:"_isCurrentState",value:function(){return this._rtcSession._state===this}},{key:"transit",value:function(e){this._isCurrentState()&&this._rtcSession.transit(e)}},{key:"hangup",value:function(){this.transit(new x(this._rtcSession))}},{key:"onIceCandidate",value:function(e){}},{key:"onRemoteHungup",value:function(){throw new p.UnsupportedOperation("onRemoteHungup not implemented by "+this.name)}},{key:"onSignalingConnected",value:function(){throw new p.UnsupportedOperation("onSignalingConnected not implemented by "+this.name)}},{key:"onSignalingHandshaked",value:function(){throw new p.UnsupportedOperation("onSignalingHandshaked not implemented by "+this.name)}},{key:"onSignalingFailed",value:function(e){throw new p.UnsupportedOperation("onSignalingFailed not implemented by "+this.name)}},{key:"onIceStateChange",value:function(e){}},{key:"logger",get:function(){return this._rtcSession._logger}},{key:"name",get:function(){return"RTCSessionState"}}]),e}(),R=n.GrabLocalMediaState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this,t=Date.now();if(e._rtcSession._isUserProvidedStream)e.transit(new T(e._rtcSession));else{var n=new Promise(function(t,n){setTimeout(function(){n(new p.GumTimeout("Local media has not been initialized yet."))},e._rtcSession._gumTimeoutMillis)}),r=e._gUM(e._rtcSession._buildMediaConstraints());Promise.race([r,n]).then(function(n){e._rtcSession._sessionReport.gumTimeMillis=Date.now()-t,e._rtcSession._onGumSuccess(e._rtcSession),e._rtcSession._localStream=n,e._rtcSession._pcm&&(e._rtcSession._pcm._mediaStream=n),e._rtcSession._sessionReport.gumOtherFailure=!1,e._rtcSession._sessionReport.gumTimeoutFailure=!1,e.transit(new T(e._rtcSession))}).catch(function(n){var r;e._rtcSession._sessionReport.gumTimeMillis=Date.now()-t,n instanceof p.GumTimeout?(r=h.RTC_ERRORS.GUM_TIMEOUT_FAILURE,e._rtcSession._sessionReport.gumTimeoutFailure=!0,e._rtcSession._sessionReport.gumOtherFailure=!1):(r=h.RTC_ERRORS.GUM_OTHER_FAILURE,e._rtcSession._sessionReport.gumOtherFailure=!0,e._rtcSession._sessionReport.gumTimeoutFailure=!1),e.logger.error("Local media initialization failed",n),e._rtcSession._onGumError(e._rtcSession),e.transit(new x(e._rtcSession,r))})}}},{key:"_gUM",value:function(e){return this._rtcSession._strategy._gUM(e)}},{key:"name",get:function(){return"GrabLocalMediaState"}}]),t}(E),T=n.CreateOfferState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this,t=e._rtcSession._localStream;e._rtcSession._strategy.addStream(e._rtcSession._pc,t),e._rtcSession._onLocalStreamAdded(e._rtcSession,t),e._rtcSession._pc.createOffer().then(function(t){e._rtcSession._localSessionDescription=t,e._rtcSession._sessionReport.createOfferFailure=!1,e.transit(new w(e._rtcSession))}).catch(function(t){e.logger.error("CreateOffer failed",t),e._rtcSession._sessionReport.createOfferFailure=!0,e.transit(new x(e._rtcSession,h.RTC_ERRORS.CREATE_OFFER_FAILURE))})}},{key:"name",get:function(){return"CreateOfferState"}}]),t}(E),w=n.SetLocalSessionDescriptionState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this,t=e._rtcSession._localSessionDescription,n=new u.SdpOptions;e._rtcSession._forceAudioCodec&&(n.forceCodec.audio=e._rtcSession._forceAudioCodec),e._rtcSession._forceVideoCodec&&(n.forceCodec.video=e._rtcSession._forceVideoCodec),n.enableOpusDtx=e._rtcSession._enableOpusDtx;var r=(0,u.transformSdp)(t.sdp,n);t.sdp=r.sdp,t.sdp+="a=ptime:20\r\n",t.sdp+="a=maxptime:20\r\n",t.sdp=t.sdp.replace("minptime=10","minptime=20"),e.logger.info("LocalSD",e._rtcSession._localSessionDescription),e._rtcSession._pc.setLocalDescription(e._rtcSession._localSessionDescription).then(function(){var t=Date.now()-e._rtcSession._connectTimeStamp;e._rtcSession._sessionReport.initializationTimeMillis=t,e._rtcSession._onSessionInitialized(e._rtcSession,t),e._rtcSession._sessionReport.setLocalDescriptionFailure=!1,e.transit(new k(e._rtcSession,r.mLines))}).catch(function(t){e.logger.error("SetLocalDescription failed",t),e._rtcSession._sessionReport.setLocalDescriptionFailure=!0,e.transit(new x(e._rtcSession,h.RTC_ERRORS.SET_LOCAL_DESCRIPTION_FAILURE))})}},{key:"name",get:function(){return"SetLocalSessionDescriptionState"}}]),t}(E),k=n.ConnectSignalingAndIceCollectionState=function(e){function t(e,n){(0,d.default)(this,t);var r=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._iceCandidates=[],r._iceCandidateFoundationsMap={},r._mLines=n,r}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this;e._startTime=Date.now(),setTimeout(function(){e._isCurrentState()&&!e._iceCompleted&&(e.logger.warn("ICE collection timed out"),e._reportIceCompleted(!0))},e._rtcSession._iceTimeoutMillis),e._rtcSession._pcm&&e._rtcSession._pcm._signalingChannel?(e._rtcSession._bindSignalingChannel(),e._rtcSession._pcm._signalingChannel._wss._connnectionId=e._rtcSession._connectionId,e._rtcSession._pcm._signalingChannel._contactToken=e._rtcSession._contactToken,e._rtcSession._pcm._signalingChannel._callId=e._rtcSession._callId):e._rtcSession._createSignalingChannel().connect()}},{key:"onSignalingConnected",value:function(){this._rtcSession._signallingConnectTimestamp=Date.now(),this._rtcSession._sessionReport.signallingConnectTimeMillis=this._rtcSession._signallingConnectTimestamp-this._startTime,this._signalingConnected=!0,this._rtcSession._onSignalingConnected(this._rtcSession),this._rtcSession._sessionReport.signallingConnectionFailure=!1,this._checkAndTransit()}},{key:"onSignalingFailed",value:function(e){this._rtcSession._sessionReport.signallingConnectTimeMillis=Date.now()-this._startTime,this.logger.error("Failed connecting to signaling server",e),this._rtcSession._sessionReport.signallingConnectionFailure=!0,this.transit(new x(this._rtcSession,h.RTC_ERRORS.SIGNALLING_CONNECTION_FAILURE))}},{key:"_createLocalCandidate",value:function(e){return new RTCIceCandidate(e)}},{key:"onIceCandidate",value:function(e){var t=e.candidate;this.logger.log("onicecandidate "+JSON.stringify(t)),t?t.candidate&&(this._iceCandidates.push(this._createLocalCandidate(t)),this._iceCompleted||this._checkCandidatesSufficient(t)):this._reportIceCompleted(!1)}},{key:"_checkCandidatesSufficient",value:function(e){var t=(0,v.parseCandidate)(e.candidate);if(1==t.component){var n=t.foundation,r=e.sdpMLineIndex;if(n&&r>=0&&r<this._mLines){var i=this._iceCandidateFoundationsMap[n]||[];i.includes(r)||i.push(r),this._iceCandidateFoundationsMap[n]=i,this._mLines==i.length&&this._reportIceCompleted(!1)}}}},{key:"_reportIceCompleted",value:function(e){this._rtcSession._sessionReport.iceCollectionTimeMillis=Date.now()-this._startTime,this._iceCompleted=!0,this._rtcSession._onIceCollectionComplete(this._rtcSession,e,this._iceCandidates.length),this._iceCandidates.length>0?(this._rtcSession._sessionReport.iceCollectionFailure=!1,this._checkAndTransit()):(this.logger.error("No ICE candidate"),this._rtcSession._sessionReport.iceCollectionFailure=!0,this.transit(new x(this._rtcSession,h.RTC_ERRORS.ICE_COLLECTION_TIMEOUT)))}},{key:"_checkAndTransit",value:function(){this._iceCompleted&&this._signalingConnected?this.transit(new I(this._rtcSession,this._iceCandidates)):this._iceCompleted?this.logger.log("Pending signaling connection"):this.logger.log("Pending ICE collection")}},{key:"name",get:function(){return"ConnectSignalingAndIceCollectionState"}}]),t}(E),I=n.InviteAnswerState=function(e){function t(e,n){(0,d.default)(this,t);var r=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._iceCandidates=n,r}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this._rtcSession;e._onSignalingStarted(e),e._signalingChannel.invite(e._localSessionDescription.sdp,this._iceCandidates)}},{key:"onSignalingAnswered",value:function(e,t,n,r,i){this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!1,this._rtcSession._pcm&&(this._rtcSession._pcm.inactivityDuration=n,this._rtcSession._pcm.peerConnectionId=r,this._rtcSession._pcm.peerConnectionToken=i),this.transit(new P(this._rtcSession,e,t))}},{key:"onSignalingFailed",value:function(e){var t;e.name==p.BusyExceptionName?(this.logger.error("User Busy, possibly multiple CCP windows open",e),this._rtcSession._sessionReport.userBusyFailure=!0,this._rtcSession._sessionReport.handshakingFailure=!0,t=h.RTC_ERRORS.USER_BUSY):e.name==p.CallNotFoundExceptionName?(this.logger.error("Call not found. One of the participant probably hungup.",e),t=h.RTC_ERRORS.CALL_NOT_FOUND,this._rtcSession._sessionReport.handshakingFailure=!0):(this.logger.error("Failed handshaking with signaling server",e),this._rtcSession._sessionReport.userBusyFailure=!1,this._rtcSession._sessionReport.handshakingFailure=!0,t=h.RTC_ERRORS.SIGNALLING_HANDSHAKE_FAILURE),this.transit(new x(this._rtcSession,t))}},{key:"hangup",value:function(){this._rtcSession._pcm&&this.transit(new x(this._rtcSession,"Agent clicks hangs up"))}},{key:"name",get:function(){return"InviteAnswerState"}}]),t}(E),P=n.AcceptState=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._sdp=n,i._candidates=r,i}return(0,c.default)(t,e),(0,l.default)(t,[{key:"_createSessionDescription",value:function(e){return new RTCSessionDescription(e)}},{key:"_createRemoteCandidate",value:function(e){return new RTCIceCandidate(e)}},{key:"onEnter",value:function(){var e=this._rtcSession;return this._sdp?!this._candidates||this._candidates.length<1?(this.logger.error("No remote ICE candidate"),e._stopSession(),e._sessionReport.noRemoteIceCandidateFailure=!0,void this.transit(new x(e,h.RTC_ERRORS.NO_REMOTE_ICE_CANDIDATE))):(e._sessionReport.invalidRemoteSDPFailure=!1,e._sessionReport.noRemoteIceCandidateFailure=!1,void this._rtcSession._strategy.setRemoteDescription(this,e)):(this.logger.error("Invalid remote SDP"),e._stopSession(),e._sessionReport.invalidRemoteSDPFailure=!0,void this.transit(new x(e,h.RTC_ERRORS.INVALID_REMOTE_SDP)))}},{key:"onSignalingHandshaked",value:function(){this._rtcSession._sessionReport.handshakingTimeMillis=Date.now()-this._rtcSession._signallingConnectTimestamp,this._signalingHandshaked=!0,this._checkAndTransit()}},{key:"_checkAndTransit",value:function(){this._signalingHandshaked&&this._remoteDescriptionSet?this._rtcSession._pcm&&!this._rtcSession._contactToken?(this._rtcSession._pcm._rtcSession=null,this.transit(new O(this._rtcSession))):this.transit(new M(this._rtcSession)):this._signalingHandshaked?this.logger.log("Pending setting remote description"):this.logger.log("Pending handshaking")}},{key:"onPeerConnectionStateChange",value:function(){}},{key:"name",get:function(){return"AcceptState"}}]),t}(E),A=n.ConnectContactState=function(e){function t(e){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this._rtcSession,t=this.logger,n=this;e._sessionReport.isExistingPersistentPeerConnection=!0,e._pcm._signalingChannel.connectContact();try{e._pcm._mediaStream=n._createMediaStream(e._pc.getSenders()[0].track),e._onLocalStreamAdded(e,e._pcm._mediaStream)}catch(e){t.error("[connectContact] Failed to get audio track from existing peer connection").withException(e)}(this.transit(new M(this._rtcSession)),e._isUserProvidedStream)?t.log("Not resetting media stream as user provided stream is being used"):this._gUM(e._buildMediaConstraints()).then(function(r){try{var i=r.getAudioTracks()[0];e._isUserProvidedStream?t.log("Not resetting media stream as user provided stream was set after rtcJs GUM"):e._pc.getSenders()[0].replaceTrack(i).then(function(){e._pcm._mediaStream=n._createMediaStream(e._pc.getSenders()[0].track),e._onLocalStreamAdded(e,e._pcm._mediaStream),t.log("[connectContact] Audio device set successfully and _onLocalStreamAdded triggered")})}catch(e){return void t.error("[connectContact] Failed to update audio track for the peer connection").withException(e)}}).catch(function(e){t.error("[connectContact] Failed to get microphone stream from getUserMedia").withException(e)})}},{key:"_gUM",value:function(e){return this._rtcSession._strategy._gUM(e)}},{key:"_createMediaStream",value:function(e){return this._rtcSession._strategy._createMediaStream(e)}},{key:"onSignalingHandshaked",value:function(){}},{key:"name",get:function(){return"ConnectContactState"}}]),t}(E),M=n.TalkingState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){var e=this;this._startTime=Date.now(),this._rtcSession._sessionReport.preTalkingTimeMillis=this._startTime-this._rtcSession._connectTimeStamp,this._rtcSession._sessionReport.isMediaClusterPath=this._rtcSession._signalingChannel._isMediaClusterPath,this._rtcSession._sessionReport.isPersistentPeerConnection=!(!this._rtcSession._pcm||!this._rtcSession._pcm.isPersistentConnectionEnabled()),this._rtcSession._pcm&&this._rtcSession.resumeLocalAudio(),this._rtcSession._onSessionConnected(this._rtcSession);var t,n=void 0,r=void 0,i=(t=(0,a.default)(o.default.mark(function t(){var i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e._rtcSession&&e._rtcSession._pc&&0!==e._rtcSession._pc.getReceivers().length&&(i=e._rtcSession._pc.getReceivers()[0])instanceof RTCRtpReceiver&&i.getSynchronizationSources().forEach(function(t){var i=t.timestamp-e._rtcSession._connectTimeStamp;i>0&&(e._rtcSession._sessionReport.firstRTPTimeMillis=i),clearInterval(n),clearTimeout(r)});case 1:case"end":return t.stop()}},t,e)})),function(){return t.apply(this,arguments)});r=setTimeout(function(){clearInterval(n),console.log("Timeout reached, stopping the interval")},1e3),n=setInterval(i,20),this.setSubState(new C.ConnectedSubstate(this._rtcSession))}},{key:"onSignalingReconnected",value:function(){}},{key:"onRemoteHungup",value:function(){this._rtcSession._pcm?this._rtcSession._pcm._signalingChannel.hangup():this._rtcSession._signalingChannel.hangup(),this.transit(new O(this._rtcSession))}},{key:"hangup",value:function(){this._rtcSession._pcm?this._rtcSession._pcm._signalingChannel.hangup():this._rtcSession._signalingChannel.hangup(),this.transit(new O(this._rtcSession))}},{key:"onIceStateChange",value:function(e){var t=this._rtcSession._strategy.onIceStateChange(e,this._rtcSession._pc);this.logger.info("ICE Connection State: ",t),this._subState&&"function"==typeof this._subState.onIceStateChange&&this._subState.onIceStateChange(e),t==h.ICE_CONNECTION_STATE.DISCONNECTED&&(this.logger.info("Lost ICE connection"),this._rtcSession._sessionReport.iceConnectionsLost+=1),t==h.ICE_CONNECTION_STATE.FAILED&&(this._rtcSession._sessionReport.iceConnectionsFailed=!0)}},{key:"onSignalingConnected",value:function(){this._subState&&"function"==typeof this._subState.onSignalingConnected&&this._subState.onSignalingConnected()}},{key:"onSignalingFailed",value:function(e){var t;this._subState&&"function"==typeof this._subState.onSignalingFailed&&this._subState.onSignalingFailed(e),e.name==p.AccessDeniedExceptionName?(this.logger.error("[TalkingState] Access Denied by server",e),this._rtcSession._sessionReport.handshakingFailure=!0,t=h.RTC_ERRORS.SIGNALLING_HANDSHAKE_FAILURE,this.transit(new x(this._rtcSession,t))):this.logger.error("[TalkingState] Failed handshaking with signaling server",e)}},{key:"onSignalingAnswered",value:function(e,t){this._subState&&"function"==typeof this._subState.onSignalingAnswered&&this._subState.onSignalingAnswered(e,t)}},{key:"onSignalingHandshaked",value:function(){this._subState&&"function"==typeof this._subState.onSignalingHandshaked&&this._subState.onSignalingHandshaked()}},{key:"onIceCandidate",value:function(e){this._subState&&"function"==typeof this._subState.onIceCandidate&&this._subState.onIceCandidate(e)}},{key:"onIceRestartFailure",value:function(){this._subState&&"function"==typeof this._subState.onIceRestartFailure&&this._subState.onIceRestartFailure()}},{key:"_checkAndTransit",value:function(){this._subState&&"function"==typeof this._subState._checkAndTransit&&this._subState._checkAndTransit()}},{key:"setSubState",value:function(e){this.logger.info("Substate: "+(this._subState?this._subState.name:"null")+" => "+e.name),this._subState&&this._subState.onExit(),this._subState=e,this._subState.onEnter()}},{key:"onPeerConnectionStateChange",value:function(){var e=this._rtcSession._strategy.onPeerConnectionStateChange(this._rtcSession._pc);this.logger.info("Peer Connection State: ",e),e==h.PEER_CONNECTION_STATE.FAILED&&(this._rtcSession._sessionReport.peerConnectionFailed=!0)}},{key:"onExit",value:function(){this._rtcSession._sessionReport.talkingTimeMillis=Date.now()-this._startTime,this._rtcSession._pcm&&this._rtcSession._pcm.isPersistentConnectionEnabled()||this._rtcSession._detachMedia(),this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionCompleted(this._rtcSession),this._subState&&this._subState.onExit()}},{key:"name",get:function(){return"TalkingState"}}]),t}(E),D=n.CleanUpState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){if(this._rtcSession._pcm){try{this._rtcSession._pcm._mediaStream=this._rtcSession._strategy._createMediaStream(this._rtcSession._pc.getSenders()[0].track)}catch(e){this.logger.error("Creating MediaStream error: ",e)}this._rtcSession.pauseLocalAudio()}this._startTime=Date.now(),this._rtcSession._stopSession(),this._rtcSession._sessionReport.cleanupTimeMillis=Date.now()-this._startTime,this._rtcSession._onSessionDestroyed(this._rtcSession,this._rtcSession._sessionReport)}},{key:"hangup",value:function(){}},{key:"name",get:function(){return"CleanUpState"}}]),t}(E),O=n.DisconnectedState=function(e){function t(){return(0,d.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onSignalingHandshaked",value:function(){}},{key:"onPeerConnectionStateChange",value:function(){}},{key:"name",get:function(){return"DisconnectedState"}}]),t}(D),x=n.FailedState=function(e){function t(e,n){(0,d.default)(this,t);var r=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._failureReason=n,r}return(0,c.default)(t,e),(0,l.default)(t,[{key:"onEnter",value:function(){this._rtcSession._sessionReport.sessionEndTime=new Date,this._rtcSession._onSessionFailed(this._rtcSession,this._failureReason),this._rtcSession._pcm&&this._rtcSession._pcm.destroy(),(0,i.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onEnter",this).call(this)}},{key:"name",get:function(){return"FailedState"}}]),t}(D),N=function(){function e(t,n,i,o,a,s,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new b.default,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if((0,d.default)(this,e),!(l instanceof y.default))throw new Error("Expected a strategy of type CCPInitiationStrategyInterface");if(!_&&"string"!=typeof t||t&&0===t.trim().length)throw new p.IllegalParameters("signalingUri required");if(!n)throw new p.IllegalParameters("iceServers required");if("object"!==(void 0===o?"undefined":(0,r.default)(o)))throw new p.IllegalParameters("logger required");this._callId=a||(0,g.default)(),this._strategy=l,this._connectionId=s,this._wssManager=c,this._sessionReport=new f.SessionReport,this._signalingUri=t,this._iceServers=n,this._contactToken=i,this._originalLogger=o,this._logger=(0,u.wrapLogger)(this._originalLogger,this._callId,"SESSION"),this._pcm=_,this._iceTimeoutMillis=h.DEFAULT_ICE_TIMEOUT_MS,this._gumTimeoutMillis=h.DEFAULT_GUM_TIMEOUT_MS,this._enableAudio=!0,this._enableVideo=!1,this._facingMode="user",this._legacyStatsReportSupport=!1,this._isUserProvidedStream=!1,this._onGumError=this._onGumSuccess=this._onLocalStreamAdded=this._onSessionFailed=this._onSessionInitialized=this._onSignalingConnected=this._onIceCollectionComplete=this._onSignalingStarted=this._onSessionConnected=this._onRemoteStreamAdded=this._onSessionCompleted=this._onSessionDestroyed=function(){}}return(0,l.default)(e,[{key:"pauseLocalVideo",value:function(){if(this._localStream){var e=this._localStream.getVideoTracks()[0];e&&(e.enabled=!1)}}},{key:"resumeLocalVideo",value:function(){if(this._localStream){var e=this._localStream.getVideoTracks()[0];e&&(e.enabled=!0)}}},{key:"pauseRemoteVideo",value:function(){if(this._remoteVideoStream){var e=this._remoteVideoStream.getTracks()[1];e&&(e.enabled=!1)}}},{key:"resumeRemoteVideo",value:function(){if(this._remoteVideoStream){var e=this._remoteVideoStream.getTracks()[1];e&&(e.enabled=!0)}}},{key:"pauseLocalAudio",value:function(){var e;this._pcm?this._pcm._mediaStream&&(e=this._pcm._mediaStream.getAudioTracks()[0])&&(e.enabled=!1):this._localStream&&(e=this._localStream.getAudioTracks()[0])&&(e.enabled=!1)}},{key:"resumeLocalAudio",value:function(){var e;this._pcm?this._pcm._mediaStream&&(e=this._pcm._mediaStream.getAudioTracks()[0])&&(e.enabled=!0):this._localStream&&(e=this._localStream.getAudioTracks()[0])&&(e.enabled=!0)}},{key:"pauseRemoteAudio",value:function(){if(this._remoteAudioStream){var e=this._remoteAudioStream.getTracks()[0];e&&(e.enabled=!1)}}},{key:"resumeRemoteAudio",value:function(){if(this._remoteAudioStream){var e=this._remoteAudioStream.getTracks()[0];e&&(e.enabled=!0)}}},{key:"transit",value:function(e){try{this._logger.info((this._state?this._state.name:"null")+" => "+e.name),this._state&&this._state.onExit&&this._state.onExit()}finally{if(this._state=e,e.onEnter)try{e.onEnter()}catch(t){throw this._logger.warn(e.name+"#onEnter failed",t),t}}}},{key:"_createSignalingChannel",value:function(){var e=new _.default(this._callId,this._signalingUri,this._contactToken,this._originalLogger,this._signalingConnectTimeout,this._connectionId,this._wssManager,this._iceRestart,this._pcm);return e.onConnected=(0,u.hitch)(this,this._signalingConnected),e.onAnswered=(0,u.hitch)(this,this._signalingAnswered),e.onHandshaked=(0,u.hitch)(this,this._signalingHandshaked),e.onRemoteHungup=(0,u.hitch)(this,this._signalingRemoteHungup),e.onFailed=(0,u.hitch)(this,this._signalingFailed),e.onDisconnected=(0,u.hitch)(this,this._signalingDisconnected),this._signalingChannel=e,this._pcm&&(this._pcm._signalingChannel=e),e}},{key:"_bindSignalingChannel",value:function(){var e=this._pcm._signalingChannel;return e.onConnected=(0,u.hitch)(this,this._signalingConnected),e.onAnswered=(0,u.hitch)(this,this._signalingAnswered),e.onHandshaked=(0,u.hitch)(this,this._signalingHandshaked),e.onRemoteHungup=(0,u.hitch)(this,this._signalingRemoteHungup),e.onFailed=(0,u.hitch)(this,this._signalingFailed),e.onDisconnected=(0,u.hitch)(this,this._signalingDisconnected),this._signalingChannel=e,e}},{key:"_signalingConnected",value:function(){this._state.onSignalingConnected()}},{key:"_signalingAnswered",value:function(e,t,n,r,i){this._state.onSignalingAnswered(e,t,n,r,i)}},{key:"_signalingHandshaked",value:function(){this._state.onSignalingHandshaked()}},{key:"_signalingRemoteHungup",value:function(){this._state.onRemoteHungup()}},{key:"_signalingFailed",value:function(e){this._state.onSignalingFailed(e)}},{key:"_signalingDisconnected",value:function(){}},{key:"_createPeerConnection",value:function(e,t){return this._strategy._createPeerConnection(e,t)}},{key:"connect",value:function(e){var t=new Date;this._sessionReport.sessionStartTime=t,this._connectTimeStamp=t.getTime(),e&&"closed"!=e.signalingState?this._pc=e:(e&&(e.close(),e=null),h.RTC_PEER_CONNECTION_CONFIG.iceServers=this._iceServers,h.RTC_PEER_CONNECTION_CONFIG.iceCandidatePoolSize=h.DEFAULT_ICE_CANDIDATE_POOL_SIZE,this._pc=this._createPeerConnection(h.RTC_PEER_CONNECTION_CONFIG,h.RTC_PEER_CONNECTION_OPTIONAL_CONFIG)),this._pc.ontrack=(0,u.hitch)(this,this._ontrack),this._pc.onicecandidate=(0,u.hitch)(this,this._onIceCandidate),this._pc.onconnectionstatechange=(0,u.hitch)(this,this._onPeerConnectionStateChange),this._pc.oniceconnectionstatechange=(0,u.hitch)(this,this._onIceStateChange),this._pcm&&this._pcm.isPersistentConnectionEnabled()&&this._pcm._signalingChannel?(this._bindSignalingChannel(),this.transit(new A(this))):this.transit(new R(this))}},{key:"accept",value:function(){throw new p.UnsupportedOperation("accept does not go through signaling channel at this moment")}},{key:"hangup",value:function(){this._state.hangup()}},{key:"getStats",value:function(){var e=(0,a.default)(o.default.mark(function e(){var t,n,r,i,s=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Date,n=function(){var e=(0,a.default)(o.default.mark(function e(n){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._pc.getStats();case 2:return r=e.sent,e.abrupt("return",(0,m.extractMediaStatsFromStats)(t,r,n));case 4:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),!this._pc||"stable"!==this._pc.signalingState){e.next=13;break}return e.next=5,n("audio_input");case 5:return r=e.sent,e.next=8,n("audio_output");case 8:return i=e.sent,r&&null!==r.rttMilliseconds&&(i._rttMilliseconds=r.rttMilliseconds),e.abrupt("return",{audioInputStats:r,audioOutputStats:i});case 13:return e.abrupt("return",Promise.reject(new p.IllegalState));case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRemoteAudioStats",value:function(){return this.getStats().then(function(e){return e.audioOutputStats?e.audioOutputStats:Promise.reject(new p.IllegalState)})}},{key:"getUserAudioStats",value:function(){return this.getStats().then(function(e){return e.audioInputStats?e.audioInputStats:Promise.reject(new p.IllegalState)})}},{key:"_onIceCandidate",value:function(e){this._state.onIceCandidate(e)}},{key:"_onPeerConnectionStateChange",value:function(){this._state.onPeerConnectionStateChange()}},{key:"_onIceStateChange",value:function(e){this._state.onIceStateChange(e)}},{key:"_ontrack",value:function(e){this._strategy._ontrack(this,e),this._onRemoteStreamAdded(this,e.streams[0])}},{key:"_detachMedia",value:function(){this._remoteVideoElement&&(this._remoteVideoElement.srcObject=null),this._remoteAudioElement&&(this._remoteAudioElement.srcObject=null,this._remoteAudioStream=null)}},{key:"_stopSession",value:function(){if(!this._pcm||!this._pcm.isPersistentConnectionEnabled())try{this._localStream&&!this._isUserProvidedStream&&((0,u.closeStream)(this._localStream),this._localStream=null,this._isUserProvidedStream=!1)}finally{try{this._pc&&this._pc.close()}catch(e){}finally{this._pc=null}}}},{key:"_buildMediaConstraints",value:function(){var e={};if(this._strategy._buildMediaConstraints(this,e),this._enableVideo){var t={},n={},r={},i={};void 0!==this._idealVideoWidth&&(n.ideal=this._idealVideoWidth),void 0!==this._maxVideoWidth&&(n.max=this._maxVideoWidth),void 0!==this._minVideoWidth&&(n.min=this._minVideoWidth),void 0!==this._idealVideoHeight&&(r.ideal=this._idealVideoHeight),void 0!==this._maxVideoHeight&&(r.max=this._maxVideoHeight),void 0!==this._minVideoHeight&&(r.min=this._minVideoHeight),Object.keys(n).length>0&&Object.keys(r).length>0&&(t.width=n,t.height=r),void 0!==this._videoFrameRate&&(i.ideal=this._videoFrameRate),void 0!==this._minVideoFrameRate&&(i.min=this._minVideoFrameRate),void 0!==this._maxVideoFrameRate&&(i.max=this._maxVideoFrameRate),Object.keys(i).length>0&&(t.frameRate=i),"user"!==this._facingMode&&"environment"!==this._facingMode&&(this._facingMode="user"),t.facingMode=this._facingMode,Object.keys(t).length>0?e.video=t:e.video=!0}return e}},{key:"sessionReport",get:function(){return this._sessionReport}},{key:"callId",get:function(){return this._callId}},{key:"mediaStream",get:function(){return this._localStream},set:function(e){this._localStream=e,this._pcm&&(this._pcm._mediaStream=e),this._isUserProvidedStream=!0}},{key:"remoteVideoStream",get:function(){return this._remoteVideoStream}},{key:"onGumSuccess",set:function(e){this._onGumSuccess=e}},{key:"onGumError",set:function(e){this._onGumError=e}},{key:"onSessionFailed",set:function(e){this._onSessionFailed=e}},{key:"onLocalStreamAdded",set:function(e){this._onLocalStreamAdded=e}},{key:"onSessionInitialized",set:function(e){this._onSessionInitialized=e}},{key:"onSignalingConnected",set:function(e){this._onSignalingConnected=e}},{key:"onIceCollectionComplete",set:function(e){this._onIceCollectionComplete=e}},{key:"onSignalingStarted",set:function(e){this._onSignalingStarted=e}},{key:"onSessionConnected",set:function(e){this._onSessionConnected=e}},{key:"onRemoteStreamAdded",set:function(e){this._onRemoteStreamAdded=e}},{key:"onSessionCompleted",set:function(e){this._onSessionCompleted=e}},{key:"onSessionDestroyed",set:function(e){this._onSessionDestroyed=e}},{key:"enableAudio",set:function(e){this._enableAudio=e}},{key:"echoCancellation",set:function(e){this._echoCancellation=e}},{key:"enableVideo",set:function(e){this._enableVideo=e}},{key:"maxVideoFrameRate",set:function(e){this._maxVideoFrameRate=e}},{key:"minVideoFrameRate",set:function(e){this._minVideoFrameRate=e}},{key:"videoFrameRate",set:function(e){this._videoFrameRate=e}},{key:"maxVideoWidth",set:function(e){this._maxVideoWidth=e}},{key:"minVideoWidth",set:function(e){this._minVideoWidth=e}},{key:"idealVideoWidth",set:function(e){this._idealVideoWidth=e}},{key:"maxVideoHeight",set:function(e){this._maxVideoHeight=e}},{key:"minVideoHeight",set:function(e){this._minVideoHeight=e}},{key:"idealVideoHeight",set:function(e){this._idealVideoHeight=e}},{key:"facingMode",set:function(e){this._facingMode=e}},{key:"remoteAudioElement",set:function(e){this._remoteAudioElement=e}},{key:"remoteVideoElement",set:function(e){this._remoteVideoElement=e}},{key:"signalingConnectTimeout",set:function(e){this._signalingConnectTimeout=e}},{key:"iceTimeoutMillis",set:function(e){this._iceTimeoutMillis=e}},{key:"gumTimeoutMillis",set:function(e){this._gumTimeoutMillis=e}},{key:"forceAudioCodec",set:function(e){this._forceAudioCodec=e}},{key:"forceVideoCodec",set:function(e){this._forceVideoCodec=e}},{key:"enableOpusDtx",set:function(e){this._enableOpusDtx=e}}]),e}();n.default=N},{"./exceptions":152,"./rtc_const":153,"./rtc_session_talking_substates":157,"./rtp-stats":158,"./session_report":159,"./signaling":160,"./strategies/CCPInitiationStrategyInterface":161,"./strategies/StandardStrategy":165,"./utils":167,"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/get":19,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21,"babel-runtime/helpers/typeof":24,"babel-runtime/regenerator":27,sdp:133,"uuid/v4":137}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AcceptSubstate=n.InviteAnswerSubstate=n.ConnectSignalingAndIceCollectionSubstate=n.SetLocalSessionDescriptionSubstate=n.IceRestartSubstate=n.ConnectedSubstate=void 0;var r=l(e("babel-runtime/helpers/classCallCheck")),i=l(e("babel-runtime/helpers/createClass")),o=e("./rtc_const"),a=e("./utils"),s=e("./exceptions"),c=e("sdp"),d=e("./signaling");function l(e){return e&&e.__esModule?e:{default:e}}var u=n.ConnectedSubstate=function(){function e(t){(0,r.default)(this,e),this._rtcSession=t,this.retryInterval=3e3}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"onEnter",value:function(){}},{key:"onIceStateChange",value:function(e){var t=this,n=this._rtcSession._strategy.onIceStateChange(e,this._rtcSession._pc);this.logger.info("ICE Connection State: ",n),n==o.ICE_CONNECTION_STATE.DISCONNECTED&&(this._rtcSession._pcm&&this._rtcSession._pcm._peerConnectionToken?(this.logger.info("Detected Lost ICE connection, pending IceRestart"),this.IceRestartTimeoutId=setTimeout(function(){t._rtcSession._pc.iceConnectionState===o.ICE_CONNECTION_STATE.DISCONNECTED?(t.logger.info("Trying to restart ICE connection"),t._rtcSession._sessionReport.iceRestartAttempts+=1,t._rtcSession._state.setSubState(new f(t._rtcSession))):t.logger.info("The network recovered, IceRestart cancelled")},this.retryInterval)):this.logger.info("Detected Lost ICE connection, IceRestart not supported"))}},{key:"onSignalingFailed",value:function(e){this._rtcSession._pcm&&this._rtcSession._pcm._peerConnectionToken?e.name===s.BadRequestExceptionName&&e.message.includes("Stale Peer Connection")&&(this.logger.error("Server detect peer connection being unhealthy, performing IceRestart",e),this._rtcSession._sessionReport.iceRestartAttempts+=1,this._rtcSession._state.setSubState(new f(this._rtcSession))):this.logger.info("Server detect peer connection being unhealthy, IceRestart not supported")}},{key:"onExit",value:function(){this.IceRestartTimeoutId&&(this.logger.info("Exiting, cleaning up IceRestart timeout"),clearTimeout(this.IceRestartTimeoutId))}},{key:"name",get:function(){return"ConnectedSubstate"}}]),e}(),f=n.IceRestartSubstate=function(){function e(t){(0,r.default)(this,e),this._rtcSession=t}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"onEnter",value:function(){this.performIceRestart()}},{key:"performIceRestart",value:function(){var e=this;this._rtcSession._pcm._iceRestart=!0,this._rtcSession._pcm._requestIceAccess().then(function(t){var n=JSON.parse(JSON.stringify(o.RTC_PEER_CONNECTION_CONFIG));return n.iceServers=t,n.iceCandidatePoolSize=o.DEFAULT_ICE_CANDIDATE_POOL_SIZE,e._rtcSession._pc.setConfiguration(n),e._rtcSession._pc.createOffer({iceRestart:!0})}).then(function(t){e._rtcSession._localSessionDescription=t,e.logger.info("ICE restart offer created and set as local description"),e._rtcSession._state.setSubState(new h(e._rtcSession))}).catch(function(t){e.logger.error("ICE restart failed",t),e._rtcSession._state.setSubState(new u(e._rtcSession))})}},{key:"onExit",value:function(){}},{key:"name",get:function(){return"IceRestartSubstate"}}]),e}(),h=n.SetLocalSessionDescriptionSubstate=function(){function e(t){(0,r.default)(this,e),this._rtcSession=t}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"onEnter",value:function(){var e=this,t=this._rtcSession._localSessionDescription,n=new a.SdpOptions;n.enableOpusDtx=this._rtcSession._enableOpusDtx;var r=(0,a.transformSdp)(t.sdp,n);t.sdp=r.sdp,t.sdp+="a=ptime:20\r\n",t.sdp+="a=maxptime:20\r\n",t.sdp=t.sdp.replace("minptime=10","minptime=20"),this.logger.info("LocalSD",this._rtcSession._localSessionDescription),this._rtcSession._pc.setLocalDescription(this._rtcSession._localSessionDescription).then(function(){e.logger.info("Local description set successfully"),e._rtcSession._state.setSubState(new p(e._rtcSession,r.mLines))}).catch(function(t){e.logger.error("Failed to set local description",t),e._rtcSession._state.setSubState(new u(e._rtcSession))})}},{key:"onExit",value:function(){}},{key:"name",get:function(){return"SetLocalSessionDescriptionSubstate"}}]),e}(),p=n.ConnectSignalingAndIceCollectionSubstate=function(){function e(t,n){(0,r.default)(this,e),this._rtcSession=t,this._iceCandidates=[],this._iceCandidateFoundationsMap={},this._mLines=n,this._iceCompletedForIceRestart=!1,this._rtcSession._bindSignalingChannel()}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"onEnter",value:function(){var e=this;setTimeout(function(){e._isCurrentState()&&!e._iceCompletedForIceRestart&&(e.logger.warn("ICE collection timed out"),e._reportIceCompleted(!0))},this._rtcSession._iceTimeoutMillis)}},{key:"_isCurrentState",value:function(){return this._rtcSession._state._subState===this}},{key:"_createLocalCandidate",value:function(e){return new RTCIceCandidate(e)}},{key:"onIceCandidate",value:function(e){var t=e.candidate;this.logger.log("onicecandidate "+JSON.stringify(t)),t?t.candidate&&(this._iceCandidates.push(this._createLocalCandidate(t)),this._iceCompletedForIceRestart||this._checkCandidatesSufficient(t)):this._reportIceCompleted(!1)}},{key:"_checkCandidatesSufficient",value:function(e){var t=(0,c.parseCandidate)(e.candidate);if(1==t.component){var n=t.foundation,r=e.sdpMLineIndex;if(n&&r>=0&&r<this._mLines){var i=this._iceCandidateFoundationsMap[n]||[];i.includes(r)||i.push(r),this._iceCandidateFoundationsMap[n]=i,this._mLines==i.length&&this._reportIceCompleted(!1)}}}},{key:"_reportIceCompleted",value:function(e){this._iceCompletedForIceRestart=!0,this._rtcSession._onIceCollectionComplete(this._rtcSession,e,this._iceCandidates.length),this._iceCandidates.length>0?this._checkAndTransit():(this.logger.error("No ICE candidate"),this._rtcSession._sessionReport.iceCollectionFailure=!0,this._rtcSession._state.setSubState(new u(this._rtcSession)))}},{key:"_checkAndTransit",value:function(){this._iceCompletedForIceRestart?this._rtcSession._state.setSubState(new _(this._rtcSession,this._iceCandidates)):this._iceCompletedForIceRestart||this.logger.log("Pending ICE collection")}},{key:"onExit",value:function(){}},{key:"name",get:function(){return"ConnectSignalingAndIceCollectionSubstate"}}]),e}(),_=n.InviteAnswerSubstate=function(){function e(t,n){(0,r.default)(this,e),this._rtcSession=t,this._iceCandidates=n,this.retryCount=0,this.maxRetries=3,this.retryInterval=1e3}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"onEnter",value:function(){this.attemptInvite()}},{key:"attemptInvite",value:function(){this._rtcSession._createSignalingChannel().connect(),this._rtcSession._pcm._signalingChannel.transit(new d.PendingInviteState(this._rtcSession._pcm._signalingChannel)),this._rtcSession._pcm._signalingChannel.invite(this._rtcSession._localSessionDescription.sdp,this._iceCandidates)}},{key:"retryInvite",value:function(){var e=this;this.retryCount<this.maxRetries?(this.retryCount++,this.logger.info("Retrying invite in "+this.retryInterval/1e3+" seconds. Attempt "+this.retryCount),this.signalingRetryTimeoutId=setTimeout(function(){return e.attemptInvite()},this.retryInterval)):(this.logger.error("Max invite attempts reached. Returning to ConnectedSubstate."),this._rtcSession._state.setSubState(new u(this._rtcSession)))}},{key:"onSignalingFailed",value:function(e){e.name===s.BusyExceptionName?(this.logger.error("User Busy, possibly multiple CCP windows open",e),this._rtcSession._state.setSubState(new u(this._rtcSession))):e.name===s.CallNotFoundExceptionName?(this.logger.error("Call not found. One of the participant probably hung up.",e),this._rtcSession._state.setSubState(new u(this._rtcSession))):(this.logger.error("Failed handshaking with signaling server",e),this.retryInvite())}},{key:"onSignalingAnswered",value:function(e,t){this._rtcSession._state.setSubState(new g(this._rtcSession,e,t))}},{key:"onExit",value:function(){this.signalingRetryTimeoutId&&(this.logger.info("Exiting, cleaning up invite retry timeout"),clearTimeout(this.signalingRetryTimeoutId))}},{key:"name",get:function(){return"InviteAnswerSubstate"}}]),e}(),g=n.AcceptSubstate=function(){function e(t,n,i){(0,r.default)(this,e),this._rtcSession=t,this._sdp=n,this._candidates=i}return(0,i.default)(e,[{key:"logger",get:function(){return this._rtcSession._logger}}]),(0,i.default)(e,[{key:"_createSessionDescription",value:function(e){return new RTCSessionDescription(e)}},{key:"_createRemoteCandidate",value:function(e){return new RTCIceCandidate(e)}},{key:"onEnter",value:function(){this._sdp?(!this._candidates||this._candidates.length<1)&&(this.logger.error("No remote ICE candidate"),this._rtcSession._state.setSubState(new u(this._rtcSession))):(this.logger.error("Invalid remote SDP"),this._rtcSession._state.setSubState(new u(this._rtcSession))),this._rtcSession._strategy.setRemoteDescriptionForIceRestart(this,this._rtcSession)}},{key:"onSignalingHandshaked",value:function(){this._signalingHandshakedForIceRestart=!0,this._checkAndTransit()}},{key:"onIceRestartFailure",value:function(){this._rtcSession._state.setSubState(new u(this._rtcSession))}},{key:"_checkAndTransit",value:function(){this._signalingHandshakedForIceRestart&&this._remoteDescriptionSetForIceRestart?this._rtcSession._state.setSubState(new u(this._rtcSession)):this._signalingHandshakedForIceRestart?this.logger.log("Pending setting remote description"):this.logger.log("Pending handshaking")}},{key:"onExit",value:function(){}},{key:"name",get:function(){return"AcceptSubstate"}}]),e}()},{"./exceptions":152,"./rtc_const":153,"./signaling":160,"./utils":167,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,sdp:133}],158:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=a(e("babel-runtime/helpers/classCallCheck")),i=a(e("babel-runtime/helpers/createClass"));n.extractMediaStatsFromStats=function(e,t,n){var r=null,i=null;return t.forEach(function(t){t&&("inbound-rtp"===t.type&&"audio_input"===n?(i=t.type,r={timestamp:e,packetsLost:t.packetsLost,packetsCount:t.packetsReceived,jbMilliseconds:Math.floor(1e3*(0,o.when_defined)(t.jitter,0)),audioLevel:(0,o.is_defined)(t.audioLevel)?Math.floor(32768*t.audioLevel):null}):"outbound-rtp"===t.type&&"audio_output"===n?(r=r||{}).packetsCount=t.packetsSent:"media-source"===t.type&&"audio_output"===n?(r=r||{}).audioLevel=(0,o.is_defined)(t.audioLevel)?Math.floor(32768*t.audioLevel):null:"remote-inbound-rtp"===t.type&&"audio_output"===n&&(i=t.type,(r=r||{}).timestamp=e,r.packetsLost=t.packetsLost,r.rttMilliseconds=(0,o.is_defined)(t.roundTripTime)?Math.floor(1e3*t.roundTripTime):null,r.jbMilliseconds=Math.floor(1e3*(0,o.when_defined)(t.jitter,0))))}),r?new s(r,i,n):null};var o=e("./utils");function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,n,i){(0,r.default)(this,e);var a=t||{};this._timestamp=a.timestamp||(new Date).getTime(),this._packetsLost=(0,o.when_defined)(a.packetsLost),this._packetsCount=(0,o.when_defined)(a.packetsCount),this._audioLevel=(0,o.when_defined)(a.audioLevel),this._procMilliseconds=(0,o.when_defined)(a.procMilliseconds),this._rttMilliseconds=(0,o.when_defined)(a.rttMilliseconds),this._jbMilliseconds=(0,o.when_defined)(a.jbMilliseconds),this._bytesSent=(0,o.when_defined)(a.bytesSent),this._bytesReceived=(0,o.when_defined)(a.bytesReceived),this._framesEncoded=(0,o.when_defined)(a.framesEncoded),this._framesDecoded=(0,o.when_defined)(a.framesDecoded),this._frameRateSent=(0,o.when_defined)(a.frameRateSent),this._frameRateReceived=(0,o.when_defined)(a.frameRateReceived),this._statsReportType=n||a._statsReportType||"unknown",this._streamType=i||a.streamType||"unknown"}return(0,i.default)(e,[{key:"packetsCount",get:function(){return this._packetsCount}},{key:"packetsLost",get:function(){return this._packetsLost}},{key:"packetLossPercentage",get:function(){return this._packetsCount>0?this._packetsLost/this._packetsCount:0}},{key:"audioLevel",get:function(){return this._audioLevel}},{key:"timestamp",get:function(){return this._timestamp}},{key:"procMilliseconds",get:function(){return this._procMilliseconds}},{key:"rttMilliseconds",get:function(){return this._rttMilliseconds}},{key:"jbMilliseconds",get:function(){return this._jbMilliseconds}},{key:"bytesSent",get:function(){return this._bytesSent}},{key:"bytesReceived",get:function(){return this._bytesReceived}},{key:"framesEncoded",get:function(){return this._framesEncoded}},{key:"framesDecoded",get:function(){return this._framesDecoded}},{key:"frameRateSent",get:function(){return this._frameRateSent}},{key:"frameRateReceived",get:function(){return this._frameRateReceived}},{key:"statsReportType",get:function(){return this._statsReportType}},{key:"streamType",get:function(){return this._streamType}}]),e}()},{"./utils":167,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}],159:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SessionReport=void 0;var r=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}n.SessionReport=function(){function e(){(0,r.default)(this,e),this._sessionStartTime=null,this._sessionEndTime=null,this._gumTimeMillis=null,this._initializationTimeMillis=null,this._iceCollectionTimeMillis=null,this._signallingConnectTimeMillis=null,this._handshakingTimeMillis=null,this._preTalkingTimeMillis=null,this._talkingTimeMillis=null,this._iceConnectionsLost=0,this._iceConnectionsFailed=null,this._peerConnectionFailed=null,this._cleanupTimeMillis=null,this._iceCollectionFailure=null,this._signallingConnectionFailure=null,this._handshakingFailure=null,this._gumOtherFailure=null,this._gumTimeoutFailure=null,this._createOfferFailure=null,this._setLocalDescriptionFailure=null,this._userBusyFailure=null,this._invalidRemoteSDPFailure=null,this._noRemoteIceCandidateFailure=null,this._setRemoteDescriptionFailure=null,this._streamStats=[],this._rtcJsVersion="1.2.1",this._userAgentData=null}return(0,i.default)(e,[{key:"sessionStartTime",get:function(){return this._sessionStartTime},set:function(e){this._sessionStartTime=e}},{key:"sessionEndTime",get:function(){return this._sessionEndTime},set:function(e){this._sessionEndTime=e}},{key:"gumTimeMillis",get:function(){return this._gumTimeMillis},set:function(e){this._gumTimeMillis=e}},{key:"initializationTimeMillis",get:function(){return this._initializationTimeMillis},set:function(e){this._initializationTimeMillis=e}},{key:"iceCollectionTimeMillis",get:function(){return this._iceCollectionTimeMillis},set:function(e){this._iceCollectionTimeMillis=e}},{key:"signallingConnectTimeMillis",get:function(){return this._signallingConnectTimeMillis},set:function(e){this._signallingConnectTimeMillis=e}},{key:"preTalkingTimeMillis",get:function(){return this._preTalkingTimeMillis},set:function(e){this._preTalkingTimeMillis=e}},{key:"handshakingTimeMillis",get:function(){return this._handshakingTimeMillis},set:function(e){this._handshakingTimeMillis=e}},{key:"talkingTimeMillis",get:function(){return this._talkingTimeMillis},set:function(e){this._talkingTimeMillis=e}},{key:"iceConnectionsLost",get:function(){return this._iceConnectionsLost},set:function(e){this._iceConnectionsLost=e}},{key:"iceConnectionsFailed",get:function(){return this._iceConnectionsFailed},set:function(e){this._iceConnectionsFailed=e}},{key:"peerConnectionFailed",get:function(){return this._peerConnectionFailed},set:function(e){this._peerConnectionFailed=e}},{key:"cleanupTimeMillis",get:function(){return this._cleanupTimeMillis},set:function(e){this._cleanupTimeMillis=e}},{key:"iceCollectionFailure",get:function(){return this._iceCollectionFailure},set:function(e){this._iceCollectionFailure=e}},{key:"signallingConnectionFailure",get:function(){return this._signallingConnectionFailure},set:function(e){this._signallingConnectionFailure=e}},{key:"handshakingFailure",get:function(){return this._handshakingFailure},set:function(e){this._handshakingFailure=e}},{key:"gumTimeoutFailure",get:function(){return this._gumTimeoutFailure},set:function(e){this._gumTimeoutFailure=e}},{key:"gumOtherFailure",get:function(){return this._gumOtherFailure},set:function(e){this._gumOtherFailure=e}},{key:"createOfferFailure",get:function(){return this._createOfferFailure},set:function(e){this._createOfferFailure=e}},{key:"setLocalDescriptionFailure",get:function(){return this._setLocalDescriptionFailure},set:function(e){this._setLocalDescriptionFailure=e}},{key:"userBusyFailure",get:function(){return this._userBusyFailure},set:function(e){this._userBusyFailure=e}},{key:"invalidRemoteSDPFailure",get:function(){return this._invalidRemoteSDPFailure},set:function(e){this._invalidRemoteSDPFailure=e}},{key:"setRemoteDescriptionFailure",get:function(){return this._setRemoteDescriptionFailure},set:function(e){this._setRemoteDescriptionFailure=e}},{key:"noRemoteIceCandidateFailure",get:function(){return this._noRemoteIceCandidateFailure},set:function(e){this._noRemoteIceCandidateFailure=e}},{key:"streamStats",get:function(){return this._streamStats},set:function(e){this._streamStats=e}},{key:"rtcJsVersion",get:function(){return this._rtcJsVersion},set:function(e){this._rtcJsVersion=e}},{key:"userAgentData",get:function(){return this._userAgentData},set:function(e){this._userAgentData=e}}]),e}()},{"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FailedState=n.DisconnectedState=n.PendingLocalHangupState=n.PendingRemoteHangupState=n.PendingReconnectState=n.TalkingState=n.IdleState=n.PendingAcceptAckState=n.PendingConnectContactState=n.PendingAcceptState=n.PendingAnswerState=n.PendingInviteState=n.PendingConnectState=n.FailOnTimeoutState=n.SignalingState=void 0;var r=_(e("babel-runtime/helpers/get")),i=_(e("babel-runtime/regenerator")),o=_(e("babel-runtime/helpers/asyncToGenerator")),a=_(e("babel-runtime/helpers/possibleConstructorReturn")),s=_(e("babel-runtime/helpers/inherits")),c=_(e("babel-runtime/helpers/classCallCheck")),d=_(e("babel-runtime/helpers/createClass")),l=e("./utils"),u=e("./rtc_const"),f=e("./exceptions"),h=_(e("uuid/v4")),p=_(e("./virtual_wss_connection_manager"));function _(e){return e&&e.__esModule?e:{default:e}}var g=n.SignalingState=function(){function e(t){(0,c.default)(this,e),this._signaling=t,this._createTime=(new Date).getTime()}return(0,d.default)(e,[{key:"setStateTimeout",value:function(e){setTimeout((0,l.hitch)(this,this._onTimeoutChecked),e)}},{key:"onEnter",value:function(){}},{key:"_onTimeoutChecked",value:function(){this.isCurrentState&&this.onTimeout()}},{key:"onTimeout",value:function(){throw new f.UnsupportedOperation}},{key:"transit",value:function(e){this._signaling.transit(e)}},{key:"onExit",value:function(){}},{key:"onOpen",value:function(){throw new f.UnsupportedOperation("onOpen not supported by "+this.name)}},{key:"onError",value:function(){this.channelDown()}},{key:"onClose",value:function(){this.channelDown()}},{key:"channelDown",value:function(){throw new f.UnsupportedOperation("channelDown not supported by "+this.name)}},{key:"onRpcMsg",value:function(e){throw new f.UnsupportedOperation("onRpcMsg not supported by "+this.name)}},{key:"invite",value:function(e,t){throw new f.UnsupportedOperation("invite not supported by "+this.name)}},{key:"accept",value:function(){throw new f.UnsupportedOperation("accept not supported by "+this.name)}},{key:"connectContact",value:function(){throw new f.UnsupportedOperation("connectContact not supported by "+this.name)}},{key:"hangup",value:function(){}},{key:"bye",value:function(){}},{key:"isCurrentState",get:function(){return this===this._signaling.state}},{key:"name",get:function(){return"SignalingState"}},{key:"logger",get:function(){return this._signaling._logger}}]),e}(),m=n.FailOnTimeoutState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._timeoutMs=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){this.setStateTimeout(this._timeoutMs)}},{key:"onTimeout",value:function(){this.transit(new P(this._signaling,new f.Timeout))}},{key:"name",get:function(){return"FailOnTimeoutState"}}]),t}(g),v=n.PendingConnectState=function(e){function t(e,n,r,i){(0,c.default)(this,t);var o=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o._initialStartTime=r||(new Date).getTime(),o._retries=i||0,o}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onOpen",value:function(){this._signaling._pcm&&this._signaling._pcm.contactToken&&this._signaling._pcm.isPersistentConnectionEnabled()&&!this._signaling._isFirstTimeSetup?this.transit(new S(this._signaling)):this.transit(new y(this._signaling))}},{key:"channelDown",value:function(){var e=(new Date).getTime(),n=this._initialStartTime+this._timeoutMs-e;n>0&&++this._retries<3?(this._signaling._connect(),this.transit(new t(this._signaling,n,this._initialStartTime,this._retries))):this.transit(new P(this._signaling,new f.SignalingChannelDownError))}},{key:"name",get:function(){return"PendingConnectState"}}]),t}(m),y=n.PendingInviteState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._retries=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;new Promise(function(t){e._signaling._connectedHandler(),t()})}},{key:"invite",value:function(e,t){var n,r=(0,h.default)();n=this._signaling._pcm?{sdp:e,candidates:t,callContextToken:this._signaling._contactToken,contactId:void 0===this._signaling.callId?"":this._signaling.callId,browserId:this._signaling._pcm.browserId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,iceRestart:this._signaling._pcm._iceRestart,peerConnectionToken:this._signaling._pcm.peerConnectionToken}:{sdp:e,candidates:t,callContextToken:this._signaling._contactToken},this.logger.log("Sending SDP",(0,l.getRedactedSdp)(e)),this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.INVITE_METHOD_NAME,params:n,id:r})),this.transit(new b(this._signaling,r,this._retries))}},{key:"channelDown",value:function(){this.transit(new P(this._signaling,new f.SignalingChannelDownError))}},{key:"name",get:function(){return"PendingInviteState"}}]),t}(g),b=n.PendingAnswerState=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.MAX_INVITE_DELAY_MS));return i._inviteId=n,i._retries=r||0,i}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onRpcMsg",value:function(e){var t=this;e.id===this._inviteId&&(e.error||!e.result?++this._retries<0?this.transit(new y(this._signaling,this._retries)):this.transit(new P(this._signaling,this.translateInviteError(e))):(new Promise(function(n){if(t.logger.log("Received SDP",(0,l.getRedactedSdp)(e.result.sdp)),t._signaling._pcm){t._signaling._pcm.peerConnectionToken=e.result.peerConnectionToken,t._signaling._pcm.peerConnectionId=e.result.peerConnectionId;var r=!!e.result.peerConnectionId;r!==t._signaling._pcm.isRTPSAllowlisted&&r&&t._signaling._pcm.closeEarlyMediaConnection(),t._signaling._pcm.isRTPSAllowlisted=r,t._signaling._answeredHandler(e.result.sdp,e.result.candidates,e.result.inactivityDuration,e.result.peerConnectionId,e.result.peerConnectionToken)}else t._signaling._answeredHandler(e.result.sdp,e.result.candidates);t._signaling._isMediaClusterPath=!(e.result.sdp.includes("AmazonConnect")&&e.result.sdp.includes("silenceSupp")),n()}),this.transit(new C(this._signaling,this._signaling._autoAnswer))))}},{key:"translateInviteError",value:function(e){return e.error&&403==e.error.code?new f.AccessDeniedException(e.error.message):e.error&&486==e.error.code?new f.BusyException(e.error.message):e.error&&404==e.error.code?new f.CallNotFoundException(e.error.message):e.error&&400==e.error.code?new f.BadRequestException(e.error.message):e.error&&408==e.error.code?new f.RequestTimeoutException(e.error.message):e.error&&409==e.error.code?new f.IdempotencyException(e.error.message):e.error&&500==e.error.code?new f.InternalServerException(e.error.message):new f.UnknownSignalingError}},{key:"hangup",value:function(){this.transit(new P(this._signaling,"Hangs up in PendingAnswerState"))}},{key:"name",get:function(){return"PendingAnswerState"}}]),t}(m),C=n.PendingAcceptState=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._autoAnswer=n,i._retries=r,i}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){this._autoAnswer&&this.accept()}},{key:"accept",value:function(){this.sendAcceptRequest(),this._signaling._pcm&&this._signaling._pcm.isPersistentConnectionEnabled()&&null===this._signaling._pcm.contactToken&&this._signaling._isFirstTimeSetup?this.transit(new E(this._signaling,this._acceptId,this._retries,u.ACCEPT_METHOD_NAME)):this.transit(new R(this._signaling,this._acceptId,this._retries,u.ACCEPT_METHOD_NAME))}},{key:"channelDown",value:function(){this.transit(new P(this._signaling,new f.SignalingChannelDownError))}},{key:"sendAcceptRequest",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._acceptId=(0,h.default)(),t={},this._signaling._pcm&&(t={contactId:void 0===this._signaling._pcm.callId?null:this._signaling._pcm.callId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken}),this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.ACCEPT_METHOD_NAME,params:t,id:this._acceptId}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return"PendingAcceptState"}}]),t}(g),S=n.PendingConnectContactState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._retries=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){(0,r.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onEnter",this).call(this);this.connectContact()}},{key:"connectContact",value:function(){this._connectContactId=(0,h.default)();var e={contactId:this._signaling._pcm.callId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken,callContextToken:this._signaling._pcm.contactToken};this._signaling._wss._connectionId=this._signaling._pcm.connectionId,this._signaling._connectionId=this._signaling._pcm.connectionId,this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.CONNECT_CONTACT_METHOD_NAME,params:e,id:this._connectContactId})),this.transit(new R(this._signaling,this._connectContactId,this._retries,u.CONNECT_CONTACT_METHOD_NAME))}},{key:"name",get:function(){return"PendingConnectContactState"}}]),t}(g),E=(n.PendingAcceptAckState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.MAX_ACCEPT_BYE_DELAY_MS));return r._acceptId=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onRpcMsg",value:function(e){e.id===this._acceptId&&(e.error?this.transit(new P(this._signaling,new f.SignalingChannelDownError)):(this._signaling._clientToken=e.result.clientToken,this.transit(new R(this._signaling))))}},{key:"name",get:function(){return"PendingAcceptAckState"}}]),t}(m),n.IdleState=function(e){function t(e,n,r,i){(0,c.default)(this,t);var o=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o._methodId=n,o._retries=r||0,o._retryMethod=i,o}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;new Promise(function(t){e._signaling._handshakedHandler(),t()}),e._signaling._pcm.startInactivityTimer()}},{key:"connectContact",value:function(){this.transit(new S(this._signaling))}},{key:"hangup",value:function(){this.bye()}},{key:"bye",value:function(){this._byeId=(0,h.default)(),this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.BYE_METHOD_NAME,params:{contactId:void 0===this._signaling._pcm.callId?null:this._signaling._pcm.callId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken,callContextToken:this._signaling._pcm.contactToken},id:this._byeId})),this.transit(new w(this._signaling,this._byeId))}},{key:"onRpcMsg",value:function(e){e.method===u.PC_BYE_METHOD_NAME?(this.logger.log("Received PC bye from server, tear down the peer connection"),this.tearDownPeerConnection(e.peerConnectionId)):e.method===u.BYE_METHOD_NAME?this.transit(new k(this._signaling,e.id)):"renewClientToken"===e.method?this._signaling._clientToken=e.params.clientToken:this._signaling._pcm&&e.error&&e.id===this._methodId&&(this._retryMethod===u.ACCEPT_METHOD_NAME&&++this._retries<0?this.transit(new C(this._signaling,this._retries)):this._signaling._pcm._rtcSession?this._signaling._pcm.destroy():this.transit(new P(this._signaling,this.translateResponseError(e))))}},{key:"tearDownPeerConnection",value:function(e){e===this._signaling._pcm.peerConnectionId?(this._signaling._pcm.destroy(e),this.transit(new I(this._signaling))):this.logger.log("peerConnectionId in the PCBye request does NOT match the peerConnectionId of the existing peer connection, failed to tear down peer connection")}},{key:"translateResponseError",value:function(e){return e.error&&403==e.error.code?new f.AccessDeniedException(e.error.message):e.error&&404==e.error.code?new f.CallNotFoundException(e.error.message):e.error&&400==e.error.code?new f.BadRequestException(e.error.message):e.error&&408==e.error.code?new f.RequestTimeoutException(e.error.message):e.error&&500==e.error.code?new f.InternalServerException(e.error.message):new f.UnknownSignalingError}},{key:"channelDown",value:function(){this._signaling._reconnect(),this._signaling.transit(new T(this._signaling))}},{key:"name",get:function(){return"IdleState"}}]),t}(g)),R=n.TalkingState=function(e){function t(e,n,r,i){(0,c.default)(this,t);var o=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o._methodId=n,o._retries=r||0,o._retryMethod=i,o}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;e._signaling._pcm&&e._signaling._pcm.isPersistentConnectionEnabled()&&!e._signaling._isFirstTimeSetup||new Promise(function(t){e._signaling._handshakedHandler(),t()}),e._signaling._isFirstTimeSetup=!1}},{key:"hangup",value:function(){this._signaling._pcm&&this._signaling._pcm.isPersistentConnectionEnabled()?this.disconnectContact():this.bye()}},{key:"bye",value:function(){this._byeId=(0,h.default)();var e={};e=this._signaling._pcm?{contactId:void 0===this._signaling._pcm.callId?null:this._signaling._pcm.callId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken,callContextToken:this._signaling._pcm.contactToken}:{callContextToken:this._signaling._contactToken},this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.BYE_METHOD_NAME,params:e,id:this._byeId})),this.transit(new w(this._signaling,this._byeId))}},{key:"disconnectContact",value:function(){this._disconnectContactId=(0,h.default)();this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.DISCONNECT_CONTACT_METHOD_NAME,params:{contactId:this._signaling._pcm.callId,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken},id:this._disconnectContactId})),this.transit(new E(this._signaling,this._disconnectContactId))}},{key:"onRpcMsg",value:function(e){e.method===u.BYE_METHOD_NAME?this.transit(new k(this._signaling,e.id)):"renewClientToken"===e.method?this._signaling._clientToken=e.params.clientToken:this._signaling._pcm&&e.error&&e.id===this._methodId&&(this._retryMethod===u.CONNECT_CONTACT_METHOD_NAME&&++this._retries<0?this.transit(new S(this._signaling,this._retries)):this._retryMethod===u.ACCEPT_METHOD_NAME&&++this._retries<0?this.transit(new C(this._signaling,this._retries)):this.transit(new P(this._signaling,this.translateResponseError(e))))}},{key:"translateResponseError",value:function(e){return e.error&&403==e.error.code?new f.AccessDeniedException(e.error.message):404==e.error.code?new f.CallNotFoundException(e.error.message):400==e.error.code?new f.BadRequestException(e.error.message):408==e.error.code?new f.RequestTimeoutException(e.error.message):500==e.error.code?new f.InternalServerException(e.error.message):new f.UnknownSignalingError}},{key:"channelDown",value:function(){this._signaling._reconnect(),this._signaling.transit(new T(this._signaling))}},{key:"name",get:function(){return"TalkingState"}}]),t}(g),T=n.PendingReconnectState=function(e){function t(e){return(0,c.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.DEFAULT_CONNECT_TIMEOUT_MS))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onOpen",value:function(){this.transit(new R(this._signaling))}},{key:"channelDown",value:function(){this.transit(new P(this._signaling,new f.SignalingChannelDownError))}},{key:"name",get:function(){return"PendingReconnectState"}}]),t}(m),w=n.PendingRemoteHangupState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.MAX_ACCEPT_BYE_DELAY_MS));return r._byeId=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onRpcMsg",value:function(e){e.id!==this._byeId&&e.method!==u.BYE_METHOD_NAME||this.transit(new I(this._signaling))}},{key:"name",get:function(){return"PendingRemoteHangupState"}}]),t}(m),k=n.PendingLocalHangupState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._byeId=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;new Promise(function(t){e._signaling._remoteHungupHandler(),t()})}},{key:"hangup",value:function(){this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",result:{},id:this._byeId})),this.transit(new I(this._signaling))}},{key:"onRpcMsg",value:function(){}},{key:"channelDown",value:function(){this.transit(new I(this._signaling))}},{key:"name",get:function(){return"PendingLocalHangupState"}}]),t}(g),I=n.DisconnectedState=function(e){function t(){return(0,c.default)(this,t),(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;new Promise(function(t){e._signaling._disconnectedHandler(),t()}),this._signaling._wss.close()}},{key:"channelDown",value:function(){}},{key:"onRpcMsg",value:function(){}},{key:"name",get:function(){return"DisconnectedState"}}]),t}(g),P=n.FailedState=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._exception=n,r}return(0,s.default)(t,e),(0,d.default)(t,[{key:"onEnter",value:function(){var e=this;new Promise(function(t){e._signaling._pcm&&e._exception.name===f.AccessDeniedExceptionName&&(e._signaling._pcm.isRTPSAllowlisted=!1,e._signaling._pcm.closeEarlyMediaConnection()),e._signaling._failedHandler(e._exception),t()}),e._signaling._pcm||e._signaling._wss.close()}},{key:"bye",value:function(){this._byeId=(0,h.default)(),this._signaling._wss.send(JSON.stringify({jsonrpc:"2.0",method:u.BYE_METHOD_NAME,params:{contactId:void 0===this._signaling._pcm.callId?null:this._signaling._pcm.callId,persistentConnection:this._signaling._pcm.isPPCEnabled,peerConnectionId:this._signaling._pcm.peerConnectionId,peerConnectionToken:this._signaling._pcm.peerConnectionToken,callContextToken:this._signaling._pcm.contactToken},id:this._byeId}))}},{key:"hangup",value:function(){this.bye()}},{key:"onRpcMsg",value:function(){}},{key:"channelDown",value:function(){}},{key:"name",get:function(){return"FailedState"}},{key:"exception",get:function(){return this._exception}}]),t}(g),A=function(){function e(t,n,r,i,o,a,s){var d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;(0,c.default)(this,e),this._callId=t,this._connectTimeoutMs=o||u.DEFAULT_CONNECT_TIMEOUT_MS,this._autoAnswer=!0,this._signalingUri=n,this._contactToken=r,this._logger=(0,l.wrapLogger)(i,t,"SIGNALING"),this._connectionId=a,this._wssManager=s,this._iceRestart=d,this._pcm=f,this._isFirstTimeSetup=!0,this._connectedHandler=this._answeredHandler=this._handshakedHandler=this._reconnectedHandler=this._remoteHungupHandler=this._disconnectedHandler=this._failedHandler=function(){}}return(0,d.default)(e,[{key:"connect",value:function(){this._connect(),this.transit(new v(this,this._connectTimeoutMs))}},{key:"_connect",value:function(){this._wss=this._connectWebSocket(this._buildInviteUri())}},{key:"transit",value:function(e){try{this._logger.info((this._state?this._state.name:"null")+" => "+e.name),this.state&&this.state.onExit&&this.state.onExit()}finally{this._state=e,this._state.onEnter&&this._state.onEnter()}}},{key:"_connectWebSocket",value:function(e){var t=void 0;return(t=this._wssManager?new p.default(this._logger,this._connectionId,this._wssManager):new WebSocket(e)).onopen=(0,l.hitch)(this,this._onOpen),t.onmessage=(0,l.hitch)(this,this._onMessage),t.onerror=(0,l.hitch)(this,this._onError),t.onclose=(0,l.hitch)(this,this._onClose),t}},{key:"_buildInviteUri",value:function(){return this._contactToken?this._buildUriBase()+"&contactCtx="+encodeURIComponent(this._contactToken):this._buildUriBase()}},{key:"_buildReconnectUri",value:function(){return this._buildUriBase()+"&clientToken="+encodeURIComponent(this._clientToken)}},{key:"_buildUriBase",value:function(){var e="?";return!this._pcm&&this._signalingUri.indexOf(e)>-1&&(e="&"),this._signalingUri+e+"callId="+encodeURIComponent(this._callId)}},{key:"_onMessage",value:function(e){this.state.onRpcMsg(JSON.parse(e.data))}},{key:"_onOpen",value:function(e){this.state.onOpen(e)}},{key:"_onError",value:function(e){this.state.onError(e)}},{key:"_onClose",value:function(e){this._logger.log("WebSocket onclose code="+e.code+", reason="+e.reason),this.state.onClose(e)}},{key:"_reconnect",value:function(){this._wss=this._connectWebSocket(this._buildReconnectUri())}},{key:"invite",value:function(e,t){this.state.invite(e,t)}},{key:"connectContact",value:function(){this.state.connectContact()}},{key:"accept",value:function(){this.state.accept()}},{key:"hangup",value:function(){this.state.hangup()}},{key:"bye",value:function(){this.state.bye()}},{key:"callId",get:function(){return this._callId}},{key:"iceRestart",get:function(){return this._iceRestart}},{key:"onConnected",set:function(e){this._connectedHandler=e}},{key:"onAnswered",set:function(e){this._answeredHandler=e}},{key:"onHandshaked",set:function(e){this._handshakedHandler=e}},{key:"onReconnected",set:function(e){this._reconnectedHandler=e}},{key:"onRemoteHungup",set:function(e){this._remoteHungupHandler=e}},{key:"onDisconnected",set:function(e){this._disconnectedHandler=e}},{key:"onFailed",set:function(e){this._failedHandler=e}},{key:"state",get:function(){return this._state}}]),e}();n.default=A},{"./exceptions":152,"./rtc_const":153,"./utils":167,"./virtual_wss_connection_manager":168,"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/get":19,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21,"babel-runtime/regenerator":27,"uuid/v4":137}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e),console.log("CCPInitiationStrategyInterface initialized")}return(0,i.default)(e,[{key:"getStrategyName",value:function(){console.error("getStrategyName needs to be overridden")}},{key:"_isEarlyMediaConnectionSupported",value:function(){console.error("_isEarlyMediaConnectionSupported needs to be overridden")}},{key:"_createRtcPeerConnection",value:function(){console.error("_createRtcPeerConnection needs to be overridden")}},{key:"_gUM",value:function(){console.error("_gUM needs to be overridden")}},{key:"_createMediaStream",value:function(){console.error("_createMediaStream needs to be overridden")}},{key:"addStream",value:function(){console.error("addStream needs to be overridden")}},{key:"setRemoteDescription",value:function(){console.error("setRemoteDescription needs to be overridden")}},{key:"setRemoteDescriptionForIceRestart",value:function(){console.error("setRemoteDescriptionForIceRestart needs to be overridden")}},{key:"onIceStateChange",value:function(){console.error("onIceStateChange needs to be overridden")}},{key:"onPeerConnectionStateChange",value:function(){console.error("onPeerConnectionStateChange needs to be overridden")}},{key:"_createPeerConnection",value:function(){console.error("_createPeerConnection needs to be overridden")}},{key:"connect",value:function(){console.error("connect needs to be overridden")}},{key:"_ontrack",value:function(){console.error("_ontrack needs to be overridden")}},{key:"_buildMediaConstraints",value:function(){console.error("_buildMediaConstraints needs to be overridden")}}]),e}();n.default=a},{"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}],162:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=l(e("babel-runtime/helpers/classCallCheck")),i=l(e("babel-runtime/helpers/createClass")),o=l(e("babel-runtime/helpers/possibleConstructorReturn")),a=l(e("babel-runtime/helpers/inherits")),s=l(e("./CCPInitiationStrategyInterface")),c=e("../rtc_session"),d=e("../rtc_const");function l(e){return e&&e.__esModule?e:{default:e}}var u=function(n){function s(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,r.default)(this,s);var n=(0,o.default)(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return t&&e("@citrix/ucsdk/CitrixWebRTC"),console.log("CitrixVDIStrategy initializing"),n.initCitrixWebRTC(),n.initGetCitrixWebrtcRedir(),n.initLog(),n.version="UNKNOWN",n}return(0,a.default)(s,n),(0,i.default)(s,[{key:"initCitrixWebRTC",value:function(){var e=this;window.CitrixWebRTC.setVMEventCallback(function(t){if("vdiClientConnected"===t.event){if(!window.CitrixWebRTC.isFeatureOn("webrtc1.0"))throw new Error("Citrix WebRTC redirection feature is NOT supported!");console.log("CitrixVDIStrategy initialized"),e.version=t.version}else"vdiClientDisconnected"===t.event&&console.log("vdiClientDisconnected")}),window.CitrixWebRTC.initUCSDK("AmazonConnect")}},{key:"initGetCitrixWebrtcRedir",value:function(){window.getCitrixWebrtcRedir=function(){return Promise.resolve(1)}}},{key:"initLog",value:function(){window.CitrixWebRTC.initLog(t.connect.getLog())}},{key:"_isEarlyMediaConnectionSupported",value:function(){return!1}},{key:"_createRtcPeerConnection",value:function(e,t){return new window.CitrixWebRTC.CitrixPeerConnection(e,t)}},{key:"_gUM",value:function(e){return window.CitrixWebRTC.getUserMedia(e)}},{key:"_createMediaStream",value:function(e){return window.CitrixWebRTC.createMediaStream([e])}},{key:"addStream",value:function(e,t){t.getTracks().forEach(function(t){e.addTransceiver(t,{})})}},{key:"setRemoteDescription",value:function(e,t){this.version&&"Browser"===this.version.clientPlatform&&e._candidates.forEach(function(t){t&&"string"==typeof t.candidate&&""!==t.candidate.trim()&&(e._sdp+="a="+t.candidate+"\n",e.logger.info("Updated SDP for ChromeOS","a="+t.candidate+"\n"))});var n=e._createSessionDescription({type:"answer",sdp:e._sdp});t._pc.setRemoteDescription(n,function(){Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)})).catch(function(t){e.logger.warn("Error adding remote candidate",t)}),t._sessionReport.setRemoteDescriptionFailure=!1,e._remoteDescriptionSet=!0,e._checkAndTransit()},function(){t._stopSession(),t._sessionReport.setRemoteDescriptionFailure=!0,e.transit(new c.FailedState(t,d.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"setRemoteDescriptionForIceRestart",value:function(e,t){var n=e._createSessionDescription({type:"answer",sdp:e._sdp});t._pc.setRemoteDescription(n,function(){Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)})).catch(function(t){e.logger.warn("Error adding remote candidate",t)}),e._remoteDescriptionSetForIceRestart=!0,e._checkAndTransit()},function(){e.onIceRestartFailure()})}},{key:"onIceStateChange",value:function(e,t){return t.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(e){return e.connectionState_}},{key:"_createPeerConnection",value:function(e,t){return new window.CitrixWebRTC.CitrixPeerConnection(e,t)}},{key:"_ontrack",value:function(e,t){window.CitrixWebRTC.mapAudioElement(e._remoteAudioElement),t.streams.length>1&&e._logger.warn("Found more than 1 streams for "+t.track.kind+" track "+t.track.id+" : "+t.streams.map(function(e){return e.id}).join(",")),"video"===t.track.kind&&e._remoteVideoElement?(e._remoteVideoElement.srcObject=t.streams[0],e._remoteVideoStream=t.streams[0]):"audio"===t.track.kind&&e._remoteAudioElement&&(e._remoteAudioElement.srcObject=t.streams[0],e._remoteAudioStream=t.streams[0]),e._remoteAudioElement.play()}},{key:"_buildMediaConstraints",value:function(e,t){if(e._enableAudio){var n={};void 0!==e._echoCancellation&&(n.echoCancellation=!!e._echoCancellation),window.audio_input&&(n.deviceId=window.audio_input),Object.keys(n).length>0?t.audio=n:t.audio=!0}else t.audio=!1}},{key:"getStrategyName",value:function(){return"CitrixVDIStrategy"}}]),s}(s.default);n.default=u}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../rtc_const":153,"../rtc_session":156,"./CCPInitiationStrategyInterface":161,"@citrix/ucsdk/CitrixWebRTC":2,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=f(e("babel-runtime/helpers/typeof")),i=f(e("babel-runtime/helpers/classCallCheck")),o=f(e("babel-runtime/helpers/createClass")),a=f(e("babel-runtime/helpers/possibleConstructorReturn")),s=f(e("babel-runtime/helpers/inherits")),c=f(e("./CCPInitiationStrategyInterface")),d=e("../rtc_session"),l=e("../rtc_const"),u=e("../config/constants");function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!window.DCVWebRTCPeerConnectionProxy)throw new Error("DCV WebRTC redirection feature is NOT supported!");return window.DCVWebRTCPeerConnectionProxy.setInitCallback(function(t){if(!t.success)throw new Error("DCV WebRTC redirection feature is NOT supported!");e.proxy=window.DCVWebRTCRedirProxy,e.proxy.overrideWebRTC(),console.log("DCVStrategy initialized")},5e3),e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"isChromeBrowser",value:function(){return this.proxy.clientInfo.browserDetails.browser===u.CHROME}},{key:"getChromeBrowserVersion",value:function(){return this.proxy.clientInfo.browserDetails.version}},{key:"_isEarlyMediaConnectionSupported",value:function(){return this.isChromeBrowser()&&this.getChromeBrowserVersion()>=59}},{key:"_createRtcPeerConnection",value:function(e,t){return this.proxy.createPeerConnection(e,t)}},{key:"_buildMediaConstraints",value:function(e,t){if(e._enableAudio){var n={};(0,r.default)(e._echoCancellation)!==u.UNDEFINED&&(n.echoCancellation=!!e._echoCancellation),Object.keys(n).length>0?t.audio=n:t.audio=!0}else t.audio=!1}},{key:"_gUM",value:function(e){return this.proxy.getUserMedia(e)}},{key:"_createMediaStream",value:function(e){return new MediaStream([e])}},{key:"_createPeerConnection",value:function(e,t){return this.proxy.createPeerConnection(e,t)}},{key:"addStream",value:function(e,t){t.getTracks().forEach(function(n){e.addTransceiver(n.kind,{streams:[t]}).sender.replaceTrack(n)})}},{key:"setRemoteDescription",value:function(e,t){var n=t._pc.setRemoteDescription(e._createSessionDescription({type:u.ANSWER,sdp:e._sdp}));n.catch(function(t){e.logger.error("SetRemoteDescription failed",t)}),n.then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){t._sessionReport.setRemoteDescriptionFailure=!1,e._remoteDescriptionSet=!0,e._checkAndTransit()}).catch(function(){t._stopSession(),t._sessionReport.setRemoteDescriptionFailure=!0,e.transit(new d.FailedState(t,l.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"setRemoteDescriptionForIceRestart",value:function(e,t){var n=t._pc.setRemoteDescription(e._createSessionDescription({type:u.ANSWER,sdp:e._sdp}));n.catch(function(t){e.logger.error("SetRemoteDescription failed",t)}),n.then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){e._remoteDescriptionSetForIceRestart=!0,e._checkAndTransit()}).catch(function(){e.onIceRestartFailure()})}},{key:"onIceStateChange",value:function(e,t){return t.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(e){return e.connectionState}},{key:"_ontrack",value:function(e,t){t.streams.length>1&&console.warn("Found more than 1 streams for "+t.track.kind+" track "+t.track.id+" : "+t.streams.map(function(e){return e.id}).join(","));var n=t.streams[0];e._remoteAudioElement=this.createMediaElement(n),e._remoteAudioStream=n,e._remoteAudioElement.srcObject=n}},{key:"createMediaElement",value:function(e){var t={kind:u.AUDIO,autoplay:!0},n=e.createMediaElement(t);return console.log("Creating proxied media element."),n}},{key:"getStrategyName",value:function(){return u.DCV_STRATEGY}}]),t}(c.default);n.default=h},{"../config/constants":150,"../rtc_const":153,"../rtc_session":156,"./CCPInitiationStrategyInterface":161,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21,"babel-runtime/helpers/typeof":24}],164:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=f(e("babel-runtime/regenerator")),i=f(e("babel-runtime/helpers/asyncToGenerator")),o=f(e("babel-runtime/helpers/classCallCheck")),a=f(e("babel-runtime/helpers/createClass")),s=f(e("babel-runtime/helpers/possibleConstructorReturn")),c=f(e("babel-runtime/helpers/inherits")),d=f(e("./CCPInitiationStrategyInterface")),l=e("../rtc_session"),u=e("../rtc_const");function f(e){return e&&e.__esModule?e:{default:e}}var h=function(n){function d(){(0,o.default)(this,d);var n=(0,s.default)(this,(d.__proto__||Object.getPrototypeOf(d)).call(this)),a=n;a.topWindowName="UNKNOWN",a.hasRequestedTitle=!1;var c=e("@euc-releases/horizon-webrtc-redir-sdk/HorizonWebRTCExtension"),l=e("@euc-releases/horizon-webrtc-redir-sdk/HorizonSDKforWebRTCRedir");window.HorizonWebRTCExtension=c,window.HorizonWebRtcRedirectionAPI=l,n.globalWindowReference=null,window.getHorizonClientID=(0,i.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){window.HorizonWebRTCExtension.getHorizonClientID().then(function(t){console.log("getHorizonClientID resolved with:",t),e(t)}).catch(function(e){console.error("Failed to get client ID: "+e),t("Failed to get client ID: "+e)})}));case 1:case"end":return e.stop()}},e,this)})),window.getHorizonWSSPort=(0,i.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){window.HorizonWebRTCExtension.getHorizonWSSPort().then(function(t){console.log("getHorizonWSSPort resolved with:",t),e(t)}).catch(function(e){console.error("Failed to get WSS port: "+e),t("Failed to get WSS port: "+e)})}));case 1:case"end":return e.stop()}},e,this)})),window.getHorizonWindowTitle=function(){if(a.topWindowName.endsWith(u.ACITVE_SOFTPHONE_TAB))return a.topWindowName;var e=a.getCurrentTimeString();try{return a.setTopWindowName(top.document.title+e+u.ACITVE_SOFTPHONE_TAB)}catch(e){return a.setupMessageListener(),a.topWindowName}};var f={error:function(e){return t.connect.getLog().error("OmnissaVDI: "+e)},info:function(e){return t.connect.getLog().info("OmnissaVDI: "+e)},warn:function(e){return t.connect.getLog().warn("OmnissaVDI: "+e)}};if(!window.HorizonWebRtcRedirectionAPI.initSDK(f,"AmazonConnect",n.vmEventHandler))throw new Error("Omnissa WebRTC Redirection API failed to initialize");return n}return(0,c.default)(d,n),(0,a.default)(d,[{key:"vmEventHandler",value:function(e){var t=e.event;switch(console.log("Horizon WebRTCRedirSDK Event:",JSON.stringify(e)),t){case"vdiClientConnected":console.log("Got event from WebRTCRedirSDK: vdiClientConnected");break;case"vdiClientDisconnected":console.log("Got event from WebRTCRedirSDK: vdiClientDisconnected");break;default:console.log("Got an unknown event from WebRTCRedirSDK: "+JSON.stringify(e))}}},{key:"_isEarlyMediaConnectionSupported",value:function(){return!1}},{key:"_createRtcPeerConnection",value:function(e,t){return window.HorizonWebRtcRedirectionAPI.newPeerConnection(e,t)}},{key:"_gUM",value:function(e){return window.HorizonWebRtcRedirectionAPI.getUserMedia(e)}},{key:"_createMediaStream",value:function(e){return window.HorizonWebRtcRedirectionAPI.newMediaStream([e])}},{key:"_createPeerConnection",value:function(e,t){return window.HorizonWebRtcRedirectionAPI.newPeerConnection(e,t)}},{key:"onIceStateChange",value:function(e,t){return t.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(e){return e.connectionState}},{key:"_buildMediaConstraints",value:function(e,t){if(e._enableAudio){var n={};window.audio_input?(console.log("Setting deviceId to:",window.audio_input),n.deviceId=window.audio_input):console.log("No audio input device specified"),Object.keys(n).length>0?(console.log("Using specific audio constraints:",n),t.audio=n):(console.log("No specific constraints, setting audio to true"),t.audio=!0)}else console.log("Audio is disabled, setting audio to false"),t.audio=!1}},{key:"addStream",value:function(e,t){t.getTracks().forEach(function(n){e.addTrack(n,t)})}},{key:"setRemoteDescription",value:function(e,t){t._pc.setRemoteDescription(e._createSessionDescription({type:"answer",sdp:e._sdp})).then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){t._sessionReport.setRemoteDescriptionFailure=!1,e._remoteDescriptionSet=!0,e._checkAndTransit()}).catch(function(){e.logger.error("Stopping session due to setRemoteDescription failure"),t._stopSession(),t._sessionReport.setRemoteDescriptionFailure=!0,e.transit(new l.FailedState(t,u.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"setRemoteDescriptionForIceRestart",value:function(e,t){t._pc.setConfiguration?(e.logger.info("Modern Horizon client detected, proceeding with ICE restart"),t._pc.setRemoteDescription(e._createSessionDescription({type:"answer",sdp:e._sdp})).then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){e._remoteDescriptionSetForIceRestart=!0,e._checkAndTransit()}).catch(function(n){e.logger.error("ICE restart failed",{error:n,peerConnectionState:t._pc.connectionState,iceConnectionState:t._pc.iceConnectionState,signalingState:t._pc.signalingState}),e.onIceRestartFailure()})):(e.logger.error("Legacy Horizon client detected, skipping ICE restart"),e.onIceRestartFailure())}},{key:"_ontrack",value:function(e,t){if(0!==t.streams.length){t.streams.length>1&&e._logger.warn("Found more than 1 streams for "+t.track.kind+" track "+t.track.id+" : "+t.streams.map(function(e){return e.id}).join(","));var n=t.streams[0],r=n.getAudioTracks()[0];if(console.log("Audio Track:",r),console.log("Checking value of stream: ",JSON.stringify(n,null,2)),"audio"===n.track[0].kind&&e._remoteAudioElement)try{var i=document.createElement("audio");i.id="remoteAudioElement0",window.HorizonWebRtcRedirectionAPI.onAudioCreated(i,this.globalWindowReference),i.srcObject=n,e._remoteAudioElement=i,e._remoteAudioStream=n}catch(e){return void console.error("Failed to set srcObject on _remoteAudioElement:",e)}e._remoteAudioElement.autoplay=!0,e._remoteAudioElement.playsInline=!0}else e._logger.warn("No streams found in the event")}},{key:"getStrategyName",value:function(){return"OmnissaVDIStrategy"}},{key:"getCurrentTimeString",value:function(){var e=new Date;return" "+e.getHours()+e.getMinutes()+e.getSeconds()+" "}},{key:"setTopWindowName",value:function(e){return top.document.title=e,this.topWindowName=e,this.topWindowName}},{key:"setupMessageListener",value:function(){window.addEventListener("message",this.handleMessage.bind(this)),this.hasRequestedTitle||(this.hasRequestedTitle=!0,window.parent.postMessage({type:"get_horizon_window_title"},"*"))}},{key:"handleMessage",value:function(e){"horizon_window_title_response"===e.data.type&&(this.topWindowName=e.data.title)}}]),d}(d.default);n.default=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../rtc_const":153,"../rtc_session":156,"./CCPInitiationStrategyInterface":161,"@euc-releases/horizon-webrtc-redir-sdk/HorizonSDKforWebRTCRedir":3,"@euc-releases/horizon-webrtc-redir-sdk/HorizonWebRTCExtension":4,"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21,"babel-runtime/regenerator":27}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=u(e("babel-runtime/helpers/classCallCheck")),i=u(e("babel-runtime/helpers/createClass")),o=u(e("babel-runtime/helpers/possibleConstructorReturn")),a=u(e("babel-runtime/helpers/inherits")),s=u(e("./CCPInitiationStrategyInterface")),c=e("../rtc_const"),d=e("../utils"),l=e("../rtc_session");function u(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return console.log("StandardStrategy initialized"),e}return(0,a.default)(t,e),(0,i.default)(t,[{key:"_isEarlyMediaConnectionSupported",value:function(){return(0,d.isChromeBrowser)()&&(0,d.getChromeBrowserVersion)()>=c.CHROME_SUPPORTED_VERSION}},{key:"_createRtcPeerConnection",value:function(e,t){return new RTCPeerConnection(e,t)}},{key:"_gUM",value:function(e){return navigator.mediaDevices.getUserMedia(e)}},{key:"_createMediaStream",value:function(e){return new MediaStream([e])}},{key:"addStream",value:function(e,t){e.addStream(t)}},{key:"setRemoteDescription",value:function(e,t){var n=t._pc.setRemoteDescription(e._createSessionDescription({type:"answer",sdp:e._sdp}));n.catch(function(t){e.logger.error("SetRemoteDescription failed",t)}),n.then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){t._sessionReport.setRemoteDescriptionFailure=!1,e._remoteDescriptionSet=!0,e._checkAndTransit()}).catch(function(){t._stopSession(),t._sessionReport.setRemoteDescriptionFailure=!0,e.transit(new l.FailedState(t,c.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE))})}},{key:"setRemoteDescriptionForIceRestart",value:function(e,t){var n=t._pc.setRemoteDescription(e._createSessionDescription({type:"answer",sdp:e._sdp}));n.catch(function(t){e.logger.error("SetRemoteDescription failed",t)}),n.then(function(){var n=Promise.all(e._candidates.map(function(n){var r=e._createRemoteCandidate(n);return e.logger.info("Adding remote candidate",r),t._pc.addIceCandidate(r)}));return n.catch(function(t){e.logger.warn("Error adding remote candidate",t)}),n}).then(function(){e._remoteDescriptionSetForIceRestart=!0,e._checkAndTransit()}).catch(function(){e.onIceRestartFailure()})}},{key:"onIceStateChange",value:function(e,t){return e.currentTarget.iceConnectionState}},{key:"onPeerConnectionStateChange",value:function(e){return e.connectionState}},{key:"_createPeerConnection",value:function(e,t){return new RTCPeerConnection(e,t)}},{key:"_ontrack",value:function(e,t){t.streams.length>1&&e._logger.warn("Found more than 1 streams for "+t.track.kind+" track "+t.track.id+" : "+t.streams.map(function(e){return e.id}).join(",")),"video"===t.track.kind&&e._remoteVideoElement?(e._remoteVideoElement.srcObject=t.streams[0],e._remoteVideoStream=t.streams[0]):"audio"===t.track.kind&&e._remoteAudioElement&&(e._remoteAudioElement.srcObject=t.streams[0],e._remoteAudioStream=t.streams[0],e._pcm&&(e._pcm._remoteAudioStream=e._remoteAudioStream))}},{key:"_buildMediaConstraints",value:function(e,t){if(e._enableAudio){var n={};void 0!==e._echoCancellation&&(n.echoCancellation=!!e._echoCancellation),Object.keys(n).length>0?t.audio=n:t.audio=!0}else t.audio=!1}},{key:"getStrategyName",value:function(){return"StandardStrategy"}}]),t}(s.default);n.default=f},{"../rtc_const":153,"../rtc_session":156,"../utils":167,"./CCPInitiationStrategyInterface":161,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/helpers/inherits":20,"babel-runtime/helpers/possibleConstructorReturn":21}],166:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserAgentData=void 0;var r=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}n.UserAgentData=function(){function e(){(0,r.default)(this,e),this._platform=null,this._platformVersion=null,this._architecture=null,this._bitness=null,this._browserBrand=null,this._browserVersion=null,this._mobile=!1,this._model=null}return(0,i.default)(e,[{key:"platform",get:function(){return this._platform},set:function(e){this._platform=e}},{key:"platformVersion",get:function(){return this._platformVersion},set:function(e){this._platformVersion=e}},{key:"architecture",get:function(){return this._architecture},set:function(e){this._architecture=e}},{key:"bitness",get:function(){return this._bitness},set:function(e){this._bitness=e}},{key:"browserBrand",get:function(){return this._browserBrand},set:function(e){this._browserBrand=e}},{key:"browserVersion",get:function(){return this._browserVersion},set:function(e){this._browserVersion=e}},{key:"mobile",get:function(){return this._mobile},set:function(e){this._mobile=e}},{key:"model",get:function(){return this._model},set:function(e){this._model=e}}]),e}()},{"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}],167:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getUserAgentData=n.SdpOptions=void 0;var r,i=h(e("babel-runtime/regenerator")),o=h(e("babel-runtime/helpers/asyncToGenerator")),a=h(e("babel-runtime/helpers/classCallCheck")),s=h(e("babel-runtime/helpers/createClass"));n.getUserAgentData=(r=(0,o.default)(i.default.mark(function e(){var t,n,r,o,a,s,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new l.UserAgentData,!navigator.userAgentData){e.next=15;break}return e.next=4,navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","bitness","mobile","model","fullVersionList"]);case 4:n=e.sent,t.platform=n.platform,t.platformVersion=n.platformVersion,t.architecture=n.architecture,t.bitness=n.bitness,t.mobile=n.mobile,t.model=n.model,(r=n.fullVersionList.find(function(e){return u.BROWSER_LIST.includes(e.brand)}))?(t.browserBrand=r.brand,t.browserVersion=r.version):(o=n.fullVersionList.find(function(e){return"Not A Brand"!==e.brand}),t.browserBrand=o?o.brand:"Unknown",t.browserVersion=o?o.version:"Unknown"),e.next=23;break;case 15:a=navigator.userAgent,s=new f.default(a),c=s.getResult(),t.browserBrand=c.browser.name||"Unknown",t.browserVersion=c.browser.version||"Unknown",t.platform=c.os.name||"Unknown",t.platformVersion=c.os.version||"Unknown",t.architecture=c.cpu.architecture||"Unknown";case 23:return e.abrupt("return",t);case 24:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)});n.hitch=_,n.wrapLogger=function(e,t,n){var r={};return p.forEach(function(i){if(!e[i])throw new Error("Logging method "+i+" required");r[i]=_(e,e[i],t,n)}),r},n.closeStream=function(e){if(e)for(var t=e.getTracks(),n=0;n<t.length;n++){var r=t[n];try{r.stop()}catch(e){}}},n.transformSdp=function(e,t){for(var n=(0,d.splitSections)(e),r=1;r<n.length;r++){var i=(0,d.getKind)(n[r]),o=(0,d.parseRtpParameters)(n[r]),a=o.codecs.reduce(function(e,t){return e[""+t.payloadType]=t,e},{});n[r]=(0,d.splitLines)(n[r]).map(function(e){if(e.startsWith("m=")){if(t.forceCodec[i]){var n=Object.keys(a).filter(function(e){return!t._shouldDeleteCodec(i,a[e].name)});return/.*RTP\/S?AVPF? /.exec(e)+n.join(" ")}return e}if(e.startsWith("a=rtpmap:")){var r=(0,d.parseRtpMap)(e),o=a[r.payloadType];return g(o)&&t._shouldDeleteCodec(i,o.name)?null:g(o)&&"OPUS"===o.name.toUpperCase()?(o.parameters.usedtx=t.enableOpusDtx?"1":"0",(e+"\r\n"+(0,d.writeFmtp)(o)).trim()):e}if(e.startsWith("a=fmtp:")){var s=e.substring("a=fmtp:".length,e.indexOf(" ")),o=a[s];return g(o)&&t._shouldDeleteCodec(i,o.name)?null:g(o)&&"OPUS"===o.name.toUpperCase()?null:e}if(e.startsWith("a=rtcp-fb:")){var s=e.substring(e.indexOf(":")+1,e.indexOf(" "));if("*"===s)return e;var o=a[s];return g(o)&&t._shouldDeleteCodec(i,o.name)?null:e}return e}).filter(function(e){return null!==e}).join("\r\n")}return{sdp:n.map(function(e){return e.trim()}).join("\r\n")+"\r\n",mLines:n.length-1}},n.is_defined=g,n.when_defined=function(e,t){var n=g(t)?t:null;return g(e)?e:n},n.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},n.assertTrue=function(e,t){if(!e)throw new Error(t)},n.isChromeBrowser=function(){return-1!==navigator.userAgent.indexOf("Chrome")},n.getChromeBrowserVersion=function(){var e=navigator.userAgent,t=e.substring(e.indexOf("Chrome")+7);return t?parseFloat(t):-1},n.getRedactedSdp=function(e){return e.replace(/a=ice-pwd:[^\r\n]*/,"a=ice-pwd:[redacted]")},n.isFirefoxBrowser=function(e){return e?e.browserBrand.toUpperCase()===u.FIREFOX.toUpperCase():-1!==navigator.userAgent.indexOf(u.FIREFOX)};var c=e("./exceptions"),d=e("sdp"),l=e("./user_agent_data"),u=e("./rtc_const"),f=h(e("ua-parser-js"));function h(e){return e&&e.__esModule?e:{default:e}}var p=["log","info","warn","error"];function _(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();if(!t)throw new c.IllegalParameters("utils.hitch(): scope is required!");if(!n)throw new c.IllegalParameters("utils.hitch(): method is required!");if("function"!=typeof n)throw new c.IllegalParameters("utils.hitch(): method is not a function!");return function(){var r=Array.prototype.slice.call(arguments);return n.apply(t,e.concat(r))}}n.SdpOptions=function(){function e(){(0,a.default)(this,e),this._forceCodec={}}return(0,s.default)(e,[{key:"_shouldDeleteCodec",value:function(e,t){var n=t.toUpperCase();return this._forceCodec[e]&&n!==this._forceCodec[e].toUpperCase()&&"TELEPHONE-EVENT"!==n}},{key:"enableOpusDtx",get:function(){return this._enableOpusDtx},set:function(e){this._enableOpusDtx=e}},{key:"forceCodec",get:function(){return this._forceCodec}}]),e}();function g(e){return void 0!==e}},{"./exceptions":152,"./rtc_const":153,"./user_agent_data":166,"babel-runtime/helpers/asyncToGenerator":16,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18,"babel-runtime/regenerator":27,sdp:133,"ua-parser-js":134}],168:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),o=e("./utils"),a=e("./rtc_const");function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,n,i){(0,r.default)(this,e),this._logger=t,this._connectionId=n,this._wssManager=i,this._initializeWebSocketEventListeners()}return(0,i.default)(e,[{key:"_initializeWebSocketEventListeners",value:function(){var e=this;this._wssManager.subscribeTopics([a.SOFTPHONE_ROUTE_KEY]),this._unSubscribe=this._wssManager.onMessage(a.SOFTPHONE_ROUTE_KEY,(0,o.hitch)(this,this._webSocketManagerOnMessage)),setTimeout(function(){e._onOpen()},0)}},{key:"_webSocketManagerOnMessage",value:function(e){var t=void 0;e.content&&(t=JSON.parse(e.content)),this._onMessage&&t&&this._connectionId===t.connectionId&&this._onMessage({data:JSON.stringify(t.jsonRpcMsg)})}},{key:"send",value:function(e){var t={};try{t.topic=a.SOFTPHONE_ROUTE_KEY,t.connectionId=this._connectionId,t.jsonRpcMsg=JSON.parse(e),this._wssManager.sendMessage(t)}catch(e){this._logger.error("Error in sendMessage ",e)}}},{key:"close",value:function(){this._logger.info("closing virtual connection"),this._unSubscribe()}},{key:"onmessage",set:function(e){this._onMessage=e}},{key:"onopen",set:function(e){this._onOpen=e}}]),e}();n.default=c},{"./rtc_const":153,"./utils":167,"babel-runtime/helpers/classCallCheck":17,"babel-runtime/helpers/createClass":18}]},{},[1,151]);