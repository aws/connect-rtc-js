!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?git :e||self).dcvwebrtc={})}(this,(function(e){"use strict";var t={major:0,minor:3,patch:3,buildNumber:0,gitHash:"2a04538bd16eaa144c6a87ab71a77e2e314f348f",versionStr:"0.3.3+build.0"},n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i={exports:{}};!function(e){var t,r;t=n,r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},s=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(){for(var n=this.getLevel(),i=0;i<r.length;i++){var s=r[i];this[s]=i<n?e:this.methodFactory(s,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(d.call(this),this[e].apply(this,arguments))}}function l(r,i,s){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?o:void 0!==console[r]?a(console,r):void 0!==console.log?a(console,"log"):e)}(r)||c.apply(this,arguments)}function h(e,n){var a,o,c,h=this,u="loglevel";function _(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(u),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch(e){}return void 0===h.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"==typeof t&&void 0!==h.levels[t.toUpperCase()]&&(t=h.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=h.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),h.name=e,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=n||l,h.getLevel=function(){return null!=c?c:null!=o?o:a},h.setLevel=function(e,n){return c=f(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(c),d.call(h)},h.setDefaultLevel=function(e){o=f(e),_()||h.setLevel(e,!1)},h.resetLevel=function(){c=null,function(){if(typeof window!==t&&u){try{window.localStorage.removeItem(u)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),d.call(h)},h.enableAll=function(e){h.setLevel(h.levels.TRACE,e)},h.disableAll=function(e){h.setLevel(h.levels.SILENT,e)},h.rebuild=function(){if(s!==h&&(a=f(s.getLevel())),d.call(h),s===h)for(var e in i)i[e].rebuild()},a=f(s?s.getLevel():"WARN");var E=_();null!=E&&(c=f(E)),d.call(h)}(s=new h).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new h(e,s.methodFactory)),t};var u=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=u),s},s.getLoggers=function(){return i},s.default=s,s},e.exports?e.exports=r():t.log=r()}(i);var s=r(i.exports);const a=Object.freeze({HELLO_API_NAME:"hello",GETUSERMEDIA_API_NAME:"navigator.mediaDevices.getUserMedia",ENUMERATEDEVICES_API_NAME:"navigator.mediaDevices.enumerateDevices",GENERATE_CERTIFICATE_API_NAME:"RTCPeerConnection.generateCertificate",NEWRTCPEERCONNECTION_API_NAME:"new.RTCPeerConnection",PC_GET_CONFIGURATION:"pcs.getConfiguration",NEW_AUDIO_CONTEXT:"new.AudioContext",CREATE_WORKER:"new.Worker",WORKER_POST_MESSAGE:"workers.postMessage",WORKER_TERMINATE:"workers.terminate",AUDIO_CTX_CREATE_AUDIO_NODE:"audioContexts.createAudioNode",AUDIO_CTX_CLOSE:"audioContexts.close",AUDIO_NODE_CONNECT:"audioNodes.connect",AUDIO_NODE_DISCONNECT:"audioNodes.disconnect",AUDIO_PARAM_SET_VALUE_AT_TIME:"audioParams.setValueAtTime",AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME:"audioParams.linearRampToValueAtTime",AUDIO_NODE_SET_TYPE:"audioNodes.setType",AUDIO_NODE_START:"audioNodes.start",AUDIO_NODE_STOP:"audioNodes.stop",PC_CLOSE_API_NAME:"pcs.close",ADDSTREAM_API_NAME:"pcs.addStream",STREAM_REMOVE_TRACK:"streams.removeTrack",STREAM_ADD_TRACK:"streams.addTrack",GET_STATS_API_NAME:"pcs.getStats",CREATE_OFFER_API_NAME:"pcs.createOffer",SET_LOCAL_DESCRIPTION_API_NAME:"pcs.setLocalDescription",ADD_PC_EVENT_LISTENER:"pcs.addEventListener",ADD_TRACK_EVENT_LISTENER:"tracks.addEventListener",ADD_DTMF_EVENT_LISTENER:"dtmfs.addEventListener",ADD_WORKER_EVENT_LISTENER:"workers.addEventListener",SET_REMOTE_DESCRIPTION_API_NAME:"pcs.setRemoteDescription",ADD_ICE_CANDIDATE_API_NAME:"pcs.addIceCandidate",CREATE_MEDIA_ELEMENT_API_NAME:"document.createElement",MEDIA_ELEMENT_SET_SINK_ID_API_NAME:"mediaElements.setSinkId",MEDIA_ELEMENT_REMOVE:"mediaElements.remove",CREATE_ANSWER_API_NAME:"pcs.createAnswer",UNLOAD_EVENT_NAME:"unload",TOGGLE_TRACK_ENABLED_API_NAME:"tracks.enabled",TRACK_STOP_API_NAME:"tracks.stop",TRACK_GET_SETTINGS:"tracks.getSettings",GET_RECEIVERS_API_NAME:"pcs.getReceivers",ADD_TRACK_API_NAME:"pcs.addTrack",GET_SENDERS_API_NAME:"pcs.getSenders",GET_SENDER_STATS_API_NAME:"senders.getStats",GET_RECEIVER_STATS_API_NAME:"receivers.getStats",SET_MEDIA_SRC_OBJ_API_NAME:"mediaElements.srcObject",SET_MEDIA_HIDDEN_API_NAME:"mediaElements.hidden",SET_MEDIA_VOLUME_API_NAME:"mediaElements.volume",MEDIA_ELEMENT_PLAY_API_NAME:"mediaElements.play",MEDIA_ELEMENT_PAUSE_API_NAME:"mediaElements.pause",MEDIA_ELEMENT_MUTED:"mediaElements.muted",ADD_TRANSCEIVER_API_NAME:"pcs.addTransceiver",GET_TRANSCEIVERS_API_NAME:"pcs.getTransceivers",TRANSCEIVER_SET_CODEC_PREFS:"transceivers.setCodecPreferences",REPLACE_SENDER_TRACK_API_NAME:"senders.replaceTrack",PC_REMOVE_TRACK_API_NAME:"pcs.removeTrack",INSERT_DTMF_API_NAME:"dtmfSenders.insertDTMF",SENDER_CREATE_ENCODED_STREAMS:"senders.createEncodedStreams",RECEIVER_CREATE_ENCODED_STREAMS:"receivers.createEncodedStreams"}),o=Object.freeze({SIG_STATE_CHANGE:"signalingstatechange",TRACK:"track",CONN_STATE_CHANGE:"connectionstatechange",ICE_CONN_STATE_CHANGE:"iceconnectionstatechange",ICE_GATHER_STATE_CHANGE:"icegatheringstatechange",ICE_CANDIDATE:"icecandidate",NEGOTIATION_NEEDED:"negotiationneeded"}),d=Object.freeze({ENDED:"ended",MUTE:"mute",UNMUTE:"unmute"}),c=Object.freeze({TONECHANGE:"tonechange"}),l=Object.freeze({ERROR:"error",MESSAGE:"message",MESSAGE_ERROR:"messageerror"}),h=Object.freeze({NEW:"new",AVAILABLE:"available",UNAVAILABLE:"unavailable"}),u=Object.freeze({CHROME:"diilpfplcnhehakckkpmcmibmhbingnd",EDGE:"kjbbkjjiecchbcdoollhgffghfjnbhef"});for(var _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="undefined"==typeof Uint8Array?[]:new Uint8Array(256),E=0;E<64;E++)f[_.charCodeAt(E)]=E;var p=function(e){var t,n=new Uint8Array(e),r=n.length,i="";for(t=0;t<r;t+=3)i+=_[n[t]>>2],i+=_[(3&n[t])<<4|n[t+1]>>4],i+=_[(15&n[t+1])<<2|n[t+2]>>6],i+=_[63&n[t+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i},g=function(e){var t,n,r,i,s,a=.75*e.length,o=e.length,d=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),l=new Uint8Array(c);for(t=0;t<o;t+=4)n=f[e.charCodeAt(t)],r=f[e.charCodeAt(t+1)],i=f[e.charCodeAt(t+2)],s=f[e.charCodeAt(t+3)],l[d++]=n<<2|r>>4,l[d++]=(15&r)<<4|i>>2,l[d++]=(3&i)<<6|63&s;return c},m={exports:{}};
    /*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
    !function(e,t){!function(e){function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const n=256,r=286,i=30,s=15,a=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=new Array(576);t(l);const h=new Array(60);t(h);const u=new Array(512);t(u);const _=new Array(256);t(_);const f=new Array(29);t(f);const E=new Array(i);function p(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let g,m,A;function v(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(E);const w=e=>e<256?u[e]:u[256+(e>>>7)],T=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},y=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,T(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},b=(e,t,n)=>{y(e,n[2*t],n[2*t+1])},R=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},k=(e,t,n)=>{const r=new Array(16);let i,a,o=0;for(i=1;i<=s;i++)o=o+n[i-1]<<1,r[i]=o;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=R(r[t]++,t))}},I=e=>{let t;for(t=0;t<r;t++)e.dyn_ltree[2*t]=0;for(t=0;t<i;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},N=e=>{e.bi_valid>8?T(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},S=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},C=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&S(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!S(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},P=(e,t,r)=>{let i,s,d,c,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,s=e.pending_buf[e.sym_buf+l++],0===i?b(e,s,t):(d=_[s],b(e,d+n+1,t),c=a[d],0!==c&&(s-=f[d],y(e,s,c)),i--,d=w(i),b(e,d,r),c=o[d],0!==c&&(i-=E[d],y(e,i,c)))}while(l<e.sym_next);b(e,256,t)},D=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let o,d,c,l=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<a;o++)0!==n[2*o]?(e.heap[++e.heap_len]=l=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=l,o=e.heap_len>>1;o>=1;o--)C(e,n,o);c=a;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=d,n[2*c]=n[2*o]+n[2*d],e.depth[c]=(e.depth[o]>=e.depth[d]?e.depth[o]:e.depth[d])+1,n[2*o+1]=n[2*d+1]=c,e.heap[1]=c++,C(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,h,u,_,f,E,p=0;for(_=0;_<=s;_++)e.bl_count[_]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)h=e.heap[l],_=n[2*n[2*h+1]+1]+1,_>c&&(_=c,p++),n[2*h+1]=_,h>r||(e.bl_count[_]++,f=0,h>=d&&(f=o[h-d]),E=n[2*h],e.opt_len+=E*(_+f),a&&(e.static_len+=E*(i[2*h+1]+f)));if(0!==p){do{for(_=c-1;0===e.bl_count[_];)_--;e.bl_count[_]--,e.bl_count[_+1]+=2,e.bl_count[c]--,p-=2}while(p>0);for(_=c;0!==_;_--)for(h=e.bl_count[_];0!==h;)u=e.heap[--l],u>r||(n[2*u+1]!==_&&(e.opt_len+=(_-n[2*u+1])*n[2*u],n[2*u+1]=_),h--)}})(e,t),k(n,l,e.bl_count)},x=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,d=7,c=4;for(0===a&&(d=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++o<d&&i===a||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=i,0===a?(d=138,c=3):i===a?(d=6,c=3):(d=7,c=4))},O=(e,t,n)=>{let r,i,s=-1,a=t[1],o=0,d=7,c=4;for(0===a&&(d=138,c=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++o<d&&i===a)){if(o<c)do{b(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==s&&(b(e,i,e.bl_tree),o--),b(e,16,e.bl_tree),y(e,o-3,2)):o<=10?(b(e,17,e.bl_tree),y(e,o-3,3)):(b(e,18,e.bl_tree),y(e,o-11,7));o=0,s=i,0===a?(d=138,c=3):i===a?(d=6,c=3):(d=7,c=4)}};let M=!1;const L=(e,t,n,r)=>{y(e,0+(r?1:0),3),N(e),T(e,n),T(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var U=(e,t,r,i)=>{let s,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<n;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),D(e,e.l_desc),D(e,e.d_desc),o=(e=>{let t;for(x(e,e.dyn_ltree,e.l_desc.max_code),x(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=s&&(s=a)):s=a=r+5,r+4<=s&&-1!==t?L(e,t,r,i):4===e.strategy||a===s?(y(e,2+(i?1:0),3),P(e,l,h)):(y(e,4+(i?1:0),3),((e,t,n,r)=>{let i;for(y(e,t-257,5),y(e,n-1,5),y(e,r-4,4),i=0;i<r;i++)y(e,e.bl_tree[2*c[i]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),P(e,e.dyn_ltree,e.dyn_dtree)),I(e),i&&N(e)},z={_tr_init:e=>{M||((()=>{let e,t,n,c,v;const w=new Array(16);for(n=0,c=0;c<28;c++)for(f[c]=n,e=0;e<1<<a[c];e++)_[n++]=c;for(_[n-1]=c,v=0,c=0;c<16;c++)for(E[c]=v,e=0;e<1<<o[c];e++)u[v++]=c;for(v>>=7;c<i;c++)for(E[c]=v<<7,e=0;e<1<<o[c]-7;e++)u[256+v++]=c;for(t=0;t<=s;t++)w[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,w[8]++;for(;e<=255;)l[2*e+1]=9,e++,w[9]++;for(;e<=279;)l[2*e+1]=7,e++,w[7]++;for(;e<=287;)l[2*e+1]=8,e++,w[8]++;for(k(l,287,w),e=0;e<i;e++)h[2*e+1]=5,h[2*e]=R(e,5);g=new p(l,a,257,r,s),m=new p(h,o,0,i,s),A=new p(new Array(0),d,0,19,7)})(),M=!0),e.l_desc=new v(e.dyn_ltree,g),e.d_desc=new v(e.dyn_dtree,m),e.bl_desc=new v(e.bl_tree,A),e.bi_buf=0,e.bi_valid=0,I(e)},_tr_stored_block:L,_tr_flush_block:U,_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_[r]+n+1)]++,e.dyn_dtree[2*w(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{y(e,2,3),b(e,256,l),(e=>{16===e.bi_valid?(T(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},G=(e,t,n,r)=>{let i=65535&e,s=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,s=s+i|0}while(--a);i%=65521,s%=65521}return i|s<<16};const V=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var q=(e,t,n,r)=>{const i=V,s=r+n;e^=-1;for(let n=r;n<s;n++)e=e>>>8^i[255&(e^t[n])];return~e},F={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:j,_tr_stored_block:B,_tr_flush_block:Z,_tr_tally:W,_tr_align:K}=z,{Z_NO_FLUSH:$,Z_PARTIAL_FLUSH:J,Z_FULL_FLUSH:Y,Z_FINISH:X,Z_BLOCK:Q,Z_OK:ee,Z_STREAM_END:te,Z_STREAM_ERROR:ne,Z_DATA_ERROR:re,Z_BUF_ERROR:ie,Z_DEFAULT_COMPRESSION:se,Z_FILTERED:ae,Z_HUFFMAN_ONLY:oe,Z_RLE:de,Z_FIXED:ce,Z_DEFAULT_STRATEGY:le,Z_UNKNOWN:he,Z_DEFLATED:ue}=H,_e=258,fe=262,Ee=42,pe=113,ge=666,me=(e,t)=>(e.msg=F[t],t),Ae=e=>2*e-(e>4?9:0),ve=e=>{let t=e.length;for(;--t>=0;)e[t]=0},we=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let Te=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ye=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},be=(e,t)=>{Z(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ye(e.strm)},Re=(e,t)=>{e.pending_buf[e.pending++]=t},ke=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ie=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=G(e.adler,t,i,n):2===e.state.wrap&&(e.adler=q(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Ne=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match;const d=e.strstart>e.w_size-fe?e.strstart-(e.w_size-fe):0,c=e.window,l=e.w_mask,h=e.prev,u=e.strstart+_e;let _=c[s+a-1],f=c[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+a]===f&&c[n+a-1]===_&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<u);if(r=_e-(u-s),s=u-_e,r>a){if(e.match_start=t,a=r,r>=o)break;_=c[s+a-1],f=c[s+a]}}}while((t=h[t&l])>d&&0!=--i);return a<=e.lookahead?a:e.lookahead},Se=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-fe)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),we(e),r+=t),0===e.strm.avail_in)break;if(n=Ie(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Te(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Te(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<fe&&0!==e.strm.avail_in)},Ce=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&t!==X||t===$||n!==r+e.strm.avail_in))break;a=t===X&&n===r+e.strm.avail_in?1:0,B(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ye(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ie(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==$&&t!==X&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Ie(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===X)&&t!==$&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===X&&0===e.strm.avail_in&&n===r?1:0,B(e,e.block_start,n,a),e.block_start+=n,ye(e.strm)),a?3:1)},Pe=(e,t)=>{let n,r;for(;;){if(e.lookahead<fe){if(Se(e),e.lookahead<fe&&t===$)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-fe&&(e.match_length=Ne(e,n)),e.match_length>=3)if(r=W(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Te(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Te(e,e.ins_h,e.window[e.strstart+1]);else r=W(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2},De=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<fe){if(Se(e),e.lookahead<fe&&t===$)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-fe&&(e.match_length=Ne(e,n),e.match_length<=5&&(e.strategy===ae||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=W(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Te(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(be(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=W(e,0,e.window[e.strstart-1]),r&&be(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=W(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2};function xe(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const Oe=[new xe(0,0,0,0,Ce),new xe(4,4,8,4,Pe),new xe(4,5,16,8,Pe),new xe(4,6,32,32,Pe),new xe(4,4,16,16,De),new xe(8,16,32,32,De),new xe(8,16,128,128,De),new xe(8,32,128,256,De),new xe(32,128,258,1024,De),new xe(32,258,258,4096,De)];function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ue,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ve(this.dyn_ltree),ve(this.dyn_dtree),ve(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ve(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ve(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Le=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ee&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==pe&&t.status!==ge?1:0},Ue=e=>{if(Le(e))return me(e,ne);e.total_in=e.total_out=0,e.data_type=he;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Ee:pe,e.adler=2===t.wrap?0:1,t.last_flush=-2,j(t),ee},ze=e=>{const t=Ue(e);var n;return t===ee&&((n=e.state).window_size=2*n.w_size,ve(n.head),n.max_lazy_match=Oe[n.level].max_lazy,n.good_match=Oe[n.level].good_length,n.nice_match=Oe[n.level].nice_length,n.max_chain_length=Oe[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Ge=(e,t,n,r,i,s)=>{if(!e)return ne;let a=1;if(t===se&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==ue||r<8||r>15||t<0||t>9||s<0||s>ce||8===r&&1!==a)return me(e,ne);8===r&&(r=9);const o=new Me;return e.state=o,o.strm=e,o.status=Ee,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=n,ze(e)};var Ve={deflateInit:(e,t)=>Ge(e,t,ue,15,8,le),deflateInit2:Ge,deflateReset:ze,deflateResetKeep:Ue,deflateSetHeader:(e,t)=>Le(e)||2!==e.state.wrap?ne:(e.state.gzhead=t,ee),deflate:(e,t)=>{if(Le(e)||t>Q||t<0)return e?me(e,ne):ne;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===ge&&t!==X)return me(e,0===e.avail_out?ie:ne);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ye(e),0===e.avail_out)return n.last_flush=-1,ee}else if(0===e.avail_in&&Ae(t)<=Ae(r)&&t!==X)return me(e,ie);if(n.status===ge&&0!==e.avail_in)return me(e,ie);if(n.status===Ee&&0===n.wrap&&(n.status=pe),n.status===Ee){let t=ue+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=oe||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,ke(n,t),0!==n.strstart&&(ke(n,e.adler>>>16),ke(n,65535&e.adler)),e.adler=1,n.status=pe,ye(e),0!==n.pending)return n.last_flush=-1,ee}if(57===n.status)if(e.adler=0,Re(n,31),Re(n,139),Re(n,8),n.gzhead)Re(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Re(n,255&n.gzhead.time),Re(n,n.gzhead.time>>8&255),Re(n,n.gzhead.time>>16&255),Re(n,n.gzhead.time>>24&255),Re(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),Re(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Re(n,255&n.gzhead.extra.length),Re(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=q(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Re(n,0),Re(n,0),Re(n,0),Re(n,0),Re(n,0),Re(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),Re(n,3),n.status=pe,ye(e),0!==n.pending)return n.last_flush=-1,ee;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=q(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,ye(e),0!==n.pending)return n.last_flush=-1,ee;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=q(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=q(e.adler,n.pending_buf,n.pending-r,r)),ye(e),0!==n.pending)return n.last_flush=-1,ee;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Re(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=q(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=q(e.adler,n.pending_buf,n.pending-r,r)),ye(e),0!==n.pending)return n.last_flush=-1,ee;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Re(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=q(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ye(e),0!==n.pending))return n.last_flush=-1,ee;Re(n,255&e.adler),Re(n,e.adler>>8&255),e.adler=0}if(n.status=pe,ye(e),0!==n.pending)return n.last_flush=-1,ee}if(0!==e.avail_in||0!==n.lookahead||t!==$&&n.status!==ge){let r=0===n.level?Ce(n,t):n.strategy===oe?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Se(e),0===e.lookahead)){if(t===$)return 1;break}if(e.match_length=0,n=W(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===de?((e,t)=>{let n,r,i,s;const a=e.window;for(;;){if(e.lookahead<=_e){if(Se(e),e.lookahead<=_e&&t===$)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){s=e.strstart+_e;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);e.match_length=_e-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=W(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=W(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(n,t):Oe[n.level].func(n,t);if(3!==r&&4!==r||(n.status=ge),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),ee;if(2===r&&(t===J?K(n):t!==Q&&(B(n,0,0,!1),t===Y&&(ve(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ye(e),0===e.avail_out))return n.last_flush=-1,ee}return t!==X?ee:n.wrap<=0?te:(2===n.wrap?(Re(n,255&e.adler),Re(n,e.adler>>8&255),Re(n,e.adler>>16&255),Re(n,e.adler>>24&255),Re(n,255&e.total_in),Re(n,e.total_in>>8&255),Re(n,e.total_in>>16&255),Re(n,e.total_in>>24&255)):(ke(n,e.adler>>>16),ke(n,65535&e.adler)),ye(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?ee:te)},deflateEnd:e=>{if(Le(e))return ne;const t=e.state.status;return e.state=null,t===pe?me(e,re):ee},deflateSetDictionary:(e,t)=>{let n=t.length;if(Le(e))return ne;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==Ee||r.lookahead)return ne;if(1===i&&(e.adler=G(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(ve(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const s=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Se(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=Te(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Se(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=s,r.wrap=i,ee},deflateInfo:"pako deflate (from Nodeca project)"};const qe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Fe=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)qe(n,t)&&(e[t]=n[t])}}return e},He=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length}return n};let je=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){je=!1}const Be=new Uint8Array(256);for(let e=0;e<256;e++)Be[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Be[254]=Be[254]=1;var Ze=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,s,a=e.length,o=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},We=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){s[i++]=t;continue}let a=Be[t];if(a>4)s[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&je)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(s,i)},Ke=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Be[e[n]]>t?n:t},$e=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Je=Object.prototype.toString,{Z_NO_FLUSH:Ye,Z_SYNC_FLUSH:Xe,Z_FULL_FLUSH:Qe,Z_FINISH:et,Z_OK:tt,Z_STREAM_END:nt,Z_DEFAULT_COMPRESSION:rt,Z_DEFAULT_STRATEGY:it,Z_DEFLATED:st}=H;function at(e){this.options=Fe({level:rt,method:st,chunkSize:16384,windowBits:15,memLevel:8,strategy:it},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let n=Ve.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==tt)throw new Error(F[n]);if(t.header&&Ve.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ze(t.dictionary):"[object ArrayBuffer]"===Je.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Ve.deflateSetDictionary(this.strm,e),n!==tt)throw new Error(F[n]);this._dict_set=!0}}function ot(e,t){const n=new at(t);if(n.push(e,!0),n.err)throw n.msg||F[n.err];return n.result}at.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?et:Ye,"string"==typeof e?n.input=Ze(e):"[object ArrayBuffer]"===Je.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Xe||s===Qe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Ve.deflate(n,s),i===nt)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ve.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===tt;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},at.prototype.onData=function(e){this.chunks.push(e)},at.prototype.onEnd=function(e){e===tt&&(this.result=He(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var dt={Deflate:at,deflate:ot,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ot(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ot(e,t)},constants:H};const ct=16209;var lt=function(e,t){let n,r,i,s,a,o,d,c,l,h,u,_,f,E,p,g,m,A,v,w,T,y,b,R;const k=e.state;n=e.next_in,b=e.input,r=n+(e.avail_in-5),i=e.next_out,R=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),o=k.dmax,d=k.wsize,c=k.whave,l=k.wnext,h=k.window,u=k.hold,_=k.bits,f=k.lencode,E=k.distcode,p=(1<<k.lenbits)-1,g=(1<<k.distbits)-1;e:do{_<15&&(u+=b[n++]<<_,_+=8,u+=b[n++]<<_,_+=8),m=f[u&p];t:for(;;){if(A=m>>>24,u>>>=A,_-=A,A=m>>>16&255,0===A)R[i++]=65535&m;else{if(!(16&A)){if(!(64&A)){m=f[(65535&m)+(u&(1<<A)-1)];continue t}if(32&A){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=ct;break e}v=65535&m,A&=15,A&&(_<A&&(u+=b[n++]<<_,_+=8),v+=u&(1<<A)-1,u>>>=A,_-=A),_<15&&(u+=b[n++]<<_,_+=8,u+=b[n++]<<_,_+=8),m=E[u&g];n:for(;;){if(A=m>>>24,u>>>=A,_-=A,A=m>>>16&255,!(16&A)){if(!(64&A)){m=E[(65535&m)+(u&(1<<A)-1)];continue n}e.msg="invalid distance code",k.mode=ct;break e}if(w=65535&m,A&=15,_<A&&(u+=b[n++]<<_,_+=8,_<A&&(u+=b[n++]<<_,_+=8)),w+=u&(1<<A)-1,w>o){e.msg="invalid distance too far back",k.mode=ct;break e}if(u>>>=A,_-=A,A=i-s,w>A){if(A=w-A,A>c&&k.sane){e.msg="invalid distance too far back",k.mode=ct;break e}if(T=0,y=h,0===l){if(T+=d-A,A<v){v-=A;do{R[i++]=h[T++]}while(--A);T=i-w,y=R}}else if(l<A){if(T+=d+l-A,A-=l,A<v){v-=A;do{R[i++]=h[T++]}while(--A);if(T=0,l<v){A=l,v-=A;do{R[i++]=h[T++]}while(--A);T=i-w,y=R}}}else if(T+=l-A,A<v){v-=A;do{R[i++]=h[T++]}while(--A);T=i-w,y=R}for(;v>2;)R[i++]=y[T++],R[i++]=y[T++],R[i++]=y[T++],v-=3;v&&(R[i++]=y[T++],v>1&&(R[i++]=y[T++]))}else{T=i-w;do{R[i++]=R[T++],R[i++]=R[T++],R[i++]=R[T++],v-=3}while(v>2);v&&(R[i++]=R[T++],v>1&&(R[i++]=R[T++]))}break}}break}}while(n<r&&i<a);v=_>>3,n-=v,_-=v<<3,u&=(1<<_)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),k.hold=u,k.bits=_};const ht=15,ut=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),_t=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ft=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Et=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pt=(e,t,n,r,i,s,a,o)=>{const d=o.bits;let c,l,h,u,_,f,E=0,p=0,g=0,m=0,A=0,v=0,w=0,T=0,y=0,b=0,R=null;const k=new Uint16Array(16),I=new Uint16Array(16);let N,S,C,P=null;for(E=0;E<=ht;E++)k[E]=0;for(p=0;p<r;p++)k[t[n+p]]++;for(A=d,m=ht;m>=1&&0===k[m];m--);if(A>m&&(A=m),0===m)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(g=1;g<m&&0===k[g];g++);for(A<g&&(A=g),T=1,E=1;E<=ht;E++)if(T<<=1,T-=k[E],T<0)return-1;if(T>0&&(0===e||1!==m))return-1;for(I[1]=0,E=1;E<ht;E++)I[E+1]=I[E]+k[E];for(p=0;p<r;p++)0!==t[n+p]&&(a[I[t[n+p]]++]=p);if(0===e?(R=P=a,f=20):1===e?(R=ut,P=_t,f=257):(R=ft,P=Et,f=0),b=0,p=0,E=g,_=s,v=A,w=0,h=-1,y=1<<A,u=y-1,1===e&&y>852||2===e&&y>592)return 1;for(;;){N=E-w,a[p]+1<f?(S=0,C=a[p]):a[p]>=f?(S=P[a[p]-f],C=R[a[p]-f]):(S=96,C=0),c=1<<E-w,l=1<<v,g=l;do{l-=c,i[_+(b>>w)+l]=N<<24|S<<16|C}while(0!==l);for(c=1<<E-1;b&c;)c>>=1;if(0!==c?(b&=c-1,b+=c):b=0,p++,0==--k[E]){if(E===m)break;E=t[n+a[p]]}if(E>A&&(b&u)!==h){for(0===w&&(w=A),_+=g,v=E-w,T=1<<v;v+w<m&&(T-=k[v+w],!(T<=0));)v++,T<<=1;if(y+=1<<v,1===e&&y>852||2===e&&y>592)return 1;h=b&u,i[h]=A<<24|v<<16|_-s}}return 0!==b&&(i[_+b]=E-w<<24|64<<16),o.bits=A,0};const{Z_FINISH:gt,Z_BLOCK:mt,Z_TREES:At,Z_OK:vt,Z_STREAM_END:wt,Z_NEED_DICT:Tt,Z_STREAM_ERROR:yt,Z_DATA_ERROR:bt,Z_MEM_ERROR:Rt,Z_BUF_ERROR:kt,Z_DEFLATED:It}=H,Nt=16180,St=16190,Ct=16191,Pt=16192,Dt=16194,xt=16199,Ot=16200,Mt=16206,Lt=16209,Ut=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function zt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Gt=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Nt||t.mode>16211?1:0},Vt=e=>{if(Gt(e))return yt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Nt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,vt},qt=e=>{if(Gt(e))return yt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Vt(e)},Ft=(e,t)=>{let n;if(Gt(e))return yt;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?yt:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,qt(e))},Ht=(e,t)=>{if(!e)return yt;const n=new zt;e.state=n,n.strm=e,n.window=null,n.mode=Nt;const r=Ft(e,t);return r!==vt&&(e.state=null),r};let jt,Bt,Zt=!0;const Wt=e=>{if(Zt){jt=new Int32Array(512),Bt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pt(1,e.lens,0,288,jt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pt(2,e.lens,0,32,Bt,0,e.work,{bits:5}),Zt=!1}e.lencode=jt,e.lenbits=9,e.distcode=Bt,e.distbits=5},Kt=(e,t,n,r)=>{let i;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var $t={inflateReset:qt,inflateReset2:Ft,inflateResetKeep:Vt,inflateInit:e=>Ht(e,15),inflateInit2:Ht,inflate:(e,t)=>{let n,r,i,s,a,o,d,c,l,h,u,_,f,E,p,g,m,A,v,w,T,y,b=0;const R=new Uint8Array(4);let k,I;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Gt(e)||!e.output||!e.input&&0!==e.avail_in)return yt;n=e.state,n.mode===Ct&&(n.mode=Pt),a=e.next_out,i=e.output,d=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,h=o,u=d,y=vt;e:for(;;)switch(n.mode){case Nt:if(0===n.wrap){n.mode=Pt;break}for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,R[0]=255&c,R[1]=c>>>8&255,n.check=q(n.check,R,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Lt;break}if((15&c)!==It){e.msg="unknown compression method",n.mode=Lt;break}if(c>>>=4,l-=4,T=8+(15&c),0===n.wbits&&(n.wbits=T),T>15||T>n.wbits){e.msg="invalid window size",n.mode=Lt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Ct,c=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(n.flags=c,(255&n.flags)!==It){e.msg="unknown compression method",n.mode=Lt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Lt;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=q(n.check,R,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,R[2]=c>>>16&255,R[3]=c>>>24&255,n.check=q(n.check,R,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=q(n.check,R,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=q(n.check,R,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(_=n.length,_>o&&(_=o),_&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+_),T)),512&n.flags&&4&n.wrap&&(n.check=q(n.check,r,_,s)),o-=_,s+=_,n.length-=_),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;_=0;do{T=r[s+_++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&_<o);if(512&n.flags&&4&n.wrap&&(n.check=q(n.check,r,_,s)),o-=_,s+=_,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;_=0;do{T=r[s+_++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&_<o);if(512&n.flags&&4&n.wrap&&(n.check=q(n.check,r,_,s)),o-=_,s+=_,T)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Lt;break}c=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Ct;break;case 16189:for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}e.adler=n.check=Ut(c),c=0,l=0,n.mode=St;case St:if(0===n.havedict)return e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,Tt;e.adler=n.check=1,n.mode=Ct;case Ct:if(t===mt||t===At)break e;case Pt:if(n.last){c>>>=7&l,l-=7&l,n.mode=Mt;break}for(;l<3;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}switch(n.last=1&c,c>>>=1,l-=1,3&c){case 0:n.mode=16193;break;case 1:if(Wt(n),n.mode=xt,t===At){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Lt}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Lt;break}if(n.length=65535&c,c=0,l=0,n.mode=Dt,t===At)break e;case Dt:n.mode=16195;case 16195:if(_=n.length,_){if(_>o&&(_=o),_>d&&(_=d),0===_)break e;i.set(r.subarray(s,s+_),a),o-=_,s+=_,d-=_,a+=_,n.length-=_;break}n.mode=Ct;break;case 16196:for(;l<14;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Lt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.lens[N[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[N[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},y=pt(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,y){e.msg="invalid code lengths set",n.mode=Lt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[c&(1<<n.lenbits)-1],p=b>>>24,g=b>>>16&255,m=65535&b,!(p<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(m<16)c>>>=p,l-=p,n.lens[n.have++]=m;else{if(16===m){for(I=p+2;l<I;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(c>>>=p,l-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=Lt;break}T=n.lens[n.have-1],_=3+(3&c),c>>>=2,l-=2}else if(17===m){for(I=p+3;l<I;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=p,l-=p,T=0,_=3+(7&c),c>>>=3,l-=3}else{for(I=p+7;l<I;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=p,l-=p,T=0,_=11+(127&c),c>>>=7,l-=7}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Lt;break}for(;_--;)n.lens[n.have++]=T}}if(n.mode===Lt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Lt;break}if(n.lenbits=9,k={bits:n.lenbits},y=pt(1,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,y){e.msg="invalid literal/lengths set",n.mode=Lt;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},y=pt(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,y){e.msg="invalid distances set",n.mode=Lt;break}if(n.mode=xt,t===At)break e;case xt:n.mode=Ot;case Ot:if(o>=6&&d>=258){e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,lt(e,u),a=e.next_out,i=e.output,d=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,n.mode===Ct&&(n.back=-1);break}for(n.back=0;b=n.lencode[c&(1<<n.lenbits)-1],p=b>>>24,g=b>>>16&255,m=65535&b,!(p<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(g&&!(240&g)){for(A=p,v=g,w=m;b=n.lencode[w+((c&(1<<A+v)-1)>>A)],p=b>>>24,g=b>>>16&255,m=65535&b,!(A+p<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=A,l-=A,n.back+=A}if(c>>>=p,l-=p,n.back+=p,n.length=m,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=Ct;break}if(64&g){e.msg="invalid literal/length code",n.mode=Lt;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;l<I;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;b=n.distcode[c&(1<<n.distbits)-1],p=b>>>24,g=b>>>16&255,m=65535&b,!(p<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(!(240&g)){for(A=p,v=g,w=m;b=n.distcode[w+((c&(1<<A+v)-1)>>A)],p=b>>>24,g=b>>>16&255,m=65535&b,!(A+p<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=A,l-=A,n.back+=A}if(c>>>=p,l-=p,n.back+=p,64&g){e.msg="invalid distance code",n.mode=Lt;break}n.offset=m,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;l<I;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Lt;break}n.mode=16204;case 16204:if(0===d)break e;if(_=u-d,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Lt;break}_>n.wnext?(_-=n.wnext,f=n.wsize-_):f=n.wnext-_,_>n.length&&(_=n.length),E=n.window}else E=i,f=a-n.offset,_=n.length;_>d&&(_=d),d-=_,n.length-=_;do{i[a++]=E[f++]}while(--_);0===n.length&&(n.mode=Ot);break;case 16205:if(0===d)break e;i[a++]=n.length,d--,n.mode=Ot;break;case Mt:if(n.wrap){for(;l<32;){if(0===o)break e;o--,c|=r[s++]<<l,l+=8}if(u-=d,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?q(n.check,i,u,a-u):G(n.check,i,u,a-u)),u=d,4&n.wrap&&(n.flags?c:Ut(c))!==n.check){e.msg="incorrect data check",n.mode=Lt;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Lt;break}c=0,l=0}n.mode=16208;case 16208:y=wt;break e;case Lt:y=bt;break e;case 16210:return Rt;default:return yt}return e.next_out=a,e.avail_out=d,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,(n.wsize||u!==e.avail_out&&n.mode<Lt&&(n.mode<Mt||t!==gt))&&Kt(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?q(n.check,i,u,e.next_out-u):G(n.check,i,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Ct?128:0)+(n.mode===xt||n.mode===Dt?256:0),(0===h&&0===u||t===gt)&&y===vt&&(y=kt),y},inflateEnd:e=>{if(Gt(e))return yt;let t=e.state;return t.window&&(t.window=null),e.state=null,vt},inflateGetHeader:(e,t)=>{if(Gt(e))return yt;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,vt):yt},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Gt(e)?yt:(r=e.state,0!==r.wrap&&r.mode!==St?yt:r.mode===St&&(i=1,i=G(i,t,n,0),i!==r.check)?bt:(s=Kt(e,t,n,n),s?(r.mode=16210,Rt):(r.havedict=1,vt)))},inflateInfo:"pako inflate (from Nodeca project)"},Jt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Yt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_FINISH:Qt,Z_OK:en,Z_STREAM_END:tn,Z_NEED_DICT:nn,Z_STREAM_ERROR:rn,Z_DATA_ERROR:sn,Z_MEM_ERROR:an}=H;function on(e){this.options=Fe({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;let n=$t.inflateInit2(this.strm,t.windowBits);if(n!==en)throw new Error(F[n]);if(this.header=new Jt,$t.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ze(t.dictionary):"[object ArrayBuffer]"===Yt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=$t.inflateSetDictionary(this.strm,t.dictionary),n!==en)))throw new Error(F[n])}function dn(e,t){const n=new on(t);if(n.push(e),n.err)throw n.msg||F[n.err];return n.result}on.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Qt:Xt,"[object ArrayBuffer]"===Yt.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=$t.inflate(n,a),s===nn&&i&&(s=$t.inflateSetDictionary(n,i),s===en?s=$t.inflate(n,a):s===sn&&(s=nn));n.avail_in>0&&s===tn&&n.state.wrap>0&&0!==e[n.next_in];)$t.inflateReset(n),s=$t.inflate(n,a);switch(s){case rn:case sn:case nn:case an:return this.onEnd(s),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||s===tn))if("string"===this.options.to){let e=Ke(n.output,n.next_out),t=n.next_out-e,i=We(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==en||0!==o){if(s===tn)return s=$t.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},on.prototype.onData=function(e){this.chunks.push(e)},on.prototype.onEnd=function(e){e===en&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=He(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var cn={Inflate:on,inflate:dn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,dn(e,t)},ungzip:dn,constants:H};const{Deflate:ln,deflate:hn,deflateRaw:un,gzip:_n}=dt,{Inflate:fn,inflate:En,inflateRaw:pn,ungzip:gn}=cn;var mn=ln,An=hn,vn=un,wn=_n,Tn=fn,yn=En,bn=pn,Rn=gn,kn=H,In={Deflate:mn,deflate:An,deflateRaw:vn,gzip:wn,Inflate:Tn,inflate:yn,inflateRaw:bn,ungzip:Rn,constants:kn};e.Deflate=mn,e.Inflate=Tn,e.constants=kn,e.default=In,e.deflate=An,e.deflateRaw=vn,e.gzip=wn,e.inflate=yn,e.inflateRaw=bn,e.ungzip=Rn,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,m.exports);var A=r(m.exports);function v(){return function(){const e=window.navigator.userAgent.toLowerCase();return e.indexOf("edg/")>-1||e.indexOf("edge")>-1}()?u.EDGE:u.CHROME}class w{constructor(e){if(this.version=t,this.config=e,this.logger=e.logger,this.clientInfo=null,this.certParams={name:"ECDSA",namedCurve:"P-256"},this.extensionId=v(),this.pcProxies=new Map,this.audioContextProxies=new Map,this.audioNodeProxies=new Map,this.workerProxies=new Map,this.streamProxies=new Map,this.eventListeners=new Map,this.mediaElementProxies=new Map,this.transceiverProxies=new Map,this.senderProxies=new Map,this.dtmfProxies=new Map,this.receiverProxies=new Map,this.trackProxies=new Map,this.overridenApis=new Map,this.decoder=new TextDecoder("utf-8"),this.logger.debug(`Checking for chrome extension.  Chrome runtime: ${chrome.runtime}`),void 0===chrome.runtime)throw new Error("Chrome runtime not available.  DCV WebRTC chrome extension may not be active.");this.overridenApis.set("navigator.mediaDevices.getUserMedia",navigator.mediaDevices.getUserMedia),this.overridenApis.set("navigator.mediaDevices.enumerateDevices",navigator.mediaDevices.enumerateDevices),this.overridenApis.set("window.RTCPeerConnection",window.RTCPeerConnection),this.overridenApis.set("window.RTCPeerConnection.generateCertificate",window.RTCPeerConnection.generateCertificate),this.overridenApis.set("window.AudioContext",window.AudioContext),this.overridenApis.set("window.Worker",window.Worker),this.status=h.NEW,this.statusChangeEventListeners=[],this.lastHeartbeat=Date.now(),this.heartbeatTimeout=null,this.heartbeatTimeoutMs=1e4,this.heartbeatIntervalPeriodMs=1e3,this.heartbeatInterval=null}clearHeartbeatInterval(){this.heartbeatTimeout&&(clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=null),this.hearbeatInterval&&(clearInterval(this.hearbeatInterval),this.hearbeatInterval=null)}resetHeartbeat(e){var t=this;this.clearHeartbeatInterval(),this.heartbeatTimeoutMs=e&&e.heartbeatTimeoutMs?e.heartbeatTimeoutMs:this.heartbeatTimeoutMs,this.heartbeatIntervalPeriodMs=e&&e.heartbeatIntervalPeriodMs?e.heartbeatIntervalPeriodMs:this.heartbeatIntervalPeriodMs,this.hearbeatInterval=setInterval((async function(){t.heartbeatTimeout||(t.heartbeatTimeout=setTimeout((function(){t.logger.debug(`heartbeatTimeout reached, current status: ${t.status}, last hb: ${Date.now()-t.lastHeartbeat}ms ago.`),t.status!==h.UNAVAILABLE&&(t.status=h.UNAVAILABLE,t.statusChangeEventListeners.forEach((function(e){e({status:t.status,data:t.clientInfo,lastHeartbeat:t.lastHeartbeat})})))}),t.heartbeatTimeoutMs));try{if(t.clientInfo=await t.sendApiRequest(a.HELLO_API_NAME,[]),!t.clientInfo)throw new Error("Failed to get clientInfo.");t.heartbeatTimeout&&(clearTimeout(t.heartbeatTimeout),t.heartbeatTimeout=null),t.status!==h.AVAILABLE&&(t.status=h.AVAILABLE,t.statusChangeEventListeners.forEach((function(e){e({status:t.status,data:t.clientInfo})}))),t.lastHeartbeat=Date.now()}catch(e){t.logger.debug(`Heartbeat ping failed.  Last heartbeat received ${Date.now()-t.lastHeartbeat}ms ago.`)}}),this.heartbeatIntervalPeriodMs)}makeMediaDeviceInfoProxies(e){return e.forEach((function(e){e.toJSON=function(){return e}})),e}makeTrackProxy(e){var t=this;if(this.trackProxies.has(e.id)){let t=this.trackProxies.get(e.id);return Object.assign(t,e),t}return this.trackProxies.set(e.id,e),e.pendingEvents=new Map,e.stop=function(){t.sendApiRequest(a.TRACK_STOP_API_NAME,[e.id])},e.getSettings=function(){return t.sendApiRequest(a.TRACK_GET_SETTINGS,[e.id]).then((function(t){t&&(e.settings=t)})),e.settings},e.addEventListener=function(n,r,i){t.logger.debug("Setting ended event listener via addEventListener."),t.addTrackEventListener(e.id,n,r,i)},e.removeEventListener=function(n,r){t.removeEventListener(e.id,n,r)},Object.defineProperty(e,"onended",{set:function(n){t.addTrackEventListener(e.id,d.ENDED,n)},get:function(){return null}}),Object.defineProperty(e,"onmute",{set:function(n){t.addTrackEventListener(e.id,d.MUTE,n)},get:function(){return null}}),Object.defineProperty(e,"onunmute",{set:function(n){t.addTrackEventListener(e.id,d.UNMUTE,n)},get:function(){return null}}),e.trackEnabled=e.enabled,Object.defineProperty(e,"enabled",{set:function(n){e.trackEnabled=n,t.sendApiRequest(a.TOGGLE_TRACK_ENABLED_API_NAME,[e.id,n]).then((function(n){n&&(t.trackProxies.get(e.id).trackEnabled=n.enabled)}))},get:function(){return e.trackEnabled}}),this.preRegisterEvents(d,e,this.addTrackEventListener),e}makeStreamProxy(e){var t=this;this.streamProxies.set(e.id,e);let n=new MediaStream;n.type="proxy",n.proxy=e;let r=e.tracks?e.tracks.map((function(e){return t.makeTrackProxy(e)})):[];return e.tracks=r,n.getTracks=function(){return r},n.getAudioTracks=function(){return r.filter((function(e){return"audio"===e.kind}))},n.getVideoTracks=function(){return r.filter((function(e){return"video"===e.kind}))},n.getTrackById=function(e){return r.find((function(t){return t.id===e}))},n.createMediaElement=function(e){return t.createMediaElement(e)},n.addTrack=function(n){t.sendApiRequest(a.STREAM_ADD_TRACK,[e.id,n.id])},n.removeTrack=function(n){t.sendApiRequest(a.STREAM_REMOVE_TRACK,[e.id,n.id])},n}updateTransceiverProxy(e){let t=this.transceiverProxies.get(e.id);return t||(t={}),Object.assign(t,e),e.receiver&&"proxy"===e.receiver.type&&(t.receiver=this.updateReceiverProxy(e.receiver)),e.sender&&"proxy"===e.sender.type&&(t.sender=this.updateSenderProxy(e.sender)),this.transceiverProxies.set(e.id,t),t}updatePCSenders(e,t){var n=this;let r=t.map((function(e){return n.updateSenderProxy(e)}));this.pcProxies.get(e).senders=r}updatePCReceivers(e,t){var n=this;let r=t.map((function(e){return n.updateReceiverProxy(e)}));this.pcProxies.get(e).receivers=r}updatePCTransceivers(e,t){var n=this;let r=t;r.forEach((function(e){n.updateTransceiverProxy(e)})),this.pcProxies.get(e).transceivers=r}isValidApi(e){let t=!1;for(const n in a)if(a[n]===e){t=!0;break}return t}async sendApiRequest(e,t,n=crypto.randomUUID()){this.logger.debug(e,t,n);try{const r={api:e,args:t};let i=A.deflateRaw(JSON.stringify(r));const s={requestId:n,message:i,type:"request"};this.logger.debug("Sending request:",JSON.stringify(s));let a=await chrome.runtime.sendMessage(this.extensionId,s);i=a.message;const o=A.inflateRaw(i),d=this.decoder.decode(o);if(a.message=JSON.parse(d),this.logger.debug("Received response: ",JSON.stringify(a)),!a||!a.message||!a.type){let e=`Received empty message or type, extensionResponse: ${JSON.stringify(a)}, request: ${JSON.stringify(s)}, message: ${JSON.stringify(r)}`;return this.logger.warn(e),null}if("error"===a.type){let e=`Received error: ${JSON.stringify(a)}, for request: ${JSON.stringify(s)}, message: ${JSON.stringify(r)}`,t=null;if(this.logger.debug(e),a.message.error&&a.message.error.message&&a.message.error&&a.message.error.name)throw e=a.message.error.message,t=a.message.error.name,new DOMException(e,t);return null}if("response"!==a.type&&"event"!==a.type&&"error"!==a.type){let e=`Received invalid message type, type: ${JSON.stringify(a.type)}, event: ${JSON.stringify(a)}, request: ${JSON.stringify(s)}, message: ${JSON.stringify(r)}`;return this.logger.warn(e),null}if(a.message.api&&!this.isValidApi(a.message.api)){let e=`Received invalid message api, event: ${JSON.stringify(a)}, request: ${JSON.stringify(s)}, message: ${JSON.stringify(r)}`;return this.logger.warn(e),null}return"event"===a.type?a.message.event:a.message.response}catch(r){return this.logger.warn(`Failed to send api request: api: ${e}, args: ${t}, requestId: ${n}`,r),null}}async getUserMediaInternal(e){let t=await this.sendApiRequest(a.GETUSERMEDIA_API_NAME,[e]);return t?this.makeStreamProxy(t):null}getOverridenApi(e){return this.overridenApis.get(e)}async getUserMedia(e){const t=Object.freeze(e);if(t.audio&&t.video){let e=await navigator.permissions.query({name:"microphone"}),n=await navigator.permissions.query({name:"camera"});if(e&&"granted"===e.state&&n&&"granted"===n.state)return await this.getUserMediaInternal(t)}else if(t.audio){let e=await navigator.permissions.query({name:"microphone"});if(e&&"granted"===e.state)return await this.getUserMediaInternal(t)}else if(t.video){let e=await navigator.permissions.query({name:"camera"});if(e&&"granted"===e.state)return await this.getUserMediaInternal(t)}let n=[];if(t.video&&(n=await this.getOverridenApi("navigator.mediaDevices.enumerateDevices").apply(navigator.mediaDevices),n=n.filter((function(e){return e.kind&&e.kind.indexOf("video")>-1}))),t.audio&&!t.video||t.video&&n.length>0){(await this.getOverridenApi("navigator.mediaDevices.getUserMedia").apply(navigator.mediaDevices,[t])).getTracks().forEach((function(e){e.stop()}))}return await this.getUserMediaInternal(t)}async enumerateDevices(){let e=await this.sendApiRequest(a.ENUMERATEDEVICES_API_NAME,[]);return e?this.makeMediaDeviceInfoProxies(e):null}getVersion(){return t}makeReceiverProxy(e){var t=this;return e.track&&(e.track=this.makeTrackProxy(e.track)),e.getSynchronizationSources=function(){return e.synchronizationSources},e.getStats=async function(){const n=await t.sendApiRequest(a.GET_RECEIVER_STATS_API_NAME,[e.id]);let r=new Map;return n&&n.forEach((function(e){r.set(e.id,e)})),r},e.createEncodedStreams=function(){let n={id:crypto.randomUUID(),type:"proxy",readable:{id:crypto.randomUUID(),type:"proxy"},writable:{id:crypto.randomUUID(),type:"proxy"}};return t.streamProxies.set(n.id,n),t.sendApiRequest(a.RECEIVER_CREATE_ENCODED_STREAMS,[e.id,n]),n},this.receiverProxies.set(e.id,e),e}makeDTMFProxy(e){var t=this;let n=e;return this.dtmfProxies.has(n.id)?(n=this.dtmfProxies.get(n.id),Object.assign(n,e)):(this.dtmfProxies.set(n.id,n),n.pendingEvents=new Map,n.insertDTMF=function(e,r,i){t.sendApiRequest(a.INSERT_DTMF_API_NAME,[n.id,e,r,i])},n.addEventListener=function(e,r,i){t.addDtmfEventListener(n.id,e,r,i)},n.removeEventListener=function(e,r){t.removeEventListener(n.id,e,r)},Object.defineProperty(n,"ontonechange",{set:function(e){t.addDtmfEventListener(n.id,c.TONECHANGE,e)},get:function(){return null}}),this.preRegisterEvents(c,n,this.addDtmfEventListener)),n}makeSenderProxy(e){var t=this;return e.track&&(e.track=this.makeTrackProxy(e.track)),e.dtmf&&(e.dtmf=this.makeDTMFProxy(e.dtmf)),e.getStats=async function(){let n=await t.sendApiRequest(a.GET_SENDER_STATS_API_NAME,[e.id]);return n&&(n.has=function(e){return void 0!==n.find((function(t){return t.id===e}))},n.get=function(e){return n.find((function(t){return t.id===e}))}),n},e.replaceTrack=function(n){return e.track=n,t.sendApiRequest(a.REPLACE_SENDER_TRACK_API_NAME,[e.id,n])},e.createEncodedStreams=function(){let n={id:crypto.randomUUID(),type:"proxy",readable:{type:"proxy",id:crypto.randomUUID()},writable:{type:"proxy",id:crypto.randomUUID()}};return t.streamProxies.set(n.id,n),t.sendApiRequest(a.SENDER_CREATE_ENCODED_STREAMS,[e.id,n]),n},e}updateSenderProxy(e){let t=this.senderProxies.get(e.id);return t?Object.assign(t,e):(t=e,this.senderProxies.set(e.id,t)),this.makeSenderProxy(t)}updateReceiverProxy(e){let t=this.receiverProxies.get(e.id);return t?Object.assign(t,e):(t=e,this.receiverProxies.set(e.id,t)),this.makeReceiverProxy(t)}addTrack(e,t){var n=this;let r=crypto.randomUUID();this.sendApiRequest(a.ADD_TRACK_API_NAME,[r,...arguments]).then((function(e){e&&(n.updateSenderProxy(e),n.updatePCSenders(e.pcId,e.senders),n.updatePCReceivers(e.pcId,e.receivers),n.updatePCTransceivers(e.pcId,e.transceivers))}));let i=this.updateSenderProxy({id:r});return this.pcProxies.get(e).senders.push(i),i}updatePeerConnectionProxy(e){let t=this.pcProxies.get(e.pcId);Object.assign(t,e),this.updatePCSenders(e.pcId,e.senders),this.updatePCReceivers(e.pcId,e.receivers),this.updatePCTransceivers(e.pcId,e.transceivers)}createPeerConnection(e,t){var n=this;let r=crypto.randomUUID(),i=this;this.logger.debug(`Creating RTCPeerConnection with id: ${r}`);let s={type:"proxy",id:r,signalingState:"new",connectionState:"new",iceConnectionState:"new",iceGatheringState:"new",receivers:[],senders:[],transceivers:[],pendingEvents:new Map,configuration:e,close:function(){n.close(r)},addStream:function(e){n.addStream(r,e)},getConfiguration:function(){return n.sendApiRequest(a.PC_GET_CONFIGURATION,[r]).then((function(e){e&&(s.configuration=e)})),s.configuration},getStats:function(e){return n.getStats(r,e)},createOffer:function(e){return n.createOffer(r,e)},createAnswer:function(e){return n.createAnswer(r,e)},setLocalDescription:function(e){return n.setLocalDescription(r,e)},addEventListener:function(e,t){n.addPeerConnectionEventListener(r,e,t)},removeEventListener:function(e,t){n.removeEventListener(r,e,t)},getEventListener:function(e){return n.eventListeners.get(r).get(e)},set onicecandidate(e){this.addEventListener(o.ICE_CANDIDATE,e)},get onicecandidate(){return this.getEventListener(o.ICE_CANDIDATE)},set ontrack(e){this.addEventListener(o.TRACK,e)},get ontrack(){return this.getEventListener(o.TRACK)},get onsignalingstatechange(){return this.getEventListener(o.SIG_STATE_CHANGE)},set onsignalingstatechange(e){this.addEventListener(o.SIG_STATE_CHANGE,e)},get onconnectionstatechange(){return this.getEventListener(o.CONN_STATE_CHANGE)},set onconnectionstatechange(e){this.addEventListener(o.CONN_STATE_CHANGE,e)},get oniceconnectionstatechange(){return this.getEventListener(o.ICE_CONN_STATE_CHANGE)},set oniceconnectionstatechange(e){this.addEventListener(o.ICE_CONN_STATE_CHANGE,e)},get onicegatheringstatechange(){return this.getEventListener(o.ICE_GATHER_STATE_CHANGE)},set onicegatheringstatechange(e){this.addEventListener(o.ICE_GATHER_STATE_CHANGE,e)},get onnegotiationneeded(){return this.getEventListener(o.NEGOTIATION_NEEDED)},set onnegotiationneeded(e){this.addEventListener(o.NEGOTIATION_NEEDED,e)},setRemoteDescription:function(e){return n.setRemoteDescription(r,e)},addIceCandidate:function(e){return n.addIceCandidate(r,e)},getRemoteStreams:function(){return n.logger.warn("getRemoteStreams not implemented on proxy."),[]},getReceivers:function(){return n.getReceivers(r)},getSenders:function(){return n.getSenders(r)},addTrack:function(e){let t=[r,...arguments];return i.addTrack.apply(i,t)},addTransceiver:function(e,t){return n.addTransceiver(r,e,t)},getTransceivers:function(){return n.getTransceivers(r)},removeTrack:function(e){n.removeTrack(r,e)}};return this.pcProxies.set(r,s),this.sendApiRequest(a.NEWRTCPEERCONNECTION_API_NAME,[r,e,t],r).then((function(e){e&&n.updatePeerConnectionProxy(e)}),(function(e){n.logger.error(`Error creating proxied RTCPeerConnection: ${e}`)})),this.preRegisterEvents(o,this.pcProxies.get(r),this.addPeerConnectionEventListener),this.pcProxies.get(r)}preRegisterEvents(e,t,n){for(const r in e)"string"==typeof e[r]&&n.apply(this,[t.id,e[r],function(e){t.pendingEvents.has(e.eventName)||t.pendingEvents.set(e.eventName,[]),t.pendingEvents.get(e.eventName).push(e)}])}updateAudioContextProxy(e){let t=this.audioContextProxies.get(e.id);Object.assign(t,e)}updateAudioNodeProxy(e){let t=this.audioNodeProxies.get(e.id);Object.assign(t,e),e.stream&&this.makeStreamProxy(e.stream)}makeAudioNodeProxy(e,t){var n=this;return{type:"proxy",id:t,context:this.audioContextProxies.get(e),connect:function(e,r,i){return n.sendApiRequest(a.AUDIO_NODE_CONNECT,[t,e,r,i]),e},disconnect:function(e,r,i){n.sendApiRequest(a.AUDIO_NODE_DISCONNECT,[t,e,r,i])}}}createAudioNode(e,t,n){var r=this;let i=crypto.randomUUID();return this.audioNodeProxies.set(i,this.makeAudioNodeProxy(e,i)),this.sendApiRequest(a.AUDIO_CTX_CREATE_AUDIO_NODE,[e,i,t,n],i).then((function(e){e&&r.updateAudioNodeProxy(e)}),(function(e){r.logger.error(`Error creating proxied ${t}: ${e}`)})),this.audioNodeProxies.get(i)}makeWorkerProxy(e){var t=this;let n={id:e,pendingEvents:new Map,type:"proxy",postMessage:function(n,r){t.sendApiRequest(a.WORKER_POST_MESSAGE,[e,n,r])},terminate:function(){t.sendApiRequest(a.WORKER_TERMINATE,[e])},addEventListener:function(e,r,i){t.addWorkerEventListener(n.id,e,r,i)},removeEventListener:function(e,r){t.removeEventListener(n.id,e,r)}};return Object.defineProperty(n,"onerror",{set:function(e){t.addWorkerEventListener(n.id,l.ERROR,e)},get:function(){return null}}),Object.defineProperty(n,"onmessage",{set:function(e){t.addWorkerEventListener(n.id,l.MESSAGE,e)},get:function(){return null}}),Object.defineProperty(n,"onmessageerror",{set:function(e){t.addWorkerEventListener(n.id,l.MESSAGE_ERROR,e)},get:function(){return null}}),n}createWorker(e,t){var n=this;let r=crypto.randomUUID(),i=this.makeWorkerProxy(r);return this.workerProxies.set(r,i),fetch(e).then((function(e){e.blob().then((function(e){e.arrayBuffer().then((function(i){let s=p(i);n.sendApiRequest(a.CREATE_WORKER,[r,e.type,s,t]).then((function(e){n.logger.debug(`Created worker: ${JSON.stringify(e)}`)}))}))}))})),this.logger.debug(`Preregistering events for worker: ${JSON.stringify(i)}`),this.preRegisterEvents(l,i,this.addWorkerEventListener),i}createAudioContext(){var e=this;let t=crypto.randomUUID(),n=crypto.randomUUID();return this.audioContextProxies.set(t,{type:"proxy",id:t,destination:this.makeAudioNodeProxy(t,n),createGain:function(){let n=e.createAudioNode(t,"Gain",[]),r={setValueAtTime:function(t,i){return r.currentValue=t,e.sendApiRequest(a.AUDIO_PARAM_SET_VALUE_AT_TIME,[n.id,t,i]),r},linearRampToValueAtTime:function(t,i){return e.sendApiRequest(a.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME,[n.id,t,i]),r}};return Object.defineProperty(r,"value",{set:function(e){return r.setValueAtTime(e,0)},get:function(){return r.currentValue}}),n.gain=r,n},createOscillator:function(){let n=e.createAudioNode(t,"Oscillator",[]);n.start=function(t=0){e.sendApiRequest(a.AUDIO_NODE_START,[n.id,t])},n.stop=function(t=0){e.sendApiRequest(a.AUDIO_NODE_STOP,[n.id,t])},Object.defineProperty(n,"type",{set:function(t){n.currentType=t,e.sendApiRequest(a.AUDIO_NODE_SET_TYPE,[n.id,t])},get:function(){return n.currentType}});let r={setValueAtTime:function(t,i){return e.sendApiRequest(a.AUDIO_PARAM_SET_VALUE_AT_TIME,[n.id,t,i]),r}};return Object.defineProperty(r,"value",{set:function(e){return r.setValueAtTime(e,0)},get:function(){return r.currentValue}}),n.frequency=r,n},createMediaStreamSource:function(n){return e.createAudioNode(t,"MediaStreamSource",[n.proxy])},createAnalyser:function(){return e.createAudioNode(t,"Analyser",[])},createMediaStreamDestination:function(){let n=e.createAudioNode(t,"MediaStreamDestination",[]);return n.stream=e.makeStreamProxy({id:n.id,tracks:[{id:n.id,kind:"audio"}]}),n},close:function(){return e.sendApiRequest(a.AUDIO_CTX_CLOSE,[t])}}),this.sendApiRequest(a.NEW_AUDIO_CONTEXT,[t,n],t).then((function(t){t&&e.updateAudioContextProxy(t)}),(function(t){e.logger.error(`Error creating proxied AudioContext: ${t}`)})),this.audioContextProxies.get(t)}close(e){this.eventListeners.get(e).clear(),this.sendApiRequest(a.PC_CLOSE_API_NAME,[e])}addStream(e,t){this.sendApiRequest(a.ADDSTREAM_API_NAME,[e,t.proxy])}getStats(e,t){return"function"==typeof t?Promise.reject(new Error("callback based getStats is obsolete.")):this.sendApiRequest(a.GET_STATS_API_NAME,[e,t])}createOffer(e,t){return this.sendApiRequest(a.CREATE_OFFER_API_NAME,[e,t])}createAnswer(e,t){return this.sendApiRequest(a.CREATE_ANSWER_API_NAME,[e,t])}setLocalDescription(e,t){return this.pcProxies.get(e).localDescription=t,this.sendApiRequest(a.SET_LOCAL_DESCRIPTION_API_NAME,[e,t])}setRemoteDescription(e,t){return this.sendApiRequest(a.SET_REMOTE_DESCRIPTION_API_NAME,[e,t])}handleAddEventListenerResponse(e){var t=this;e.eventName===o.SIG_STATE_CHANGE?this.updatePeerConnectionProxy(e):e.eventName===o.TRACK?(e.streams=e.streams.map((function(e){return t.makeStreamProxy(e)})),e.track=this.makeTrackProxy(e.track),this.updatePeerConnectionProxy(e)):(e.eventName===o.CONN_STATE_CHANGE||e.eventName===o.ICE_CONN_STATE_CHANGE||e.eventName===o.ICE_GATHER_STATE_CHANGE||e.eventName===o.ICE_CANDIDATE||e.eventName===o.NEGOTIATION_NEEDED)&&this.updatePeerConnectionProxy(e),this.fireUpEventHandlers(this.pcProxies.get(e.pcId),e),this.sendApiRequest(a.ADD_PC_EVENT_LISTENER,[e.pcId,e.eventName]).then((function(e){e&&t.handleAddEventListenerResponse(e)}))}fireUpEventHandlers(e,t){if(e&&this.eventListeners.get(e.id).has(t.eventName)){let n=e.pendingEvents;this.eventListeners.get(e.id).get(t.eventName).forEach((function(e,r){0===r?e(t):n.get(t.eventName).forEach((function(t){e(t)}))})),n.set(t.eventName,[])}}handleAddTrackEventListenerResponse(e){var t=this;"mute"!==e.eventName&&"unmute"!==e.eventName||(this.trackProxies.get(e.trackId).muted=e.muted),this.fireUpEventHandlers(this.trackProxies.get(e.trackId),e),this.sendApiRequest(a.ADD_TRACK_EVENT_LISTENER,[e.trackId,e.eventName]).then((function(e){e&&t.handleAddTrackEventListenerResponse(e)}))}handleAddDtmfEventListenerResponse(e){var t=this;this.fireUpEventHandlers(this.dtmfProxies.get(e.dtmfId),e),this.sendApiRequest(a.ADD_DTMF_EVENT_LISTENER,[e.dtmfId,e.eventName]).then((function(e){e&&t.handleAddDtmfEventListenerResponse(e)}))}handleAddWorkerEventListenerResponse(e){var t=this;this.fireUpEventHandlers(this.workerProxies.get(e.wId),e),this.sendApiRequest(a.ADD_WORKER_EVENT_LISTENER,[e.wId,e.eventName]).then((function(e){e&&t.handleAddWorkerEventListenerResponse(e)}))}addEventListener(e,t,n){this.eventListeners.has(e)||this.eventListeners.set(e,new Map),this.eventListeners.get(e).has(t)||this.eventListeners.get(e).set(t,[]),this.eventListeners.get(e).get(t).push(n)}addPeerConnectionEventListener(e,t,n){var r=this;this.addEventListener(e,t,n),this.sendApiRequest(a.ADD_PC_EVENT_LISTENER,[e,t]).then((function(e){e&&r.handleAddEventListenerResponse(e)}))}addTrackEventListener(e,t,n,r){var i=this;this.addEventListener(e,t,n),this.sendApiRequest(a.ADD_TRACK_EVENT_LISTENER,[e,t,r]).then((function(e){e&&i.handleAddTrackEventListenerResponse(e)}))}addDtmfEventListener(e,t,n,r){var i=this;this.addEventListener(e,t,n),this.sendApiRequest(a.ADD_DTMF_EVENT_LISTENER,[e,t,r]).then((function(e){e&&i.handleAddDtmfEventListenerResponse(e)}))}addWorkerEventListener(e,t,n){var r=this;this.addEventListener(e,t,n),this.sendApiRequest(a.ADD_WORKER_EVENT_LISTENER,[e,t]).then((function(e){e&&r.handleAddWorkerEventListenerResponse(e)}))}removeEventListener(e,t,n){let r=this.eventListeners.get(e).get(t);const i=r.indexOf(n);i>-1&&r.splice(i,1)}addIceCandidate(e,t){let n=t?{sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}:null;return this.sendApiRequest(a.ADD_ICE_CANDIDATE_API_NAME,[e,n])}createMediaElement(e){var t=this;let n=crypto.randomUUID();this.sendApiRequest(a.CREATE_MEDIA_ELEMENT_API_NAME,[n,e],n).then((function(e){if(e){t.mediaElementProxies.get(e.id).sinkId=e.sinkId}}));let r={id:n,type:"proxy",classList:new Set,isMuted:!1,play:function(){t.sendApiRequest(a.MEDIA_ELEMENT_PLAY_API_NAME,[n])},pause:function(){t.sendApiRequest(a.MEDIA_ELEMENT_PAUSE_API_NAME,[n])},setSinkId:function(e){return t.sendApiRequest(a.MEDIA_ELEMENT_SET_SINK_ID_API_NAME,[n,e])},remove:function(){return t.sendApiRequest(a.MEDIA_ELEMENT_REMOVE,[n])}};return this.mediaElementProxies.set(n,r),r.classList.remove=function(e){r.classList.delete(e)},Object.assign(r,e),Object.defineProperty(r,"srcObject",{set:function(e){r.stream=e,t.sendApiRequest(a.SET_MEDIA_SRC_OBJ_API_NAME,[r.id,e&&e.proxy?e.proxy:e])},get:function(){return r.stream}}),Object.defineProperty(r,"hidden",{set:function(e){t.sendApiRequest(a.SET_MEDIA_HIDDEN_API_NAME,[r.id,e])},get:function(){return r.hidden}}),Object.defineProperty(r,"volume",{set:function(e){t.sendApiRequest(a.SET_MEDIA_VOLUME_API_NAME,[r.id,e])},get:function(){return r.volume}}),Object.defineProperty(r,"muted",{set:function(e){r.isMuted=e,t.sendApiRequest(a.MEDIA_ELEMENT_MUTED,[r.id,e]).then((function(e){e&&(r.isMuted=e.muted)}))},get:function(){return r.isMuted}}),r}generateCertificate(e){return this.sendApiRequest(a.GENERATE_CERTIFICATE_API_NAME,[e])}getReceivers(e){var t=this;return this.sendApiRequest(a.GET_RECEIVERS_API_NAME,[e]).then((function(e){e&&t.updatePCReceivers(e.pcId,e.receivers)})),this.pcProxies.get(e).receivers}getSenders(e){var t=this;return this.sendApiRequest(a.GET_SENDERS_API_NAME,[e]).then((function(e){e&&t.updatePCSenders(e.pcId,e.senders)})),this.pcProxies.get(e).senders}removeTrack(e,t){this.sendApiRequest(a.PC_REMOVE_TRACK_API_NAME,[e,t])}getTransceivers(e){var t=this;return this.sendApiRequest(a.GET_TRANSCEIVERS_API_NAME,[e]).then((function(e){e&&t.updatePCTransceivers(e.pcId,e.transceivers)})),this.pcProxies.get(e).transceivers}addTransceiver(e,t,n){var r=this;let i=crypto.randomUUID(),s={type:"proxy",id:i,sender:this.makeSenderProxy({id:crypto.randomUUID()}),receiver:this.makeReceiverProxy({id:crypto.randomUUID()}),setCodecPreferences:function(e){r.sendApiRequest(a.TRANSCEIVER_SET_CODEC_PREFS,[i,e])}};return this.transceiverProxies.set(s.id,s),this.pcProxies.get(e).transceivers.push(s),this.pcProxies.get(e).receivers.push(s.receiver),this.pcProxies.get(e).senders.push(s.sender),this.sendApiRequest(a.ADD_TRANSCEIVER_API_NAME,[e,s,"string"==typeof t?t:this.makeTrackProxy(t),n]).then((function(e){e&&(r.updateTransceiverProxy(e),r.updatePCSenders(e.pcId,e.senders),r.updatePCReceivers(e.pcId,e.receivers),r.updatePCTransceivers(e.pcId,e.transceivers))})),s}setLogger(e){this.logger=e}overrideWebRTC(){var e=this;this.logger.info("Overriding WebRTC interfaces for the current webapp.");let t=this;navigator.mediaDevices.getUserMedia=function(t){return e.getUserMedia(t)},navigator.mediaDevices.enumerateDevices=function(){return e.enumerateDevices()},window.RTCPeerConnection=function(e,n){return t.createPeerConnection(e,n)},window.RTCPeerConnection.generateCertificate=function(e){return t.generateCertificate(e)},window.AudioContext=function(){return t.createAudioContext()},window.Worker=function(e,n){return t.createWorker(e,n)}}removeStatusChangeEventListener(e){this.statusChangeEventListeners=this.statusChangeEventListeners.filter((function(t){return t!==e}))}addStatusChangeEventListener(e){this.statusChangeEventListeners.push(e)}async sendHelloRequest(){var e=this;let n=await this.sendApiRequest(a.HELLO_API_NAME,[]);return n&&!globalThis.DCVWebRTCRedirProxy&&(this.status=h.AVAILABLE,this.logger.info(`Running in a DCV WebRTC redirection env, proxy version: ${t.versionStr} - ${t.gitHash}`),this.logger.info(`Client info: ${JSON.stringify(n)}`),window.addEventListener("beforeunload",(function(t){let n={pcIds:[],streamIds:[],mediaElementIds:[],transceiverIds:[],senderIds:[],receiverIds:[],trackIds:[],workerIds:[]};e.pcProxies.forEach((function(e,t){n.pcIds.push(t)})),e.streamProxies.forEach((function(e,t){n.streamIds.push(t)})),e.trackProxies.forEach((function(e,t){n.trackIds.push(t)})),e.workerProxies.forEach((function(e,t){n.workerIds.push(t)})),e.mediaElementProxies.forEach((function(e,t){n.mediaElementIds.push(t)})),e.transceiverProxies.forEach((function(e,t){n.transceiverIds.push(t)})),e.senderProxies.forEach((function(e,t){n.senderIds.push(t)})),e.receiverProxies.forEach((function(e,t){n.receiverIds.push(t)})),e.sendApiRequest(a.UNLOAD_EVENT_NAME,[n])}))),n}static setInitCallback(e,t){let n=globalThis.DCVWebRTCRedirProxy;if(n)e({success:!0,proxy:n});else{w.initCallbacks||(w.initCallbacks=new Map);let n=setTimeout((function(e){e({success:!1,error:`Failed to initialize DCVWebRTCPeerConnectionProxy in ${t}ms`}),w.initCallbacks.delete(e)}),t,e);w.initCallbacks.set(e,n)}}}function T(e,t,n){globalThis.DCVWebRTCRedirProxy=t,w.initCallbacks?(w.initCallbacks.forEach((function(r,i){clearTimeout(r),i({success:e,proxy:t,error:n})})),w.initCallbacks.clear()):s.debug("No DCVWebRTCPeerConnectionProxy.initCallback was specified.")}try{window.DCVWebRTCPeerConnectionProxy=w;let e=new w({logger:s});e.sendHelloRequest().then((function(t){s.debug(`Successfully received hello response from client: ${JSON.stringify(t)}`),e.clientInfo=t,e.resetHeartbeat(null),T(!0,e)})).catch((function(e){const t=`Running in an invalid dcv webrtc env, skipping setting up proxy: ${JSON.stringify(e)}`;s.debug(t),T(!1,null,t)}))}catch(e){const t=e.message;T(!1,null,t),s.debug(`Skipping setting up proxy in client env: ${t}`)}e.DCVWebRTCRedirClient=class{constructor(e){this.version=t,this.config=e,this.logger=e.logger?e.logger:s,this.channel=e.channel,this.decoder=new TextDecoder("utf-8"),this.messageBuffer=null,this.pcs=new Map,this.pcPromises=new Map,this.audioContexts=new Map,this.audioNodes=new Map,this.workers=new Map,this.workerPromises=new Map,this.certs=new Map,this.streams=new Map,this.tracks=new Map,this.offers=new Map,this.answers=new Map,this.remoteDescriptions=new Map,this.mediaElements=new Map,this.senders=new Map,this.dtmfSenders=new Map,this.receivers=new Map,this.transceivers=new Map,this.logger.info(`Created WebRTC Redirection Client version: ${t.versionStr} - ${t.gitHash}`)}encodeBase64(e){return p(e)}decodeBase64(e){return g(e)}getVersion(){return this.version}concatUint8Arrays(e){const t=e.reduce((function(e,t){return e+t.byteLength}),0),n=new Uint8Array(t);let r=0;return e.forEach((function(e){n.set(e,r),r+=e.byteLength})),n}parseHeader(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}onMessageReceived(e){this.logger.debug(`onMessageReceived, binaryPayload.byteLength: ${e.byteLength}`);try{let t=0;for(null===this.messageBuffer?this.messageBuffer=new Uint8Array(e):this.messageBuffer=this.concatUint8Arrays([this.messageBuffer,new Uint8Array(e)]),this.messageBuffer.byteLength>=4&&(t=this.parseHeader(this.messageBuffer));t>0&&this.messageBuffer.byteLength>=t+4;){let e=4,n=4+t,r=this.messageBuffer.slice(e,n);this.logger.debug("Decoding payload: ",r);let i=this.decoder.decode(r);this.logger.debug(`Received message: ${i}`);let s=JSON.parse(i);this.logger.debug("Received json: ",s),this.handleMessage(s),this.messageBuffer=this.messageBuffer.slice(n),t=this.messageBuffer.byteLength>=4?this.parseHeader(this.messageBuffer):0}}catch(e){this.logger.error(`Failed to parse JSON from binaryPayload: ${e}`),this.messageBuffer=null}}getPeerConnection(e){var t=this;return this.pcs.has(e)?this.pcs.get(e):(this.pcPromises.has(e)||this.pcPromises.set(e,[]),new Promise((function(n,r){t.pcPromises.get(e).push({resolve:n,reject:r})})))}closePeerConnection(e){var t=this;if(this.pcs.has(e)){let n=this.pcs.get(e);n.getTransceivers().forEach((function(e){e.sender&&(e.sender.dtmf&&t.dtmfSenders.forEach((function(n,r){n===e.sender.dtmf&&t.dtmfSenders.delete(r)})),t.senders.forEach((function(n,r){n===e.sender&&t.senders.delete(r)}))),e.receiver&&t.receivers.forEach((function(n,r){n===e.receiver&&t.receivers.delete(r)})),t.transceivers.forEach((function(n,r){n===e&&t.transceivers.delete(r)}))})),n.getSenders().forEach((function(e){t.senders.forEach((function(n,r){n===e&&t.senders.delete(r)}))})),n.getReceivers((function(e){t.receivers.forEach((function(n,r){n===e&&t.receivers.delete(r)}))})),n.localDescription&&(this.offers.forEach((function(e,r){n.localDescription.type===e.type&&n.localDescription.sdp===e.sdp&&t.offers.delete(r)})),this.answers.forEach((function(e,r){n.localDescription.type===e.type&&n.localDescription.sdp===e.sdp&&t.offers.delete(r)}))),n.remoteDescription&&this.remoteDescriptions.forEach((function(e,r){n.remoteDescription.type===e.type&&n.remoteDescription.sdp===e.sdp&&t.remoteDescriptions.delete(r)})),this.pcPromises.has(e)&&(this.pcPromises.get(e).forEach((function(e){e.reject(null)})),this.pcPromises.delete(e)),n.close(),this.pcs.delete(e)}}getPendingEvent(e,t){return e.pendingEvents.has(t)&&e.pendingEvents.get(t).length>0?e.pendingEvents.get(t).shift():(e.eventPromises.has(t)||e.eventPromises.set(t,[]),new Promise((function(n,r){e.eventPromises.get(t).push({resolve:n,reject:r})})))}getStream(e){return this.streams.get(e)}makeTrackTO(e,t=(e.id?e.id:crypto.randomUUID())){return this.tracks.set(t,e),{type:"proxy",contentHint:e.contentHint,enabled:e.enabled,id:t,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,settings:e.getSettings()}}makeStreamTO(e,t=(e.id?e.id:crypto.randomUUID())){var n=this;this.streams.set(t,e);let r=e.getTracks().map((function(e){return n.makeTrackTO(e)}));return{type:"proxy",id:t,active:e.active,tracks:r}}makeSyncronizationSourceTO(e){return{audioLevel:e.audioLevel,rtpTimestamp:e.rtpTimestamp,source:e.source,timestamp:e.timestamp}}makeReceiverTO(e){var t=this;let n=e.getSynchronizationSources();n=n.map((function(e){return t.makeSyncronizationSourceTO(e)}));let r={id:e.id?e.id:crypto.randomUUID(),type:"proxy",track:e.track?this.makeTrackTO(e.track):null,synchronizationSources:n,stats:[]};return e.id=r.id,this.receivers.set(r.id,e),r}makeDTMFSenderTO(e){let t={id:e.id?e.id:crypto.randomUUID(),type:"proxy",toneBuffer:e.toneBuffer};return e.id=t.id,this.dtmfSenders.set(t.id,e),t}makeSenderTO(e){let t={id:e.id?e.id:crypto.randomUUID(),type:"proxy",track:e.track?this.makeTrackTO(e.track):null,dtmf:e.dtmf?this.makeDTMFSenderTO(e.dtmf):null};return e.id=t.id,this.senders.set(t.id,e),t}makeTransceiverTO(e){return{id:e.id,type:"proxy",currentDirection:e.currentDirection,direction:e.direction,mid:e.mid,receiver:e.receiver?this.makeReceiverTO(e.receiver):null,sender:e.sender?this.makeSenderTO(e.sender):null,stopped:e.stopped}}findProxySubject(e){return this.pcs.has(e)?this.pcs.get(e):this.audioContexts.has(e)?this.audioContexts.get(e):this.audioNodes.has(e)?this.audioNodes.get(e):this.workers.has(e)?this.workers.get(e):this.certs.has(e)?this.certs.get(e):this.streams.has(e)?this.streams.get(e):this.offers.has(e)?this.offers.get(e):this.answers.has(e)?this.answers.get(e):this.remoteDescriptions.has(e)?this.remoteDescriptions.get(e):this.mediaElements.has(e)?this.mediaElements.get(e):this.senders.has(e)?this.senders.get(e):this.dtmfSenders.has(e)?this.dtmfSenders.get(e):this.receivers.has(e)?this.receivers.get(e):this.transceivers.has(e)?this.transceivers.get(e):this.tracks.has(e)?this.tracks.get(e):null}traverse(e,t){if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t.apply(this,[e,n,e[n]]),null!==e[n]&&"object"==typeof e[n]&&this.traverse(e[n],t))}getWorker(e){var t=this;return this.workers.has(e)?this.workers.get(e):(this.workerPromises.has(e)||this.workerPromises.set(e,[]),new Promise((function(n,r){t.workerPromises.get(e).push({resolve:n,reject:r})})))}gatherPeerConnectionState(e,t){var n=this;e.canTrickleIceCandidates=t.canTrickleIceCandidates,e.connectionState=t.connectionState,e.currentLocalDescription=t.currentLocalDescription,e.currentRemoteDescription=t.currentRemoteDescription,e.iceConnectionState=t.iceConnectionState,e.iceGatheringState=t.iceGatheringState,e.iceGatheringState=t.iceGatheringState,e.localDescription=t.localDescription,e.peerIdentity=t.peerIdentity,e.pendingLocalDescription=t.pendingLocalDescription,e.pendingRemoteDescription=t.pendingRemoteDescription,e.remoteDescription=t.remoteDescription,e.sctp=t.sctp,e.signalingState=t.signalingState,e.configuration=t.getConfiguration(),e.transceivers=t.getTransceivers().map((function(e){return n.makeTransceiverTO(e)})),e.senders=t.getSenders().map((function(e){return n.makeSenderTO(e)})),e.receivers=t.getReceivers().map((function(e){return n.makeReceiverTO(e)}))}async callWebRTCApi(e,t,n){var r=this;switch(e){case a.HELLO_API_NAME:return{version:this.version,platform:"web",userAgent:navigator.userAgent};case a.GETUSERMEDIA_API_NAME:{let[e]=n,t=await navigator.mediaDevices.getUserMedia(e);return this.makeStreamTO(t)}case a.ENUMERATEDEVICES_API_NAME:return(await navigator.mediaDevices.enumerateDevices()).map((function(e){return e.toJSON()}));case a.STREAM_ADD_TRACK:{let[e,t]=n,r=this.streams.get(e),i=this.tracks.get(t);return r&&i&&r.addTrack(i),{}}case a.STREAM_REMOVE_TRACK:{let[e,t]=n,r=this.streams.get(e),i=this.tracks.get(t);return r&&i&&r.removeTrack(i),{}}case a.GENERATE_CERTIFICATE_API_NAME:{let[e]=n,r=await RTCPeerConnection.generateCertificate(e);return this.certs.set(t,r),{type:"proxy",id:t,expires:r.expires,fingerprints:r.getFingerprints()}}case a.NEWRTCPEERCONNECTION_API_NAME:{let[e,t,i]=n;if(t&&t.certificates){let e=t.certificates.map((function(e){return r.certs.get(e.id)}));t.certificates=e}let s=new RTCPeerConnection(t,i);this.pcs.set(e,s),this.pcPromises.has(e)&&(this.pcPromises.get(e).forEach((function(e){e.resolve(e)})),this.pcPromises.set(e,[]));let a={type:"proxy",pcId:e};return this.gatherPeerConnectionState(a,s),a}case a.PC_GET_CONFIGURATION:{let[e]=n;return(await this.getPeerConnection(e)).getConfiguration()}case a.CREATE_WORKER:{let[e,t,r,i]=n,s=g(r),a=new Blob([s],{type:t}),o=URL.createObjectURL(a),d=new Worker(o,i);return this.workers.set(e,d),this.workerPromises.has(e)&&(this.workerPromises.get(e).forEach((function(e){e.resolve(d)})),this.workerPromises.set(e,[])),{type:"proxy",id:e}}case a.WORKER_TERMINATE:{let[e]=n;return this.workers.has(e)&&(this.workers.get(e).terminate(),this.workerPromises.has(e)&&this.workerPromises.get(e).forEach((function(e){e.reject(null)})),this.workerPromises.delete(e),this.workers.delete(e)),{}}case a.WORKER_POST_MESSAGE:{let[e,t,i]=n,s=await this.getWorker(e);return this.logger.debug("Message before traversing: ",JSON.stringify(t)),this.traverse(t,(function(e,t,n){"proxy"===n.type&&n.id&&(e[t]=r.findProxySubject(n.id))})),this.logger.debug("Message after traversing: ",t),this.logger.debug("Options before traversing: ",JSON.stringify(i)),this.traverse(i,(function(e,t,n){"proxy"===n.type&&n.id&&(e[t]=r.findProxySubject(n.id))})),this.logger.debug("Options after traversing: ",i),s.postMessage(t,i),{type:"proxy",id:e}}case a.NEW_AUDIO_CONTEXT:{let[e,t]=n,r=new AudioContext;return this.audioContexts.set(e,r),this.audioNodes.set(t,r.destination),{type:"proxy",id:e,baseLatency:r.baseLatency,currentTime:r.currentTime,outputLatency:r.outputLatency,sampleRate:r.sampleRate,sinkId:r.sinkId,state:r.state}}case a.AUDIO_CTX_CREATE_AUDIO_NODE:{let[e,t,i,s]=n;if(this.audioContexts.has(e)){let n=this.audioContexts.get(e),a=n["create"+i];s=s.map((function(e){return"proxy"===e.type?r.findProxySubject(e.id):e}));let o=a.apply(n,s);this.audioNodes.set(t,o);let d=null;if(o.stream){let e=o.stream.getTracks().map((function(e){return r.makeTrackTO(e,t)}));d=this.makeStreamTO(o.stream,t),d.tracks=e}return{id:t,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs,numberOfOutputs:o.numberOfOutputs,fftSize:o.fftSize,frequencyBinCount:o.frequencyBinCount,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant,stream:d}}return{}}case a.AUDIO_CTX_CLOSE:{let[e]=n;if(this.audioContexts.has(e)){this.audioContexts.get(e).close(),this.audioContexts.delete(e)}return{}}case a.AUDIO_NODE_CONNECT:{let[e,t,r,i]=n,s=this.audioNodes.get(e),a=this.findProxySubject(t.id);return s&&a&&s.connect(a,r||0,i||0),{}}case a.AUDIO_NODE_DISCONNECT:{let[e,t,r,i]=n,s=this.audioNodes.get(e),a=this.findProxySubject(t.id);return s&&a&&s.disconnect(a,r||0,i||0),{}}case a.AUDIO_NODE_SET_TYPE:{let[e,t]=n;if(this.audioNodes.has(e)){this.audioNodes.get(e).type=t}return{}}case a.AUDIO_NODE_START:{let[e,t]=n;if(this.audioNodes.has(e)){this.audioNodes.get(e).start(t)}return{}}case a.AUDIO_NODE_STOP:{let[e,t]=n;if(this.audioNodes.has(e)){this.audioNodes.get(e).stop(t)}return{}}case a.AUDIO_PARAM_SET_VALUE_AT_TIME:{let[e,t,r]=n;if(this.audioNodes.has(e)){let n=this.audioNodes.get(e);n.gain?n.gain.setValueAtTime(t,r||n.context.currentTime):n.frequency&&n.frequency.setValueAtTime(t,r||n.context.currentTime)}return{}}case a.AUDIO_PARAM_SET_RAMP_TO_VALUE_AT_TIME:{let[e,t,r]=n;if(this.audioNodes.has(e)){let n=this.audioNodes.get(e);n.frequency&&n.frequency.linearRampToValueAtTime(t,r||n.context.currentTime)}return{}}case a.GET_RECEIVERS_API_NAME:{let[e]=n;return{pcId:e,receivers:(await this.getPeerConnection(e)).getReceivers().map((function(e){return r.makeReceiverTO(e)}))}}case a.GET_SENDERS_API_NAME:{let[e]=n;return{pcId:e,senders:(await this.getPeerConnection(e)).getSenders().map((function(e){return r.makeSenderTO(e)}))}}case a.INSERT_DTMF_API_NAME:{let[e,t,r,i]=n,s=this.dtmfSenders.get(e);return s&&s.insertDTMF(t,r,i),{}}case a.GET_TRANSCEIVERS_API_NAME:{let[e]=n,t=(await this.getPeerConnection(e)).getTransceivers();return t=t.map((function(e){return e.id=e.id?e.id:crypto.randomUUID(),r.makeTransceiverTO(e)})),{pcId:e,transceivers:t}}case a.TRANSCEIVER_SET_CODEC_PREFS:return{};case a.ADD_TRACK_API_NAME:{let[e,t,i,...s]=n,a=await this.getPeerConnection(t),o=[];s.forEach((function(e){const t=r.streams.get(e.proxy.id);t&&o.push(t)}));let d=this.tracks.get(i.id);if(d){let n=[d,...o],i=a.addTrack.apply(a,n);i.id=e;let s=this.makeSenderTO(i);return s.pcId=t,s.senders=a.getSenders().map((function(e){return r.makeSenderTO(e)})),s.receivers=a.getReceivers().map((function(e){return r.makeReceiverTO(e)})),s.transceivers=a.getTransceivers().map((function(e){return r.makeTransceiverTO(e)})),s}return{}}case a.ADD_TRANSCEIVER_API_NAME:{let[e,t,i,s]=n,a=await this.getPeerConnection(e);if("string"!=typeof i&&(i=this.tracks.get(i.id)),s&&s.streams){let e=[];s.streams.forEach((function(t){if(t.proxy){let n=r.streams.get(t.proxy.id);e.push(n)}})),s.streams=e}let o=a.addTransceiver(i,s);o.id=t.id,this.transceivers.set(t.id,o),o.sender&&(o.sender.id=t.sender.id,this.senders.set(t.sender.id,o.sender)),o.receiver&&(o.receiver.id=t.receiver.id,this.receivers.set(t.receiver.id,o.receiver));let d=this.makeTransceiverTO(o);return d.pcId=e,d.senders=a.getSenders().map((function(e){return r.makeSenderTO(e)})),d.receivers=a.getReceivers().map((function(e){return r.makeReceiverTO(e)})),d.transceivers=a.getTransceivers().map((function(e){return r.makeTransceiverTO(e)})),d}case a.PC_CLOSE_API_NAME:{let[e]=n;return this.closePeerConnection(e),{}}case a.ADDSTREAM_API_NAME:{let[e,t]=n,r=this.streams.get(t.id);return(await this.getPeerConnection(e)).addStream(r),t}case a.GET_STATS_API_NAME:{let[e,t]=n,r=await this.getPeerConnection(e),i=await r.getStats(t),s=[];return i.forEach((function(e){let t=Object.assign({},e);s.push(t)})),s}case a.GET_SENDER_STATS_API_NAME:{let[e]=n;if(this.senders.has(e)){let t=await this.senders.get(e).getStats(),n=[];return t.forEach((function(e){let t=Object.assign({},e);n.push(t)})),n}return[]}case a.GET_RECEIVER_STATS_API_NAME:{let[e]=n;if(this.receivers.has(e)){let t=await this.receivers.get(e).getStats(),n=[];return t.forEach((function(e){let t={id:e.id?e.id:crypto.randomUUID(),type:e.type,concealedSamples:e.concealedSamples};n.push(t)})),n}return{}}case a.REPLACE_SENDER_TRACK_API_NAME:{let[e,t]=n,r=this.senders.get(e),i=t?this.tracks.get(t.id):null;return i&&r&&await r.replaceTrack(i),{}}case a.PC_REMOVE_TRACK_API_NAME:{let[e,t]=n,r=await this.getPeerConnection(e),i=this.senders.get(t.id);return i&&r.removeTrack(i),{}}case a.CREATE_OFFER_API_NAME:{let[e,r]=n,i=await this.getPeerConnection(e),s=await i.createOffer(r);return this.offers.set(t,s),{id:t,type:s.type,sdp:s.sdp}}case a.CREATE_ANSWER_API_NAME:{let[e,r]=n,i=await this.getPeerConnection(e),s=await i.createAnswer(r);return this.answers.set(t,s),{id:t,type:s.type,sdp:s.sdp}}case a.SET_LOCAL_DESCRIPTION_API_NAME:{let[e,t]=n,r="offer"===t.type?this.offers:this.answers,i=t.id?r.get(t.id):t;if(i){i.sdp=t.sdp;let n=await this.getPeerConnection(e);return await n.setLocalDescription(i),t}return{}}case a.SET_REMOTE_DESCRIPTION_API_NAME:{let[e,t]=n,r=await this.getPeerConnection(e);return await r.setRemoteDescription(t),t}case a.ADD_ICE_CANDIDATE_API_NAME:{let[e,t]=n,r=t?new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate}):null;return(await this.getPeerConnection(e)).addIceCandidate(r),t}case a.ADD_PC_EVENT_LISTENER:{let[e,i]=n,s=await this.getPeerConnection(e);if(s.pendingEvents||(s.pendingEvents=new Map),s.eventPromises||(s.eventPromises=new Map),s.pendingEvents.has(i)){let e=await this.getPendingEvent(s,i);this.sendEvent(a.ADD_PC_EVENT_LISTENER,t,e)}else if(!s[i]){const n=function(n){let i=null;if(n.type===o.ICE_CANDIDATE){r.logger.debug("event: ",n);let t=n.candidate,a=null;t&&(a={sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate,type:t.type,foundation:t.foundation,protocol:t.protocol,address:t.address,port:t.port,priority:t.priority,url:t.url,relayProtocol:t.relayProtocol,component:t.compoonent,relatedAddress:t.relatedAddress,relatedPort:t.relatedPort,tcpType:t.tcpType,usernameFragment:t.usernameFragment}),i={pcId:e,eventName:n.type,type:"proxy",candidate:a},r.gatherPeerConnectionState(i,s)}else n.type===o.SIG_STATE_CHANGE?(i={pcId:e,eventName:n.type,type:"proxy"},r.gatherPeerConnectionState(i,s)):n.type===o.TRACK?(i={pcId:e,eventName:n.type,type:"proxy",streams:[],senders:[],receivers:[],track:r.makeTrackTO(n.track)},i.streams=n.streams.map((function(e){return r.makeStreamTO(e)})),r.gatherPeerConnectionState(i,s)):n.type===o.CONN_STATE_CHANGE||n.type===o.ICE_CONN_STATE_CHANGE||n.type===o.ICE_GATHER_STATE_CHANGE||n.type===o.NEGOTIATION_NEEDED?(i={pcId:e,eventName:n.type,type:"proxy"},r.gatherPeerConnectionState(i,s)):r.logger.warn(`Ignored event, type: ${n.type}, event: ${JSON.stringify(n)}`);i&&r.processPendingEvents(s,n,i,a.ADD_PC_EVENT_LISTENER,t)};s[i]=n,s.addEventListener(i,n)}return null}case a.ADD_TRACK_EVENT_LISTENER:{let[e,i,s]=n,o=this.tracks.get(e);if(o){if(o.pendingEvents||(o.pendingEvents=new Map),o.eventPromises||(o.eventPromises=new Map),o.pendingEvents.has(i)){let e=await this.getPendingEvent(o,i);this.sendEvent(a.ADD_TRACK_EVENT_LISTENER,t,e)}else if(!o[i]){const n=function(n){if(Object.values(d).includes(i)){let i={trackId:e,eventName:n.type,type:"proxy"};i&&r.processPendingEvents(o,n,i,a.ADD_TRACK_EVENT_LISTENER,t)}else r.logger.warn(`Ignored event: ${JSON.stringify(n)}`)};o[i]=n,o.addEventListener(i,n,s)}return null}return{}}case a.ADD_WORKER_EVENT_LISTENER:{let[e,i]=n,s=await this.getWorker(e);if(s.pendingEvents||(s.pendingEvents=new Map),s.eventPromises||(s.eventPromises=new Map),s.pendingEvents.has(i)){let e=await this.getPendingEvent(s,i);this.sendEvent(a.ADD_WORKER_EVENT_LISTENER,t,e)}else if(!s[i]){const n=function(n){if(r.logger.debug("Received event: ",n),Object.values(l).includes(i)){let i={wId:e,eventName:n.type,type:"proxy",data:n.data};i&&r.processPendingEvents(s,n,i,a.ADD_WORKER_EVENT_LISTENER,t)}else r.logger.warn(`Ignored event: ${JSON.stringify(n)}`,n)};s[i]=n,s.addEventListener(i,n)}return null}case a.ADD_DTMF_EVENT_LISTENER:{let[e,i,s]=n,o=this.dtmfSenders.get(e);if(o.pendingEvents||(o.pendingEvents=new Map),o.eventPromises||(o.eventPromises=new Map),o.pendingEvents.has(i)){let e=await this.getPendingEvent(o,i);this.sendEvent(a.ADD_DTMF_EVENT_LISTENER,t,e)}else if(!o[i]){const n=function(n){if(Object.values(c).includes(i)){let i={dtmfId:e,eventName:n.type,type:n.type,tone:n.tone};r.processPendingEvents(o,n,i,a.ADD_DTMF_EVENT_LISTENER,t)}else r.logger.warn(`Ignored event: ${JSON.stringify(n)}`)};o[i]=n,o.addEventListener(i,n,s)}return null}case a.CREATE_MEDIA_ELEMENT_API_NAME:{let[e,t]=n;if("audio"!==t.kind&&"video"!==t.kind)return this.logger.warn(`Invalid media type: ${JSON.stringify(t)}`),null;let r=document.createElement(t.kind);return Object.assign(r,t),document.body.appendChild(r),this.mediaElements.set(e,r),{id:e,sinkId:r.sinkId}}case a.MEDIA_ELEMENT_SET_SINK_ID_API_NAME:{let[e,t]=n,r=this.mediaElements.get(e);if(r){return await r.setSinkId(t),{id:e,sinkId:r.sinkId}}return{}}case a.SET_MEDIA_SRC_OBJ_API_NAME:{let[e,t]=n,r=t?this.getStream(t.id):null;return this.mediaElements.has(e)&&(this.mediaElements.get(e).srcObject=r),{}}case a.MEDIA_ELEMENT_MUTED:{let[e,t]=n;return this.mediaElements.has(e)&&(this.mediaElements.get(e).muted=t),{id:e,muted:t}}case a.SET_MEDIA_HIDDEN_API_NAME:{let[e,t]=n,r=this.mediaElements.get(e);return r&&(r.hidden=t),{}}case a.SET_MEDIA_VOLUME_API_NAME:{let[e,t]=n;return this.mediaElements.has(e)&&(this.mediaElements.get(e).volume=t),{}}case a.MEDIA_ELEMENT_PLAY_API_NAME:{let[e]=n;return this.mediaElements.has(e)&&this.mediaElements.get(e).play(),{}}case a.MEDIA_ELEMENT_PAUSE_API_NAME:{let[e]=n;return this.mediaElements.has(e)&&this.mediaElements.get(e).pause(),{}}case a.MEDIA_ELEMENT_REMOVE:{let[e]=n;return this.mediaElements.has(e)&&(this.mediaElements.get(e).remove(),this.mediaElements.delete(e)),{}}case a.TOGGLE_TRACK_ENABLED_API_NAME:{let[e,t]=n,r=this.tracks.get(e);return r?(r.enabled=t,this.makeTrackTO(r)):{}}case a.TRACK_STOP_API_NAME:{let[e]=n,t=this.tracks.get(e);return t&&(t.stop(),this.tracks.delete(e)),{}}case a.TRACK_GET_SETTINGS:{let[e]=n,t=this.tracks.get(e);return t?t.getSettings():{}}case a.SENDER_CREATE_ENCODED_STREAMS:{let[e,t]=n;if(this.senders.has(e)){let n=this.senders.get(e).createEncodedStreams();return this.streams.set(t.id,n),this.streams.set(t.readable.id,n.readable),this.streams.set(t.writable.id,n.writable),t}return{}}case a.RECEIVER_CREATE_ENCODED_STREAMS:{let[e,t]=n;if(this.receivers.has(e)){let n=this.receivers.get(e).createEncodedStreams();return this.streams.set(t.id,n),this.streams.set(t.readable.id,n.readable),this.streams.set(t.writable.id,n.writable),t}return{}}case a.UNLOAD_EVENT_NAME:{let[e]=n;return e.pcIds.forEach((function(e){r.closePeerConnection(e)})),e.streamIds.forEach((function(e){let t=r.streams.get(e);t&&("function"==typeof t.getTracks&&t.getTracks().forEach((function(e){e.stop()})),r.streams.delete(e))})),e.trackIds.forEach((function(e){r.tracks.delete(e)})),e.workerIds.forEach((function(e){let t=r.workers.get(e);t&&t.terminate(),r.workers.delete(e)})),e.mediaElementIds.forEach((function(e){let t=r.mediaElements.get(e);t&&(t.remove(),r.mediaElements.delete(e))})),e.transceiverIds.forEach((function(e){r.transceivers.delete(e)})),e.senderIds.forEach((function(e){r.senders.delete(e)})),e.receiverIds.forEach((function(e){r.receivers.delete(e)})),{}}default:return null}}sendMessage(e){this.logger.debug(`Sending message: ${JSON.stringify(e)}`);let t=e.message,n=A.deflateRaw(JSON.stringify(t));e.message=n;let r=(new TextEncoder).encode(JSON.stringify(e)),i=r.byteLength,s=new Uint8Array([i,i>>8,i>>16,i>>24]);this.channel.sendMessage(s),this.channel.sendMessage(r)}sendEvent(e,t,n){let r={requestId:t,type:"event",message:{api:e,event:n}};this.sendMessage(r)}sendResponse(e,t,n){let r={requestId:t,type:"response",message:{api:e,response:n}};this.sendMessage(r)}sendError(e,t,n){let r={requestId:t,type:"error",message:{api:e,error:n}};this.sendMessage(r)}async handleWebRTCApi(e){try{let t=await this.callWebRTCApi(e.message.api,e.requestId,e.message.args);t&&this.sendResponse(e.message.api,e.requestId,t)}catch(t){this.logger.error(`Error handling WebRTC API: ${JSON.stringify(e)}, message: ${t.message?t.message:"(no message)"}, error: ${JSON.stringify(t)}`),this.logger.trace(t),this.sendError(e.message.api,e.requestId,{name:t.name,message:t.message})}}processPendingEvents(e,t,n,r,i){if(e.pendingEvents.has(t.type)){e.pendingEvents.get(t.type).push(n);let r=e.eventPromises.get(t.type);r&&r.forEach((function(e){e.resolve(n)}))}else this.sendEvent(r,i,n),e.pendingEvents.set(t.type,[])}handleMessage(e){let t=e.message,n=A.inflateRaw(t),r=this.decoder.decode(n);e.message=JSON.parse(r),e.message.api&&e.requestId&&e.message.args?this.handleWebRTCApi(e):(this.logger.error(`Invalid message format: ${JSON.stringify(e)}`),this.logger.trace(e))}onClose(e){this.logger.info(`WebRTC redir custom channel closed: ${JSON.stringify(e)}"`),this.release()}release(){var e=this;this.streams.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),this.mediaElements.forEach((function(e){e.remove()})),this.pcs.forEach((function(t,n){e.closePeerConnection(n)})),this.certs.clear()}}}));